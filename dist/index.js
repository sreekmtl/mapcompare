/*! For license information please see index.js.LICENSE.txt */
(()=>{var __webpack_modules__={8874:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},1788:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(8081),r=i.n(n),s=i(3645),o=i.n(s)()(r());o.push([t.id,':root,\n:host {\n  --ol-background-color: white;\n  --ol-accent-background-color: #F5F5F5;\n  --ol-subtle-background-color: rgba(128, 128, 128, 0.25);\n  --ol-partial-background-color: rgba(255, 255, 255, 0.75);\n  --ol-foreground-color: #333333;\n  --ol-subtle-foreground-color: #666666;\n  --ol-brand-color: #00AAFF;\n}\n\n.ol-box {\n  box-sizing: border-box;\n  border-radius: 2px;\n  border: 1.5px solid var(--ol-background-color);\n  background-color: var(--ol-partial-background-color);\n}\n\n.ol-mouse-position {\n  top: 8px;\n  right: 8px;\n  position: absolute;\n}\n\n.ol-scale-line {\n  background: var(--ol-partial-background-color);\n  border-radius: 4px;\n  bottom: 8px;\n  left: 8px;\n  padding: 2px;\n  position: absolute;\n}\n\n.ol-scale-line-inner {\n  border: 1px solid var(--ol-subtle-foreground-color);\n  border-top: none;\n  color: var(--ol-foreground-color);\n  font-size: 10px;\n  text-align: center;\n  margin: 1px;\n  will-change: contents, width;\n  transition: all 0.25s;\n}\n\n.ol-scale-bar {\n  position: absolute;\n  bottom: 8px;\n  left: 8px;\n}\n\n.ol-scale-bar-inner {\n  display: flex;\n}\n\n.ol-scale-step-marker {\n  width: 1px;\n  height: 15px;\n  background-color: var(--ol-foreground-color);\n  float: right;\n  z-index: 10;\n}\n\n.ol-scale-step-text {\n  position: absolute;\n  bottom: -5px;\n  font-size: 10px;\n  z-index: 11;\n  color: var(--ol-foreground-color);\n  text-shadow: -1.5px 0 var(--ol-partial-background-color), 0 1.5px var(--ol-partial-background-color), 1.5px 0 var(--ol-partial-background-color), 0 -1.5px var(--ol-partial-background-color);\n}\n\n.ol-scale-text {\n  position: absolute;\n  font-size: 12px;\n  text-align: center;\n  bottom: 25px;\n  color: var(--ol-foreground-color);\n  text-shadow: -1.5px 0 var(--ol-partial-background-color), 0 1.5px var(--ol-partial-background-color), 1.5px 0 var(--ol-partial-background-color), 0 -1.5px var(--ol-partial-background-color);\n}\n\n.ol-scale-singlebar {\n  position: relative;\n  height: 10px;\n  z-index: 9;\n  box-sizing: border-box;\n  border: 1px solid var(--ol-foreground-color);\n}\n\n.ol-scale-singlebar-even {\n  background-color: var(--ol-subtle-foreground-color);\n}\n\n.ol-scale-singlebar-odd {\n  background-color: var(--ol-background-color);\n}\n\n.ol-unsupported {\n  display: none;\n}\n\n.ol-viewport,\n.ol-unselectable {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n  -webkit-tap-highlight-color: transparent;\n}\n\n.ol-viewport canvas {\n  all: unset;\n  overflow: hidden;\n}\n\n.ol-viewport {\n  touch-action: pan-x pan-y;\n}\n\n.ol-selectable {\n  -webkit-touch-callout: default;\n  -webkit-user-select: text;\n  -moz-user-select: text;\n  user-select: text;\n}\n\n.ol-grabbing {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n\n.ol-grab {\n  cursor: move;\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n}\n\n.ol-control {\n  position: absolute;\n  background-color: var(--ol-subtle-background-color);\n  border-radius: 4px;\n}\n\n.ol-zoom {\n  top: .5em;\n  left: .5em;\n}\n\n.ol-rotate {\n  top: .5em;\n  right: .5em;\n  transition: opacity .25s linear, visibility 0s linear;\n}\n\n.ol-rotate.ol-hidden {\n  opacity: 0;\n  visibility: hidden;\n  transition: opacity .25s linear, visibility 0s linear .25s;\n}\n\n.ol-zoom-extent {\n  top: 4.643em;\n  left: .5em;\n}\n\n.ol-full-screen {\n  right: .5em;\n  top: .5em;\n}\n\n.ol-control button {\n  display: block;\n  margin: 1px;\n  padding: 0;\n  color: var(--ol-subtle-foreground-color);\n  font-weight: bold;\n  text-decoration: none;\n  font-size: inherit;\n  text-align: center;\n  height: 1.375em;\n  width: 1.375em;\n  line-height: .4em;\n  background-color: var(--ol-background-color);\n  border: none;\n  border-radius: 2px;\n}\n\n.ol-control button::-moz-focus-inner {\n  border: none;\n  padding: 0;\n}\n\n.ol-zoom-extent button {\n  line-height: 1.4em;\n}\n\n.ol-compass {\n  display: block;\n  font-weight: normal;\n  will-change: transform;\n}\n\n.ol-touch .ol-control button {\n  font-size: 1.5em;\n}\n\n.ol-touch .ol-zoom-extent {\n  top: 5.5em;\n}\n\n.ol-control button:hover,\n.ol-control button:focus {\n  text-decoration: none;\n  outline: 1px solid var(--ol-subtle-foreground-color);\n  color: var(--ol-foreground-color);\n}\n\n.ol-zoom .ol-zoom-in {\n  border-radius: 2px 2px 0 0;\n}\n\n.ol-zoom .ol-zoom-out {\n  border-radius: 0 0 2px 2px;\n}\n\n.ol-attribution {\n  text-align: right;\n  bottom: .5em;\n  right: .5em;\n  max-width: calc(100% - 1.3em);\n  display: flex;\n  flex-flow: row-reverse;\n  align-items: center;\n}\n\n.ol-attribution a {\n  color: var(--ol-subtle-foreground-color);\n  text-decoration: none;\n}\n\n.ol-attribution ul {\n  margin: 0;\n  padding: 1px .5em;\n  color: var(--ol-foreground-color);\n  text-shadow: 0 0 2px var(--ol-background-color);\n  font-size: 12px;\n}\n\n.ol-attribution li {\n  display: inline;\n  list-style: none;\n}\n\n.ol-attribution li:not(:last-child):after {\n  content: " ";\n}\n\n.ol-attribution img {\n  max-height: 2em;\n  max-width: inherit;\n  vertical-align: middle;\n}\n\n.ol-attribution button {\n  flex-shrink: 0;\n}\n\n.ol-attribution.ol-collapsed ul {\n  display: none;\n}\n\n.ol-attribution:not(.ol-collapsed) {\n  background: var(--ol-partial-background-color);\n}\n\n.ol-attribution.ol-uncollapsible {\n  bottom: 0;\n  right: 0;\n  border-radius: 4px 0 0;\n}\n\n.ol-attribution.ol-uncollapsible img {\n  margin-top: -.2em;\n  max-height: 1.6em;\n}\n\n.ol-attribution.ol-uncollapsible button {\n  display: none;\n}\n\n.ol-zoomslider {\n  top: 4.5em;\n  left: .5em;\n  height: 200px;\n}\n\n.ol-zoomslider button {\n  position: relative;\n  height: 10px;\n}\n\n.ol-touch .ol-zoomslider {\n  top: 5.5em;\n}\n\n.ol-overviewmap {\n  left: 0.5em;\n  bottom: 0.5em;\n}\n\n.ol-overviewmap.ol-uncollapsible {\n  bottom: 0;\n  left: 0;\n  border-radius: 0 4px 0 0;\n}\n\n.ol-overviewmap .ol-overviewmap-map,\n.ol-overviewmap button {\n  display: block;\n}\n\n.ol-overviewmap .ol-overviewmap-map {\n  border: 1px solid var(--ol-subtle-foreground-color);\n  height: 150px;\n  width: 150px;\n}\n\n.ol-overviewmap:not(.ol-collapsed) button {\n  bottom: 0;\n  left: 0;\n  position: absolute;\n}\n\n.ol-overviewmap.ol-collapsed .ol-overviewmap-map,\n.ol-overviewmap.ol-uncollapsible button {\n  display: none;\n}\n\n.ol-overviewmap:not(.ol-collapsed) {\n  background: var(--ol-subtle-background-color);\n}\n\n.ol-overviewmap-box {\n  border: 1.5px dotted var(--ol-subtle-foreground-color);\n}\n\n.ol-overviewmap .ol-overviewmap-box:hover {\n  cursor: move;\n}\n',""]);const a=o},1828:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(8081),r=i.n(n),s=i(3645),o=i.n(s)()(r());o.push([t.id,'* {\n    box-sizing: border-box;\n  }\n.column {\n    float: left;\n    width: 30%;\n    height: 680px; /* Should be removed. Only for demonstration */\n}\n  \n  /* Clear floats after the columns */\n  .row:after {\n    content: "";\n    display: table;\n    clear: both;\n}\n\n\n\np{\n    color: #000000;\n    font-family: monospace;\n    font-size: medium;\n    padding-left: 10px;\n  \n}\n\nh3{\n\n    color: #000000;\n    font-family: monospace;\n    font-size: large;\n    font-weight: bold;\n    padding-left: 10px;\n\n}\n\n\ninput[type="text"] {\n  width:500px;\n  color: #000000;\n  font-family: monospace;\n  font-size: large;\n  padding-left: 20px;\n}\n\nbutton{\n  font-family:monospace;\n  font-size: 12px;\n}\n\nlabel{\n  font-family:monospace;\n}\n\nselect{\n  font-family:monospace;\n}\n\n.article{\n  color: white;\n}',""]);const a=o},3645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",n=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),n&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),n&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,n,r,s){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var h=0;h<t.length;h++){var u=[].concat(t[h]);n&&o[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),e.push(u))}},e}},8081:t=>{"use strict";t.exports=function(t){return t[1]}},7060:(t,e,i)=>{"use strict";const{IOBuffer:n}=i(2155),r=i(5578),s=[];for(let t=0;t<=8;t++)s.push(255<<t);t.exports=class extends n{constructor(t){if(1!==t.bitDepth)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");super(t.data),this.width=t.width,this.height=t.height,this.bitDepth=t.bitDepth,this.channels=t.channels,this.components=t.components}encode(){this.encoded=new n,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const t=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(t),this.encoded.toArray()}writePixelArray(){let t=this.encoded;const e=4*Math.floor((this.bitDepth*this.width+31)/32),i=Math.ceil(this.bitDepth*this.width/8),n=e-i,r=this.bitDepth*this.width%8,o=0===r?0:8-r,a=e*this.height;let l,h,u=0,c=0,d=8;t.mark(),h=this.readUint8();for(let a=this.height-1;a>=0;a--){const f=0===a;t.reset(),t.skip(a*e);for(let e=0;e<i;e++){const a=e===i-1;c<=o&&a?(t.writeByte(h<<c),0!==o&&o!==c||f||(l=h,h=this.readByte())):0===c?(l=h,h=this.readUint8(),t.writeByte(l)):(l=h,h=this.readUint8(),t.writeByte(l<<c&s[c]|h>>d)),a&&(u+=r||0,t.skip(n),c=u%8,d=8-c)}}e>i&&(t.reset(),t.skip(a-1),t.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(t){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(t)}writeBitmapV5Header(){const t=4*Math.floor((this.bitDepth*this.width+31)/32)*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(r.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(t).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(r.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(r.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}},5578:t=>{"use strict";t.exports={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}}},4665:(t,e,i)=>{"use strict";const n=i(7060);e.c=function(t){return new n(t).encode()}},7909:t=>{"use strict";const e=[];t.exports=class{constructor(t,e){e=e||{},void 0===t&&(t=8192),"number"==typeof t&&(t=new ArrayBuffer(t));let i=t.byteLength;const n=e.offset?e.offset>>>0:0;t.buffer&&(i=t.byteLength-n,t=t.byteLength!==t.buffer.byteLength?t.buffer.slice(t.byteOffset+n,t.byteOffset+t.byteLength):n?t.buffer.slice(n):t.buffer),this.buffer=t,this.length=i,this.byteLength=i,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=i||8192,this._mark=0}available(t){return void 0===t&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){void 0===t&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(void 0===t&&(t=1),!this.available(t)){const t=this._increment+this._increment;this._increment=t;const e=this.length+t,i=new Uint8Array(e);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=e,this._data=new DataView(this.buffer)}}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){void 0===t&&(t=1);for(var e=new Uint8Array(t),i=0;i<t;i++)e[i]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){void 0===t&&(t=1),e.length=t;for(var i=0;i<t;i++)e[i]=this.readChar();return e.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}},3311:(t,e,i)=>{"use strict";const n=i(6752);t.exports=function(t,e){return new n(t,e).decode(e)}},8029:(t,e,i)=>{"use strict";const n={standard:i(4263),exif:i(9640),gps:i(5367)};t.exports=class{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if("number"==typeof t)return this.fields.get(t);if("string"==typeof t)return this.fields.get(n[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const e=n[this.kind].tagsById;for(var t of this.fields.keys())e[t]&&(this._map[e[t]]=this.fields.get(t))}return this._map}}},6486:(t,e)=>{"use strict";var i=new Map([[1,[1,n]],[2,[1,function(t,e){for(var i=[],n="",r=0;r<e;r++){var s=String.fromCharCode(t.readUint8());"\0"===s?(i.push(n),n=""):n+=s}return 1===i.length?i[0]:i}]],[3,[2,function(t,e){if(1===e)return t.readUint16();for(var i=new Uint16Array(e),n=0;n<e;n++)i[n]=t.readUint16();return i}]],[4,[4,function(t,e){if(1===e)return t.readUint32();for(var i=new Uint32Array(e),n=0;n<e;n++)i[n]=t.readUint32();return i}]],[5,[8,function(t,e){if(1===e)return t.readUint32()/t.readUint32();for(var i=new Array(e),n=0;n<e;n++)i[n]=t.readUint32()/t.readUint32();return i}]],[6,[1,function(t,e){if(1===e)return t.readInt8();for(var i=new Int8Array(e),n=0;n<e;n++)i[n]=t.readInt8();return i}]],[7,[1,n]],[8,[2,function(t,e){if(1===e)return t.readInt16();for(var i=new Int16Array(e),n=0;n<e;n++)i[n]=t.readInt16();return i}]],[9,[4,function(t,e){if(1===e)return t.readInt32();for(var i=new Int32Array(e),n=0;n<e;n++)i[n]=t.readInt32();return i}]],[10,[8,function(t,e){if(1===e)return t.readInt32()/t.readInt32();for(var i=new Array(e),n=0;n<e;n++)i[n]=t.readInt32()/t.readInt32();return i}]],[11,[4,function(t,e){if(1===e)return t.readFloat32();for(var i=new Float32Array(e),n=0;n<e;n++)i[n]=t.readFloat32();return i}]],[12,[8,function(t,e){if(1===e)return t.readFloat64();for(var i=new Float64Array(e),n=0;n<e;n++)i[n]=t.readFloat64();return i}]]]);function n(t,e){if(1===e)return t.readUint8();for(var i=new Uint8Array(e),n=0;n<e;n++)i[n]=t.readUint8();return i}e.getByteLength=function(t,e){return i.get(t)[0]*e},e.readData=function(t,e,n){return i.get(e)[1](t,n)}},9469:(t,e,i)=>{"use strict";e.decode=i(3311)},9640:t=>{"use strict";const e={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},i={};for(var n in e)i[e[n]]=n;t.exports={tagsById:e,tagsByName:i}},5367:t=>{"use strict";const e={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},i={};for(var n in e)i[e[n]]=n;t.exports={tagsById:e,tagsByName:i}},4263:t=>{"use strict";const e={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},i={};for(var n in e)i[e[n]]=n;t.exports={tagsById:e,tagsByName:i}},6752:(t,e,i)=>{"use strict";const n=i(7909),r=i(8029),s=i(8353),o=i(6486),a={ignoreImageData:!1,onlyFirst:!1};function l(t,e,i,n){for(var r=0;r<n;r++)t[i++]=e.getUint8(r);return i}function h(t,e,i,n,r){for(var s=0;s<2*n;s+=2)t[i++]=e.getUint16(s,r);return i}function u(t,e,i,n,r){for(var s=0;s<4*n;s+=4)t[i++]=e.getFloat32(s,r);return i}function c(t,e){throw new Error("Unsupported "+t+": "+e)}t.exports=class extends n{constructor(t,e){super(t,e),this._nextIFD=0}decode(t){t=Object.assign({},a,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t)),t.onlyFirst)return e[0];return e}decodeHeader(){let t=this.readUint16();if(18761===t)this.setLittleEndian();else{if(19789!==t)throw new Error("invalid byte order: 0x"+t.toString(16));this.setBigEndian()}if(t=this.readUint16(),42!==t)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){var e;this.seek(this._nextIFD),e=t.kind?new r(t.kind):new s;const i=this.readUint16();for(var n=0;n<i;n++)this.decodeIFDEntry(e);return t.ignoreImageData||this.decodeImageData(e),this._nextIFD=this.readUint32(),e}decodeIFDEntry(t){const e=this.offset,i=this.readUint16(),n=this.readUint16(),r=this.readUint32();if(n<1||n>12)return void this.skip(4);o.getByteLength(n,r)>4&&this.seek(this.readUint32());const s=o.readData(this,n,r);if(t.fields.set(i,s),34665===i||34853===i){let e,n=this.offset;34665===i?e="exif":34853===i&&(e="gps"),this._nextIFD=s,t[e]=this.decodeIFD({kind:e,ignoreImageData:!0}),this.offset=n}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;switch(e&&1!==e&&c("orientation",e),t.type){case 1:case 2:this.readStripData(t);break;default:c("image type",t.type)}}readStripData(t){const e=t.width,i=t.height,n=function(t){if(t.length){const i=t;t=i[0];for(var e=0;e<i.length;e++)i[e]!==t&&c("bit depth",i)}return t}(t.bitsPerSample),r=t.sampleFormat;let s=e*i;const o=function(t,e,i,n){return 8===i?new Uint8Array(1*t):16===i?new Uint16Array(1*t):32===i&&3===n?new Float32Array(1*t):c("bit depth / sample format",i+" / "+n)}(s,0,n,r),a=t.compression,d=t.rowsPerStrip*e,f=t.stripOffsets,g=t.stripByteCounts;for(var p=0,m=0;m<f.length;m++){var _=this.getStripData(a,f[m],g[m]),w=s>d?d:s;s-=w,8===n?p=l(o,_,p,w):16===n?p=h(o,_,p,w,this.isLittleEndian()):32===n&&3===r?p=u(o,_,p,w,this.isLittleEndian()):c("bitDepth",n)}t.data=o}getStripData(t,e,i){switch(t){case 1:return new DataView(this.buffer,e,i);case 2:case 32773:return c("Compression",t);default:throw new Error("invalid compression: "+t)}}}},8353:(t,e,i)=>{"use strict";const n=i(8029),r=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;function s(t){return"number"==typeof t?[t]:t}t.exports=class extends n{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,e=r.exec(this.dateTime);return t.setFullYear(e[1],e[2]-1,e[3]),t.setHours(e[4],e[5],e[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return s(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return s(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}},9698:(t,e,i)=>{"use strict";const n=i(7909),r=i(9469);t.exports=function(t){const e=new n(t),i={};if(e.setBigEndian(),65496!==e.readUint16())throw new Error("SOI marker not found. Not a valid JPEG file");if(65505===e.readUint16()){e.readUint16();const t=e.readBytes(6);if(69===t[0]&&120===t[1]&&105===t[2]&&102===t[3]&&0===t[4]&&0===t[5]){const t=r.decode(e,{onlyFirst:!0,ignoreImageData:!0,offset:e.offset});i.exif=t}}return i}},9464:(t,e,i)=>{"use strict";e.decode=i(9698)},8737:t=>{!function(){function e(t,e,i){this.next=i,i&&(i.prev=this),this.prev=e,e&&(e.next=this),this.data=t}function i(){if(!(this instanceof i))return new i;this._head=null,this._tail=null,this.length=0}i.prototype={push:function(t){this._tail=new e(t,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var t=this._tail;return this._tail=t.prev,t.prev&&(t.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),t.data}},unshift:function(t){this._head=new e(t,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var t=this._head;return this._head=t.next,t.next&&(t.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),t.data}},item:function(t){t<0&&(t=this.length+t);for(var e=this._head;t-- >0&&e;)e=e.next;return e?e.data:void 0},slice:function(t,e){if(t||(t=0),e||(e=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e===t)return[];if(e<t)throw new Error("invalid offset: "+t+","+e+" (length="+this.length+")");for(var i=e-t,n=new Array(i),r=0,s=this._head;t-- >0&&s;)s=s.next;for(;r<i&&s;)n[r++]=s.data,s=s.next;return n},drop:function(){i.call(this)},forEach:function(t,e){for(var i=this._head,n=0,r=this.length;n<r&&i;)t.call(e||this,i.data,n,this),i=i.next,n++},map:function(t,e){var n=new i;return this.forEach((function(i,r,s){n.push(t.call(e||s,i,r,s))})),n},filter:function(t,e){var n=new i;return this.forEach((function(i,r,s){t.call(e||s,i,r,s)&&n.push(i)})),n},reduce:function(t,e,i){var n=0,r=this._head,s=this.length;for(e||(n=1,e=r&&r.data,r=r&&r.next);n<s&&r;)e=t.call(i||this,e,r.data,this),n++,r=r.next;return e}},t.exports=i}()},9645:t=>{"use strict";function e(t){if(this.size=0|t,this.size<=1||0!=(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var e=new Array(2*this.size),i=0;i<e.length;i+=2){const t=Math.PI*i/this.size;e[i]=Math.cos(t),e[i+1]=-Math.sin(t)}this.table=e;for(var n=0,r=1;this.size>r;r<<=1)n++;this._width=n%2==0?n-1:n,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var o=0;o<this._width;o+=2){var a=this._width-o-2;this._bitrev[s]|=(s>>>o&3)<<a}}this._out=null,this._data=null,this._inv=0}t.exports=e,e.prototype.fromComplexArray=function(t,e){for(var i=e||new Array(t.length>>>1),n=0;n<t.length;n+=2)i[n>>>1]=t[n];return i},e.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t},e.prototype.toComplexArray=function(t,e){for(var i=e||this.createComplexArray(),n=0;n<i.length;n+=2)i[n]=t[n>>>1],i[n+1]=0;return i},e.prototype.completeSpectrum=function(t){for(var e=this._csize,i=e>>>1,n=2;n<i;n+=2)t[e-n]=t[n],t[e-n+1]=-t[n+1]},e.prototype.transform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null},e.prototype.realTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null},e.prototype.inverseTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var i=0;i<t.length;i++)t[i]/=this.size;this._out=null,this._data=null},e.prototype._transform4=function(){var t,e,i=this._out,n=this._csize,r=1<<this._width,s=n/r<<1,o=this._bitrev;if(4===s)for(t=0,e=0;t<n;t+=s,e++){const i=o[e];this._singleTransform2(t,i,r)}else for(t=0,e=0;t<n;t+=s,e++){const i=o[e];this._singleTransform4(t,i,r)}var a=this._inv?-1:1,l=this.table;for(r>>=2;r>=2;r>>=2){var h=(s=n/r<<1)>>>2;for(t=0;t<n;t+=s)for(var u=t+h,c=t,d=0;c<u;c+=2,d+=r){const t=c,e=t+h,n=e+h,r=n+h,s=i[t],o=i[t+1],u=i[e],f=i[e+1],g=i[n],p=i[n+1],m=i[r],_=i[r+1],w=s,y=o,v=l[d],b=a*l[d+1],x=u*v-f*b,M=u*b+f*v,k=l[2*d],S=a*l[2*d+1],E=g*k-p*S,C=g*S+p*k,I=l[3*d],A=a*l[3*d+1],T=m*I-_*A,R=m*A+_*I,P=w+E,D=y+C,F=w-E,L=y-C,O=x+T,z=M+R,N=a*(x-T),B=a*(M-R),U=P+O,G=D+z,X=P-O,Y=D-z,V=F+B,j=L-N,q=F-B,W=L+N;i[t]=U,i[t+1]=G,i[e]=V,i[e+1]=j,i[n]=X,i[n+1]=Y,i[r]=q,i[r+1]=W}}},e.prototype._singleTransform2=function(t,e,i){const n=this._out,r=this._data,s=r[e],o=r[e+1],a=r[e+i],l=r[e+i+1],h=s+a,u=o+l,c=s-a,d=o-l;n[t]=h,n[t+1]=u,n[t+2]=c,n[t+3]=d},e.prototype._singleTransform4=function(t,e,i){const n=this._out,r=this._data,s=this._inv?-1:1,o=2*i,a=3*i,l=r[e],h=r[e+1],u=r[e+i],c=r[e+i+1],d=r[e+o],f=r[e+o+1],g=r[e+a],p=r[e+a+1],m=l+d,_=h+f,w=l-d,y=h-f,v=u+g,b=c+p,x=s*(u-g),M=s*(c-p),k=m+v,S=_+b,E=w+M,C=y-x,I=m-v,A=_-b,T=w-M,R=y+x;n[t]=k,n[t+1]=S,n[t+2]=E,n[t+3]=C,n[t+4]=I,n[t+5]=A,n[t+6]=T,n[t+7]=R},e.prototype._realTransform4=function(){var t,e,i=this._out,n=this._csize,r=1<<this._width,s=n/r<<1,o=this._bitrev;if(4===s)for(t=0,e=0;t<n;t+=s,e++){const i=o[e];this._singleRealTransform2(t,i>>>1,r>>>1)}else for(t=0,e=0;t<n;t+=s,e++){const i=o[e];this._singleRealTransform4(t,i>>>1,r>>>1)}var a=this._inv?-1:1,l=this.table;for(r>>=2;r>=2;r>>=2){var h=(s=n/r<<1)>>>1,u=h>>>1,c=u>>>1;for(t=0;t<n;t+=s)for(var d=0,f=0;d<=c;d+=2,f+=r){var g=t+d,p=g+u,m=p+u,_=m+u,w=i[g],y=i[g+1],v=i[p],b=i[p+1],x=i[m],M=i[m+1],k=i[_],S=i[_+1],E=w,C=y,I=l[f],A=a*l[f+1],T=v*I-b*A,R=v*A+b*I,P=l[2*f],D=a*l[2*f+1],F=x*P-M*D,L=x*D+M*P,O=l[3*f],z=a*l[3*f+1],N=k*O-S*z,B=k*z+S*O,U=E+F,G=C+L,X=E-F,Y=C-L,V=T+N,j=R+B,q=a*(T-N),W=a*(R-B),$=U+V,Z=G+j,H=X+W,K=Y-q;if(i[g]=$,i[g+1]=Z,i[p]=H,i[p+1]=K,0!==d){if(d!==c){var J=X+-a*W,Q=-a*q-Y,tt=U+-a*V,et=-G- -a*j,it=t+u-d,nt=t+h-d;i[it]=J,i[it+1]=Q,i[nt]=tt,i[nt+1]=et}}else{var rt=U-V,st=G-j;i[m]=rt,i[m+1]=st}}}},e.prototype._singleRealTransform2=function(t,e,i){const n=this._out,r=this._data,s=r[e],o=r[e+i],a=s+o,l=s-o;n[t]=a,n[t+1]=0,n[t+2]=l,n[t+3]=0},e.prototype._singleRealTransform4=function(t,e,i){const n=this._out,r=this._data,s=this._inv?-1:1,o=2*i,a=3*i,l=r[e],h=r[e+i],u=r[e+o],c=r[e+a],d=l+u,f=l-u,g=h+c,p=s*(h-c),m=d+g,_=f,w=-p,y=d-g,v=f,b=p;n[t]=m,n[t+1]=0,n[t+2]=_,n[t+3]=w,n[t+4]=y,n[t+5]=0,n[t+6]=v,n[t+7]=b}},7769:module=>{"use strict";const toBytes=t=>[...t].map((t=>t.charCodeAt(0))),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(t,e=0){let i=t[e],n=1,r=0;for(;++r<8;)n*=256,i+=t[e+r]*n;return i}const fileType=t=>{if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof t}\``);const e=t instanceof Uint8Array?t:new Uint8Array(t);if(!(e&&e.length>1))return null;const i=(t,i)=>{i=Object.assign({offset:0},i);for(let n=0;n<t.length;n++)if(i.mask){if(t[n]!==(i.mask[n]&e[n+i.offset]))return!1}else if(t[n]!==e[n+i.offset])return!1;return!0},n=(t,e)=>i(toBytes(t),e);if(i([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(i([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(i([71,73,70]))return{ext:"gif",mime:"image/gif"};if(i([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(i([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((i([73,73,42,0])||i([77,77,0,42]))&&i([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(i([73,73,42,0])||i([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(i([66,77]))return{ext:"bmp",mime:"image/bmp"};if(i([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(i([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(i([80,75,3,4])){if(i([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(i(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const t=(t,e=0)=>t.findIndex(((t,i,n)=>i>=e&&80===n[i]&&75===n[i+1]&&3===n[i+2]&&4===n[i+3]));let r=0,s=!1,o=null;do{const a=r+30;if(s||(s=i(oxmlContentTypes,{offset:a})||i(oxmlRels,{offset:a})),o||(n("word/",{offset:a})?o={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:a})?o={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:a})&&(o={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),s&&o)return o;r=t(e,a)}while(r>=0);if(o)return o}if(i([80,75])&&(3===e[2]||5===e[2]||7===e[2])&&(4===e[3]||6===e[3]||8===e[3]))return{ext:"zip",mime:"application/zip"};if(i([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(i([82,97,114,33,26,7])&&(0===e[6]||1===e[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(i([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(i([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(i([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(i([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(i([51,103,112,53])||i([0,0,0])&&i([102,116,121,112],{offset:4})&&(i([109,112,52,49],{offset:8})||i([109,112,52,50],{offset:8})||i([105,115,111,109],{offset:8})||i([105,115,111,50],{offset:8})||i([109,109,112,52],{offset:8})||i([77,52,86],{offset:8})||i([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(i([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(i([26,69,223,163])){const t=e.subarray(4,4100),i=t.findIndex(((t,e,i)=>66===i[e]&&130===i[e+1]));if(-1!==i){const e=i+3,n=i=>[...i].every(((i,n)=>t[e+n]===i.charCodeAt(0)));if(n("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(n("webm"))return{ext:"webm",mime:"video/webm"}}}if(i([0,0,0,20,102,116,121,112,113,116,32,32])||i([102,114,101,101],{offset:4})||i([102,116,121,112,113,116,32,32],{offset:4})||i([109,100,97,116],{offset:4})||i([109,111,111,118],{offset:4})||i([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(i([82,73,70,70])){if(i([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(i([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(i([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(i([48,38,178,117,142,102,207,17,166,217])){let t=30;do{const n=readUInt64LE(e,t+16);if(i([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:t})){if(i([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:t+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(i([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:t+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}t+=n}while(t+24<=e.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(i([0,0,1,186])||i([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(i([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let t=0;t<2&&t<e.length-16;t++){if(i([73,68,51],{offset:t})||i([255,226],{offset:t,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(i([255,228],{offset:t,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(i([255,248],{offset:t,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(i([255,240],{offset:t,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(i([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(i([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(i([79,103,103,83]))return i([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:i([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:i([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:i([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:i([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(i([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(i([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(i([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(i([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(i([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(i([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((67===e[0]||70===e[0])&&i([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(i([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(i([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(i([119,79,70,70])&&(i([0,1,0,0],{offset:4})||i([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(i([119,79,70,50])&&(i([0,1,0,0],{offset:4})||i([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(i([76,80],{offset:34})&&(i([0,0,1],{offset:8})||i([1,0,2],{offset:8})||i([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(i([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(i([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(i([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(i([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(i([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(i([37,33]))return{ext:"ps",mime:"application/postscript"};if(i([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(i([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(i([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(i([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(i([77,83,67,70])||i([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(i([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(i([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(i([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(i([31,160])||i([31,157]))return{ext:"Z",mime:"application/x-compress"};if(i([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(i([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(i([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(i([71],{offset:4})&&(i([71],{offset:192})||i([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(i([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(i([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(i([0,0,0,12,106,80,32,32,13,10,135,10])){if(i([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(i([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(i([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(i([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(i([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(i([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(i([102,116,121,112],{offset:4})){if(i([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(i([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(i([104,101,105,99],{offset:8})||i([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(i([104,101,118,99],{offset:8})||i([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return i([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:i([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:i([77,80,43])||i([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:i([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:i([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:i([212,195,178,161])||i([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise(((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",(()=>{const t=new stream.PassThrough,e=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{t.fileType=fileType(e)}catch(t){reject(t)}readableStream.unshift(e),stream.pipeline?resolve(stream.pipeline(readableStream,t,(()=>{}))):resolve(readableStream.pipe(t))}))}))},2251:(t,e,i)=>{var n=Object.prototype.hasOwnProperty;t.exports=e=function(t,e){return n.call(e,t)},e.version=i(2898).version},645:(t,e)=>{e.read=function(t,e,i,n,r){var s,o,a=8*r-n-1,l=(1<<a)-1,h=l>>1,u=-7,c=i?r-1:0,d=i?-1:1,f=t[e+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+t[e+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=256*o+t[e+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),s-=h}return(f?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,i,n,r,s){var o,a,l,h=8*s-r-1,u=(1<<h)-1,c=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,g=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+c>=1?d/l:d*Math.pow(2,1-c))*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(e*l-1)*Math.pow(2,r),o+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,r),o=0));r>=8;t[i+f]=255&a,f+=g,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;t[i+f]=255&o,f+=g,o/=256,h-=8);t[i+f-g]|=128*p}},9184:(t,e,i)=>{"use strict";const n=i(7769),r=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),s=t=>{const e=n(t);return r.has(e&&e.ext)?e:null};t.exports=s,t.exports.default=s,Object.defineProperty(s,"minimumBytes",{value:n.minimumBytes})},2155:(t,e,i)=>{"use strict";function n(t,e="utf8"){return new TextDecoder(e).decode(t)}i.r(e),i.d(e,{IOBuffer:()=>a}),i(7396);const r=new TextEncoder,s=(()=>{const t=new Uint8Array(4);return!((new Uint32Array(t.buffer)[0]=1)&t[0])})(),o={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class a{constructor(t=8192,e={}){let i=!1;"number"==typeof t?t=new ArrayBuffer(t):(i=!0,this.lastWrittenByte=t.byteLength);const n=e.offset?e.offset>>>0:0,r=t.byteLength-n;let s=n;(ArrayBuffer.isView(t)||t instanceof a)&&(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+n),t=t.buffer),this.lastWrittenByte=i?r:0,this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,r),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),i=new Uint8Array(e);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const i=o[e].BYTES_PER_ELEMENT*t,n=this.byteOffset+this.offset,r=this.buffer.slice(n,n+i);if(this.littleEndian===s&&"uint8"!==e&&"int8"!==e){const t=new Uint8Array(this.buffer.slice(n,n+i));t.reverse();const r=new o[e](t.buffer);return this.offset+=i,r.reverse(),r}const a=new o[e](r);return this.offset+=i,a}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let i=0;i<t;i++)e+=this.readChar();return e}readUtf8(t=1){return n(this.readBytes(t))}decodeText(t=1,e="utf-8"){return n(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(function(t){return r.encode(t)}(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},7396:function(){"use strict";!function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${t}') is invalid.`)}function i(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${t}') is invalid.`);if(e.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let i=0;const n=t.length;let r=0,s=Math.max(32,n+(n>>1)+7),o=new Uint8Array(s>>3<<3);for(;i<n;){let e=t.charCodeAt(i++);if(e>=55296&&e<=56319){if(i<n){const n=t.charCodeAt(i);56320==(64512&n)&&(++i,e=((1023&e)<<10)+(1023&n)+65536)}if(e>=55296&&e<=56319)continue}if(r+4>o.length){s+=8,s*=1+i/t.length*2,s=s>>3<<3;const e=new Uint8Array(s);e.set(o),o=e}if(0!=(4294967168&e)){if(0==(4294965248&e))o[r++]=e>>6&31|192;else if(0==(4294901760&e))o[r++]=e>>12&15|224,o[r++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;o[r++]=e>>18&7|240,o[r++]=e>>12&63|128,o[r++]=e>>6&63|128}o[r++]=63&e|128}else o[r++]=e}return o.slice(0,r)},Object.defineProperty(i.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(i.prototype,"fatal",{value:!1}),Object.defineProperty(i.prototype,"ignoreBOM",{value:!1}),i.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const i=new Uint8Array(t);let n=0;const r=i.length,s=[];for(;n<r;){const t=i[n++];if(0===t)break;if(0==(128&t))s.push(t);else if(192==(224&t)){const e=63&i[n++];s.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&i[n++],r=63&i[n++];s.push((31&t)<<12|e<<6|r)}else if(240==(248&t)){let e=(7&t)<<18|(63&i[n++])<<12|(63&i[n++])<<6|63&i[n++];e>65535&&(e-=65536,s.push(e>>>10&1023|55296),e=56320|1023&e),s.push(e)}}return String.fromCharCode.apply(null,s)},t.TextEncoder=e,t.TextDecoder=i}("undefined"!=typeof window?window:"undefined"!=typeof self?self:this)},4091:(t,e,i)=>{"use strict";i.r(e),i.d(e,{isAnyArray:()=>r});const n=Object.prototype.toString;function r(t){const e=n.call(t);return e.endsWith("Array]")&&!e.includes("Big")}},7811:t=>{"use strict";var e=Object.prototype.toString;t.exports=function(t){return"Array"===e.call(t).substr(-6,5)}},1867:t=>{"use strict";t.exports=Number.isFinite||function(t){return!("number"!=typeof t||t!=t||t===1/0||t===-1/0)}},8336:(t,e,i)=>{var n=i(1867);t.exports=Number.isInteger||function(t){return"number"==typeof t&&n(t)&&Math.floor(t)===t}},7870:(t,e,i)=>{var n=i(587),r=i(914);t.exports={encode:n,decode:r}},914:t=>{var e=function(){"use strict";var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),e=4017,i=799,n=3406,r=2276,s=1567,o=3784,a=5793,l=2896;function h(){}function u(t,e){for(var i,n,r=0,s=[],o=16;o>0&&!t[o-1];)o--;s.push({children:[],index:0});var a,l=s[0];for(i=0;i<o;i++){for(n=0;n<t[i];n++){for((l=s.pop()).children[l.index]=e[r];l.index>0;){if(0===s.length)throw new Error("Could not recreate Huffman Table");l=s.pop()}for(l.index++,s.push(l);s.length<=i;)s.push(a={children:[],index:0}),l.children[l.index]=a.children,l=a;r++}i+1<o&&(s.push(a={children:[],index:0}),l.children[l.index]=a.children,l=a)}return s[0].children}function c(e,i,n,r,s,o,a,l,h,u){n.precision,n.samplesPerLine,n.scanLines;var c=n.mcusPerLine,d=n.progressive,f=(n.maxH,n.maxV,i),g=0,p=0;function m(){if(p>0)return p--,g>>p&1;if(255==(g=e[i++])){var t=e[i++];if(t)throw new Error("unexpected marker: "+(g<<8|t).toString(16))}return p=7,g>>>7}function _(t){for(var e,i=t;null!==(e=m());){if("number"==typeof(i=i[e]))return i;if("object"!=typeof i)throw new Error("invalid huffman sequence")}return null}function w(t){for(var e=0;t>0;){var i=m();if(null===i)return;e=e<<1|i,t--}return e}function y(t){var e=w(t);return e>=1<<t-1?e:e+(-1<<t)+1}var v,b=0,x=0;function M(t,e,i,n,r){var s=i%c,o=(i/c|0)*t.v+n,a=s*t.h+r;void 0===t.blocks[o]&&u.tolerantDecoding||e(t,t.blocks[o][a])}function k(t,e,i){var n=i/t.blocksPerLine|0,r=i%t.blocksPerLine;void 0===t.blocks[n]&&u.tolerantDecoding||e(t,t.blocks[n][r])}var S,E,C,I,A,T,R=r.length;T=d?0===o?0===l?function(t,e){var i=_(t.huffmanTableDC),n=0===i?0:y(i)<<h;e[0]=t.pred+=n}:function(t,e){e[0]|=m()<<h}:0===l?function(e,i){if(b>0)b--;else for(var n=o,r=a;n<=r;){var s=_(e.huffmanTableAC),l=15&s,u=s>>4;if(0!==l)i[t[n+=u]]=y(l)*(1<<h),n++;else{if(u<15){b=w(u)+(1<<u)-1;break}n+=16}}}:function(e,i){for(var n=o,r=a,s=0;n<=r;){var l=t[n],u=i[l]<0?-1:1;switch(x){case 0:var c=_(e.huffmanTableAC),d=15&c;if(s=c>>4,0===d)s<15?(b=w(s)+(1<<s),x=4):(s=16,x=1);else{if(1!==d)throw new Error("invalid ACn encoding");v=y(d),x=s?2:3}continue;case 1:case 2:i[l]?i[l]+=(m()<<h)*u:0==--s&&(x=2==x?3:0);break;case 3:i[l]?i[l]+=(m()<<h)*u:(i[l]=v<<h,x=0);break;case 4:i[l]&&(i[l]+=(m()<<h)*u)}n++}4===x&&0==--b&&(x=0)}:function(e,i){var n=_(e.huffmanTableDC),r=0===n?0:y(n);i[0]=e.pred+=r;for(var s=1;s<64;){var o=_(e.huffmanTableAC),a=15&o,l=o>>4;if(0!==a)i[t[s+=l]]=y(a),s++;else{if(l<15)break;s+=16}}};var P,D,F,L,O=0;for(D=1==R?r[0].blocksPerLine*r[0].blocksPerColumn:c*n.mcusPerColumn,s||(s=D);O<D;){for(E=0;E<R;E++)r[E].pred=0;if(b=0,1==R)for(S=r[0],A=0;A<s;A++)k(S,T,O),O++;else for(A=0;A<s;A++){for(E=0;E<R;E++)for(F=(S=r[E]).h,L=S.v,C=0;C<L;C++)for(I=0;I<F;I++)M(S,T,O,C,I);if(++O===D)break}if(O===D)do{if(255===e[i]&&0!==e[i+1])break;i+=1}while(i<e.length-2);if(p=0,(P=e[i]<<8|e[i+1])<65280)throw new Error("marker was not found");if(!(P>=65488&&P<=65495))break;i+=2}return i-f}function d(t,h){var u,c,d=[],f=h.blocksPerLine,g=h.blocksPerColumn,p=f<<3,_=new Int32Array(64),w=new Uint8Array(64);function y(t,u,c){var d,f,g,p,m,_,w,y,v,b,x=h.quantizationTable,M=c;for(b=0;b<64;b++)M[b]=t[b]*x[b];for(b=0;b<8;++b){var k=8*b;0!=M[1+k]||0!=M[2+k]||0!=M[3+k]||0!=M[4+k]||0!=M[5+k]||0!=M[6+k]||0!=M[7+k]?(d=a*M[0+k]+128>>8,f=a*M[4+k]+128>>8,g=M[2+k],p=M[6+k],m=l*(M[1+k]-M[7+k])+128>>8,y=l*(M[1+k]+M[7+k])+128>>8,_=M[3+k]<<4,w=M[5+k]<<4,v=d-f+1>>1,d=d+f+1>>1,f=v,v=g*o+p*s+128>>8,g=g*s-p*o+128>>8,p=v,v=m-w+1>>1,m=m+w+1>>1,w=v,v=y+_+1>>1,_=y-_+1>>1,y=v,v=d-p+1>>1,d=d+p+1>>1,p=v,v=f-g+1>>1,f=f+g+1>>1,g=v,v=m*r+y*n+2048>>12,m=m*n-y*r+2048>>12,y=v,v=_*i+w*e+2048>>12,_=_*e-w*i+2048>>12,w=v,M[0+k]=d+y,M[7+k]=d-y,M[1+k]=f+w,M[6+k]=f-w,M[2+k]=g+_,M[5+k]=g-_,M[3+k]=p+m,M[4+k]=p-m):(v=a*M[0+k]+512>>10,M[0+k]=v,M[1+k]=v,M[2+k]=v,M[3+k]=v,M[4+k]=v,M[5+k]=v,M[6+k]=v,M[7+k]=v)}for(b=0;b<8;++b){var S=b;0!=M[8+S]||0!=M[16+S]||0!=M[24+S]||0!=M[32+S]||0!=M[40+S]||0!=M[48+S]||0!=M[56+S]?(d=a*M[0+S]+2048>>12,f=a*M[32+S]+2048>>12,g=M[16+S],p=M[48+S],m=l*(M[8+S]-M[56+S])+2048>>12,y=l*(M[8+S]+M[56+S])+2048>>12,_=M[24+S],w=M[40+S],v=d-f+1>>1,d=d+f+1>>1,f=v,v=g*o+p*s+2048>>12,g=g*s-p*o+2048>>12,p=v,v=m-w+1>>1,m=m+w+1>>1,w=v,v=y+_+1>>1,_=y-_+1>>1,y=v,v=d-p+1>>1,d=d+p+1>>1,p=v,v=f-g+1>>1,f=f+g+1>>1,g=v,v=m*r+y*n+2048>>12,m=m*n-y*r+2048>>12,y=v,v=_*i+w*e+2048>>12,_=_*e-w*i+2048>>12,w=v,M[0+S]=d+y,M[56+S]=d-y,M[8+S]=f+w,M[48+S]=f-w,M[16+S]=g+_,M[40+S]=g-_,M[24+S]=p+m,M[32+S]=p-m):(v=a*c[b+0]+8192>>14,M[0+S]=v,M[8+S]=v,M[16+S]=v,M[24+S]=v,M[32+S]=v,M[40+S]=v,M[48+S]=v,M[56+S]=v)}for(b=0;b<64;++b){var E=128+(M[b]+8>>4);u[b]=E<0?0:E>255?255:E}}m(p*g*8);for(var v=0;v<g;v++){var b=v<<3;for(u=0;u<8;u++)d.push(new Uint8Array(p));for(var x=0;x<f;x++){y(h.blocks[v][x],w,_);var M=0,k=x<<3;for(c=0;c<8;c++){var S=d[b+c];for(u=0;u<8;u++)S[k+u]=w[M++]}}}return d}function f(t){return t<0?0:t>255?255:t}h.prototype={load:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){var t=new Uint8Array(e.response||e.mozResponseArrayBuffer);this.parse(t),this.onload&&this.onload()}.bind(this),e.send(null)},parse:function(e){var i=1e3*this.opts.maxResolutionInMP*1e3,n=0;function r(){var t=e[n]<<8|e[n+1];return n+=2,t}function s(t){var e,i,n=1,r=1;for(i in t.components)t.components.hasOwnProperty(i)&&(n<(e=t.components[i]).h&&(n=e.h),r<e.v&&(r=e.v));var s=Math.ceil(t.samplesPerLine/8/n),o=Math.ceil(t.scanLines/8/r);for(i in t.components)if(t.components.hasOwnProperty(i)){e=t.components[i];var a=Math.ceil(Math.ceil(t.samplesPerLine/8)*e.h/n),l=Math.ceil(Math.ceil(t.scanLines/8)*e.v/r),h=s*e.h,u=o*e.v,c=[];m(u*h*256);for(var d=0;d<u;d++){for(var f=[],g=0;g<h;g++)f.push(new Int32Array(64));c.push(f)}e.blocksPerLine=a,e.blocksPerColumn=l,e.blocks=c}t.maxH=n,t.maxV=r,t.mcusPerLine=s,t.mcusPerColumn=o}e.length;var o,a,l,h,f=null,g=null,p=[],_=[],w=[],y=[],v=r(),b=-1;if(this.comments=[],65496!=v)throw new Error("SOI not found");for(v=r();65497!=v;){switch(v){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var x=(l=void 0,h=void 0,l=r(),h=e.subarray(n,n+l-2),n+=h.length,h);if(65534===v){var M=String.fromCharCode.apply(null,x);this.comments.push(M)}65504===v&&74===x[0]&&70===x[1]&&73===x[2]&&70===x[3]&&0===x[4]&&(f={version:{major:x[5],minor:x[6]},densityUnits:x[7],xDensity:x[8]<<8|x[9],yDensity:x[10]<<8|x[11],thumbWidth:x[12],thumbHeight:x[13],thumbData:x.subarray(14,14+3*x[12]*x[13])}),65505===v&&69===x[0]&&120===x[1]&&105===x[2]&&102===x[3]&&0===x[4]&&(this.exifBuffer=x.subarray(5,x.length)),65518===v&&65===x[0]&&100===x[1]&&111===x[2]&&98===x[3]&&101===x[4]&&0===x[5]&&(g={version:x[6],flags0:x[7]<<8|x[8],flags1:x[9]<<8|x[10],transformCode:x[11]});break;case 65499:for(var k=r()+n-2;n<k;){var S=e[n++];m(256);var E=new Int32Array(64);if(S>>4==0)for($=0;$<64;$++)E[t[$]]=e[n++];else{if(S>>4!=1)throw new Error("DQT: invalid table spec");for($=0;$<64;$++)E[t[$]]=r()}p[15&S]=E}break;case 65472:case 65473:case 65474:r(),(o={}).extended=65473===v,o.progressive=65474===v,o.precision=e[n++],o.scanLines=r(),o.samplesPerLine=r(),o.components={},o.componentsOrder=[];var C=o.scanLines*o.samplesPerLine;if(C>i){var I=Math.ceil((C-i)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${I}MP`)}var A,T=e[n++];for(q=0;q<T;q++){A=e[n];var R=e[n+1]>>4,P=15&e[n+1],D=e[n+2];if(R<=0||P<=0)throw new Error("Invalid sampling factor, expected values above 0");o.componentsOrder.push(A),o.components[A]={h:R,v:P,quantizationIdx:D},n+=3}s(o),_.push(o);break;case 65476:var F=r();for(q=2;q<F;){var L=e[n++],O=new Uint8Array(16),z=0;for($=0;$<16;$++,n++)z+=O[$]=e[n];m(16+z);var N=new Uint8Array(z);for($=0;$<z;$++,n++)N[$]=e[n];q+=17+z,(L>>4==0?y:w)[15&L]=u(O,N)}break;case 65501:r(),a=r();break;case 65500:r(),r();break;case 65498:r();var B=e[n++],U=[];for(q=0;q<B;q++){Z=o.components[e[n++]];var G=e[n++];Z.huffmanTableDC=y[G>>4],Z.huffmanTableAC=w[15&G],U.push(Z)}var X=e[n++],Y=e[n++],V=e[n++],j=c(e,n,o,U,a,X,Y,V>>4,15&V,this.opts);n+=j;break;case 65535:255!==e[n]&&n--;break;default:if(255==e[n-3]&&e[n-2]>=192&&e[n-2]<=254){n-=3;break}if(224===v||225==v){if(-1!==b)throw new Error(`first unknown JPEG marker at offset ${b.toString(16)}, second unknown JPEG marker ${v.toString(16)} at offset ${(n-1).toString(16)}`);b=n-1;const t=r();if(255===e[n+t-2]){n+=t-2;break}}throw new Error("unknown JPEG marker "+v.toString(16))}v=r()}if(1!=_.length)throw new Error("only single frame JPEGs supported");for(var q=0;q<_.length;q++){var W=_[q].components;for(var $ in W)W[$].quantizationTable=p[W[$].quantizationIdx],delete W[$].quantizationIdx}for(this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=f,this.adobe=g,this.components=[],q=0;q<o.componentsOrder.length;q++){var Z=o.components[o.componentsOrder[q]];this.components.push({lines:d(0,Z),scaleX:Z.h/o.maxH,scaleY:Z.v/o.maxV})}},getData:function(t,e){var i,n,r,s,o,a,l,h,u,c,d,g,p,_,w,y,v,b,x,M,k,S=this.width/t,E=this.height/e,C=0,I=t*e*this.components.length;m(I);var A=new Uint8Array(I);switch(this.components.length){case 1:for(i=this.components[0],c=0;c<e;c++)for(o=i.lines[0|c*i.scaleY*E],u=0;u<t;u++)d=o[0|u*i.scaleX*S],A[C++]=d;break;case 2:for(i=this.components[0],n=this.components[1],c=0;c<e;c++)for(o=i.lines[0|c*i.scaleY*E],a=n.lines[0|c*n.scaleY*E],u=0;u<t;u++)d=o[0|u*i.scaleX*S],A[C++]=d,d=a[0|u*n.scaleX*S],A[C++]=d;break;case 3:for(k=!0,this.adobe&&this.adobe.transformCode?k=!0:void 0!==this.opts.colorTransform&&(k=!!this.opts.colorTransform),i=this.components[0],n=this.components[1],r=this.components[2],c=0;c<e;c++)for(o=i.lines[0|c*i.scaleY*E],a=n.lines[0|c*n.scaleY*E],l=r.lines[0|c*r.scaleY*E],u=0;u<t;u++)k?(d=o[0|u*i.scaleX*S],g=a[0|u*n.scaleX*S],b=f(d+1.402*((p=l[0|u*r.scaleX*S])-128)),x=f(d-.3441363*(g-128)-.71413636*(p-128)),M=f(d+1.772*(g-128))):(b=o[0|u*i.scaleX*S],x=a[0|u*n.scaleX*S],M=l[0|u*r.scaleX*S]),A[C++]=b,A[C++]=x,A[C++]=M;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(k=!1,this.adobe&&this.adobe.transformCode?k=!0:void 0!==this.opts.colorTransform&&(k=!!this.opts.colorTransform),i=this.components[0],n=this.components[1],r=this.components[2],s=this.components[3],c=0;c<e;c++)for(o=i.lines[0|c*i.scaleY*E],a=n.lines[0|c*n.scaleY*E],l=r.lines[0|c*r.scaleY*E],h=s.lines[0|c*s.scaleY*E],u=0;u<t;u++)k?(d=o[0|u*i.scaleX*S],g=a[0|u*n.scaleX*S],p=l[0|u*r.scaleX*S],_=h[0|u*s.scaleX*S],w=255-f(d+1.402*(p-128)),y=255-f(d-.3441363*(g-128)-.71413636*(p-128)),v=255-f(d+1.772*(g-128))):(w=o[0|u*i.scaleX*S],y=a[0|u*n.scaleX*S],v=l[0|u*r.scaleX*S],_=h[0|u*s.scaleX*S]),A[C++]=255-w,A[C++]=255-y,A[C++]=255-v,A[C++]=255-_;break;default:throw new Error("Unsupported color mode")}return A},copyToImageData:function(t,e){var i,n,r,s,o,a,l,h,u,c=t.width,d=t.height,g=t.data,p=this.getData(c,d),m=0,_=0;switch(this.components.length){case 1:for(n=0;n<d;n++)for(i=0;i<c;i++)r=p[m++],g[_++]=r,g[_++]=r,g[_++]=r,e&&(g[_++]=255);break;case 3:for(n=0;n<d;n++)for(i=0;i<c;i++)l=p[m++],h=p[m++],u=p[m++],g[_++]=l,g[_++]=h,g[_++]=u,e&&(g[_++]=255);break;case 4:for(n=0;n<d;n++)for(i=0;i<c;i++)o=p[m++],a=p[m++],r=p[m++],l=255-f(o*(1-(s=p[m++])/255)+s),h=255-f(a*(1-s/255)+s),u=255-f(r*(1-s/255)+s),g[_++]=l,g[_++]=h,g[_++]=u,e&&(g[_++]=255);break;default:throw new Error("Unsupported color mode")}}};var g=0,p=0;function m(t=0){var e=g+t;if(e>p){var i=Math.ceil((e-p)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${i}MB`)}g=e}return h.resetMaxMemoryUsage=function(t){g=0,p=t},h.getBytesAllocated=function(){return g},h.requestMemoryAllocation=m,h}();t.exports=function(t,i={}){var n={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...i},r=new Uint8Array(t),s=new e;s.opts=n,e.resetMaxMemoryUsage(1024*n.maxMemoryUsageInMB*1024),s.parse(r);var o=n.formatAsRGBA?4:3,a=s.width*s.height*o;try{e.requestMemoryAllocation(a);var l={width:s.width,height:s.height,exifBuffer:s.exifBuffer,data:n.useTArray?new Uint8Array(a):Buffer.alloc(a)};s.comments.length>0&&(l.comments=s.comments)}catch(t){if(t instanceof RangeError)throw new Error("Could not allocate enough memory for the image. Required: "+a);if(t instanceof ReferenceError&&"Buffer is not defined"===t.message)throw new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true");throw t}return s.copyToImageData(l,n.formatAsRGBA),l}},587:t=>{function e(t){Math.round;var e,i,n,r,s,o=Math.floor,a=new Array(64),l=new Array(64),h=new Array(64),u=new Array(64),c=new Array(65535),d=new Array(65535),f=new Array(64),g=new Array(64),p=[],m=0,_=7,w=new Array(64),y=new Array(64),v=new Array(64),b=new Array(256),x=new Array(2048),M=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],k=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],S=[0,1,2,3,4,5,6,7,8,9,10,11],E=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],C=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],I=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],A=[0,1,2,3,4,5,6,7,8,9,10,11],T=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],R=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function P(t,e){for(var i=0,n=0,r=new Array,s=1;s<=16;s++){for(var o=1;o<=t[s];o++)r[e[n]]=[],r[e[n]][0]=i,r[e[n]][1]=s,n++,i++;i*=2}return r}function D(t){for(var e=t[0],i=t[1]-1;i>=0;)e&1<<i&&(m|=1<<_),i--,--_<0&&(255==m?(F(255),F(0)):F(m),_=7,m=0)}function F(t){p.push(t)}function L(t){F(t>>8&255),F(255&t)}function O(t,e,i,n,r){for(var s,o=r[0],a=r[240],l=function(t,e){var i,n,r,s,o,a,l,h,u,c,d=0;for(u=0;u<8;++u){i=t[d],n=t[d+1],r=t[d+2],s=t[d+3],o=t[d+4],a=t[d+5],l=t[d+6];var g=i+(h=t[d+7]),p=i-h,m=n+l,_=n-l,w=r+a,y=r-a,v=s+o,b=s-o,x=g+v,M=g-v,k=m+w,S=m-w;t[d]=x+k,t[d+4]=x-k;var E=.707106781*(S+M);t[d+2]=M+E,t[d+6]=M-E;var C=.382683433*((x=b+y)-(S=_+p)),I=.5411961*x+C,A=1.306562965*S+C,T=.707106781*(k=y+_),R=p+T,P=p-T;t[d+5]=P+I,t[d+3]=P-I,t[d+1]=R+A,t[d+7]=R-A,d+=8}for(d=0,u=0;u<8;++u){i=t[d],n=t[d+8],r=t[d+16],s=t[d+24],o=t[d+32],a=t[d+40],l=t[d+48];var D=i+(h=t[d+56]),F=i-h,L=n+l,O=n-l,z=r+a,N=r-a,B=s+o,U=s-o,G=D+B,X=D-B,Y=L+z,V=L-z;t[d]=G+Y,t[d+32]=G-Y;var j=.707106781*(V+X);t[d+16]=X+j,t[d+48]=X-j;var q=.382683433*((G=U+N)-(V=O+F)),W=.5411961*G+q,$=1.306562965*V+q,Z=.707106781*(Y=N+O),H=F+Z,K=F-Z;t[d+40]=K+W,t[d+24]=K-W,t[d+8]=H+$,t[d+56]=H-$,d++}for(u=0;u<64;++u)c=t[u]*e[u],f[u]=c>0?c+.5|0:c-.5|0;return f}(t,e),h=0;h<64;++h)g[M[h]]=l[h];var u=g[0]-i;i=g[0],0==u?D(n[0]):(D(n[d[s=32767+u]]),D(c[s]));for(var p=63;p>0&&0==g[p];p--);if(0==p)return D(o),i;for(var m,_=1;_<=p;){for(var w=_;0==g[_]&&_<=p;++_);var y=_-w;if(y>=16){m=y>>4;for(var v=1;v<=m;++v)D(a);y&=15}s=32767+g[_],D(r[(y<<4)+d[s]]),D(c[s]),_++}return 63!=p&&D(o),i}function z(t){t<=0&&(t=1),t>100&&(t=100),s!=t&&(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],i=0;i<64;i++){var n=o((e[i]*t+50)/100);n<1?n=1:n>255&&(n=255),a[M[i]]=n}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],s=0;s<64;s++){var c=o((r[s]*t+50)/100);c<1?c=1:c>255&&(c=255),l[M[s]]=c}for(var d=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,g=0;g<8;g++)for(var p=0;p<8;p++)h[f]=1/(a[M[f]]*d[g]*d[p]*8),u[f]=1/(l[M[f]]*d[g]*d[p]*8),f++}(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),s=t)}this.encode=function(t,s){var o;(new Date).getTime(),s&&z(s),p=new Array,m=0,_=7,L(65496),L(65504),L(16),F(74),F(70),F(73),F(70),F(0),F(1),F(1),F(0),L(1),L(1),F(0),F(0),void 0!==(o=t.comments)&&o.constructor===Array&&o.forEach((t=>{if("string"==typeof t){L(65534);var e,i=t.length;for(L(i+2),e=0;e<i;e++)F(t.charCodeAt(e))}})),function(t){if(t){L(65505),69===t[0]&&120===t[1]&&105===t[2]&&102===t[3]?L(t.length+2):(L(t.length+5+2),F(69),F(120),F(105),F(102),F(0));for(var e=0;e<t.length;e++)F(t[e])}}(t.exifBuffer),function(){L(65499),L(132),F(0);for(var t=0;t<64;t++)F(a[t]);F(1);for(var e=0;e<64;e++)F(l[e])}(),function(t,e){L(65472),L(17),F(8),L(e),L(t),F(3),F(1),F(17),F(0),F(2),F(17),F(1),F(3),F(17),F(1)}(t.width,t.height),function(){L(65476),L(418),F(0);for(var t=0;t<16;t++)F(k[t+1]);for(var e=0;e<=11;e++)F(S[e]);F(16);for(var i=0;i<16;i++)F(E[i+1]);for(var n=0;n<=161;n++)F(C[n]);F(1);for(var r=0;r<16;r++)F(I[r+1]);for(var s=0;s<=11;s++)F(A[s]);F(17);for(var o=0;o<16;o++)F(T[o+1]);for(var a=0;a<=161;a++)F(R[a])}(),L(65498),L(12),F(3),F(1),F(0),F(2),F(17),F(3),F(17),F(0),F(63),F(0);var c=0,d=0,f=0;m=0,_=7,this.encode.displayName="_encode_";for(var g,b,M,P,N,B,U,G,X,Y=t.data,V=t.width,j=t.height,q=4*V,W=0;W<j;){for(g=0;g<q;){for(B=N=q*W+g,U=-1,G=0,X=0;X<64;X++)B=N+(G=X>>3)*q+(U=4*(7&X)),W+G>=j&&(B-=q*(W+1+G-j)),g+U>=q&&(B-=g+U-q+4),b=Y[B++],M=Y[B++],P=Y[B++],w[X]=(x[b]+x[M+256>>0]+x[P+512>>0]>>16)-128,y[X]=(x[b+768>>0]+x[M+1024>>0]+x[P+1280>>0]>>16)-128,v[X]=(x[b+1280>>0]+x[M+1536>>0]+x[P+1792>>0]>>16)-128;c=O(w,h,c,e,n),d=O(y,u,d,i,r),f=O(v,u,f,i,r),g+=32}W+=8}if(_>=0){var $=[];$[1]=_+1,$[0]=(1<<_+1)-1,D($)}return L(65497),Buffer.from(p)},(new Date).getTime(),t||(t=50),function(){for(var t=String.fromCharCode,e=0;e<256;e++)b[e]=t(e)}(),e=P(k,S),i=P(I,A),n=P(E,C),r=P(T,R),function(){for(var t=1,e=2,i=1;i<=15;i++){for(var n=t;n<e;n++)d[32767+n]=i,c[32767+n]=[],c[32767+n][1]=i,c[32767+n][0]=n;for(var r=-(e-1);r<=-t;r++)d[32767+r]=i,c[32767+r]=[],c[32767+r][1]=i,c[32767+r][0]=e-1+r;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)x[t]=19595*t,x[t+256>>0]=38470*t,x[t+512>>0]=7471*t+32768,x[t+768>>0]=-11059*t,x[t+1024>>0]=-21709*t,x[t+1280>>0]=32768*t+8421375,x[t+1536>>0]=-27439*t,x[t+1792>>0]=-5329*t}(),z(t),(new Date).getTime()}t.exports=function(t,i){return void 0===i&&(i=50),{data:new e(i).encode(t,i),width:t.width,height:t.height}}},5307:t=>{t.exports=function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[o]={exports:{}};e[o][0].call(h.exports,(function(t){return r(e[o][1][t]||t)}),h,h.exports,t,e,i,n)}return i[o].exports}for(var s=void 0,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){var n,r,s,o,a,l={}.hasOwnProperty;n=t("./PriorityQueue/AbstractPriorityQueue"),r=t("./PriorityQueue/ArrayStrategy"),o=t("./PriorityQueue/BinaryHeapStrategy"),s=t("./PriorityQueue/BHeapStrategy"),(a=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=o),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return function(t,e){for(var i in e)l.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e}(n)).ArrayStrategy=r,a.BinaryHeapStrategy=o,a.BHeapStrategy=s,e.exports=a},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,e,i){e.exports=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){this.length++,this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t}()},{}],3:[function(t,e,i){var n;n=function(t,e,i){var n,r,s;for(r=0,n=t.length;r<n;)i(t[s=r+n>>>1],e)>=0?r=s+1:n=s;return r},e.exports=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;e=n(this.data,t,this.comparator),this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){this.data.length=0},t}()},{}],4:[function(t,e,i){e.exports=function(){function t(t){var e,i,n,r,s,o,a,l;for(this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.pageSize=(null!=t?t.pageSize:void 0)||512,this.length=0,a=0;1<<a<this.pageSize;)a+=1;if(1<<a!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=a,this._emptyMemoryPageTemplate=e=[],i=0,s=this.pageSize;0<=s?i<s:i>s;0<=s?++i:--i)e.push(null);if(this._memory=[],this._mask=this.pageSize-1,t.initialValues)for(n=0,r=(o=t.initialValues).length;n<r;n++)l=o[n],this.queue(l)}return t.prototype.queue=function(t){this.length+=1,this._write(this.length,t),this._bubbleUp(this.length,t)},t.prototype.dequeue=function(){var t,e;return t=this._read(1),e=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,e),this._bubbleDown(1,e)),t},t.prototype.peek=function(){return this._read(1)},t.prototype.clear=function(){this.length=0,this._memory.length=0},t.prototype._write=function(t,e){var i;for(i=t>>this._shift;i>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[i][t&this._mask]=e},t.prototype._read=function(t){return this._memory[t>>this._shift][t&this._mask]},t.prototype._bubbleUp=function(t,e){var i,n,r,s;for(i=this.comparator;t>1&&(n=t&this._mask,t<this.pageSize||n>3?r=t&~this._mask|n>>1:n<2?(r=t-this.pageSize>>this._shift,r+=r&~(this._mask>>1),r|=this.pageSize>>1):r=t-2,!(i(s=this._read(r),e)<0));)this._write(r,e),this._write(t,s),t=r},t.prototype._bubbleDown=function(t,e){var i,n,r,s,o;for(o=this.comparator;t<this.length;)if(t>this._mask&&!(t&this._mask-1)?i=n=t+2:t&this.pageSize>>1?(i=(t&~this._mask)>>1,n=1+(i=1+(i|=t&this._mask>>1)<<this._shift)):n=(i=t+(t&this._mask))+1,i!==n&&n<=this.length)if(r=this._read(i),s=this._read(n),o(r,e)<0&&o(r,s)<=0)this._write(i,e),this._write(t,r),t=i;else{if(!(o(s,e)<0))break;this._write(n,e),this._write(t,s),t=n}else{if(!(i<=this.length))break;if(!(o(r=this._read(i),e)<0))break;this._write(i,e),this._write(t,r),t=i}},t}()},{}],5:[function(t,e,i){e.exports=function(){function t(t){var e;this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.length=0,this.data=(null!=(e=t.initialValues)?e.slice(0):void 0)||[],this._heapify()}return t.prototype._heapify=function(){var t,e,i;if(this.data.length>0)for(t=e=1,i=this.data.length;1<=i?e<i:e>i;t=1<=i?++e:--e)this._bubbleUp(t)},t.prototype.queue=function(t){this.data.push(t),this._bubbleUp(this.data.length-1)},t.prototype.dequeue=function(){var t,e;return e=this.data[0],t=this.data.pop(),this.data.length>0&&(this.data[0]=t,this._bubbleDown(0)),e},t.prototype.peek=function(){return this.data[0]},t.prototype.clear=function(){this.length=0,this.data.length=0},t.prototype._bubbleUp=function(t){for(var e,i;t>0&&(e=t-1>>>1,this.comparator(this.data[t],this.data[e])<0);)i=this.data[e],this.data[e]=this.data[t],this.data[t]=i,t=e},t.prototype._bubbleDown=function(t){var e,i,n,r,s;for(e=this.data.length-1;r=1+(i=1+(t<<1)),n=t,i<=e&&this.comparator(this.data[i],this.data[n])<0&&(n=i),r<=e&&this.comparator(this.data[r],this.data[n])<0&&(n=r),n!==t;)s=this.data[n],this.data[n]=this.data[t],this.data[t]=s,t=n},t}()},{}]},{},[1])(1)},2229:function(t){t.exports=function(){"use strict";function t(t){return"string"==typeof t||t instanceof String}var e=Number.isFinite||window.isFinite;function i(t){return e(t)}function n(t){return t}function r(t,e){if(e.length!==t.length)return!1;for(var i=0;i<t.length;i++){if(e[i].compareArray&&!e[i].compareArray(t[i]))return!1;if(e[i]!==t[i])return!1}return!0}function s(t,e){Object.keys(e).forEach((function(i){t[i]=e[i]}))}function o(){for(var t=1,e=0,i=0;i<arguments.length;i++){var n=arguments[i];e+=h(n),t*=n}return 0!==e?l(t,e):t}function a(t,e){if(0===e)throw new Error("Divide by zero");var i=Math.pow(10,h(e));return o(t,i/(i*e))}function l(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function h(t){if(!isFinite(t))return 0;for(var e=0;t%1!=0;)t*=10,e++;return e}function u(){var t;if(!this)return t=Object.create(u.prototype),u.apply(t,arguments),t;t=Error.apply(this,arguments),this.name="QtyError",this.message=t.message,this.stack=t.stack}function c(t,e){throw new u("Incompatible units: "+t+" and "+e)}u.prototype=Object.create(Error.prototype,{constructor:{value:u}});var d={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","","","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["t","tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],86400,"time",["<second>"]],"<week>":[["wk","week","weeks"],604800,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"molar_concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"molar_concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","",""],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules","Joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<electronvolt>":[["eV","electronvolt","electronvolts"],1602176634e-28,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<arcminute>":[["arcmin","arcminute","arcminutes"],Math.PI/10800,"angle",["<radian>"]],"<arcsecond>":[["arcsec","arcsecond","arcseconds"],Math.PI/648e3,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppb>":[["ppb"],1e-9,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-12,"prefix_only",["<1>"]],"<ppq>":[["ppq"],1e-15,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},f=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],g="<1>",p=[g];function m(t,e){var n=e[1],r=e[3]||[],s=e[4]||[];if(!i(n))throw new u(t+": Invalid unit definition. 'scalar' must be a number");r.forEach((function(e){if(void 0===d[e])throw new u(t+": Invalid unit definition. Unit "+e+" in 'numerator' is not recognized")})),s.forEach((function(e){if(void 0===d[e])throw new u(t+": Invalid unit definition. Unit "+e+" in 'denominator' is not recognized")}))}var _={},w={},y={},v={},b={};for(var x in d)if(d.hasOwnProperty(x)){var M=d[x];if("prefix"===M[2]){_[x]=M[1];for(var k=0;k<M[0].length;k++)w[M[0][k]]=x}else{m(x,M),y[x]={scalar:M[1],numerator:M[3],denominator:M[4]};for(var S=0;S<M[0].length;S++)v[M[0][S]]=x}b[x]=M[0][0]}var E=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function C(){if(this.signature)return this.signature;for(var t=I.call(this),e=0;e<t.length;e++)t[e]*=Math.pow(20,e);return t.reduce((function(t,e){return t+e}),0)}function I(){if(!this.isBase())return I.call(this.toBase());for(var t,e,i=new Array(E.length),n=0;n<i.length;n++)i[n]=0;for(var r=0;r<this.numerator.length;r++)(t=d[this.numerator[r]])&&(e=E.indexOf(t[2]))>=0&&(i[e]=i[e]+1);for(var s=0;s<this.denominator.length;s++)(t=d[this.denominator[s]])&&(e=E.indexOf(t[2]))>=0&&(i[e]=i[e]-1);return i}var A=new RegExp("^([+-]?\\s*(?:(?:\\d+(?:\\.\\d+)?)|(?:\\.\\d+))(?:[Ee][+-]?\\d+)?)?\\s*([^/]*)(?:/(.+))?$"),T="\\^|\\*{2}",R="[01234]",P=new RegExp("([^ \\*\\d]+?)(?:"+T+")?(-?"+R+"(?![a-zA-Z]))"),D=new RegExp("([^ \\*\\d]+?)(?:"+T+")?("+R+"(?![a-zA-Z]))");function F(e){t(e)||(e=e.toString()),e=e.trim();var i=A.exec(e);if(!i)throw new u(e+": Quantity not recognized");var n=i[1];n?(n=n.replace(/\s/g,""),this.scalar=parseFloat(n)):this.scalar=1;for(var r,s,o,a=i[2],l=i[3];i=P.exec(a);){if(r=parseFloat(i[2]),isNaN(r))throw new u("Unit exponent is not a number");if(0===r&&!O.test(i[1]))throw new u("Unit not recognized");s=i[1]+" ",o="";for(var h=0;h<Math.abs(r);h++)o+=s;r>=0?a=a.replace(i[0],o):(l=l?l+o:o,a=a.replace(i[0],""))}for(;i=D.exec(l);){if(r=parseFloat(i[2]),isNaN(r))throw new u("Unit exponent is not a number");if(0===r&&!O.test(i[1]))throw new u("Unit not recognized");s=i[1]+" ",o="";for(var c=0;c<r;c++)o+=s;l=l.replace(i[0],o)}a&&(this.numerator=B(a.trim())),l&&(this.denominator=B(l.trim()))}var L="("+Object.keys(w).sort((function(t,e){return e.length-t.length})).join("|")+")??("+Object.keys(v).sort((function(t,e){return e.length-t.length})).join("|")+")(?:\\b|$)",O=new RegExp("^\\s*("+L+"[\\s\\*]*)+$"),z=new RegExp(L,"g"),N={};function B(t){var e=N[t];if(e)return e;var i,n=[];if(!O.test(t))throw new u("Unit not recognized");for(;i=z.exec(t);)n.push(i.slice(1));return n=(n=(n=n.map((function(t){return w[t[0]]?[w[t[0]],v[t[1]]]:[v[t[1]]]}))).reduce((function(t,e){return t.concat(e)}),[])).filter((function(t){return t})),N[t]=n,n}function U(t){return t instanceof G}function G(t,e){if(X.apply(null,arguments),!U(this))return new G(t,e);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=p,this.denominator=p,Y(t)?(this.scalar=t.scalar,this.numerator=t.numerator&&0!==t.numerator.length?t.numerator:p,this.denominator=t.denominator&&0!==t.denominator.length?t.denominator:p):e?(F.call(this,e),this.scalar=t):F.call(this,t),this.denominator.join("*").indexOf("temp")>=0)throw new u("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new u("Cannot multiply by temperatures");if(!r(this.denominator,p))throw new u("Cannot divide with temperatures")}if(this.initValue=t,V.call(this),this.isTemperature()&&this.baseScalar<0)throw new u("Temperatures must not be less than absolute zero")}function X(e,n){if(n){if(!i(e)||!t(n))throw new u("Only number accepted as initialization value when units are explicitly provided")}else if(!(t(e)||i(e)||U(e)||Y(e)))throw new u("Only string, number or quantity accepted as single initialization value")}function Y(t){return t&&"object"==typeof t&&t.hasOwnProperty("scalar")}function V(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=C.call(this);else{var t=this.toBase();this.baseScalar=t.scalar,this.signature=t.signature}}G.prototype={constructor:G};var j={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency",25599999980:"information_rate",256e8:"information",511999999980:"angular_velocity",512e9:"angle"};function q(t,e){var i=e.to(W(t.units()));return G({scalar:t.scalar+i.scalar,numerator:t.numerator,denominator:t.denominator})}function W(t){if("tempK"===t)return"degK";if("tempC"===t)return"degC";if("tempF"===t)return"degF";if("tempR"===t)return"degR";throw new u("Unknown type for temp conversion from: "+t)}function $(t,e){var i,n=function(t){var e,i=t.units();if(i.match(/(deg)[CFRK]/))e=t.baseScalar;else if("tempK"===i)e=t.scalar;else if("tempC"===i)e=t.scalar;else if("tempF"===i)e=5*t.scalar/9;else{if("tempR"!==i)throw new u("Unknown type for temp conversion from: "+i);e=5*t.scalar/9}return G({scalar:e,numerator:["<kelvin>"],denominator:p})}(t),r=e.units();if("degK"===r)i=n.scalar;else if("degC"===r)i=n.scalar;else if("degF"===r)i=9*n.scalar/5;else{if("degR"!==r)throw new u("Unknown type for degree conversion to: "+r);i=9*n.scalar/5}return G({scalar:i,numerator:e.numerator,denominator:e.denominator})}G.prototype.kind=function(){return j[this.signature.toString()]},s(G.prototype,{isDegrees:function(){return(null===this.signature||400===this.signature)&&1===this.numerator.length&&r(this.denominator,p)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}}),s(G.prototype,{to:function(e){var i,n;return null==e?this:t(e)?(i=this._conversionCache[e])?i:(n=G(e)).units()===this.units()?this:(this.isCompatible(n)?n=n.isTemperature()?function(t,e){var i,n=e.units();if("tempK"===n)i=t.baseScalar;else if("tempC"===n)i=t.baseScalar-273.15;else if("tempF"===n)i=9*t.baseScalar/5-459.67;else{if("tempR"!==n)throw new u("Unknown type for temp conversion to: "+n);i=9*t.baseScalar/5}return G({scalar:i,numerator:e.numerator,denominator:e.denominator})}(this,n):n.isDegrees()?$(this,n):G({scalar:a(this.baseScalar,n.baseScalar),numerator:n.numerator,denominator:n.denominator}):this.isInverse(n)?n=this.inverse().to(e):c(this.units(),n.units()),this._conversionCache[e]=n,n):this.to(e.units())},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return function(t){var e,i=t.units();if(i.match(/(deg)[CFRK]/))e=t.baseScalar;else if("tempK"===i)e=t.scalar;else if("tempC"===i)e=t.scalar+273.15;else if("tempF"===i)e=5*(t.scalar+459.67)/9;else{if("tempR"!==i)throw new u("Unknown type for temp conversion from: "+i);e=5*t.scalar/9}return G({scalar:e,numerator:["<temp-K>"],denominator:p})}(this);var t=Z[this.units()];return t||(t=function(t,e){for(var i,n=[],r=[],s=1,a=0;a<t.length;a++)i=t[a],_[i]?s=o(s,_[i]):y[i]&&(s*=y[i].scalar,y[i].numerator&&n.push(y[i].numerator),y[i].denominator&&r.push(y[i].denominator));for(var l=0;l<e.length;l++)i=e[l],_[i]?s/=_[i]:y[i]&&(s/=y[i].scalar,y[i].numerator&&r.push(y[i].numerator),y[i].denominator&&n.push(y[i].denominator));return G({scalar:s,numerator:n=n.reduce((function(t,e){return t.concat(e)}),[]),denominator:r=r.reduce((function(t,e){return t.concat(e)}),[])})}(this.numerator,this.denominator),Z[this.units()]=t),t.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new u("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(e){if(t(e)&&(e=G(e)),i(e)&&(e=G(e+" "+this.units())),this.isUnitless()?e.isUnitless()||c(this.units(),e.units()):e=e.to(this.units()),0===e.scalar)throw new u("Divide by zero");return G(o(Math.round(this.scalar/e.scalar),e.scalar)+this.units())}});var Z={};function H(t,e,i,n){function r(t){return t!==g}t=t.filter(r),i=i.filter(r),e=e.filter(r),n=n.filter(r);var s={};function o(t,e){for(var i,n,r,o=0;o<t.length;o++)if(_[t[o]]?(i=t[o+1],n=t[o],r=_[n],o++):(i=t[o],n=null,r=1),i&&i!==g)if(s[i]){s[i][0]+=e;var l=s[i][2]?_[s[i][2]]:1;s[i][1===e?3:4]*=a(r,l)}else s[i]=[e,i,n,1,1]}o(t,1),o(e,-1),o(i,1),o(n,-1);var l=[],h=[],u=1;for(var c in s)if(s.hasOwnProperty(c)){var d,f=s[c];if(f[0]>0)for(d=0;d<f[0];d++)l.push(null===f[2]?f[1]:[f[2],f[1]]);else if(f[0]<0)for(d=0;d<-f[0];d++)h.push(null===f[2]?f[1]:[f[2],f[1]]);u*=a(f[3],f[4])}return 0===l.length&&(l=p),0===h.length&&(h=p),[l=l.reduce((function(t,e){return t.concat(e)}),[]),h=h.reduce((function(t,e){return t.concat(e)}),[]),u]}function K(){}G.parse=function(e){if(!t(e))throw new u("Argument should be a string");try{return this(e)}catch(t){return null}},G.getUnits=function(t){var e,i=[],n=Object.keys(d);if(void 0===t)for(e=0;e<n.length;e++)-1===["","prefix"].indexOf(d[n[e]][2])&&i.push(n[e].substr(1,n[e].length-2));else{if(-1===this.getKinds().indexOf(t))throw new u("Kind not recognized");for(e=0;e<n.length;e++)d[n[e]][2]===t&&i.push(n[e].substr(1,n[e].length-2))}return i.sort((function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0}))},G.getAliases=function(t){if(!v[t])throw new u("Unit not recognized");return d[v[t]][0]},G.mulSafe=o,G.divSafe=a,G.getKinds=function(){return t=Object.keys(j).map((function(t){return j[t]})),e={},t.filter((function(t){return!e.hasOwnProperty(t)&&(e[t]=!0)}));var t,e},G.swiftConverter=function(t,e){var i,r=G(t),s=G(e);return r.eq(s)?n:(i=r.isTemperature()?function(t){return r.mul(t).to(s).scalar}:function(t){return t*r.baseScalar/s.baseScalar},function(t){var e,n,r;if(Array.isArray(t)){for(n=t.length,r=[],e=0;e<n;e++)r.push(i(t[e]));return r}return i(t)})},G.Error=u,s(G.prototype,{add:function(e){if(t(e)&&(e=G(e)),this.isCompatible(e)||c(this.units(),e.units()),this.isTemperature()&&e.isTemperature())throw new u("Cannot add two temperatures");return this.isTemperature()?q(this,e):e.isTemperature()?q(e,this):G({scalar:this.scalar+e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(e){if(t(e)&&(e=G(e)),this.isCompatible(e)||c(this.units(),e.units()),this.isTemperature()&&e.isTemperature())return n=e,r=(i=this).units(),s=n.to(r),o=G(W(r)),G({scalar:i.scalar-s.scalar,numerator:o.numerator,denominator:o.denominator});var i,n,r,s,o,a,l;if(this.isTemperature())return a=this,l=e.to(W(a.units())),G({scalar:a.scalar-l.scalar,numerator:a.numerator,denominator:a.denominator});if(e.isTemperature())throw new u("Cannot subtract a temperature from a differential degree unit");return G({scalar:this.scalar-e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(e){if(i(e))return G({scalar:o(this.scalar,e),numerator:this.numerator,denominator:this.denominator});if(t(e)&&(e=G(e)),(this.isTemperature()||e.isTemperature())&&!this.isUnitless()&&!e.isUnitless())throw new u("Cannot multiply by temperatures");var n=this,r=e;n.isCompatible(r)&&400!==n.signature&&(r=r.to(n));var s=H(n.numerator,n.denominator,r.numerator,r.denominator);return G({scalar:o(n.scalar,r.scalar,s[2]),numerator:s[0],denominator:s[1]})},div:function(e){if(i(e)){if(0===e)throw new u("Divide by zero");return G({scalar:this.scalar/e,numerator:this.numerator,denominator:this.denominator})}if(t(e)&&(e=G(e)),0===e.scalar)throw new u("Divide by zero");if(e.isTemperature())throw new u("Cannot divide with temperatures");if(this.isTemperature()&&!e.isUnitless())throw new u("Cannot divide with temperatures");var n=this,r=e;n.isCompatible(r)&&400!==n.signature&&(r=r.to(n));var s=H(n.numerator,n.denominator,r.denominator,r.numerator);return G({scalar:o(n.scalar,s[2])/r.scalar,numerator:s[0],denominator:s[1]})},inverse:function(){if(this.isTemperature())throw new u("Cannot divide with temperatures");if(0===this.scalar)throw new u("Divide by zero");return G({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}}),s(G.prototype,{eq:function(t){return 0===this.compareTo(t)},lt:function(t){return-1===this.compareTo(t)},lte:function(t){return this.eq(t)||this.lt(t)},gt:function(t){return 1===this.compareTo(t)},gte:function(t){return this.eq(t)||this.gt(t)},compareTo:function(e){return t(e)?this.compareTo(G(e)):(this.isCompatible(e)||c(this.units(),e.units()),this.baseScalar<e.baseScalar?-1:this.baseScalar===e.baseScalar?0:this.baseScalar>e.baseScalar?1:void 0)},same:function(t){return this.scalar===t.scalar&&this.units()===t.units()}}),s(G.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every((function(t){return r(t,p)}))},isCompatible:function(e){return t(e)?this.isCompatible(G(e)):!!U(e)&&void 0!==e.signature&&this.signature===e.signature},isInverse:function(t){return this.inverse().isCompatible(t)},isBase:function(){return void 0!==this._isBase?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach((function(t){t!==g&&-1===f.indexOf(t)&&(this._isBase=!1)}),this),!1===this._isBase||(this._isBase=!0),this._isBase)}}),K.prototype.get=function(t){return arguments.length>1&&(t=Array.apply(null,arguments)),t.reduce((function(e,i,n){if(e){var r=e[i];return n===t.length-1?r?r.data:void 0:r}}),this)},K.prototype.set=function(t,e){return arguments.length>2&&(t=Array.prototype.slice.call(arguments,0,-1),e=arguments[arguments.length-1]),t.reduce((function(i,n,r){var s=i[n];return void 0===s&&(s=i[n]={}),r===t.length-1?(s.data=e,e):s}),this)},G.formatter=function(t,e){return(t+" "+e).trim()},s(G.prototype,{units:function(){if(void 0!==this._units)return this._units;var t=r(this.numerator,p),e=r(this.denominator,p);if(t&&e)return this._units="",this._units;var i=Q(this.numerator),n=Q(this.denominator);return this._units=i+(e?"":"/"+n),this._units},toString:function(e,n){var r;if(i(e))r=this.units(),n=e;else if(t(e))r=e;else if(U(e))return this.toPrec(e).toString(n);var s=this.to(r);return((void 0!==n?l(s.scalar,n):s.scalar)+" "+s.units()).trim()},format:function(t,e){1===arguments.length&&"function"==typeof t&&(e=t,t=void 0),e=e||G.formatter;var i=this.to(t);return e.call(this,i.scalar,i.units())}});var J=new K;function Q(t){var e=J.get(t);return e||(e=r(t,p)?"1":function(t){return t.reduce((function(t,e){var i=t[e];return i||t.push(i=t[e]=[e,0]),i[1]++,t}),[]).map((function(t){return t[0]+(t[1]>1?t[1]:"")}))}(function(t){for(var e,i,n=[],r=0;r<t.length;r++)e=t[r],i=t[r+1],_[e]?(n.push(b[e]+b[i]),r++):n.push(b[e]);return n}(t)).join("*"),J.set(t,e),e)}return G.version="1.8.0",G}()},5520:t=>{!function(){function e(t){for(var e=0,r=t.length-1,s=void 0,o=void 0,a=void 0,l=n(e,r);;){if(r<=e)return t[l];if(r==e+1)return t[e]>t[r]&&i(t,e,r),t[l];for(t[s=n(e,r)]>t[r]&&i(t,s,r),t[e]>t[r]&&i(t,e,r),t[s]>t[e]&&i(t,s,e),i(t,s,e+1),o=e+1,a=r;;){do{o++}while(t[e]>t[o]);do{a--}while(t[a]>t[e]);if(a<o)break;i(t,o,a)}i(t,e,a),a<=l&&(e=o),a>=l&&(r=a-1)}}var i=function(t,e,i){var n;return n=[t[i],t[e]],t[e]=n[0],t[i]=n[1],n},n=function(t,e){return~~((t+e)/2)};t.exports?t.exports=e:window.median=e}()},4805:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});var n=i(4091);function r(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,n.isAnyArray)(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==i.output){if(!(0,n.isAnyArray)(i.output))throw new TypeError("output option must be an array if specified");e=i.output}else e=new Array(t.length);var r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,n.isAnyArray)(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var i=e.fromIndex,r=void 0===i?0:i,s=e.toIndex,o=void 0===s?t.length:s;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=r||o>t.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[r],l=r+1;l<o;l++)t[l]<a&&(a=t[l]);return a}(t),s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,n.isAnyArray)(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var i=e.fromIndex,r=void 0===i?0:i,s=e.toIndex,o=void 0===s?t.length:s;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=r||o>t.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[r],l=r+1;l<o;l++)t[l]>a&&(a=t[l]);return a}(t);if(r===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=i.min,a=void 0===o?i.autoMinMax?r:0:o,l=i.max,h=void 0===l?i.autoMinMax?s:1:l;if(a>=h)throw new RangeError("min option must be smaller than max option");for(var u=(h-a)/(s-r),c=0;c<t.length;c++)e[c]=(t[c]-r)*u+a;return e}},530:t=>{"use strict";function e(t){this.value=t,this.parent=null,this.rank=0}t.exports=class{constructor(){this.nodes=new Map}add(t){var i=this.nodes.get(t);return i||(i=new e(t),this.nodes.set(t,i)),i}union(t,e){const i=this.find(t),n=this.find(e);i!==n&&(i.rank<n.rank?i.parent=n:i.rank>n.rank?n.parent=i:(n.parent=i,i.rank++))}find(t){for(var e=t;null!==e.parent;)e=e.parent;for(var i=t;null!==i.parent;){var n=i;i=i.parent,n.parent=e}return e}connected(t,e){return this.find(t)===this.find(e)}}},4953:(t,e,i)=>{"use strict";function n(t,e){let i=0;for(let n=0;n<t.length;n++)i+=(t[n]-e[n])*(t[n]-e[n]);return i}function r(t,e){return Math.sqrt(n(t,e))}i.r(e),i.d(e,{euclidean:()=>r,squaredEuclidean:()=>n})},7345:(t,e,i)=>{"use strict";var n=i(5571),r={DEBUG:!1,ifft2DArray:function(t,e,i){var r=new Array(e*i),s=e/2,o=2*(i-1);n.init(s);for(var a={re:new Array(s),im:new Array(s)},l=0;l<i;l++){for(var h=s-1;h>=0;h--)a.re[h]=t[2*h*i+l],a.im[h]=t[(2*h+1)*i+l];for(n.bt(a.re,a.im),h=s-1;h>=0;h--)r[2*h*i+l]=a.re[h],r[(2*h+1)*i+l]=a.im[h]}var u=new Array(s*o);n.init(o);var c={re:new Array(o),im:new Array(o)},d=o*s;for(h=0;h<e;h+=2){for(c.re[0]=r[h*i],c.im[0]=r[(h+1)*i],l=1;l<i;l++)c.re[l]=r[h*i+l],c.im[l]=r[(h+1)*i+l],c.re[o-l]=r[h*i+l],c.im[o-l]=-r[(h+1)*i+l];n.bt(c.re,c.im);var f=h/2*o;for(l=o-1;l>=0;l--)u[f+l]=c.re[l]/d}return u},fft2DArray:function(t,e,i,r){Object.assign({},{inplace:!0});var s=i/2+1,o=2*e,a=new Array(o*s);n.init(i);for(var l,h,u,c,d,f={re:new Array(i),im:new Array(i)},g={re:new Array(i),im:new Array(i)},p={re:new Array(i),im:new Array(i)},m=0;m<e/2;m++){l=2*m*i,f.re=t.slice(l,l+i),l=(2*m+1)*i,f.im=t.slice(l,l+i),n.fft1d(f.re,f.im),this.reconstructTwoRealFFT(f,g,p),h=4*m*s,u=(4*m+1)*s,c=(4*m+2)*s,d=(4*m+3)*s;for(var _=s-1;_>=0;_--)a[h+_]=g.re[_],a[u+_]=g.im[_],a[c+_]=p.re[_],a[d+_]=p.im[_]}g=null,p=null;var w=new Array(o*s);n.init(e);for(var y={re:new Array(e),im:new Array(e)},v=s-1;v>=0;v--){for(m=e-1;m>=0;m--)y.re[m]=a[2*m*s+v],y.im[m]=a[(2*m+1)*s+v],isNaN(y.re[m])&&(y.re[m]=0),isNaN(y.im[m])&&(y.im[m]=0);for(n.fft1d(y.re,y.im),m=e-1;m>=0;m--)w[2*m*s+v]=y.re[m],w[(2*m+1)*s+v]=y.im[m]}return w},reconstructTwoRealFFT:function(t,e,i){var n,r,s,o,a,l=t.re.length;e.re[0]=t.re[0],e.im[0]=0,i.re[0]=t.im[0],i.im[0]=0;for(var h=l/2;h>0;h--)a=l-h,n=.5*(t.re[h]-t.re[a]),r=.5*(t.re[h]+t.re[a]),s=.5*(t.im[h]-t.im[a]),o=.5*(t.im[h]+t.im[a]),e.re[h]=r,e.im[h]=s,e.re[a]=r,e.im[a]=-s,i.re[h]=o,i.im[h]=-n,i.re[a]=o,i.im[a]=n},convolute2DI:function(t,e,i,n){for(var r,s,o=0;o<i/2;o++)for(var a=0;a<n;a++)r=t[2*o*n+a]*e[2*o*n+a]-t[(2*o+1)*n+a]*e[(2*o+1)*n+a],s=t[2*o*n+a]*e[(2*o+1)*n+a]+t[(2*o+1)*n+a]*e[2*o*n+a],t[2*o*n+a]=r,t[(2*o+1)*n+a]=s},convolute:function(t,e,i,n,r){for(var s=new Array(n*i),o=0;o<i*n;o++)s[o]=t[o];s=this.fft2DArray(s,i,n);var a,l=e.length,h=e[0].length,u=new Array(n*i);for(o=0;o<n*i;o++)u[o]=0;for(var c=Math.floor((l-1)/2),d=Math.floor((h-1)/2),f=0;f<l;f++){a=(f-c+i)%i;for(var g=0;g<h;g++)u[a*n+(g-d+n)%n]=e[f][g]}u=this.fft2DArray(u,i,n);var p=2*i,m=n/2+1;return this.convolute2DI(s,u,p,m),this.ifft2DArray(s,p,m)},toRadix2:function(t,e,i){var n,r,s,o,a=i,l=e;if(0===i||0!=(i&i-1)){for(a=0;i>>++a!=0;);a=1<<a}if(0===e||0!=(e&e-1)){for(l=0;e>>++l!=0;);l=1<<l}if(l==e&&a==i)return{data:t,rows:e,cols:i};var h=new Array(l*a),u=Math.floor((l-e)/2)-e,c=Math.floor((a-i)/2)-i;for(n=0;n<l;n++)for(s=n*a,o=(n-u)%e*i,r=0;r<a;r++)h[s+r]=t[o+(r-c)%i];return{data:h,rows:l,cols:a}},crop:function(t,e,i,n,r,s){if(e==n&&i==r)return t;Object.assign({},s);var o,a,l,h,u=new Array(r*n),c=Math.floor((e-n)/2),d=Math.floor((i-r)/2);for(l=0;l<n;l++)for(o=l*r,a=(l+c)*i,h=0;h<r;h++)u[o+h]=t[a+(h+d)];return u}};t.exports=r},5571:function(t,e){(function(){var t;(t=e).toString=function(){return"version 0.3.0, released 2013-03"};for(var i=0,n=null,r=null,s={init:function(t){if(0===t||0!=(t&t-1))throw new Error("init: radix-2 required");i=t,s._initArray(),s._makeBitReversalTable(),s._makeCosSinTable()},fft1d:function(t,e){s.fft(t,e,1)},ifft1d:function(t,e){var n=1/i;s.fft(t,e,-1);for(var r=0;r<i;r++)t[r]*=n,e[r]*=n},bt1d:function(t,e){s.fft(t,e,-1)},fft2d:function(t,e){for(var n=[],r=[],o=0,a=0;a<i;a++){o=a*i;for(var l=0;l<i;l++)n[l]=t[l+o],r[l]=e[l+o];s.fft1d(n,r);for(var h=0;h<i;h++)t[h+o]=n[h],e[h+o]=r[h]}for(var u=0;u<i;u++){for(var c=0;c<i;c++)o=u+c*i,n[c]=t[o],r[c]=e[o];s.fft1d(n,r);for(var d=0;d<i;d++)t[o=u+d*i]=n[d],e[o]=r[d]}},ifft2d:function(t,e){for(var n=[],r=[],o=0,a=0;a<i;a++){o=a*i;for(var l=0;l<i;l++)n[l]=t[l+o],r[l]=e[l+o];s.ifft1d(n,r);for(var h=0;h<i;h++)t[h+o]=n[h],e[h+o]=r[h]}for(var u=0;u<i;u++){for(var c=0;c<i;c++)o=u+c*i,n[c]=t[o],r[c]=e[o];s.ifft1d(n,r);for(var d=0;d<i;d++)t[o=u+d*i]=n[d],e[o]=r[d]}},fft:function(t,e,s){for(var o,a,l,h,u,c,d,f,g,p=i>>2,m=0;m<i;m++)m<(h=n[m])&&(u=t[m],t[m]=t[h],t[h]=u,u=e[m],e[m]=e[h],e[h]=u);for(var _=1;_<i;_<<=1){a=0,o=i/(_<<1);for(var w=0;w<_;w++){c=r[a+p],d=s*r[a];for(var y=w;y<i;y+=_<<1)f=c*t[l=y+_]+d*e[l],g=c*e[l]-d*t[l],t[l]=t[y]-f,t[y]+=f,e[l]=e[y]-g,e[y]+=g;a+=o}}},_initArray:function(){n="undefined"!=typeof Uint32Array?new Uint32Array(i):[],r="undefined"!=typeof Float64Array?new Float64Array(1.25*i):[]},_paddingZero:function(){},_makeBitReversalTable:function(){var t=0,e=0,r=0;for(n[0]=0;++t<i;){for(r=i>>1;r<=e;)e-=r,r>>=1;e+=r,n[t]=e}},_makeCosSinTable:function(){var t=i>>1,e=i>>2,n=i>>3,s=t+e,o=Math.sin(Math.PI/i),a=2*o*o,l=Math.sqrt(a*(2-a)),h=r[e]=1,u=r[0]=0;o=2*a;for(var c=1;c<n;c++)a+=o*(h-=a),l-=o*(u+=l),r[c]=u,r[e-c]=h;0!==n&&(r[n]=Math.sqrt(.5));for(var d=0;d<e;d++)r[t-d]=r[d];for(var f=0;f<s;f++)r[f+t]=-r[f]}},o=["init","fft1d","ifft1d","fft2d","ifft2d"],a=0;a<o.length;a++)t[o[a]]=s[o[a]];return t.bt=s.bt1d,t.fft=s.fft1d,t.ifft=s.ifft1d,t}).call(this)},3910:(t,e,i)=>{"use strict";e.FFTUtils=i(7345),i(5571)},8881:(t,e,i)=>{"use strict";const{squaredEuclidean:n}=i(4953),r={sigma:1};t.exports=class{constructor(t){t=Object.assign({},r,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const i=n(t,e);return Math.exp(-i/this.divisor)}}},4229:t=>{"use strict";const e={degree:1,constant:1,scale:1};t.exports=class{constructor(t){t=Object.assign({},e,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,e){for(var i=0,n=0;n<t.length;n++)i+=t[n]*e[n];return Math.pow(this.scale*i+this.constant,this.degree)}}},7613:t=>{"use strict";const e={alpha:.01,constant:-Math.E};t.exports=class{constructor(t){t=Object.assign({},e,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,e){for(var i=0,n=0;n<t.length;n++)i+=t[n]*e[n];return Math.tanh(this.alpha*i+this.constant)}}},6952:(t,e,i)=>{"use strict";const{Matrix:n,MatrixTransposeView:r}=i(8406),s=i(8881),o=i(4229),a=i(7613),l=i(8541),h=i(9176),u=i(3316),c=i(1960),d={gaussian:s,rbf:s,polynomial:o,poly:o,anova:l,cauchy:h,exponential:u,histogram:c,min:c,laplacian:i(8557),multiquadratic:i(8609),rational:i(3029),sigmoid:a,mlp:a};t.exports=class{constructor(t,e){if(this.kernelType=t,"linear"!==t)if("string"==typeof t){t=t.toLowerCase();var i=d[t];if(!i)throw new Error(`unsupported kernel type: ${t}`);this.kernelFunction=new i(e)}else{if("object"!=typeof t||"function"!=typeof t.compute)throw new TypeError("first argument must be a valid kernel type or instance");this.kernelFunction=t}}compute(t,e){if(t=n.checkMatrix(t),e=void 0===e?t:n.checkMatrix(e),"linear"===this.kernelType)return t.mmul(new r(e));const i=new n(t.rows,e.rows);if(t===e)for(let e=0;e<t.rows;e++)for(let n=e;n<t.rows;n++){const r=this.kernelFunction.compute(t.getRow(e),t.getRow(n));i.set(e,n,r),i.set(n,e,r)}else for(let n=0;n<t.rows;n++)for(let r=0;r<e.rows;r++)i.set(n,r,this.kernelFunction.compute(t.getRow(n),e.getRow(r)));return i}}},8541:t=>{"use strict";const e={sigma:1,degree:1};t.exports=class{constructor(t){t=Object.assign({},e,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,e){for(var i=0,n=Math.min(t.length,e.length),r=1;r<=n;++r)i+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[r-1],r)-Math.pow(e[r-1],r),2)),this.degree);return i}}},9176:(t,e,i)=>{"use strict";const{squaredEuclidean:n}=i(4953),r={sigma:1};t.exports=class{constructor(t){t=Object.assign({},r,t),this.sigma=t.sigma}compute(t,e){return 1/(1+n(t,e)/(this.sigma*this.sigma))}}},3316:(t,e,i)=>{"use strict";const{euclidean:n}=i(4953),r={sigma:1};t.exports=class{constructor(t){t=Object.assign({},r,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const i=n(t,e);return Math.exp(-i/this.divisor)}}},1960:t=>{"use strict";t.exports=class{compute(t,e){for(var i=Math.min(t.length,e.length),n=0,r=0;r<i;++r)n+=Math.min(t[r],e[r]);return n}}},8557:(t,e,i)=>{"use strict";const{euclidean:n}=i(4953),r={sigma:1};t.exports=class{constructor(t){t=Object.assign({},r,t),this.sigma=t.sigma}compute(t,e){const i=n(t,e);return Math.exp(-i/this.sigma)}}},8609:(t,e,i)=>{"use strict";const{squaredEuclidean:n}=i(4953),r={constant:1};t.exports=class{constructor(t){t=Object.assign({},r,t),this.constant=t.constant}compute(t,e){return Math.sqrt(n(t,e)+this.constant*this.constant)}}},3029:(t,e,i)=>{"use strict";const{squaredEuclidean:n}=i(4953),r={constant:1};t.exports=class{constructor(t){t=Object.assign({},r,t),this.constant=t.constant}compute(t,e){const i=n(t,e);return 1-i/(i+this.constant)}}},414:(t,e,i)=>{var n=i(3910).FFTUtils;function r(t){var e,i,n=t;if("number"!=typeof t[0]){e=t.length,i=t[0].length,n=new Array(e*i);for(var r=0;r<e;r++)for(var s=0;s<i;s++)n[r*i+s]=t[r][s]}else{var o=Math.sqrt(t.length);Number.isInteger(o)&&(e=o,i=o)}return{data:n,rows:e,cols:i}}t.exports={fft:function(t,e,i){var s,o,a=r(t),l=a.data,h=Object.assign({normalize:!1,divisor:1,rows:a.rows,cols:a.cols},i);if(!h.rows||!h.cols)throw new Error("Invalid number of rows or columns "+s+" "+o);s=h.rows,o=h.cols;var u,c,d=h.divisor,f=e.length,g=e[0].length;if(h.normalize)for(d=0,u=0;u<f;u++)for(c=0;c<g;c++)d+=e[u][c];if(0===d)throw new RangeError("convolution: The divisor is equal to zero");var p=n.toRadix2(l,s,o),m=n.convolute(p.data,e,p.rows,p.cols);if(m=n.crop(m,p.rows,p.cols,s,o),0!=d&&1!=d)for(u=0;u<m.length;u++)m[u]/=d;return m},direct:function(t,e,i){var n,s,o=r(t),a=o.data,l=Object.assign({normalize:!1,divisor:1,rows:o.rows,cols:o.cols},i);if(!l.rows||!l.cols)throw new Error("Invalid number of rows or columns "+n+" "+s);n=l.rows,s=l.cols;var h,u,c,d,f,g,p=l.divisor,m=e.length,_=e[0].length;if(l.normalize)for(p=0,h=0;h<m;h++)for(u=0;u<_;u++)p+=e[h][u];if(0===p)throw new RangeError("convolution: The divisor is equal to zero");var w=new Array(n*s),y=Math.floor(m/2),v=Math.floor(_/2);for(d=0;d<n;d++)for(c=0;c<s;c++){for(f=0,u=0;u<m;u++)for(h=0;h<_;h++)g=e[m-u-1][_-h-1],f+=a[(d+u-y+n)%n*s+(c+h-v+s)%s]*g;w[d*s+c]=f/p}return w},kernelFactory:{LoG:function(t,e,i){var n=1e3;i&&i.factor&&(n=i.factor);var r,s,o,a,l=new Array(e);n*=-1;var h=(e-1)/2,u=2*t*t;for(r=0;r<e;r++)for(l[r]=new Array(e),a=(r-h)*(r-h),s=0;s<e;s++)o=-((s-h)*(s-h)+a)/u,l[r][s]=Math.round(n*(1+o)*Math.exp(o));return l}},matrix2Array:r}},8406:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(4091),r=i(4805);const s=" ".repeat(2),o=" ".repeat(4);function a(t,e={}){const{maxRows:i=15,maxColumns:n=10,maxNumSize:r=8,padMinus:a="auto"}=e;return`${t.constructor.name} {\n${s}[\n${o}${function(t,e,i,n,r){const{rows:s,columns:a}=t,h=Math.min(s,e),u=Math.min(a,i),c=[];if("auto"===r){r=!1;t:for(let e=0;e<h;e++)for(let i=0;i<u;i++)if(t.get(e,i)<0){r=!0;break t}}for(let e=0;e<h;e++){let i=[];for(let s=0;s<u;s++)i.push(l(t.get(e,s),n,r));c.push(`${i.join(" ")}`)}return u!==a&&(c[c.length-1]+=` ... ${a-i} more columns`),h!==s&&c.push(`... ${s-e} more rows`),c.join(`\n${o}`)}(t,i,n,r,a)}\n${s}]\n${s}rows: ${t.rows}\n${s}columns: ${t.columns}\n}`}function l(t,e,i){return(t>=0&&i?` ${h(t,e-1)}`:h(t,e)).padEnd(e)}function h(t,e){let i=t.toString();if(i.length<=e)return i;let n=t.toFixed(e);if(n.length>e&&(n=t.toFixed(Math.max(0,e-(n.length-e)))),n.length<=e&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let r=t.toExponential(e);return r.length>e&&(r=t.toExponential(Math.max(0,e-(r.length-e)))),r.slice(0)}function u(t,e,i){let n=i?t.rows:t.rows-1;if(e<0||e>n)throw new RangeError("Row index out of range")}function c(t,e,i){let n=i?t.columns:t.columns-1;if(e<0||e>n)throw new RangeError("Column index out of range")}function d(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function f(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function g(t,e){if(!n.isAnyArray(e))throw new TypeError("row indices must be an array");for(let i=0;i<e.length;i++)if(e[i]<0||e[i]>=t.rows)throw new RangeError("row indices are out of range")}function p(t,e){if(!n.isAnyArray(e))throw new TypeError("column indices must be an array");for(let i=0;i<e.length;i++)if(e[i]<0||e[i]>=t.columns)throw new RangeError("column indices are out of range")}function m(t,e,i,n,r){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(w("startRow",e),w("endRow",i),w("startColumn",n),w("endColumn",r),e>i||n>r||e<0||e>=t.rows||i<0||i>=t.rows||n<0||n>=t.columns||r<0||r>=t.columns)throw new RangeError("Submatrix indices are out of range")}function _(t,e=0){let i=[];for(let n=0;n<t;n++)i.push(e);return i}function w(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function y(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class v{static from1DArray(t,e,i){if(t*e!==i.length)throw new RangeError("data length does not match given dimensions");let n=new x(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)n.set(r,t,i[r*e+t]);return n}static rowVector(t){let e=new x(1,t.length);for(let i=0;i<t.length;i++)e.set(0,i,t[i]);return e}static columnVector(t){let e=new x(t.length,1);for(let i=0;i<t.length;i++)e.set(i,0,t[i]);return e}static zeros(t,e){return new x(t,e)}static ones(t,e){return new x(t,e).fill(1)}static rand(t,e,i={}){if("object"!=typeof i)throw new TypeError("options must be an object");const{random:n=Math.random}=i;let r=new x(t,e);for(let i=0;i<t;i++)for(let t=0;t<e;t++)r.set(i,t,n());return r}static randInt(t,e,i={}){if("object"!=typeof i)throw new TypeError("options must be an object");const{min:n=0,max:r=1e3,random:s=Math.random}=i;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(r))throw new TypeError("max must be an integer");if(n>=r)throw new RangeError("min must be smaller than max");let o=r-n,a=new x(t,e);for(let i=0;i<t;i++)for(let t=0;t<e;t++){let e=n+Math.round(s()*o);a.set(i,t,e)}return a}static eye(t,e,i){void 0===e&&(e=t),void 0===i&&(i=1);let n=Math.min(t,e),r=this.zeros(t,e);for(let t=0;t<n;t++)r.set(t,t,i);return r}static diag(t,e,i){let n=t.length;void 0===e&&(e=n),void 0===i&&(i=e);let r=Math.min(n,e,i),s=this.zeros(e,i);for(let e=0;e<r;e++)s.set(e,e,t[e]);return s}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let i=t.rows,n=t.columns,r=new x(i,n);for(let s=0;s<i;s++)for(let i=0;i<n;i++)r.set(s,i,Math.min(t.get(s,i),e.get(s,i)));return r}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let i=t.rows,n=t.columns,r=new this(i,n);for(let s=0;s<i;s++)for(let i=0;i<n;i++)r.set(s,i,Math.max(t.get(s,i),e.get(s,i)));return r}static checkMatrix(t){return v.isMatrix(t)?t:new x(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)t.call(this,e,i);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)t.push(this.get(e,i));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let i=0;i<this.columns;i++)t[e].push(this.get(e,i))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(0!==this.get(t,t))return!1;return!0}isEchelonForm(){let t=0,e=0,i=-1,n=!0,r=!1;for(;t<this.rows&&n;){for(e=0,r=!1;e<this.columns&&!1===r;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>i?(r=!0,i=e):(n=!1,r=!0);t++}return n}isReducedEchelonForm(){let t=0,e=0,i=-1,n=!0,r=!1;for(;t<this.rows&&n;){for(e=0,r=!1;e<this.columns&&!1===r;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>i?(r=!0,i=e):(n=!1,r=!0);for(let i=e+1;i<this.rows;i++)0!==this.get(t,i)&&(n=!1);t++}return n}echelonForm(){let t=this.clone(),e=0,i=0;for(;e<t.rows&&i<t.columns;){let n=e;for(let r=e;r<t.rows;r++)t.get(r,i)>t.get(n,i)&&(n=r);if(0===t.get(n,i))i++;else{t.swapRows(e,n);let r=t.get(e,i);for(let n=i;n<t.columns;n++)t.set(e,n,t.get(e,n)/r);for(let n=e+1;n<t.rows;n++){let r=t.get(n,i)/t.get(e,i);t.set(n,i,0);for(let s=i+1;s<t.columns;s++)t.set(n,s,t.get(n,s)-t.get(e,s)*r)}e++,i++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,i=t.rows,n=i-1;for(;n>=0;)if(0===t.maxRow(n))n--;else{let r=0,s=!1;for(;r<i&&!1===s;)1===t.get(n,r)?s=!0:r++;for(let i=0;i<n;i++){let s=t.get(i,r);for(let o=r;o<e;o++){let e=t.get(i,o)-s*t.get(n,o);t.set(i,o,e)}}n--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:i=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(i)||i<=0)throw new TypeError("columns must be a positive integer");let n=new x(this.rows*e,this.columns*i);for(let t=0;t<e;t++)for(let e=0;e<i;e++)n.setSubMatrix(this,this.rows*t,this.columns*e);return n}fill(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,t);return this}neg(){return this.mulS(-1)}getRow(t){u(this,t);let e=[];for(let i=0;i<this.columns;i++)e.push(this.get(t,i));return e}getRowVector(t){return x.rowVector(this.getRow(t))}setRow(t,e){u(this,t),e=d(this,e);for(let i=0;i<this.columns;i++)this.set(t,i,e[i]);return this}swapRows(t,e){u(this,t),u(this,e);for(let i=0;i<this.columns;i++){let n=this.get(t,i);this.set(t,i,this.get(e,i)),this.set(e,i,n)}return this}getColumn(t){c(this,t);let e=[];for(let i=0;i<this.rows;i++)e.push(this.get(i,t));return e}getColumnVector(t){return x.columnVector(this.getColumn(t))}setColumn(t,e){c(this,t),e=f(this,e);for(let i=0;i<this.rows;i++)this.set(i,t,e[i]);return this}swapColumns(t,e){c(this,t),c(this,e);for(let i=0;i<this.rows;i++){let n=this.get(i,t);this.set(i,t,this.get(i,e)),this.set(i,e,n)}return this}addRowVector(t){t=d(this,t);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)+t[i]);return this}subRowVector(t){t=d(this,t);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)-t[i]);return this}mulRowVector(t){t=d(this,t);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)*t[i]);return this}divRowVector(t){t=d(this,t);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)/t[i]);return this}addColumnVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)+t[e]);return this}subColumnVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)-t[e]);return this}mulColumnVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)*t[e]);return this}divColumnVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)/t[e]);return this}mulRow(t,e){u(this,t);for(let i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)*e);return this}mulColumn(t,e){c(this,t);for(let i=0;i<this.rows;i++)this.set(i,t,this.get(i,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.get(e,i)>t[e]&&(t[e]=this.get(e,i));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.get(e,i)>t[i]&&(t[i]=this.get(e,i));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.get(e,i)>t&&(t=this.get(e,i));return t}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){y(this);let t=this.get(0,0),e=[0,0];for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)>t&&(t=this.get(i,n),e[0]=i,e[1]=n);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.get(e,i)<t[e]&&(t[e]=this.get(e,i));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.get(e,i)<t[i]&&(t[i]=this.get(e,i));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.get(e,i)<t&&(t=this.get(e,i));return t}default:throw new Error(`invalid option: ${t}`)}}minIndex(){y(this);let t=this.get(0,0),e=[0,0];for(let i=0;i<this.rows;i++)for(let n=0;n<this.columns;n++)this.get(i,n)<t&&(t=this.get(i,n),e[0]=i,e[1]=n);return e}maxRow(t){if(u(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let i=1;i<this.columns;i++)this.get(t,i)>e&&(e=this.get(t,i));return e}maxRowIndex(t){u(this,t),y(this);let e=this.get(t,0),i=[t,0];for(let n=1;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n),i[1]=n);return i}minRow(t){if(u(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let i=1;i<this.columns;i++)this.get(t,i)<e&&(e=this.get(t,i));return e}minRowIndex(t){u(this,t),y(this);let e=this.get(t,0),i=[t,0];for(let n=1;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n),i[1]=n);return i}maxColumn(t){if(c(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let i=1;i<this.rows;i++)this.get(i,t)>e&&(e=this.get(i,t));return e}maxColumnIndex(t){c(this,t),y(this);let e=this.get(0,t),i=[0,t];for(let n=1;n<this.rows;n++)this.get(n,t)>e&&(e=this.get(n,t),i[0]=n);return i}minColumn(t){if(c(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let i=1;i<this.rows;i++)this.get(i,t)<e&&(e=this.get(i,t));return e}minColumnIndex(t){c(this,t),y(this);let e=this.get(0,t),i=[0,t];for(let n=1;n<this.rows;n++)this.get(n,t)<e&&(e=this.get(n,t),i[0]=n);return i}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let i=0;i<t;i++)e.push(this.get(i,i));return e}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)t+=this.get(e,i),this.set(e,i,t);return this}dot(t){v.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let i=0;for(let n=0;n<e.length;n++)i+=e[n]*t[n];return i}mmul(t){t=x.checkMatrix(t);let e=this.rows,i=this.columns,n=t.columns,r=new x(e,n),s=new Float64Array(i);for(let o=0;o<n;o++){for(let e=0;e<i;e++)s[e]=t.get(e,o);for(let t=0;t<e;t++){let e=0;for(let n=0;n<i;n++)e+=this.get(t,n)*s[n];r.set(t,o,e)}}return r}strassen2x2(t){t=x.checkMatrix(t);let e=new x(2,2);const i=this.get(0,0),n=t.get(0,0),r=this.get(0,1),s=t.get(0,1),o=this.get(1,0),a=t.get(1,0),l=this.get(1,1),h=t.get(1,1),u=(i+l)*(n+h),c=(o+l)*n,d=i*(s-h),f=l*(a-n),g=(i+r)*h,p=u+f-g+(r-l)*(a+h),m=d+g,_=c+f,w=u-c+d+(o-i)*(n+s);return e.set(0,0,p),e.set(0,1,m),e.set(1,0,_),e.set(1,1,w),e}strassen3x3(t){t=x.checkMatrix(t);let e=new x(3,3);const i=this.get(0,0),n=this.get(0,1),r=this.get(0,2),s=this.get(1,0),o=this.get(1,1),a=this.get(1,2),l=this.get(2,0),h=this.get(2,1),u=this.get(2,2),c=t.get(0,0),d=t.get(0,1),f=t.get(0,2),g=t.get(1,0),p=t.get(1,1),m=t.get(1,2),_=t.get(2,0),w=t.get(2,1),y=t.get(2,2),v=(i-s)*(-d+p),b=(-i+s+o)*(c-d+p),M=(s+o)*(-c+d),k=i*c,S=(-i+l+h)*(c-f+m),E=(-i+l)*(f-m),C=(l+h)*(-c+f),I=(-r+h+u)*(p+_-w),A=(r-u)*(p-w),T=r*_,R=(h+u)*(-_+w),P=(-r+o+a)*(m+_-y),D=(r-a)*(m-y),F=(o+a)*(-_+y),L=k+T+n*g,O=(i+n+r-s-o-h-u)*p+b+M+k+I+T+R,z=k+S+C+(i+n+r-o-a-l-h)*m+T+P+F,N=v+o*(-c+d+g-p-m-_+y)+b+k+T+P+D,B=v+b+M+k+a*w,U=T+P+D+F+s*f,G=k+S+E+h*(-c+f+g-p-m-_+w)+I+A+T,X=I+A+T+R+l*d,Y=k+S+E+C+u*y;return e.set(0,0,L),e.set(0,1,O),e.set(0,2,z),e.set(1,0,N),e.set(1,1,B),e.set(1,2,U),e.set(2,0,G),e.set(2,1,X),e.set(2,2,Y),e}mmulStrassen(t){t=x.checkMatrix(t);let e=this.clone(),i=e.rows,n=e.columns,r=t.rows,s=t.columns;function o(t,e,i){let n=t.rows,r=t.columns;if(n===e&&r===i)return t;{let n=v.zeros(e,i);return n=n.setSubMatrix(t,0,0),n}}n!==r&&console.warn(`Multiplying ${i} x ${n} and ${r} x ${s} matrix: dimensions do not match.`);let a=Math.max(i,r),l=Math.max(n,s);return e=o(e,a,l),function t(e,i,n,r){if(n<=512||r<=512)return e.mmul(i);n%2==1&&r%2==1?(e=o(e,n+1,r+1),i=o(i,n+1,r+1)):n%2==1?(e=o(e,n+1,r),i=o(i,n+1,r)):r%2==1&&(e=o(e,n,r+1),i=o(i,n,r+1));let s=parseInt(e.rows/2,10),a=parseInt(e.columns/2,10),l=e.subMatrix(0,s-1,0,a-1),h=i.subMatrix(0,s-1,0,a-1),u=e.subMatrix(0,s-1,a,e.columns-1),c=i.subMatrix(0,s-1,a,i.columns-1),d=e.subMatrix(s,e.rows-1,0,a-1),f=i.subMatrix(s,i.rows-1,0,a-1),g=e.subMatrix(s,e.rows-1,a,e.columns-1),p=i.subMatrix(s,i.rows-1,a,i.columns-1),m=t(v.add(l,g),v.add(h,p),s,a),_=t(v.add(d,g),h,s,a),w=t(l,v.sub(c,p),s,a),y=t(g,v.sub(f,h),s,a),b=t(v.add(l,u),p,s,a),x=t(v.sub(d,l),v.add(h,c),s,a),M=t(v.sub(u,g),v.add(f,p),s,a),k=v.add(m,y);k.sub(b),k.add(M);let S=v.add(w,b),E=v.add(_,y),C=v.sub(m,_);C.add(w),C.add(x);let I=v.zeros(2*k.rows,2*k.columns);return I=I.setSubMatrix(k,0,0),I=I.setSubMatrix(S,k.rows,0),I=I.setSubMatrix(E,0,k.columns),I=I.setSubMatrix(C,k.rows,k.columns),I.subMatrix(0,n-1,0,r-1)}(e,t=o(t,a,l),a,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:i=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(i))throw new TypeError("max must be a number");if(e>=i)throw new RangeError("min must be smaller than max");let n=new x(this.rows,this.columns);for(let t=0;t<this.rows;t++){const s=this.getRow(t);s.length>0&&r(s,{min:e,max:i,output:s}),n.setRow(t,s)}return n}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:i=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(i))throw new TypeError("max must be a number");if(e>=i)throw new RangeError("min must be smaller than max");let n=new x(this.rows,this.columns);for(let t=0;t<this.columns;t++){const s=this.getColumn(t);s.length&&r(s,{min:e,max:i,output:s}),n.setColumn(t,s)}return n}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let i=0;i<t;i++){let t=this.get(e,i),n=this.get(e,this.columns-1-i);this.set(e,i,n),this.set(e,this.columns-1-i,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let i=0;i<t;i++){let t=this.get(i,e),n=this.get(this.rows-1-i,e);this.set(i,e,n),this.set(this.rows-1-i,e,t)}return this}kroneckerProduct(t){t=x.checkMatrix(t);let e=this.rows,i=this.columns,n=t.rows,r=t.columns,s=new x(e*n,i*r);for(let o=0;o<e;o++)for(let e=0;e<i;e++)for(let i=0;i<n;i++)for(let a=0;a<r;a++)s.set(n*o+i,r*e+a,this.get(o,e)*t.get(i,a));return s}kroneckerSum(t){if(t=x.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,i=t.rows,n=this.kroneckerProduct(x.eye(i,i)),r=x.eye(e,e).kroneckerProduct(t);return n.add(r)}transpose(){let t=new x(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)t.set(i,e,this.get(e,i));return t}sortRows(t=b){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=b){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,i,n){m(this,t,e,i,n);let r=new x(e-t+1,n-i+1);for(let s=t;s<=e;s++)for(let e=i;e<=n;e++)r.set(s-t,e-i,this.get(s,e));return r}subMatrixRow(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=this.columns-1),e>i||e<0||e>=this.columns||i<0||i>=this.columns)throw new RangeError("Argument out of range");let n=new x(t.length,i-e+1);for(let r=0;r<t.length;r++)for(let s=e;s<=i;s++){if(t[r]<0||t[r]>=this.rows)throw new RangeError(`Row index out of range: ${t[r]}`);n.set(r,s-e,this.get(t[r],s))}return n}subMatrixColumn(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=this.rows-1),e>i||e<0||e>=this.rows||i<0||i>=this.rows)throw new RangeError("Argument out of range");let n=new x(i-e+1,t.length);for(let r=0;r<t.length;r++)for(let s=e;s<=i;s++){if(t[r]<0||t[r]>=this.columns)throw new RangeError(`Column index out of range: ${t[r]}`);n.set(s-e,r,this.get(s,t[r]))}return n}setSubMatrix(t,e,i){if((t=x.checkMatrix(t)).isEmpty())return this;m(this,e,e+t.rows-1,i,i+t.columns-1);for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)this.set(e+n,i+r,t.get(n,r));return this}selection(t,e){g(this,t),p(this,e);let i=new x(t.length,e.length);for(let n=0;n<t.length;n++){let r=t[n];for(let t=0;t<e.length;t++){let s=e[t];i.set(n,t,this.get(r,s))}}return i}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let i=0;i<t;i++)e+=this.get(i,i);return e}clone(){return this.constructor.copy(this,new x(this.rows,this.columns))}static copy(t,e){for(const[i,n,r]of t.entries())e.set(i,n,r);return e}sum(t){switch(t){case"row":return function(t){let e=_(t.rows);for(let i=0;i<t.rows;++i)for(let n=0;n<t.columns;++n)e[i]+=t.get(i,n);return e}(this);case"column":return function(t){let e=_(t.columns);for(let i=0;i<t.rows;++i)for(let n=0;n<t.columns;++n)e[n]+=t.get(i,n);return e}(this);case void 0:return function(t){let e=0;for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)e+=t.get(i,n);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=_(t.rows,1);for(let i=0;i<t.rows;++i)for(let n=0;n<t.columns;++n)e[i]*=t.get(i,n);return e}(this);case"column":return function(t){let e=_(t.columns,1);for(let i=0;i<t.rows;++i)for(let n=0;n<t.columns;++n)e[n]*=t.get(i,n);return e}(this);case void 0:return function(t){let e=1;for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)e*=t.get(i,n);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:i=!0,mean:r=this.mean(t)}=e;if("boolean"!=typeof i)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!n.isAnyArray(r))throw new TypeError("mean must be an array");return function(t,e,i){const n=t.rows,r=t.columns,s=[];for(let o=0;o<n;o++){let n=0,a=0,l=0;for(let e=0;e<r;e++)l=t.get(o,e)-i[o],n+=l,a+=l*l;e?s.push((a-n*n/r)/(r-1)):s.push((a-n*n/r)/r)}return s}(this,i,r);case"column":if(!n.isAnyArray(r))throw new TypeError("mean must be an array");return function(t,e,i){const n=t.rows,r=t.columns,s=[];for(let o=0;o<r;o++){let r=0,a=0,l=0;for(let e=0;e<n;e++)l=t.get(e,o)-i[o],r+=l,a+=l*l;e?s.push((a-r*r/n)/(n-1)):s.push((a-r*r/n)/n)}return s}(this,i,r);case void 0:if("number"!=typeof r)throw new TypeError("mean must be a number");return function(t,e,i){const n=t.rows,r=t.columns,s=n*r;let o=0,a=0,l=0;for(let e=0;e<n;e++)for(let n=0;n<r;n++)l=t.get(e,n)-i,o+=l,a+=l*l;return e?(a-o*o/s)/(s-1):(a-o*o/s)/s}(this,i,r);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const i=this.variance(t,e);if(void 0===t)return Math.sqrt(i);for(let t=0;t<i.length;t++)i[t]=Math.sqrt(i[t]);return i}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:i=this.mean(t)}=e;switch(t){case"row":if(!n.isAnyArray(i))throw new TypeError("center must be an array");return function(t,e){for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)t.set(i,n,t.get(i,n)-e[i])}(this,i),this;case"column":if(!n.isAnyArray(i))throw new TypeError("center must be an array");return function(t,e){for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)t.set(i,n,t.get(i,n)-e[n])}(this,i),this;case void 0:if("number"!=typeof i)throw new TypeError("center must be a number");return function(t,e){for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)t.set(i,n,t.get(i,n)-e)}(this,i),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let i=e.scale;switch(t){case"row":if(void 0===i)i=function(t){const e=[];for(let i=0;i<t.rows;i++){let n=0;for(let e=0;e<t.columns;e++)n+=Math.pow(t.get(i,e),2)/(t.columns-1);e.push(Math.sqrt(n))}return e}(this);else if(!n.isAnyArray(i))throw new TypeError("scale must be an array");return function(t,e){for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)t.set(i,n,t.get(i,n)/e[i])}(this,i),this;case"column":if(void 0===i)i=function(t){const e=[];for(let i=0;i<t.columns;i++){let n=0;for(let e=0;e<t.rows;e++)n+=Math.pow(t.get(e,i),2)/(t.rows-1);e.push(Math.sqrt(n))}return e}(this);else if(!n.isAnyArray(i))throw new TypeError("scale must be an array");return function(t,e){for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)t.set(i,n,t.get(i,n)/e[n])}(this,i),this;case void 0:if(void 0===i)i=function(t){const e=t.size-1;let i=0;for(let n=0;n<t.columns;n++)for(let r=0;r<t.rows;r++)i+=Math.pow(t.get(r,n),2)/e;return Math.sqrt(i)}(this);else if("number"!=typeof i)throw new TypeError("scale must be a number");return function(t,e){for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)t.set(i,n,t.get(i,n)/e)}(this,i),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return a(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield[t,e,this.get(t,e)]}*values(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield this.get(t,e)}}function b(t,e){return t-e}v.prototype.klass="Matrix","undefined"!=typeof Symbol&&(v.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return a(this)}),v.random=v.rand,v.randomInt=v.randInt,v.diagonal=v.diag,v.prototype.diagonal=v.prototype.diag,v.identity=v.eye,v.prototype.negate=v.prototype.neg,v.prototype.tensorProduct=v.prototype.kroneckerProduct;class x extends v{data;#t(t,e){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let i=0;i<t;i++)this.data.push(new Float64Array(e));this.rows=t,this.columns=e}constructor(t,e){if(super(),x.isMatrix(t))this.#t(t.rows,t.columns),x.copy(t,this);else if(Number.isInteger(t)&&t>=0)this.#t(t,e);else{if(!n.isAnyArray(t))throw new TypeError("First argument must be a positive number or an array");{const i=t;if("number"!=typeof(e=(t=i.length)?i[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<t;n++){if(i[n].length!==e)throw new RangeError("Inconsistent array dimensions");if(!i[n].every((t=>"number"==typeof t)))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(i[n]))}this.rows=t,this.columns=e}}}set(t,e,i){return this.data[t][e]=i,this}get(t,e){return this.data[t][e]}removeRow(t){return u(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),u(this,t,!0),e=Float64Array.from(d(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){c(this,t);for(let e=0;e<this.rows;e++){const i=new Float64Array(this.columns-1);for(let n=0;n<t;n++)i[n]=this.data[e][n];for(let n=t+1;n<this.columns;n++)i[n-1]=this.data[e][n];this.data[e]=i}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),c(this,t,!0),e=f(this,e);for(let i=0;i<this.rows;i++){const n=new Float64Array(this.columns+1);let r=0;for(;r<t;r++)n[r]=this.data[i][r];for(n[r++]=e[i];r<this.columns+1;r++)n[r]=this.data[i][r-1];this.data[i]=n}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)+t.get(e,i));return this},t.add=function(t,i){return new e(t).add(i)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)-t.get(e,i));return this},t.sub=function(t,i){return new e(t).sub(i)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)*t.get(e,i));return this},t.mul=function(t,i){return new e(t).mul(i)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)/t.get(e,i));return this},t.div=function(t,i){return new e(t).div(i)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)%t.get(e,i));return this},t.mod=function(t,i){return new e(t).mod(i)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)&t.get(e,i));return this},t.and=function(t,i){return new e(t).and(i)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)|t.get(e,i));return this},t.or=function(t,i){return new e(t).or(i)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)^t.get(e,i));return this},t.xor=function(t,i){return new e(t).xor(i)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)<<t.get(e,i));return this},t.leftShift=function(t,i){return new e(t).leftShift(i)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)>>t.get(e,i));return this},t.signPropagatingRightShift=function(t,i){return new e(t).signPropagatingRightShift(i)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,this.get(e,i)>>>t.get(e,i));return this},t.rightShift=function(t,i){return new e(t).rightShift(i)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,i){return new e(t).pow(i)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,Math.pow(this.get(e,i),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this.set(e,i,Math.pow(this.get(e,i),t.get(e,i)));return this}}(v,x);class M extends v{#e;get size(){return this.#e.size}get rows(){return this.#e.rows}get columns(){return this.#e.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(t){return x.isMatrix(t)&&"SymmetricMatrix"===t.klassType}static zeros(t){return new this(t)}static ones(t){return new this(t).fill(1)}constructor(t){if(super(),x.isMatrix(t)){if(!t.isSymmetric())throw new TypeError("not symmetric data");this.#e=x.copy(t,new x(t.rows,t.rows))}else if(Number.isInteger(t)&&t>=0)this.#e=new x(t,t);else if(this.#e=new x(t),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const t=new M(this.diagonalSize);for(const[e,i,n]of this.upperRightEntries())t.set(e,i,n);return t}toMatrix(){return new x(this)}get(t,e){return this.#e.get(t,e)}set(t,e,i){return this.#e.set(t,e,i),this.#e.set(e,t,i),this}removeCross(t){return this.#e.removeRow(t),this.#e.removeColumn(t),this}addCross(t,e){void 0===e&&(e=t,t=this.diagonalSize);const i=e.slice();return i.splice(t,1),this.#e.addRow(t,i),this.#e.addColumn(t,e),this}applyMask(t){if(t.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const e=[];for(const[i,n]of t.entries())n||e.push(i);e.reverse();for(const t of e)this.removeCross(t);return this}toCompact(){const{diagonalSize:t}=this,e=new Array(t*(t+1)/2);for(let i=0,n=0,r=0;r<e.length;r++)e[r]=this.get(n,i),++i>=t&&(i=++n);return e}static fromCompact(t){const e=t.length,i=(Math.sqrt(8*e+1)-1)/2;if(!Number.isInteger(i))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(t)}`);const n=new M(i);for(let r=0,s=0,o=0;o<e;o++)n.set(r,s,t[o]),++r>=i&&(r=++s);return n}*upperRightEntries(){for(let t=0,e=0;t<this.diagonalSize;void 0){const i=this.get(t,e);yield[t,e,i],++e>=this.diagonalSize&&(e=++t)}}*upperRightValues(){for(let t=0,e=0;t<this.diagonalSize;void 0){const i=this.get(t,e);yield i,++e>=this.diagonalSize&&(e=++t)}}}M.prototype.klassType="SymmetricMatrix";class k extends M{static isDistanceMatrix(t){return M.isSymmetricMatrix(t)&&"DistanceMatrix"===t.klassSubType}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,e,i){return t===e&&(i=0),super.set(t,e,i)}addCross(t,e){return void 0===e&&(e=t,t=this.diagonalSize),(e=e.slice())[t]=0,super.addCross(t,e)}toSymmetricMatrix(){return new M(this)}clone(){const t=new k(this.diagonalSize);for(const[e,i,n]of this.upperRightEntries())e!==i&&t.set(e,i,n);return t}toCompact(){const{diagonalSize:t}=this,e=new Array((t-1)*t/2);for(let i=1,n=0,r=0;r<e.length;r++)e[r]=this.get(n,i),++i>=t&&(i=1+ ++n);return e}static fromCompact(t){const e=t.length,i=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(i))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const n=new this(i);for(let r=1,s=0,o=0;o<e;o++)n.set(r,s,t[o]),++r>=i&&(r=1+ ++s);return n}}k.prototype.klassSubType="DistanceMatrix";class S extends v{constructor(t,e,i){super(),this.matrix=t,this.rows=e,this.columns=i}}class E extends S{constructor(t,e,i){g(t,e),p(t,i),super(t,e.length,i.length),this.rowIndices=e,this.columnIndices=i}set(t,e,i){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],i),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class C extends v{constructor(t,e={}){const{rows:i=1}=e;if(t.length%i!=0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=i,this.columns=t.length/i,this.data=t}set(t,e,i){let n=this._calculateIndex(t,e);return this.data[n]=i,this}get(t,e){let i=this._calculateIndex(t,e);return this.data[i]}_calculateIndex(t,e){return t*this.columns+e}}class I extends v{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,i){return this.data[t][e]=i,this}get(t,e){return this.data[t][e]}}class A{constructor(t){let e,i,n,r,s,o,a,l,h,u=(t=I.checkMatrix(t)).clone(),c=u.rows,d=u.columns,f=new Float64Array(c),g=1;for(e=0;e<c;e++)f[e]=e;for(l=new Float64Array(c),i=0;i<d;i++){for(e=0;e<c;e++)l[e]=u.get(e,i);for(e=0;e<c;e++){for(h=Math.min(e,i),s=0,n=0;n<h;n++)s+=u.get(e,n)*l[n];l[e]-=s,u.set(e,i,l[e])}for(r=i,e=i+1;e<c;e++)Math.abs(l[e])>Math.abs(l[r])&&(r=e);if(r!==i){for(n=0;n<d;n++)o=u.get(r,n),u.set(r,n,u.get(i,n)),u.set(i,n,o);a=f[r],f[r]=f[i],f[i]=a,g=-g}if(i<c&&0!==u.get(i,i))for(e=i+1;e<c;e++)u.set(e,i,u.get(e,i)/u.get(i,i))}this.LU=u,this.pivotVector=f,this.pivotSign=g}isSingular(){let t=this.LU,e=t.columns;for(let i=0;i<e;i++)if(0===t.get(i,i))return!0;return!1}solve(t){t=x.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let i,n,r,s=t.columns,o=t.subMatrixRow(this.pivotVector,0,s-1),a=e.columns;for(r=0;r<a;r++)for(i=r+1;i<a;i++)for(n=0;n<s;n++)o.set(i,n,o.get(i,n)-o.get(r,n)*e.get(i,r));for(r=a-1;r>=0;r--){for(n=0;n<s;n++)o.set(r,n,o.get(r,n)/e.get(r,r));for(i=0;i<r;i++)for(n=0;n<s;n++)o.set(i,n,o.get(i,n)-o.get(r,n)*e.get(i,r))}return o}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,i=t.columns;for(let n=0;n<i;n++)e*=t.get(n,n);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,i=t.columns,n=new x(e,i);for(let r=0;r<e;r++)for(let e=0;e<i;e++)r>e?n.set(r,e,t.get(r,e)):r===e?n.set(r,e,1):n.set(r,e,0);return n}get upperTriangularMatrix(){let t=this.LU,e=t.rows,i=t.columns,n=new x(e,i);for(let r=0;r<e;r++)for(let e=0;e<i;e++)r<=e?n.set(r,e,t.get(r,e)):n.set(r,e,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function T(t,e){let i=0;return Math.abs(t)>Math.abs(e)?(i=e/t,Math.abs(t)*Math.sqrt(1+i*i)):0!==e?(i=t/e,Math.abs(e)*Math.sqrt(1+i*i)):0}class R{constructor(t){let e,i,n,r,s=(t=I.checkMatrix(t)).clone(),o=t.rows,a=t.columns,l=new Float64Array(a);for(n=0;n<a;n++){let t=0;for(e=n;e<o;e++)t=T(t,s.get(e,n));if(0!==t){for(s.get(n,n)<0&&(t=-t),e=n;e<o;e++)s.set(e,n,s.get(e,n)/t);for(s.set(n,n,s.get(n,n)+1),i=n+1;i<a;i++){for(r=0,e=n;e<o;e++)r+=s.get(e,n)*s.get(e,i);for(r=-r/s.get(n,n),e=n;e<o;e++)s.set(e,i,s.get(e,i)+r*s.get(e,n))}}l[n]=-t}this.QR=s,this.Rdiag=l}solve(t){t=x.checkMatrix(t);let e=this.QR,i=e.rows;if(t.rows!==i)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n,r,s,o,a=t.columns,l=t.clone(),h=e.columns;for(s=0;s<h;s++)for(r=0;r<a;r++){for(o=0,n=s;n<i;n++)o+=e.get(n,s)*l.get(n,r);for(o=-o/e.get(s,s),n=s;n<i;n++)l.set(n,r,l.get(n,r)+o*e.get(n,s))}for(s=h-1;s>=0;s--){for(r=0;r<a;r++)l.set(s,r,l.get(s,r)/this.Rdiag[s]);for(n=0;n<s;n++)for(r=0;r<a;r++)l.set(n,r,l.get(n,r)-l.get(s,r)*e.get(n,s))}return l.subMatrix(0,h-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,i=this.QR,n=i.columns,r=new x(n,n);for(t=0;t<n;t++)for(e=0;e<n;e++)t<e?r.set(t,e,i.get(t,e)):t===e?r.set(t,e,this.Rdiag[t]):r.set(t,e,0);return r}get orthogonalMatrix(){let t,e,i,n,r=this.QR,s=r.rows,o=r.columns,a=new x(s,o);for(i=o-1;i>=0;i--){for(t=0;t<s;t++)a.set(t,i,0);for(a.set(i,i,1),e=i;e<o;e++)if(0!==r.get(i,i)){for(n=0,t=i;t<s;t++)n+=r.get(t,i)*a.get(t,e);for(n=-n/r.get(i,i),t=i;t<s;t++)a.set(t,e,a.get(t,e)+n*r.get(t,i))}}return a}}class P{constructor(t,e={}){if((t=I.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let i=t.rows,n=t.columns;const{computeLeftSingularVectors:r=!0,computeRightSingularVectors:s=!0,autoTranspose:o=!1}=e;let a,l=Boolean(r),h=Boolean(s),u=!1;if(i<n)if(o){a=t.transpose(),i=a.rows,n=a.columns,u=!0;let e=l;l=h,h=e}else a=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=t.clone();let c=Math.min(i,n),d=Math.min(i+1,n),f=new Float64Array(d),g=new x(i,c),p=new x(n,n),m=new Float64Array(n),_=new Float64Array(i),w=new Float64Array(d);for(let t=0;t<d;t++)w[t]=t;let y=Math.min(i-1,n),v=Math.max(0,Math.min(n-2,i)),b=Math.max(y,v);for(let t=0;t<b;t++){if(t<y){f[t]=0;for(let e=t;e<i;e++)f[t]=T(f[t],a.get(e,t));if(0!==f[t]){a.get(t,t)<0&&(f[t]=-f[t]);for(let e=t;e<i;e++)a.set(e,t,a.get(e,t)/f[t]);a.set(t,t,a.get(t,t)+1)}f[t]=-f[t]}for(let e=t+1;e<n;e++){if(t<y&&0!==f[t]){let n=0;for(let r=t;r<i;r++)n+=a.get(r,t)*a.get(r,e);n=-n/a.get(t,t);for(let r=t;r<i;r++)a.set(r,e,a.get(r,e)+n*a.get(r,t))}m[e]=a.get(t,e)}if(l&&t<y)for(let e=t;e<i;e++)g.set(e,t,a.get(e,t));if(t<v){m[t]=0;for(let e=t+1;e<n;e++)m[t]=T(m[t],m[e]);if(0!==m[t]){m[t+1]<0&&(m[t]=0-m[t]);for(let e=t+1;e<n;e++)m[e]/=m[t];m[t+1]+=1}if(m[t]=-m[t],t+1<i&&0!==m[t]){for(let e=t+1;e<i;e++)_[e]=0;for(let e=t+1;e<i;e++)for(let i=t+1;i<n;i++)_[e]+=m[i]*a.get(e,i);for(let e=t+1;e<n;e++){let n=-m[e]/m[t+1];for(let r=t+1;r<i;r++)a.set(r,e,a.get(r,e)+n*_[r])}}if(h)for(let e=t+1;e<n;e++)p.set(e,t,m[e])}}let M=Math.min(n,i+1);if(y<n&&(f[y]=a.get(y,y)),i<M&&(f[M-1]=0),v+1<M&&(m[v]=a.get(v,M-1)),m[M-1]=0,l){for(let t=y;t<c;t++){for(let e=0;e<i;e++)g.set(e,t,0);g.set(t,t,1)}for(let t=y-1;t>=0;t--)if(0!==f[t]){for(let e=t+1;e<c;e++){let n=0;for(let r=t;r<i;r++)n+=g.get(r,t)*g.get(r,e);n=-n/g.get(t,t);for(let r=t;r<i;r++)g.set(r,e,g.get(r,e)+n*g.get(r,t))}for(let e=t;e<i;e++)g.set(e,t,-g.get(e,t));g.set(t,t,1+g.get(t,t));for(let e=0;e<t-1;e++)g.set(e,t,0)}else{for(let e=0;e<i;e++)g.set(e,t,0);g.set(t,t,1)}}if(h)for(let t=n-1;t>=0;t--){if(t<v&&0!==m[t])for(let e=t+1;e<n;e++){let i=0;for(let r=t+1;r<n;r++)i+=p.get(r,t)*p.get(r,e);i=-i/p.get(t+1,t);for(let r=t+1;r<n;r++)p.set(r,e,p.get(r,e)+i*p.get(r,t))}for(let e=0;e<n;e++)p.set(e,t,0);p.set(t,t,1)}let k=M-1,S=Number.EPSILON;for(;M>0;){let t,e;for(t=M-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+S*Math.abs(f[t]+Math.abs(f[t+1]));if(Math.abs(m[t])<=e||Number.isNaN(m[t])){m[t]=0;break}}if(t===M-2)e=4;else{let i;for(i=M-1;i>=t&&i!==t;i--){let e=(i!==M?Math.abs(m[i]):0)+(i!==t+1?Math.abs(m[i-1]):0);if(Math.abs(f[i])<=S*e){f[i]=0;break}}i===t?e=3:i===M-1?e=1:(e=2,t=i)}switch(t++,e){case 1:{let e=m[M-2];m[M-2]=0;for(let i=M-2;i>=t;i--){let r=T(f[i],e),s=f[i]/r,o=e/r;if(f[i]=r,i!==t&&(e=-o*m[i-1],m[i-1]=s*m[i-1]),h)for(let t=0;t<n;t++)r=s*p.get(t,i)+o*p.get(t,M-1),p.set(t,M-1,-o*p.get(t,i)+s*p.get(t,M-1)),p.set(t,i,r)}break}case 2:{let e=m[t-1];m[t-1]=0;for(let n=t;n<M;n++){let r=T(f[n],e),s=f[n]/r,o=e/r;if(f[n]=r,e=-o*m[n],m[n]=s*m[n],l)for(let e=0;e<i;e++)r=s*g.get(e,n)+o*g.get(e,t-1),g.set(e,t-1,-o*g.get(e,n)+s*g.get(e,t-1)),g.set(e,n,r)}break}case 3:{const e=Math.max(Math.abs(f[M-1]),Math.abs(f[M-2]),Math.abs(m[M-2]),Math.abs(f[t]),Math.abs(m[t])),r=f[M-1]/e,s=f[M-2]/e,o=m[M-2]/e,a=f[t]/e,u=m[t]/e,c=((s+r)*(s-r)+o*o)/2,d=r*o*(r*o);let _=0;0===c&&0===d||(_=c<0?0-Math.sqrt(c*c+d):Math.sqrt(c*c+d),_=d/(c+_));let w=(a+r)*(a-r)+_,y=a*u;for(let e=t;e<M-1;e++){let r=T(w,y);0===r&&(r=Number.MIN_VALUE);let s=w/r,o=y/r;if(e!==t&&(m[e-1]=r),w=s*f[e]+o*m[e],m[e]=s*m[e]-o*f[e],y=o*f[e+1],f[e+1]=s*f[e+1],h)for(let t=0;t<n;t++)r=s*p.get(t,e)+o*p.get(t,e+1),p.set(t,e+1,-o*p.get(t,e)+s*p.get(t,e+1)),p.set(t,e,r);if(r=T(w,y),0===r&&(r=Number.MIN_VALUE),s=w/r,o=y/r,f[e]=r,w=s*m[e]+o*f[e+1],f[e+1]=-o*m[e]+s*f[e+1],y=o*m[e+1],m[e+1]=s*m[e+1],l&&e<i-1)for(let t=0;t<i;t++)r=s*g.get(t,e)+o*g.get(t,e+1),g.set(t,e+1,-o*g.get(t,e)+s*g.get(t,e+1)),g.set(t,e,r)}m[M-2]=w;break}case 4:if(f[t]<=0&&(f[t]=f[t]<0?-f[t]:0,h))for(let e=0;e<=k;e++)p.set(e,t,-p.get(e,t));for(;t<k&&!(f[t]>=f[t+1]);){let e=f[t];if(f[t]=f[t+1],f[t+1]=e,h&&t<n-1)for(let i=0;i<n;i++)e=p.get(i,t+1),p.set(i,t+1,p.get(i,t)),p.set(i,t,e);if(l&&t<i-1)for(let n=0;n<i;n++)e=g.get(n,t+1),g.set(n,t+1,g.get(n,t)),g.set(n,t,e);t++}M--}}if(u){let t=p;p=g,g=t}this.m=i,this.n=n,this.s=f,this.U=g,this.V=p}solve(t){let e=t,i=this.threshold,n=this.s.length,r=x.zeros(n,n);for(let t=0;t<n;t++)Math.abs(this.s[t])<=i?r.set(t,t,0):r.set(t,t,1/this.s[t]);let s=this.U,o=this.rightSingularVectors,a=o.mmul(r),l=o.rows,h=s.rows,u=x.zeros(l,h);for(let t=0;t<l;t++)for(let e=0;e<h;e++){let i=0;for(let r=0;r<n;r++)i+=a.get(t,r)*s.get(e,r);u.set(t,e,i)}return u.mmul(e)}solveForDiagonal(t){return this.solve(x.diag(t))}inverse(){let t=this.V,e=this.threshold,i=t.rows,n=t.columns,r=new x(i,this.s.length);for(let s=0;s<i;s++)for(let i=0;i<n;i++)Math.abs(this.s[i])>e&&r.set(s,i,t.get(s,i)/this.s[i]);let s=this.U,o=s.rows,a=s.columns,l=new x(i,o);for(let t=0;t<i;t++)for(let e=0;e<o;e++){let i=0;for(let n=0;n<a;n++)i+=r.get(t,n)*s.get(e,n);l.set(t,e,i)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,i=this.s;for(let n=0,r=i.length;n<r;n++)i[n]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return x.diag(this.s)}}function D(t,e,i=!1){return t=I.checkMatrix(t),e=I.checkMatrix(e),i?new P(t).solve(e):t.isSquare()?new A(t).solve(e):new R(t).solve(e)}function F(t,e){let i=[];for(let n=0;n<t;n++)n!==e&&i.push(n);return i}function L(t,e,i,n=1e-9,r=1e-9){if(t>r)return new Array(e.rows+1).fill(0);{let t=e.addRow(i,[0]);for(let e=0;e<t.rows;e++)Math.abs(t.get(e,0))<n&&t.set(e,0,0);return t.to1DArray()}}class O{constructor(t,e={}){const{assumeSymmetric:i=!1}=e;if(!(t=I.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let n,r,s=t.columns,o=new x(s,s),a=new Float64Array(s),l=new Float64Array(s),h=t,u=!1;if(u=!!i||t.isSymmetric(),u){for(n=0;n<s;n++)for(r=0;r<s;r++)o.set(n,r,h.get(n,r));!function(t,e,i,n){let r,s,o,a,l,h,u,c;for(l=0;l<t;l++)i[l]=n.get(t-1,l);for(a=t-1;a>0;a--){for(c=0,o=0,h=0;h<a;h++)c+=Math.abs(i[h]);if(0===c)for(e[a]=i[a-1],l=0;l<a;l++)i[l]=n.get(a-1,l),n.set(a,l,0),n.set(l,a,0);else{for(h=0;h<a;h++)i[h]/=c,o+=i[h]*i[h];for(r=i[a-1],s=Math.sqrt(o),r>0&&(s=-s),e[a]=c*s,o-=r*s,i[a-1]=r-s,l=0;l<a;l++)e[l]=0;for(l=0;l<a;l++){for(r=i[l],n.set(l,a,r),s=e[l]+n.get(l,l)*r,h=l+1;h<=a-1;h++)s+=n.get(h,l)*i[h],e[h]+=n.get(h,l)*r;e[l]=s}for(r=0,l=0;l<a;l++)e[l]/=o,r+=e[l]*i[l];for(u=r/(o+o),l=0;l<a;l++)e[l]-=u*i[l];for(l=0;l<a;l++){for(r=i[l],s=e[l],h=l;h<=a-1;h++)n.set(h,l,n.get(h,l)-(r*e[h]+s*i[h]));i[l]=n.get(a-1,l),n.set(a,l,0)}}i[a]=o}for(a=0;a<t-1;a++){if(n.set(t-1,a,n.get(a,a)),n.set(a,a,1),o=i[a+1],0!==o){for(h=0;h<=a;h++)i[h]=n.get(h,a+1)/o;for(l=0;l<=a;l++){for(s=0,h=0;h<=a;h++)s+=n.get(h,a+1)*n.get(h,l);for(h=0;h<=a;h++)n.set(h,l,n.get(h,l)-s*i[h])}}for(h=0;h<=a;h++)n.set(h,a+1,0)}for(l=0;l<t;l++)i[l]=n.get(t-1,l),n.set(t-1,l,0);n.set(t-1,t-1,1),e[0]=0}(s,l,a,o),function(t,e,i,n){let r,s,o,a,l,h,u,c,d,f,g,p,m,_,w,y;for(o=1;o<t;o++)e[o-1]=e[o];e[t-1]=0;let v=0,b=0,x=Number.EPSILON;for(h=0;h<t;h++){for(b=Math.max(b,Math.abs(i[h])+Math.abs(e[h])),u=h;u<t&&!(Math.abs(e[u])<=x*b);)u++;if(u>h)do{for(r=i[h],c=(i[h+1]-r)/(2*e[h]),d=T(c,1),c<0&&(d=-d),i[h]=e[h]/(c+d),i[h+1]=e[h]*(c+d),f=i[h+1],s=r-i[h],o=h+2;o<t;o++)i[o]-=s;for(v+=s,c=i[u],g=1,p=g,m=g,_=e[h+1],w=0,y=0,o=u-1;o>=h;o--)for(m=p,p=g,y=w,r=g*e[o],s=g*c,d=T(c,e[o]),e[o+1]=w*d,w=e[o]/d,g=c/d,c=g*i[o]-w*r,i[o+1]=s+w*(g*r+w*i[o]),l=0;l<t;l++)s=n.get(l,o+1),n.set(l,o+1,w*n.get(l,o)+g*s),n.set(l,o,g*n.get(l,o)-w*s);c=-w*y*m*_*e[h]/f,e[h]=w*c,i[h]=g*c}while(Math.abs(e[h])>x*b);i[h]=i[h]+v,e[h]=0}for(o=0;o<t-1;o++){for(l=o,c=i[o],a=o+1;a<t;a++)i[a]<c&&(l=a,c=i[a]);if(l!==o)for(i[l]=i[o],i[o]=c,a=0;a<t;a++)c=n.get(a,o),n.set(a,o,n.get(a,l)),n.set(a,l,c)}}(s,l,a,o)}else{let t=new x(s,s),e=new Float64Array(s);for(r=0;r<s;r++)for(n=0;n<s;n++)t.set(n,r,h.get(n,r));!function(t,e,i,n){let r,s,o,a,l,h,u,c=t-1;for(h=1;h<=c-1;h++){for(u=0,a=h;a<=c;a++)u+=Math.abs(e.get(a,h-1));if(0!==u){for(o=0,a=c;a>=h;a--)i[a]=e.get(a,h-1)/u,o+=i[a]*i[a];for(s=Math.sqrt(o),i[h]>0&&(s=-s),o-=i[h]*s,i[h]=i[h]-s,l=h;l<t;l++){for(r=0,a=c;a>=h;a--)r+=i[a]*e.get(a,l);for(r/=o,a=h;a<=c;a++)e.set(a,l,e.get(a,l)-r*i[a])}for(a=0;a<=c;a++){for(r=0,l=c;l>=h;l--)r+=i[l]*e.get(a,l);for(r/=o,l=h;l<=c;l++)e.set(a,l,e.get(a,l)-r*i[l])}i[h]=u*i[h],e.set(h,h-1,u*s)}}for(a=0;a<t;a++)for(l=0;l<t;l++)n.set(a,l,a===l?1:0);for(h=c-1;h>=1;h--)if(0!==e.get(h,h-1)){for(a=h+1;a<=c;a++)i[a]=e.get(a,h-1);for(l=h;l<=c;l++){for(s=0,a=h;a<=c;a++)s+=i[a]*n.get(a,l);for(s=s/i[h]/e.get(h,h-1),a=h;a<=c;a++)n.set(a,l,n.get(a,l)+s*i[a])}}}(s,t,e,o),function(t,e,i,n,r){let s,o,a,l,h,u,c,d,f,g,p,m,_,w,y,v=t-1,b=t-1,x=Number.EPSILON,M=0,k=0,S=0,E=0,C=0,I=0,A=0,T=0;for(s=0;s<t;s++)for((s<0||s>b)&&(i[s]=r.get(s,s),e[s]=0),o=Math.max(s-1,0);o<t;o++)k+=Math.abs(r.get(s,o));for(;v>=0;){for(l=v;l>0&&(I=Math.abs(r.get(l-1,l-1))+Math.abs(r.get(l,l)),0===I&&(I=k),!(Math.abs(r.get(l,l-1))<x*I));)l--;if(l===v)r.set(v,v,r.get(v,v)+M),i[v]=r.get(v,v),e[v]=0,v--,T=0;else if(l===v-1){if(c=r.get(v,v-1)*r.get(v-1,v),S=(r.get(v-1,v-1)-r.get(v,v))/2,E=S*S+c,A=Math.sqrt(Math.abs(E)),r.set(v,v,r.get(v,v)+M),r.set(v-1,v-1,r.get(v-1,v-1)+M),d=r.get(v,v),E>=0){for(A=S>=0?S+A:S-A,i[v-1]=d+A,i[v]=i[v-1],0!==A&&(i[v]=d-c/A),e[v-1]=0,e[v]=0,d=r.get(v,v-1),I=Math.abs(d)+Math.abs(A),S=d/I,E=A/I,C=Math.sqrt(S*S+E*E),S/=C,E/=C,o=v-1;o<t;o++)A=r.get(v-1,o),r.set(v-1,o,E*A+S*r.get(v,o)),r.set(v,o,E*r.get(v,o)-S*A);for(s=0;s<=v;s++)A=r.get(s,v-1),r.set(s,v-1,E*A+S*r.get(s,v)),r.set(s,v,E*r.get(s,v)-S*A);for(s=0;s<=b;s++)A=n.get(s,v-1),n.set(s,v-1,E*A+S*n.get(s,v)),n.set(s,v,E*n.get(s,v)-S*A)}else i[v-1]=d+S,i[v]=d+S,e[v-1]=A,e[v]=-A;v-=2,T=0}else{if(d=r.get(v,v),f=0,c=0,l<v&&(f=r.get(v-1,v-1),c=r.get(v,v-1)*r.get(v-1,v)),10===T){for(M+=d,s=0;s<=v;s++)r.set(s,s,r.get(s,s)-d);I=Math.abs(r.get(v,v-1))+Math.abs(r.get(v-1,v-2)),d=f=.75*I,c=-.4375*I*I}if(30===T&&(I=(f-d)/2,I=I*I+c,I>0)){for(I=Math.sqrt(I),f<d&&(I=-I),I=d-c/((f-d)/2+I),s=0;s<=v;s++)r.set(s,s,r.get(s,s)-I);M+=I,d=f=c=.964}for(T+=1,h=v-2;h>=l&&(A=r.get(h,h),C=d-A,I=f-A,S=(C*I-c)/r.get(h+1,h)+r.get(h,h+1),E=r.get(h+1,h+1)-A-C-I,C=r.get(h+2,h+1),I=Math.abs(S)+Math.abs(E)+Math.abs(C),S/=I,E/=I,C/=I,h!==l)&&!(Math.abs(r.get(h,h-1))*(Math.abs(E)+Math.abs(C))<x*(Math.abs(S)*(Math.abs(r.get(h-1,h-1))+Math.abs(A)+Math.abs(r.get(h+1,h+1)))));)h--;for(s=h+2;s<=v;s++)r.set(s,s-2,0),s>h+2&&r.set(s,s-3,0);for(a=h;a<=v-1&&(w=a!==v-1,a!==h&&(S=r.get(a,a-1),E=r.get(a+1,a-1),C=w?r.get(a+2,a-1):0,d=Math.abs(S)+Math.abs(E)+Math.abs(C),0!==d&&(S/=d,E/=d,C/=d)),0!==d);a++)if(I=Math.sqrt(S*S+E*E+C*C),S<0&&(I=-I),0!==I){for(a!==h?r.set(a,a-1,-I*d):l!==h&&r.set(a,a-1,-r.get(a,a-1)),S+=I,d=S/I,f=E/I,A=C/I,E/=S,C/=S,o=a;o<t;o++)S=r.get(a,o)+E*r.get(a+1,o),w&&(S+=C*r.get(a+2,o),r.set(a+2,o,r.get(a+2,o)-S*A)),r.set(a,o,r.get(a,o)-S*d),r.set(a+1,o,r.get(a+1,o)-S*f);for(s=0;s<=Math.min(v,a+3);s++)S=d*r.get(s,a)+f*r.get(s,a+1),w&&(S+=A*r.get(s,a+2),r.set(s,a+2,r.get(s,a+2)-S*C)),r.set(s,a,r.get(s,a)-S),r.set(s,a+1,r.get(s,a+1)-S*E);for(s=0;s<=b;s++)S=d*n.get(s,a)+f*n.get(s,a+1),w&&(S+=A*n.get(s,a+2),n.set(s,a+2,n.get(s,a+2)-S*C)),n.set(s,a,n.get(s,a)-S),n.set(s,a+1,n.get(s,a+1)-S*E)}}}if(0!==k){for(v=t-1;v>=0;v--)if(S=i[v],E=e[v],0===E)for(l=v,r.set(v,v,1),s=v-1;s>=0;s--){for(c=r.get(s,s)-S,C=0,o=l;o<=v;o++)C+=r.get(s,o)*r.get(o,v);if(e[s]<0)A=c,I=C;else if(l=s,0===e[s]?r.set(s,v,0!==c?-C/c:-C/(x*k)):(d=r.get(s,s+1),f=r.get(s+1,s),E=(i[s]-S)*(i[s]-S)+e[s]*e[s],u=(d*I-A*C)/E,r.set(s,v,u),r.set(s+1,v,Math.abs(d)>Math.abs(A)?(-C-c*u)/d:(-I-f*u)/A)),u=Math.abs(r.get(s,v)),x*u*u>1)for(o=s;o<=v;o++)r.set(o,v,r.get(o,v)/u)}else if(E<0)for(l=v-1,Math.abs(r.get(v,v-1))>Math.abs(r.get(v-1,v))?(r.set(v-1,v-1,E/r.get(v,v-1)),r.set(v-1,v,-(r.get(v,v)-S)/r.get(v,v-1))):(y=z(0,-r.get(v-1,v),r.get(v-1,v-1)-S,E),r.set(v-1,v-1,y[0]),r.set(v-1,v,y[1])),r.set(v,v-1,0),r.set(v,v,1),s=v-2;s>=0;s--){for(g=0,p=0,o=l;o<=v;o++)g+=r.get(s,o)*r.get(o,v-1),p+=r.get(s,o)*r.get(o,v);if(c=r.get(s,s)-S,e[s]<0)A=c,C=g,I=p;else if(l=s,0===e[s]?(y=z(-g,-p,c,E),r.set(s,v-1,y[0]),r.set(s,v,y[1])):(d=r.get(s,s+1),f=r.get(s+1,s),m=(i[s]-S)*(i[s]-S)+e[s]*e[s]-E*E,_=2*(i[s]-S)*E,0===m&&0===_&&(m=x*k*(Math.abs(c)+Math.abs(E)+Math.abs(d)+Math.abs(f)+Math.abs(A))),y=z(d*C-A*g+E*p,d*I-A*p-E*g,m,_),r.set(s,v-1,y[0]),r.set(s,v,y[1]),Math.abs(d)>Math.abs(A)+Math.abs(E)?(r.set(s+1,v-1,(-g-c*r.get(s,v-1)+E*r.get(s,v))/d),r.set(s+1,v,(-p-c*r.get(s,v)-E*r.get(s,v-1))/d)):(y=z(-C-f*r.get(s,v-1),-I-f*r.get(s,v),A,E),r.set(s+1,v-1,y[0]),r.set(s+1,v,y[1]))),u=Math.max(Math.abs(r.get(s,v-1)),Math.abs(r.get(s,v))),x*u*u>1)for(o=s;o<=v;o++)r.set(o,v-1,r.get(o,v-1)/u),r.set(o,v,r.get(o,v)/u)}for(s=0;s<t;s++)if(s<0||s>b)for(o=s;o<t;o++)n.set(s,o,r.get(s,o));for(o=t-1;o>=0;o--)for(s=0;s<=b;s++){for(A=0,a=0;a<=Math.min(o,b);a++)A+=n.get(s,a)*r.get(a,o);n.set(s,o,A)}}}(s,l,a,o,t)}this.n=s,this.e=l,this.d=a,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,i=this.n,n=this.e,r=this.d,s=new x(i,i);for(t=0;t<i;t++){for(e=0;e<i;e++)s.set(t,e,0);s.set(t,t,r[t]),n[t]>0?s.set(t,t+1,n[t]):n[t]<0&&s.set(t,t-1,n[t])}return s}}function z(t,e,i,n){let r,s;return Math.abs(i)>Math.abs(n)?(r=n/i,s=i+r*n,[(t+r*e)/s,(e-r*t)/s]):(r=i/n,s=n+r*i,[(r*t+e)/s,(r*e-t)/s])}class N{constructor(t){if(!(t=I.checkMatrix(t)).isSymmetric())throw new Error("Matrix is not symmetric");let e,i,n,r=t,s=r.rows,o=new x(s,s),a=!0;for(i=0;i<s;i++){let t=0;for(n=0;n<i;n++){let s=0;for(e=0;e<n;e++)s+=o.get(n,e)*o.get(i,e);s=(r.get(i,n)-s)/o.get(n,n),o.set(i,n,s),t+=s*s}for(t=r.get(i,i)-t,a&=t>0,o.set(i,i,Math.sqrt(Math.max(t,0))),n=i+1;n<s;n++)o.set(i,n,0)}this.L=o,this.positiveDefinite=Boolean(a)}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=I.checkMatrix(t);let e=this.L,i=e.rows;if(t.rows!==i)throw new Error("Matrix dimensions do not match");if(!1===this.isPositiveDefinite())throw new Error("Matrix is not positive definite");let n,r,s,o=t.columns,a=t.clone();for(s=0;s<i;s++)for(r=0;r<o;r++){for(n=0;n<s;n++)a.set(s,r,a.get(s,r)-a.get(n,r)*e.get(s,n));a.set(s,r,a.get(s,r)/e.get(s,s))}for(s=i-1;s>=0;s--)for(r=0;r<o;r++){for(n=s+1;n<i;n++)a.set(s,r,a.get(s,r)-a.get(n,r)*e.get(n,s));a.set(s,r,a.get(s,r)/e.get(s,s))}return a}get lowerTriangularMatrix(){return this.L}}class B{constructor(t,e={}){t=I.checkMatrix(t);let{Y:i}=e;const{scaleScores:r=!1,maxIterations:s=1e3,terminationCriteria:o=1e-10}=e;let a;if(i){if(i=n.isAnyArray(i)&&"number"==typeof i[0]?x.columnVector(i):I.checkMatrix(i),i.rows!==t.rows)throw new Error("Y should have the same number of rows as X");a=i.getColumnVector(0)}else a=t.getColumnVector(0);let l,h,u,c,d=1;for(let e=0;e<s&&d>o;e++)u=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),u=u.div(u.norm()),l=t.mmul(u).div(u.transpose().mmul(u).get(0,0)),e>0&&(d=l.clone().sub(c).pow(2).sum()),c=l.clone(),i?(h=i.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),h=h.div(h.norm()),a=i.mmul(h).div(h.transpose().mmul(h).get(0,0))):a=l;if(i){let e=t.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0));e=e.div(e.norm());let n=t.clone().sub(l.clone().mmul(e.transpose())),r=a.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),s=i.clone().sub(l.clone().mulS(r.get(0,0)).mmul(h.transpose()));this.t=l,this.p=e.transpose(),this.w=u.transpose(),this.q=h,this.u=a,this.s=l.transpose().mmul(l),this.xResidual=n,this.yResidual=s,this.betas=r}else this.w=u.transpose(),this.s=l.transpose().mmul(l).sqrt(),this.t=r?l.clone().div(this.s.get(0,0)):l,this.xResidual=t.sub(l.mmul(u.transpose()))}}e.AbstractMatrix=v,e.CHO=N,e.CholeskyDecomposition=N,e.DistanceMatrix=k,e.EVD=O,e.EigenvalueDecomposition=O,e.LU=A,e.LuDecomposition=A,e.Matrix=x,e.MatrixColumnSelectionView=class extends S{constructor(t,e){p(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,i){return this.matrix.set(t,this.columnIndices[e],i),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}},e.MatrixColumnView=class extends S{constructor(t,e){c(t,e),super(t,t.rows,1),this.column=e}set(t,e,i){return this.matrix.set(t,this.column,i),this}get(t){return this.matrix.get(t,this.column)}},e.MatrixFlipColumnView=class extends S{constructor(t){super(t,t.rows,t.columns)}set(t,e,i){return this.matrix.set(t,this.columns-e-1,i),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}},e.MatrixFlipRowView=class extends S{constructor(t){super(t,t.rows,t.columns)}set(t,e,i){return this.matrix.set(this.rows-t-1,e,i),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}},e.MatrixRowSelectionView=class extends S{constructor(t,e){g(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,i){return this.matrix.set(this.rowIndices[t],e,i),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}},e.MatrixRowView=class extends S{constructor(t,e){u(t,e),super(t,1,t.columns),this.row=e}set(t,e,i){return this.matrix.set(this.row,e,i),this}get(t,e){return this.matrix.get(this.row,e)}},e.MatrixSelectionView=E,e.MatrixSubView=class extends S{constructor(t,e,i,n,r){m(t,e,i,n,r),super(t,i-e+1,r-n+1),this.startRow=e,this.startColumn=n}set(t,e,i){return this.matrix.set(this.startRow+t,this.startColumn+e,i),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}},e.MatrixTransposeView=class extends S{constructor(t){super(t,t.columns,t.rows)}set(t,e,i){return this.matrix.set(e,t,i),this}get(t,e){return this.matrix.get(e,t)}},e.NIPALS=B,e.Nipals=B,e.QR=R,e.QrDecomposition=R,e.SVD=P,e.SingularValueDecomposition=P,e.SymmetricMatrix=M,e.WrapperMatrix1D=C,e.WrapperMatrix2D=I,e.correlation=function(t,e=t,i={}){t=new x(t);let r=!1;if("object"!=typeof e||x.isMatrix(e)||n.isAnyArray(e)?e=new x(e):(i=e,e=t,r=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:o=!0}=i;s&&(t.center("column"),r||e.center("column")),o&&(t.scale("column"),r||e.scale("column"));const a=t.standardDeviation("column",{unbiased:!0}),l=r?a:e.standardDeviation("column",{unbiased:!0}),h=t.transpose().mmul(e);for(let e=0;e<h.rows;e++)for(let i=0;i<h.columns;i++)h.set(e,i,h.get(e,i)*(1/(a[e]*l[i]))*(1/(t.rows-1)));return h},e.covariance=function(t,e=t,i={}){t=new x(t);let r=!1;if("object"!=typeof e||x.isMatrix(e)||n.isAnyArray(e)?e=new x(e):(i=e,e=t,r=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=i;s&&(t=t.center("column"),r||(e=e.center("column")));const o=t.transpose().mmul(e);for(let e=0;e<o.rows;e++)for(let i=0;i<o.columns;i++)o.set(e,i,o.get(e,i)*(1/(t.rows-1)));return o},e.default=x,e.determinant=function t(e){if((e=x.checkMatrix(e)).isSquare()){if(0===e.columns)return 1;let i,n,r,s;if(2===e.columns)return i=e.get(0,0),n=e.get(0,1),r=e.get(1,0),s=e.get(1,1),i*s-n*r;if(3===e.columns){let s,o,a;return s=new E(e,[1,2],[1,2]),o=new E(e,[1,2],[0,2]),a=new E(e,[1,2],[0,1]),i=e.get(0,0),n=e.get(0,1),r=e.get(0,2),i*t(s)-n*t(o)+r*t(a)}return new A(e).determinant}throw Error("determinant can only be calculated for a square matrix")},e.inverse=function(t,e=!1){return t=I.checkMatrix(t),e?new P(t).inverse():D(t,x.eye(t.rows))},e.linearDependencies=function(t,e={}){const{thresholdValue:i=1e-9,thresholdError:n=1e-9}=e;let r=(t=x.checkMatrix(t)).rows,s=new x(r,r);for(let e=0;e<r;e++){let o=x.columnVector(t.getRow(e)),a=t.subMatrixRow(F(r,e)).transpose(),l=new P(a).solve(o),h=x.sub(o,a.mmul(l)).abs().max();s.setRow(e,L(h,l,e,i,n))}return s},e.pseudoInverse=function(t,e=Number.EPSILON){if((t=x.checkMatrix(t)).isEmpty())return t.transpose();let i=new P(t,{autoTranspose:!0}),n=i.leftSingularVectors,r=i.rightSingularVectors,s=i.diagonal;for(let t=0;t<s.length;t++)Math.abs(s[t])>e?s[t]=1/s[t]:s[t]=0;return r.mmul(x.diag(s).mmul(n.transpose()))},e.solve=D,e.wrap=function(t,e){if(n.isAnyArray(t))return t[0]&&n.isAnyArray(t[0])?new I(t):new C(t,e);throw new Error("the argument is not an array")}},2664:t=>{t.exports=function(t,e){t=t||0;for(var i=new Array(t),n=0;n<t;n++)i[n]=e;return i}},995:t=>{t.exports=function(t){return 0===t?1:(t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16))}},3614:(t,e,i)=>{"use strict";t.exports=r;var n=i(645);function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var s=4294967296,o=1/s,a="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function l(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function h(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function u(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function c(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function _(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function w(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function v(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function b(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function x(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=7&n,t(r,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=v(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=x(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=v(this.buf,this.pos)+v(this.buf,this.pos+4)*s;return this.pos+=8,t},readSFixed64:function(){var t=v(this.buf,this.pos)+x(this.buf,this.pos+4)*s;return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,s=i.buf;if(n=(112&(r=s[i.pos++]))>>4,r<128)return h(t,n,e);if(n|=(127&(r=s[i.pos++]))<<3,r<128)return h(t,n,e);if(n|=(127&(r=s[i.pos++]))<<10,r<128)return h(t,n,e);if(n|=(127&(r=s[i.pos++]))<<17,r<128)return h(t,n,e);if(n|=(127&(r=s[i.pos++]))<<24,r<128)return h(t,n,e);if(n|=(1&(r=s[i.pos++]))<<31,r<128)return h(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&a?function(t,e,i){return a.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",r=e;r<i;){var s,o,a,l=t[r],h=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(h=l):2===u?128==(192&(s=t[r+1]))&&(h=(31&l)<<6|63&s)<=127&&(h=null):3===u?(s=t[r+1],o=t[r+2],128==(192&s)&&128==(192&o)&&((h=(15&l)<<12|(63&s)<<6|63&o)<=2047||h>=55296&&h<=57343)&&(h=null)):4===u&&(s=t[r+1],o=t[r+2],a=t[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((h=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,u=1):h>65535&&(h-=65536,n+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),n+=String.fromCharCode(h),r+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==r.Bytes)return t.push(this.readVarint(e));var i=l(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==r.Bytes)return t.push(this.readSVarint());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==r.Bytes)return t.push(this.readBoolean());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==r.Bytes)return t.push(this.readFloat());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==r.Bytes)return t.push(this.readDouble());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed32());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed32());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed64());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed64());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*o),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*o),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,s=0;s<e.length;s++){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){n>56319||s+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&u(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&u(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,_,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,w,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,y,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},2582:function(t){t.exports=function(){"use strict";function t(t,n,r,s,o){!function t(i,n,r,s,o){for(;s>r;){if(s-r>600){var a=s-r+1,l=n-r+1,h=Math.log(a),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,n,Math.max(r,Math.floor(n-l*u/a+c)),Math.min(s,Math.floor(n+(a-l)*u/a+c)),o)}var d=i[n],f=r,g=s;for(e(i,r,n),o(i[s],d)>0&&e(i,r,s);f<g;){for(e(i,f,g),f++,g--;o(i[f],d)<0;)f++;for(;o(i[g],d)>0;)g--}0===o(i[r],d)?e(i,r,g):e(i,++g,s),g<=n&&(r=g+1),n<=g&&(s=g-1)}}(t,n,r||0,s||t.length-1,o||i)}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function s(t,e){o(t,0,t.children.length,e,t)}function o(t,e,i,n,r){r||(r=g(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var s=e;s<i;s++){var o=t.children[s];a(r,t.leaf?n(o):o)}return r}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function h(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function c(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(e,i,n,r,s){for(var o=[i,n];o.length;)if(!((n=o.pop())-(i=o.pop())<=r)){var a=i+Math.ceil((n-i)/r/2)*r;t(e,a,i,n,s),o.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,i=[];if(!f(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var s=0;s<e.children.length;s++){var o=e.children[s],a=e.leaf?n(o):o;f(t,a)&&(e.leaf?i.push(o):d(t,a)?this._all(o,i):r.push(o))}e=r.pop()}return i},n.prototype.collides=function(t){var e=this.data;if(!f(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],s=e.leaf?this.toBBox(r):r;if(f(t,s)){if(e.leaf||d(t,s))return!0;i.push(r)}}e=i.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=g([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var i,n,s,o=this.data,a=this.toBBox(t),l=[],h=[];o||l.length;){if(o||(o=l.pop(),n=l[l.length-1],i=h.pop(),s=!0),o.leaf){var u=r(t,o.children,e);if(-1!==u)return o.children.splice(u,1),l.push(o),this._condense(l),this}s||o.leaf||!d(o,a)?n?(i++,o=n.children[i],s=!1):o=null:(l.push(o),h.push(i),i=0,n=o,o=o.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},n.prototype._build=function(t,e,i,n){var r,o=i-e+1,a=this._maxEntries;if(o<=a)return s(r=g(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(r=g([])).leaf=!1,r.height=n;var l=Math.ceil(o/a),h=l*Math.ceil(Math.sqrt(a));p(t,e,i,h,this.compareMinX);for(var u=e;u<=i;u+=h){var c=Math.min(u+h-1,i);p(t,u,c,l,this.compareMinY);for(var d=u;d<=c;d+=l){var f=Math.min(d+l-1,c);r.children.push(this._build(t,d,f,n-1))}}return s(r,this.toBBox),r},n.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var r=1/0,s=1/0,o=void 0,a=0;a<e.children.length;a++){var l=e.children[a],h=u(l),c=(d=t,f=l,(Math.max(f.maxX,d.maxX)-Math.min(f.minX,d.minX))*(Math.max(f.maxY,d.maxY)-Math.min(f.minY,d.minY))-h);c<s?(s=c,r=h<r?h:r,o=l):c===s&&h<r&&(r=h,o=l)}e=o||e.children[0]}var d,f;return e},n.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),r=[],s=this._chooseSubtree(n,this.data,e,r);for(s.children.push(t),a(s,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},n.prototype._split=function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),a=g(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(t,e){this.data=g([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,i){for(var n,r,s,a,l,h,c,d=1/0,f=1/0,g=e;g<=i-e;g++){var p=o(t,0,g,this.toBBox),m=o(t,g,i,this.toBBox),_=(r=p,s=m,void 0,void 0,void 0,void 0,a=Math.max(r.minX,s.minX),l=Math.max(r.minY,s.minY),h=Math.min(r.maxX,s.maxX),c=Math.min(r.maxY,s.maxY),Math.max(0,h-a)*Math.max(0,c-l)),w=u(p)+u(m);_<d?(d=_,n=g,f=w<f?w:f):_===d&&w<f&&(f=w,n=g)}return n||i-e},n.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:l,r=t.leaf?this.compareMinY:h;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var r=this.toBBox,s=o(t,0,e,r),l=o(t,i-e,i,r),h=c(s)+c(l),u=e;u<i-e;u++){var d=t.children[u];a(s,t.leaf?r(d):d),h+=c(s)}for(var f=i-e-1;f>=e;f--){var g=t.children[f];a(l,t.leaf?r(g):g),h+=c(l)}return h},n.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)a(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():s(t[e],this.toBBox)},n}()},146:(t,e,i)=>{"use strict";var n=i(8005),r=i(6740),s=i(5442),o=i(7972);function a(t,e,i,n){return function(i,r,s){var o=t(t(e(r[1],s[0]),e(-s[1],r[0])),t(e(i[1],r[0]),e(-r[1],i[0]))),a=t(e(i[1],s[0]),e(-s[1],i[0])),l=n(o,a);return l[l.length-1]}}function l(t,e,i,n){return function(r,s,o,a){var l=t(t(i(t(e(o[1],a[0]),e(-a[1],o[0])),s[2]),t(i(t(e(s[1],a[0]),e(-a[1],s[0])),-o[2]),i(t(e(s[1],o[0]),e(-o[1],s[0])),a[2]))),t(i(t(e(s[1],a[0]),e(-a[1],s[0])),r[2]),t(i(t(e(r[1],a[0]),e(-a[1],r[0])),-s[2]),i(t(e(r[1],s[0]),e(-s[1],r[0])),a[2])))),h=t(t(i(t(e(o[1],a[0]),e(-a[1],o[0])),r[2]),t(i(t(e(r[1],a[0]),e(-a[1],r[0])),-o[2]),i(t(e(r[1],o[0]),e(-o[1],r[0])),a[2]))),t(i(t(e(s[1],o[0]),e(-o[1],s[0])),r[2]),t(i(t(e(r[1],o[0]),e(-o[1],r[0])),-s[2]),i(t(e(r[1],s[0]),e(-s[1],r[0])),o[2])))),u=n(l,h);return u[u.length-1]}}function h(t,e,i,n){return function(r,s,o,a,l){var h=t(t(t(i(t(i(t(e(a[1],l[0]),e(-l[1],a[0])),o[2]),t(i(t(e(o[1],l[0]),e(-l[1],o[0])),-a[2]),i(t(e(o[1],a[0]),e(-a[1],o[0])),l[2]))),s[3]),t(i(t(i(t(e(a[1],l[0]),e(-l[1],a[0])),s[2]),t(i(t(e(s[1],l[0]),e(-l[1],s[0])),-a[2]),i(t(e(s[1],a[0]),e(-a[1],s[0])),l[2]))),-o[3]),i(t(i(t(e(o[1],l[0]),e(-l[1],o[0])),s[2]),t(i(t(e(s[1],l[0]),e(-l[1],s[0])),-o[2]),i(t(e(s[1],o[0]),e(-o[1],s[0])),l[2]))),a[3]))),t(i(t(i(t(e(o[1],a[0]),e(-a[1],o[0])),s[2]),t(i(t(e(s[1],a[0]),e(-a[1],s[0])),-o[2]),i(t(e(s[1],o[0]),e(-o[1],s[0])),a[2]))),-l[3]),t(i(t(i(t(e(a[1],l[0]),e(-l[1],a[0])),s[2]),t(i(t(e(s[1],l[0]),e(-l[1],s[0])),-a[2]),i(t(e(s[1],a[0]),e(-a[1],s[0])),l[2]))),r[3]),i(t(i(t(e(a[1],l[0]),e(-l[1],a[0])),r[2]),t(i(t(e(r[1],l[0]),e(-l[1],r[0])),-a[2]),i(t(e(r[1],a[0]),e(-a[1],r[0])),l[2]))),-s[3])))),t(t(i(t(i(t(e(s[1],l[0]),e(-l[1],s[0])),r[2]),t(i(t(e(r[1],l[0]),e(-l[1],r[0])),-s[2]),i(t(e(r[1],s[0]),e(-s[1],r[0])),l[2]))),a[3]),t(i(t(i(t(e(s[1],a[0]),e(-a[1],s[0])),r[2]),t(i(t(e(r[1],a[0]),e(-a[1],r[0])),-s[2]),i(t(e(r[1],s[0]),e(-s[1],r[0])),a[2]))),-l[3]),i(t(i(t(e(o[1],a[0]),e(-a[1],o[0])),s[2]),t(i(t(e(s[1],a[0]),e(-a[1],s[0])),-o[2]),i(t(e(s[1],o[0]),e(-o[1],s[0])),a[2]))),r[3]))),t(i(t(i(t(e(o[1],a[0]),e(-a[1],o[0])),r[2]),t(i(t(e(r[1],a[0]),e(-a[1],r[0])),-o[2]),i(t(e(r[1],o[0]),e(-o[1],r[0])),a[2]))),-s[3]),t(i(t(i(t(e(s[1],a[0]),e(-a[1],s[0])),r[2]),t(i(t(e(r[1],a[0]),e(-a[1],r[0])),-s[2]),i(t(e(r[1],s[0]),e(-s[1],r[0])),a[2]))),o[3]),i(t(i(t(e(s[1],o[0]),e(-o[1],s[0])),r[2]),t(i(t(e(r[1],o[0]),e(-o[1],r[0])),-s[2]),i(t(e(r[1],s[0]),e(-s[1],r[0])),o[2]))),-a[3]))))),u=t(t(t(i(t(i(t(e(a[1],l[0]),e(-l[1],a[0])),o[2]),t(i(t(e(o[1],l[0]),e(-l[1],o[0])),-a[2]),i(t(e(o[1],a[0]),e(-a[1],o[0])),l[2]))),r[3]),i(t(i(t(e(a[1],l[0]),e(-l[1],a[0])),r[2]),t(i(t(e(r[1],l[0]),e(-l[1],r[0])),-a[2]),i(t(e(r[1],a[0]),e(-a[1],r[0])),l[2]))),-o[3])),t(i(t(i(t(e(o[1],l[0]),e(-l[1],o[0])),r[2]),t(i(t(e(r[1],l[0]),e(-l[1],r[0])),-o[2]),i(t(e(r[1],o[0]),e(-o[1],r[0])),l[2]))),a[3]),i(t(i(t(e(o[1],a[0]),e(-a[1],o[0])),r[2]),t(i(t(e(r[1],a[0]),e(-a[1],r[0])),-o[2]),i(t(e(r[1],o[0]),e(-o[1],r[0])),a[2]))),-l[3]))),t(t(i(t(i(t(e(o[1],l[0]),e(-l[1],o[0])),s[2]),t(i(t(e(s[1],l[0]),e(-l[1],s[0])),-o[2]),i(t(e(s[1],o[0]),e(-o[1],s[0])),l[2]))),r[3]),i(t(i(t(e(o[1],l[0]),e(-l[1],o[0])),r[2]),t(i(t(e(r[1],l[0]),e(-l[1],r[0])),-o[2]),i(t(e(r[1],o[0]),e(-o[1],r[0])),l[2]))),-s[3])),t(i(t(i(t(e(s[1],l[0]),e(-l[1],s[0])),r[2]),t(i(t(e(r[1],l[0]),e(-l[1],r[0])),-s[2]),i(t(e(r[1],s[0]),e(-s[1],r[0])),l[2]))),o[3]),i(t(i(t(e(s[1],o[0]),e(-o[1],s[0])),r[2]),t(i(t(e(r[1],o[0]),e(-o[1],r[0])),-s[2]),i(t(e(r[1],s[0]),e(-s[1],r[0])),o[2]))),-l[3])))),c=n(h,u);return c[c.length-1]}}function u(t){return(3===t?a:4===t?l:h)(r,n,s,o)}var c=u(3),d=u(4),f=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,i){var n,r=(t[1]-i[1])*(e[0]-i[0]),s=(t[0]-i[0])*(e[1]-i[1]),o=r-s;if(r>0){if(s<=0)return o;n=r+s}else{if(!(r<0))return o;if(s>=0)return o;n=-(r+s)}var a=33306690738754716e-32*n;return o>=a||o<=-a?o:c(t,e,i)},function(t,e,i,n){var r=t[0]-n[0],s=e[0]-n[0],o=i[0]-n[0],a=t[1]-n[1],l=e[1]-n[1],h=i[1]-n[1],u=t[2]-n[2],c=e[2]-n[2],f=i[2]-n[2],g=s*h,p=o*l,m=o*a,_=r*h,w=r*l,y=s*a,v=u*(g-p)+c*(m-_)+f*(w-y),b=7771561172376103e-31*((Math.abs(g)+Math.abs(p))*Math.abs(u)+(Math.abs(m)+Math.abs(_))*Math.abs(c)+(Math.abs(w)+Math.abs(y))*Math.abs(f));return v>b||-v>b?v:d(t,e,i,n)}];function g(t){var e=f[t.length];return e||(e=f[t.length]=u(t.length)),e.apply(void 0,t)}function p(t,e,i,n,r,s,o){return function(e,i,a,l,h){switch(arguments.length){case 0:case 1:return 0;case 2:return n(e,i);case 3:return r(e,i,a);case 4:return s(e,i,a,l);case 5:return o(e,i,a,l,h)}for(var u=new Array(arguments.length),c=0;c<arguments.length;++c)u[c]=arguments[c];return t(u)}}!function(){for(;f.length<=5;)f.push(u(f.length));t.exports=p.apply(void 0,[g].concat(f));for(var e=0;e<=5;++e)t.exports[e]=f[e]}()},4707:(t,e,i)=>{t.exports=function(t,e){for(var i=e[0],r=e[1],s=t.length,o=1,a=s,l=0,h=s-1;l<a;h=l++){var u=t[l],c=t[h],d=u[1],f=c[1];if(f<d){if(f<r&&r<d){if(0===(g=n(u,c,e)))return 0;o^=0<g|0}else if(r===d&&d<t[(l+1)%s][1]){if(0===(g=n(u,c,e)))return 0;o^=0<g|0}}else if(d<f){if(d<r&&r<f){if(0===(g=n(u,c,e)))return 0;o^=g<0|0}else if(r===d&&t[(l+1)%s][1]<d){var g;if(0===(g=n(u,c,e)))return 0;o^=g<0|0}}else if(r===d){var p=Math.min(u[0],c[0]),m=Math.max(u[0],c[0]);if(0===l){for(;h>0;){var _=(h+s-1)%s;if((v=t[_])[1]!==r)break;var w=v[0];p=Math.min(p,w),m=Math.max(m,w),h=_}if(0===h)return p<=i&&i<=m?0:1;a=h+1}for(var y=t[(h+s-1)%s][1];l+1<a;){var v;if((v=t[l+1])[1]!==r)break;w=v[0],p=Math.min(p,w),m=Math.max(m,w),l+=1}if(p<=i&&i<=m)return 0;var b=t[(l+1)%s][1];i<p&&y<r!=b<r&&(o^=1)}}return 2*o-1};var n=i(146)},5442:(t,e,i)=>{"use strict";var n=i(8005),r=i(6359);t.exports=function(t,e){var i=t.length;if(1===i){var s=n(t[0],e);return s[0]?s:[s[1]]}var o=new Array(2*i),a=[.1,.1],l=[.1,.1],h=0;n(t[0],e,a),a[0]&&(o[h++]=a[0]);for(var u=1;u<i;++u){n(t[u],e,l);var c=a[1];r(c,l[0],a),a[0]&&(o[h++]=a[0]);var d=l[1],f=a[1],g=d+f,p=f-(g-d);a[1]=g,p&&(o[h++]=p)}return a[1]&&(o[h++]=a[1]),0===h&&(o[h++]=0),o.length=h,o}},7972:t=>{"use strict";t.exports=function(t,e){var i=0|t.length,n=0|e.length;if(1===i&&1===n)return function(t,e){var i=t+e,n=i-t,r=t-(i-n)+(e-n);return r?[r,i]:[i]}(t[0],-e[0]);var r,s,o=new Array(i+n),a=0,l=0,h=0,u=Math.abs,c=t[l],d=u(c),f=-e[h],g=u(f);d<g?(s=c,(l+=1)<i&&(d=u(c=t[l]))):(s=f,(h+=1)<n&&(g=u(f=-e[h]))),l<i&&d<g||h>=n?(r=c,(l+=1)<i&&(d=u(c=t[l]))):(r=f,(h+=1)<n&&(g=u(f=-e[h])));for(var p,m,_=r+s,w=_-r,y=s-w,v=y,b=_;l<i&&h<n;)d<g?(r=c,(l+=1)<i&&(d=u(c=t[l]))):(r=f,(h+=1)<n&&(g=u(f=-e[h]))),(y=(s=v)-(w=(_=r+s)-r))&&(o[a++]=y),v=b-((p=b+_)-(m=p-b))+(_-m),b=p;for(;l<i;)(y=(s=v)-(w=(_=(r=c)+s)-r))&&(o[a++]=y),v=b-((p=b+_)-(m=p-b))+(_-m),b=p,(l+=1)<i&&(c=t[l]);for(;h<n;)(y=(s=v)-(w=(_=(r=f)+s)-r))&&(o[a++]=y),v=b-((p=b+_)-(m=p-b))+(_-m),b=p,(h+=1)<n&&(f=-e[h]);return v&&(o[a++]=v),b&&(o[a++]=b),a||(o[a++]=0),o.length=a,o}},6740:t=>{"use strict";t.exports=function(t,e){var i=0|t.length,n=0|e.length;if(1===i&&1===n)return function(t,e){var i=t+e,n=i-t,r=t-(i-n)+(e-n);return r?[r,i]:[i]}(t[0],e[0]);var r,s,o=new Array(i+n),a=0,l=0,h=0,u=Math.abs,c=t[l],d=u(c),f=e[h],g=u(f);d<g?(s=c,(l+=1)<i&&(d=u(c=t[l]))):(s=f,(h+=1)<n&&(g=u(f=e[h]))),l<i&&d<g||h>=n?(r=c,(l+=1)<i&&(d=u(c=t[l]))):(r=f,(h+=1)<n&&(g=u(f=e[h])));for(var p,m,_=r+s,w=_-r,y=s-w,v=y,b=_;l<i&&h<n;)d<g?(r=c,(l+=1)<i&&(d=u(c=t[l]))):(r=f,(h+=1)<n&&(g=u(f=e[h]))),(y=(s=v)-(w=(_=r+s)-r))&&(o[a++]=y),v=b-((p=b+_)-(m=p-b))+(_-m),b=p;for(;l<i;)(y=(s=v)-(w=(_=(r=c)+s)-r))&&(o[a++]=y),v=b-((p=b+_)-(m=p-b))+(_-m),b=p,(l+=1)<i&&(c=t[l]);for(;h<n;)(y=(s=v)-(w=(_=(r=f)+s)-r))&&(o[a++]=y),v=b-((p=b+_)-(m=p-b))+(_-m),b=p,(h+=1)<n&&(f=e[h]);return v&&(o[a++]=v),b&&(o[a++]=b),a||(o[a++]=0),o.length=a,o}},3379:t=>{"use strict";var e=[];function i(t){for(var i=-1,n=0;n<e.length;n++)if(e[n].identifier===t){i=n;break}return i}function n(t,n){for(var s={},o=[],a=0;a<t.length;a++){var l=t[a],h=n.base?l[0]+n.base:l[0],u=s[h]||0,c="".concat(h," ").concat(u);s[h]=u+1;var d=i(c),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var g=r(f,n);n.byIndex=a,e.splice(a,0,{identifier:c,updater:g,references:1})}o.push(c)}return o}function r(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,r){var s=n(t=t||[],r=r||{});return function(t){t=t||[];for(var o=0;o<s.length;o++){var a=i(s[o]);e[a].references--}for(var l=n(t,r),h=0;h<s.length;h++){var u=i(s[h]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}s=l}}},569:t=>{"use strict";var e={};t.exports=function(t,i){var n=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},9216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,r&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var s=i.sourceMap;s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},4589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},8005:t=>{"use strict";t.exports=function(t,i,n){var r=t*i,s=e*t,o=s-(s-t),a=t-o,l=e*i,h=l-(l-i),u=i-h,c=a*u-(r-o*h-a*h-o*u);return n?(n[0]=c,n[1]=r,n):[c,r]};var e=+(Math.pow(2,27)+1)},6359:t=>{"use strict";t.exports=function(t,e,i){var n=t+e,r=n-t,s=e-r,o=t-(n-r);return i?(i[0]=o+s,i[1]=n,i):[o+s,n]}},6732:(t,e,i)=>{"use strict";var n=i(7963),r=navigator.hardwareConcurrency||1;function s(t,e){if("string"!=typeof t&&"function"!=typeof t)throw new TypeError("func argument must be a function");if(void 0===e&&(e={}),"object"!=typeof e||null===e)throw new TypeError("options argument must be an object");this._workerCode=t.toString(),void 0===e.maxWorkers||"auto"===e.maxWorkers?this._numWorkers=Math.min(r-1,1):e.maxWorkers>0?this._numWorkers=Math.min(e.maxWorkers,r):this._numWorkers=r,this._workers=new Map,this._timeout=e.timeout||0,this._terminateOnError=!!e.terminateOnError;var i=e.deps;"string"==typeof i&&(i=[i]),Array.isArray(i)||(i=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(i)}Function.prototype,s.prototype._init=function(t){for(var e=n.newWorkerURL(this._workerCode,t),i=0;i<this._numWorkers;i++){var r=new Worker(e);r.onmessage=this._onmessage.bind(this,r),r.onerror=this._onerror.bind(this,r),r.running=!1,r.id=i,this._workers.set(r,null)}URL.revokeObjectURL(e)},s.prototype._onerror=function(t,e){if(!this._terminated){this._working--,t.running=!1;var i=this._workers.get(t);i&&i[1](e.message),this._workers.set(t,null),this._terminateOnError?this.terminate():this._exec()}},s.prototype._onmessage=function(t,e){if(!this._terminated){this._working--,t.running=!1;var i=this._workers.get(t);i&&i[0](e.data.data),this._workers.set(t,null),this._exec()}},s.prototype._exec=function(){for(var t of this._workers.keys()){if(this._working===this._numWorkers||0===this._waiting.length)return;if(!t.running)for(var e=0;e<this._waiting.length;e++){var i=this._waiting[e];if("number"!=typeof i[4]||i[4]===t.id){this._waiting.splice(e,1),t.postMessage({action:"exec",event:i[0],args:i[1]},i[2]),t.running=!0,t.time=Date.now(),this._workers.set(t,i[3]),this._working++;break}}}},s.prototype.terminate=function(){if(!this._terminated){for(var t of this._workers)t[0].terminate(),t[1]&&t[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},s.prototype.postAll=function(t,e){if(this._terminated)throw new Error("Cannot post (terminated)");var i=[];for(var n of this._workers.keys())i.push(this.post(t,e,[],n.id));return Promise.all(i)},s.prototype.post=function(t,e,i,n){void 0===e&&(e=[]),void 0===i&&(i=[]),Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]);var r=this;return new Promise((function(s,o){if(r._terminated)throw new Error("Cannot post (terminated)");r._waiting.push([t,e,i,[s,o],n]),r._exec()}))},t.exports=s},7963:(t,e)=>{"use strict";var i=function(){function t(){this._listeners={}}self.window=self,t.prototype.on=function(t,e){if(this._listeners[t])throw new RangeError("there is already a listener for "+t);if("function"!=typeof e)throw new TypeError("callback argument must be a function");this._listeners[t]=e},t.prototype._send=function(t,e,i){void 0===i?i=[]:Array.isArray(i)||(i=[i]),self.postMessage({id:t,data:e},i)},t.prototype._trigger=function(t,e){if(!this._listeners[t])throw new Error("event "+t+" is not defined");this._listeners[t].apply(null,e)};var e=new t;self.onmessage=function(t){switch(t.data.action){case"exec":t.data.args.unshift((function(i,n){e._send(t.data.id,i,n)})),e._trigger(t.data.event,t.data.args);break;case"ping":e._send(t.data.id,"pong");break;default:throw new Error("unexpected action: "+t.data.action)}}}.toString().split('"CODE";');e.newWorkerURL=function(t,e){var n=new Blob(["(",i[0],"importScripts.apply(self, "+JSON.stringify(e)+");\n","(",t,")();",i[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)}},9152:(t,e,i)=>{"use strict";i.d(e,{b:()=>n}),t=i.hmd(t);const n=function(){let t,e,i,n=[],r=[],s=[],o=u,a=function(t,e){return Math.abs(e.timestamp-t.timestamp)};function l(t,e){let i,n,r=-1,s=t.length;if(1===arguments.length){for(;++r<s&&!(null!=(i=t[r])&&i<=i);)i=void 0;for(;++r<s;)null!=(n=t[r])&&i>n&&(i=n)}else{for(;++r<s&&!(null!=(i=e.call(t,t[r],r))&&i<=i);)i=void 0;for(;++r<s;)null!=(n=e.call(t,t[r],r))&&i>n&&(i=n)}return i}function h(t,e){let i,n,r=-1,s=t.length;if(1===arguments.length){for(;++r<s&&!(null!=(i=t[r])&&i<=i);)i=void 0;for(;++r<s;)null!=(n=t[r])&&n>i&&(i=n)}else{for(;++r<s&&!(null!=(i=e.call(t,t[r],r))&&i<=i);)i=void 0;for(;++r<s;)null!=(n=e.call(t,t[r],r))&&n>i&&(i=n)}return i}function u(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function c(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function d(t,e){const i=t.location.latitude*Math.PI/180,n=t.location.longitude*Math.PI/180,r=e.location.latitude*Math.PI/180,s=r-i,o=e.location.longitude*Math.PI/180-n,a=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(r)*Math.sin(o/2)*Math.sin(o/2);return(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371).toPrecision(4)}function f(i){const r=[];let s=n[i];for(let l=0;l<n.length;l++)i!==l&&(e&&a(n[l],s)<=e&&o(n[l],s)<=t||o(n[l],s)<=t)&&r.push(l);return r}function g(t,e,n){r[n-1].push(t),s[t]=n;for(let t=0;t<e.length;t++){const o=e[t];if(void 0===s[o]){s[o]=0;let t=f(o);t.length>=i&&g(o,t,n)}s[o]<1&&(s[o]=n,r[n-1].push(o))}}let p=function(){s=[],r=[];for(let t=0;t<n.length;t++)if(void 0===s[t]){s[t]=0;const e=f(t);e.length<i?s[t]=0:(r.push([]),g(t,e,r.length))}return s};return p.getClusters=function(){const t=r.length,i=[];for(let s=0;s<t;s++){if(o===u||o===c){i[s]={x:0,y:0};for(let t=0;t<r[s].length;t++)i[s].x+=n[r[s][t]].x,i[s].y+=n[r[s][t]].y;i[s].x/=r[s].length,i[s].y/=r[s].length,i[s].dimension=r[s].length,i[s].parts=r[s]}if(o===d){i[s]={location:{latitude:0,longitude:0,accuracy:0}};for(let t=0;t<r[s].length;t++)i[s].location.latitude+=n[r[s][t]].location.latitude,i[s].location.longitude+=n[r[s][t]].location.longitude,i[s].location.accuracy+=n[r[s][t]].location.accuracy;i[s].dimension=r[s].length,i[s].parts=r[s],i[s].location.latitude/=r[s].length,i[s].location.longitude/=r[s].length,i[s].location.accuracy/=r[s].length}e&&(i[s].duration={},i[s].duration.start=l(r[s],(function(t){return n[t].timestamp})),i[s].duration.end=h(r[s],(function(t){return n[t].timestamp})),i[s].duration.span=i[s].duration.end-i[s].duration.start)}return i},p.data=function(t){return 0===arguments.length?n:(Array.isArray(t)&&(n=t),p)},p.eps=function(e){return 0===arguments.length?t:("number"==typeof e&&(t=e),p)},p.timeEps=function(t){return 0===arguments.length?e:("number"==typeof t&&(e=t),p)},p.minPts=function(t){return 0===arguments.length?i:("number"==typeof t&&(i=t),p)},p.distance=function(t){if(1===arguments.length)if("string"==typeof t)switch(t){case"HAVERSINE":o=d;break;case"EUCLIDEAN":default:o=u;break;case"MANHATTAN":o=c}else"function"==typeof t&&(o=t);return p},p.timeDistance=function(t){return 1===arguments.length&&(a=t),p},p};var r,s;r="undefined"!=typeof self?self:void 0,s=function(){return n},"function"==typeof define&&i.amdO?define([],s):t.exports?t.exports=s():r.jDBSCAN=s()},2898:t=>{"use strict";t.exports={version:"1.0.1"}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.amdO={},__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.nc=void 0;var __webpack_exports__={};(()=>{"use strict";var t={};__webpack_require__.r(t),__webpack_require__.d(t,{CMYK:()=>dp,GREY:()=>lp,HSL:()=>up,HSV:()=>cp,RGB:()=>hp});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{tagsById:()=>vp,tagsByName:()=>bp});var i={};__webpack_require__.r(i),__webpack_require__.d(i,{tagsById:()=>xp,tagsByName:()=>Mp});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{tagsById:()=>kp,tagsByName:()=>Sp});const r=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},s="propertychange",o=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function a(t,e){return t>e?1:t<e?-1:0}function l(t,e,i){if(t[0]<=e)return 0;const n=t.length;if(e<=t[n-1])return n-1;if("function"==typeof i){for(let r=1;r<n;++r){const n=t[r];if(n===e)return r;if(n<e)return i(e,t[r-1],n)>0?r-1:r}return n-1}if(i>0){for(let i=1;i<n;++i)if(t[i]<e)return i-1;return n-1}if(i<0){for(let i=1;i<n;++i)if(t[i]<=e)return i;return n-1}for(let i=1;i<n;++i){if(t[i]==e)return i;if(t[i]<e)return t[i-1]-e<e-t[i]?i-1:i}return n-1}function h(t,e,i){for(;e<i;){const n=t[e];t[e]=t[i],t[i]=n,++e,--i}}function u(t,e){const i=Array.isArray(e)?e:[e],n=i.length;for(let e=0;e<n;e++)t[t.length]=i[e]}function c(t,e){const i=t.length;if(i!==e.length)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}function d(){return!0}function f(){return!1}function g(){}function p(t){let e,i,n,r=!1;return function(){const s=Array.prototype.slice.call(arguments);return r&&this===n&&c(s,i)||(r=!0,n=this,i=s,e=t.apply(this,arguments)),e}}function m(t){for(const e in t)delete t[e]}function _(t){let e;for(e in t)return!1;return!e}const w=class extends o{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e="string"==typeof t,i=e?t:t.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const s=e?new r(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});let l;i in o||(o[i]=0,a[i]=0),++o[i];for(let t=0,e=n.length;t<e;++t)if(l="handleEvent"in n[t]?n[t].handleEvent(s):n[t].call(this,s),!1===l||s.propagationStopped){l=!1;break}if(0==--o[i]){let t=a[i];for(delete a[i];t--;)this.removeEventListener(i,g);delete o[i]}return l}disposeInternal(){this.listeners_&&m(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const n=i.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=g,++this.pendingRemovals_[t]):(i.splice(n,1),0===i.length&&delete this.listeners_[t]))}},y="change",v="contextmenu",b="click",x="keydown",M="keypress",k="touchmove",S="wheel";function E(t,e,i,n,r){if(n&&n!==t&&(i=i.bind(n)),r){const n=i;i=function(){t.removeEventListener(e,i),n.apply(this,arguments)}}const s={target:t,type:e,listener:i};return t.addEventListener(e,i),s}function C(t,e,i,n){return E(t,e,i,n,!0)}function I(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),m(t))}class A extends w{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(y)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=E(this,t[r],e);return n}return E(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const n=t.length;i=new Array(n);for(let r=0;r<n;++r)i[r]=C(this,t[r],e)}else i=C(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)!function(t){if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)I(t[e]);else I(t)}(i);else if(Array.isArray(t))for(let i=0,n=t.length;i<n;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}}A.prototype.on,A.prototype.once,A.prototype.un;const T=A;function R(){throw new Error("Unimplemented abstract method.")}let P=0;function D(t){return t.ol_uid||(t.ol_uid=String(++P))}class F extends r{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const L=class extends T{constructor(t){super(),this.on,this.once,this.un,D(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new F(i,t,e)),i=s,this.hasListener(i)&&this.dispatchEvent(new F(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const n=this.values_||(this.values_={});if(i)n[t]=e;else{const i=n[t];n[t]=e,i!==e&&this.notify(t,i)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],_(this.values_)&&(this.values_=null),e||this.notify(t,i)}}},O="add",z="remove",N="length";class B extends r{constructor(t,e,i){super(t),this.element=e,this.index=i}}const U=class extends L{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let t=0,e=this.array_.length;t<e;++t)this.assertUnique_(this.array_[t],t);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(N)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new B(O,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new B(z,e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new B(z,i,t)),this.dispatchEvent(new B(O,e,t))}updateLength_(){this.set(N,this.array_.length)}assertUnique_(t,e){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new Error("Duplicate item added to a unique collection")}},G="opacity",X="visible",Y="extent",V="zIndex",j="maxResolution",q="minResolution",W="maxZoom",$="minZoom",Z="source";function H(t,e){if(!t)throw new Error(e)}function K(t,e,i){return Math.min(Math.max(t,e),i)}function J(t,e,i,n,r,s){const o=r-i,a=s-n;if(0!==o||0!==a){const l=((t-i)*o+(e-n)*a)/(o*o+a*a);l>1?(i=r,n=s):l>0&&(i+=o*l,n+=a*l)}return Q(t,e,i,n)}function Q(t,e,i,n){const r=i-t,s=n-e;return r*r+s*s}function tt(t){return t*Math.PI/180}function et(t,e){const i=t%e;return i*e<0?i+e:i}function it(t,e,i){return t+i*(e-t)}function nt(t,e){const i=Math.pow(10,e);return Math.round(t*i)/i}function rt(t,e){return Math.round(nt(t,e))}function st(t,e){return Math.floor(nt(t,e))}function ot(t,e){return Math.ceil(nt(t,e))}const at=class extends L{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e[G]=void 0!==t.opacity?t.opacity:1,H("number"==typeof e[G],"Layer opacity must be a number"),e[X]=void 0===t.visible||t.visible,e[V]=t.zIndex,e[j]=void 0!==t.maxResolution?t.maxResolution:1/0,e[q]=void 0!==t.minResolution?t.minResolution:0,e[$]=void 0!==t.minZoom?t.minZoom:-1/0,e[W]=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=K(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return R()}getLayerStatesArray(t){return R()}getExtent(){return this.get(Y)}getMaxResolution(){return this.get(j)}getMinResolution(){return this.get(q)}getMinZoom(){return this.get($)}getMaxZoom(){return this.get(W)}getOpacity(){return this.get(G)}getSourceState(){return R()}getVisible(){return this.get(X)}getZIndex(){return this.get(V)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Y,t)}setMaxResolution(t){this.set(j,t)}setMinResolution(t){this.set(q,t)}setMaxZoom(t){this.set(W,t)}setMinZoom(t){this.set($,t)}setOpacity(t){H("number"==typeof t,"Layer opacity must be a number"),this.set(G,t)}setVisible(t){this.set(X,t)}setZIndex(t){this.set(V,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},lt="prerender",ht="postrender",ut="precompose",ct="rendercomplete",dt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},ft=42,gt=256,pt={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937},mt=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||pt[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},_t=6378137,wt=Math.PI*_t,yt=[-wt,-wt,wt,wt],vt=[-180,-85,180,85],bt=_t*Math.log(Math.tan(Math.PI/2));class xt extends mt{constructor(t){super({code:t,units:"m",extent:yt,global:!0,worldExtent:vt,getPointResolution:function(t,e){return t/Math.cosh(e[1]/_t)}})}}const Mt=[new xt("EPSG:3857"),new xt("EPSG:102100"),new xt("EPSG:102113"),new xt("EPSG:900913"),new xt("http://www.opengis.net/def/crs/EPSG/0/3857"),new xt("http://www.opengis.net/gml/srs/epsg.xml#3857")];const kt=[-180,-90,180,90],St=6378137*Math.PI/180;class Et extends mt{constructor(t,e){super({code:t,units:"degrees",extent:kt,axisOrientation:e,global:!0,metersPerUnit:St,worldExtent:kt})}}const Ct=[new Et("CRS:84"),new Et("EPSG:4326","neu"),new Et("urn:ogc:def:crs:OGC:1.3:CRS84"),new Et("urn:ogc:def:crs:OGC:2:84"),new Et("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Et("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Et("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let It={},At={};function Tt(t,e,i){const n=t.getCode(),r=e.getCode();n in At||(At[n]={}),At[n][r]=i}const Rt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Pt(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0,n=t.length;i<n;++i)qt(e,t[i]);return e}function Dt(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Ft(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function Lt(t,e,i){let n,r;return n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0,r=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0,n*n+r*r}function Ot(t,e){return Nt(t,e[0],e[1])}function zt(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function Nt(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function Bt(t,e){const i=t[0],n=t[1],r=t[2],s=t[3],o=e[0],a=e[1];let l=Rt.UNKNOWN;return o<i?l|=Rt.LEFT:o>r&&(l|=Rt.RIGHT),a<n?l|=Rt.BELOW:a>s&&(l|=Rt.ABOVE),l===Rt.UNKNOWN&&(l=Rt.INTERSECTING),l}function Ut(t,e,i,n,r){return r?(r[0]=t,r[1]=e,r[2]=i,r[3]=n,r):[t,e,i,n]}function Gt(t){return Ut(1/0,1/0,-1/0,-1/0,t)}function Xt(t,e){const i=t[0],n=t[1];return Ut(i,n,i,n,e)}function Yt(t,e,i,n,r){return Wt(Gt(r),t,e,i,n)}function Vt(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function jt(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function qt(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Wt(t,e,i,n,r){for(;i<n;i+=r)$t(t,e[i],e[i+1]);return t}function $t(t,e,i){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],i),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],i)}function Zt(t,e){let i;return i=e(Kt(t)),i||(i=e(Jt(t)),i||(i=e(oe(t)),i||(i=e(se(t)),i||!1)))}function Ht(t){let e=0;return he(t)||(e=ae(t)*ne(t)),e}function Kt(t){return[t[0],t[1]]}function Jt(t){return[t[2],t[1]]}function Qt(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function te(t,e){let i;if("bottom-left"===e)i=Kt(t);else if("bottom-right"===e)i=Jt(t);else if("top-left"===e)i=se(t);else{if("top-right"!==e)throw new Error("Invalid corner");i=oe(t)}return i}function ee(t,e,i,n,r){const[s,o,a,l,h,u,c,d]=ie(t,e,i,n);return Ut(Math.min(s,a,h,c),Math.min(o,l,u,d),Math.max(s,a,h,c),Math.max(o,l,u,d),r)}function ie(t,e,i,n){const r=e*n[0]/2,s=e*n[1]/2,o=Math.cos(i),a=Math.sin(i),l=r*o,h=r*a,u=s*o,c=s*a,d=t[0],f=t[1];return[d-l+c,f-h-u,d-l-c,f-h+u,d+l-c,f+h+u,d+l+c,f+h-u,d-l+c,f-h-u]}function ne(t){return t[3]-t[1]}function re(t,e,i){const n=i||[1/0,1/0,-1/0,-1/0];return le(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):Gt(n),n}function se(t){return[t[0],t[3]]}function oe(t){return[t[2],t[3]]}function ae(t){return t[2]-t[0]}function le(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function he(t){return t[2]<t[0]||t[3]<t[1]}function ue(t,e,i,n){if(he(t))return Gt(i);let r=[];if(n>1){const e=t[2]-t[0],i=t[3]-t[1];for(let s=0;s<n;++s)r.push(t[0]+e*s/n,t[1],t[2],t[1]+i*s/n,t[2]-e*s/n,t[3],t[0],t[3]-i*s/n)}else r=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(r,r,2);const s=[],o=[];for(let t=0,e=r.length;t<e;t+=2)s.push(r[t]),o.push(r[t+1]);return function(t,e,i){return Ut(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),i)}(s,o,i)}function ce(t,e){const i=e.getExtent(),n=Qt(t);if(e.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){const e=ae(i),r=Math.floor((n[0]-i[0])/e)*e;t[0]-=r,t[2]-=r}return t}function de(t,e){let i=!0;for(let n=t.length-1;n>=0;--n)if(t[n]!=e[n]){i=!1;break}return i}function fe(t,e){const i=Math.cos(e),n=Math.sin(e),r=t[0]*i-t[1]*n,s=t[1]*i+t[0]*n;return t[0]=r,t[1]=s,t}function ge(t,e){if(e.canWrapX()){const i=ae(e.getExtent()),n=function(t,e,i){const n=e.getExtent();let r=0;return e.canWrapX()&&(t[0]<n[0]||t[0]>n[2])&&(i=i||ae(n),r=Math.floor((t[0]-n[0])/i)),r}(t,e,i);n&&(t[0]-=n*i)}return t}const pe=6371008.8;function me(t,e,i){i=i||pe;const n=tt(t[1]),r=tt(e[1]),s=(r-n)/2,o=tt(e[0]-t[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*i*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}const _e={info:1,warn:2,error:3,none:4};let we=_e.info;function ye(...t){we>_e.warn||console.warn(...t)}let ve=!0;function be(t,e){if(void 0!==e)for(let i=0,n=t.length;i<n;++i)e[i]=t[i];else e=t.slice();return e}function xe(t,e){if(void 0!==e&&t!==e){for(let i=0,n=t.length;i<n;++i)e[i]=t[i];t=e}return t}function Me(t){!function(t,e){It[t]=e}(t.getCode(),t),Tt(t,t,be)}function ke(t){return"string"==typeof t?It[e=t]||It[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Se(t,e,i,n){let r;const s=(t=ke(t)).getPointResolutionFunc();if(s){if(r=s(e,i),n&&n!==t.getUnits()){const e=t.getMetersPerUnit();e&&(r=r*e/pt[n])}}else{const s=t.getUnits();if("degrees"==s&&!n||"degrees"==n)r=e;else{const o=Ae(t,ke("EPSG:4326"));if(o===xe&&"degrees"!==s)r=e*t.getMetersPerUnit();else{let t=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];t=o(t,t,2),r=(me(t.slice(0,2),t.slice(2,4))+me(t.slice(4,6),t.slice(6,8)))/2}const a=n?pt[n]:t.getMetersPerUnit();void 0!==a&&(r/=a)}}return r}function Ee(t){!function(t){t.forEach(Me)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&Tt(e,t,be)}))}))}function Ce(t,e){return t?"string"==typeof t?ke(t):t:ke(e)}function Ie(t,e){if(t===e)return!0;const i=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||Ae(t,e)===be)&&i}function Ae(t,e){let i=function(t,e){let i;return t in At&&e in At[t]&&(i=At[t][e]),i}(t.getCode(),e.getCode());return i||(i=xe),i}function Te(t,e){return Ae(ke(t),ke(e))}function Re(t,e,i){return Te(e,i)(t,void 0,t.length)}function Pe(t,e,i,n){return ue(t,Te(e,i),void 0,n)}let De=null;function Fe(){return De}function Le(t,e){return De?Re(t,e,De):t}function Oe(t,e){return De?Re(t,De,e):(ve&&!de(t,[0,0])&&t[0]>=-180&&t[0]<=180&&t[1]>=-90&&t[1]<=90&&(ve=!1,ye("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),t)}function ze(t,e){return De?Pe(t,e,De):t}function Ne(t,e){return De?Pe(t,De,e):t}function Be(t,e){if(!De)return t;const i=ke(e).getMetersPerUnit(),n=De.getMetersPerUnit();return i&&n?t*i/n:t}var Ue,Ge,Xe;function Ye(t,e,i){return function(n,r,s,o,a){if(!n)return;if(!r&&!e)return n;const l=e?0:s[0]*r,h=e?0:s[1]*r,u=a?a[0]:0,c=a?a[1]:0;let d=t[0]+l/2+u,f=t[2]-l/2+u,g=t[1]+h/2+c,p=t[3]-h/2+c;d>f&&(d=(f+d)/2,f=d),g>p&&(g=(p+g)/2,p=g);let m=K(n[0],d,f),_=K(n[1],g,p);if(o&&i&&r){const t=30*r;m+=-t*Math.log(1+Math.max(0,d-n[0])/t)+t*Math.log(1+Math.max(0,n[0]-f)/t),_+=-t*Math.log(1+Math.max(0,g-n[1])/t)+t*Math.log(1+Math.max(0,n[1]-p)/t)}return[m,_]}}function Ve(t){return t}function je(t,e,i,n){const r=ae(e)/i[0],s=ne(e)/i[1];return n?Math.min(t,Math.max(r,s)):Math.min(t,Math.min(r,s))}function qe(t,e,i){let n=Math.min(t,e);return n*=Math.log(1+50*Math.max(0,t/e-1))/50+1,i&&(n=Math.max(n,i),n/=Math.log(1+50*Math.max(0,i/t-1))/50+1),K(n,i/2,2*e)}function We(t,e,i,n,r){return i=void 0===i||i,function(s,o,a,l){if(void 0!==s){const o=n?je(t,n,a,r):t;return i&&l?qe(s,o,e):K(s,e,o)}}}function $e(t){if(void 0!==t)return 0}function Ze(t){if(void 0!==t)return t}function He(t){return Math.pow(t,3)}function Ke(t){return 1-He(1-t)}function Je(t){return 3*t*t-2*t*t*t}function Qe(t){return t}function ti(t,e){const i=e[0],n=e[1];return e[0]=t[0]*i+t[2]*n+t[4],e[1]=t[1]*i+t[3]*n+t[5],e}function ei(t,e,i,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return t[0]=n*h,t[1]=r*l,t[2]=-n*l,t[3]=r*h,t[4]=o*n*h-a*n*l+e,t[5]=o*r*l+a*r*h+i,t}function ii(t,e){const i=(n=e)[0]*n[3]-n[1]*n[2];var n;H(0!==i,"Transformation matrix cannot be inverted");const r=e[0],s=e[1],o=e[2],a=e[3],l=e[4],h=e[5];return t[0]=a/i,t[1]=-s/i,t[2]=-o/i,t[3]=r/i,t[4]=(o*h-a*l)/i,t[5]=-(r*h-s*l)/i,t}Ee(Mt),Ee(Ct),Ue=Mt,Ge=function(t,e,i){const n=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(n));for(let r=0;r<n;r+=i){e[r]=wt*t[r]/180;let i=_t*Math.log(Math.tan(Math.PI*(+t[r+1]+90)/360));i>bt?i=bt:i<-bt&&(i=-bt),e[r+1]=i}return e},Xe=function(t,e,i){const n=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(n));for(let r=0;r<n;r+=i)e[r]=180*t[r]/wt,e[r+1]=360*Math.atan(Math.exp(t[r+1]/_t))/Math.PI-90;return e},Ct.forEach((function(t){Ue.forEach((function(e){Tt(t,e,Ge),Tt(e,t,Xe)}))})),new Array(6);const ni=[1e6,1e6,1e6,1e6,2,2];function ri(t){return"matrix("+t.map(((t,e)=>Math.round(t*ni[e])/ni[e])).join(", ")+")"}function si(t,e,i,n,r,s){s=s||[];let o=0;for(let a=e;a<i;a+=n){const e=t[a],i=t[a+1];s[o++]=r[0]*e+r[2]*i+r[4],s[o++]=r[1]*e+r[3]*i+r[5]}return s&&s.length!=o&&(s.length=o),s}function oi(t,e,i,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],u=s[1];let c=0;for(let r=e;r<i;r+=n){const e=t[r]-h,i=t[r+1]-u;o[c++]=h+e*a-i*l,o[c++]=u+e*l+i*a;for(let e=r+2;e<r+n;++e)o[c++]=t[e]}return o&&o.length!=c&&(o.length=c),o}const ai=[1,0,0,1,0,0],li=class extends L{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=p(((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)}))}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return R()}closestPointXY(t,e,i,n){return R()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return R()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Gt(t),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)}rotate(t,e){R()}scale(t,e,i){R()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return R()}getType(){return R()}applyTransform(t){R()}intersectsExtent(t){return R()}translate(t,e){R()}transform(t,e){const i=ke(t),n="tile-pixels"==i.getUnits()?function(t,n,r){const s=i.getExtent(),o=i.getWorldExtent(),a=ne(o)/ne(s);return ei(ai,o[0],o[3],a,-a,0,0,0),si(t,0,t.length,r,ai,n),Te(i,e)(t,n,r)}:Te(i,e);return this.applyTransform(n),this}};function hi(t){let e;return 2==t?e="XY":3==t?e="XYZ":4==t&&(e="XYZM"),e}function ui(t){let e;return"XY"==t?e=2:"XYZ"==t||"XYM"==t?e=3:"XYZM"==t&&(e=4),e}const ci=class extends li{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Yt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return R()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=ui(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){R()}setLayout(t,e,i){let n;if(t)n=ui(t);else{for(let t=0;t<i;++t){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}n=e.length,t=hi(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();oi(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){void 0===e&&(e=t),i||(i=Qt(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();!function(t,e,i,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let u=0;for(let e=0;e<i;e+=n){const i=t[e]-l,o=t[e+1]-h;a[u++]=l+r*i,a[u++]=h+s*o;for(let i=e+2;i<e+n;++i)a[u++]=t[i]}a&&a.length!=u&&(a.length=u)}(n,0,n.length,r,t,e,i,n),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();!function(t,e,i,n,r,s,o){o=o||[];let a=0;for(let e=0;e<i;e+=n){o[a++]=t[e]+r,o[a++]=t[e+1]+s;for(let i=e+2;i<e+n;++i)o[a++]=t[i]}o&&o.length!=a&&(o.length=a)}(i,0,i.length,n,t,e,i),this.changed()}}};function di(t,e,i,n,r,s,o){const a=t[e],l=t[e+1],h=t[i]-a,u=t[i+1]-l;let c;if(0===h&&0===u)c=e;else{const d=((r-a)*h+(s-l)*u)/(h*h+u*u);if(d>1)c=i;else{if(d>0){for(let r=0;r<n;++r)o[r]=it(t[e+r],t[i+r],d);return void(o.length=n)}c=e}}for(let e=0;e<n;++e)o[e]=t[c+e];o.length=n}function fi(t,e,i,n,r){let s=t[e],o=t[e+1];for(e+=n;e<i;e+=n){const i=t[e],n=t[e+1],a=Q(s,o,i,n);a>r&&(r=a),s=i,o=n}return r}function gi(t,e,i,n,r){for(let s=0,o=i.length;s<o;++s){const o=i[s];r=fi(t,e,o,n,r),e=o}return r}function pi(t,e,i,n,r,s,o,a,l,h,u){if(e==i)return h;let c,d;if(0===r){if(d=Q(o,a,t[e],t[e+1]),d<h){for(c=0;c<n;++c)l[c]=t[e+c];return l.length=n,d}return h}u=u||[NaN,NaN];let f=e+n;for(;f<i;)if(di(t,f-n,f,n,o,a,u),d=Q(o,a,u[0],u[1]),d<h){for(h=d,c=0;c<n;++c)l[c]=u[c];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(s&&(di(t,i-n,e,n,o,a,u),d=Q(o,a,u[0],u[1]),d<h)){for(h=d,c=0;c<n;++c)l[c]=u[c];l.length=n}return h}function mi(t,e,i,n,r,s,o,a,l,h,u){u=u||[NaN,NaN];for(let c=0,d=i.length;c<d;++c){const d=i[c];h=pi(t,e,d,n,r,s,o,a,l,h,u),e=d}return h}function _i(t,e,i,n){for(let r=0,s=i.length;r<s;++r){const s=i[r];for(let i=0;i<n;++i)t[e++]=s[i]}return e}function wi(t,e,i,n,r){r=r||[];let s=0;for(let o=0,a=i.length;o<a;++o){const a=_i(t,e,i[o],n);r[s++]=a,e=a}return r.length=s,r}function yi(t,e,i,n,r){r=r||[];let s=0;for(let o=0,a=i.length;o<a;++o){const a=wi(t,e,i[o],n,r[s]);0===a.length&&(a[0]=e),r[s++]=a,e=a[a.length-1]}return r.length=s,r}function vi(t,e,i,n,r,s,o){const a=(i-e)/n;if(a<3){for(;e<i;e+=n)s[o++]=t[e],s[o++]=t[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,i-n];let u=0;for(;h.length>0;){const i=h.pop(),s=h.pop();let o=0;const a=t[s],c=t[s+1],d=t[i],f=t[i+1];for(let e=s+n;e<i;e+=n){const i=J(t[e],t[e+1],a,c,d,f);i>o&&(u=e,o=i)}o>r&&(l[(u-e)/n]=1,s+n<u&&h.push(s,u),u+n<i&&h.push(u,i))}for(let i=0;i<a;++i)l[i]&&(s[o++]=t[e+i*n],s[o++]=t[e+i*n+1]);return o}function bi(t,e,i,n,r,s,o,a){for(let l=0,h=i.length;l<h;++l){const h=i[l];o=vi(t,e,h,n,r,s,o),a.push(o),e=h}return o}function xi(t,e){return e*Math.round(t/e)}function Mi(t,e,i,n,r,s,o){if(e==i)return o;let a,l,h=xi(t[e],r),u=xi(t[e+1],r);e+=n,s[o++]=h,s[o++]=u;do{if(a=xi(t[e],r),l=xi(t[e+1],r),(e+=n)==i)return s[o++]=a,s[o++]=l,o}while(a==h&&l==u);for(;e<i;){const i=xi(t[e],r),c=xi(t[e+1],r);if(e+=n,i==a&&c==l)continue;const d=a-h,f=l-u,g=i-h,p=c-u;d*p==f*g&&(d<0&&g<d||d==g||d>0&&g>d)&&(f<0&&p<f||f==p||f>0&&p>f)?(a=i,l=c):(s[o++]=a,s[o++]=l,h=a,u=l,a=i,l=c)}return s[o++]=a,s[o++]=l,o}function ki(t,e,i,n,r,s,o,a){for(let l=0,h=i.length;l<h;++l){const h=i[l];o=Mi(t,e,h,n,r,s,o),a.push(o),e=h}return o}function Si(t,e,i,n,r){r=void 0!==r?r:[];let s=0;for(let o=e;o<i;o+=n)r[s++]=t.slice(o,o+n);return r.length=s,r}function Ei(t,e,i,n,r){r=void 0!==r?r:[];let s=0;for(let o=0,a=i.length;o<a;++o){const a=i[o];r[s++]=Si(t,e,a,n,r[s]),e=a}return r.length=s,r}function Ci(t,e,i,n,r){r=void 0!==r?r:[];let s=0;for(let o=0,a=i.length;o<a;++o){const a=i[o];r[s++]=1===a.length&&a[0]===e?[]:Ei(t,e,a,n,r[s]),e=a[a.length-1]}return r.length=s,r}function Ii(t,e,i,n){let r=0,s=t[i-n],o=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];r+=o*i-s*n,s=i,o=n}return r/2}function Ai(t,e,i,n){let r=0;for(let s=0,o=i.length;s<o;++s){const o=i[s];r+=Ii(t,e,o,n),e=o}return r}class Ti extends ci{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new Ti(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<Lt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),pi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return Ii(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Si(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=vi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Ti(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_i(this.flatCoordinates,0,t,this.stride),this.changed()}}const Ri=Ti;class Pi extends ci{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Pi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const r=this.flatCoordinates,s=Q(t,e,r[0],r[1]);if(s<n){const t=this.stride;for(let e=0;e<t;++e)i[e]=r[e];return i.length=t,s}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Xt(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Nt(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,e,i,n){for(let n=0,r=i.length;n<r;++n)t[e++]=i[n];return e}(this.flatCoordinates,0,t,this.stride),this.changed()}}const Di=Pi;function Fi(t,e,i,n,r){return!Zt(r,(function(r){return!Li(t,e,i,n,r[0],r[1])}))}function Li(t,e,i,n,r,s){let o=0,a=t[i-n],l=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];l<=s?n>s&&(i-a)*(s-l)-(r-a)*(n-l)>0&&o++:n<=s&&(i-a)*(s-l)-(r-a)*(n-l)<0&&o--,a=i,l=n}return 0!==o}function Oi(t,e,i,n,r,s){if(0===i.length)return!1;if(!Li(t,e,i[0],n,r,s))return!1;for(let e=1,o=i.length;e<o;++e)if(Li(t,i[e-1],i[e],n,r,s))return!1;return!0}function zi(t,e,i,n,r,s,o){let l,h,u,c,d,f,g;const p=r[s+1],m=[];for(let r=0,s=i.length;r<s;++r){const s=i[r];for(c=t[s-n],f=t[s-n+1],l=e;l<s;l+=n)d=t[l],g=t[l+1],(p<=f&&g<=p||f<=p&&p<=g)&&(u=(p-f)/(g-f)*(d-c)+c,m.push(u)),c=d,f=g}let _=NaN,w=-1/0;for(m.sort(a),c=m[0],l=1,h=m.length;l<h;++l){d=m[l];const r=Math.abs(d-c);r>w&&(u=(c+d)/2,Oi(t,e,i,n,u,p)&&(_=u,w=r)),c=d}return isNaN(_)&&(_=r[s]),o?(o.push(_,p,w),o):[_,p,w]}function Ni(t,e,i,n,r){let s=[];for(let o=0,a=i.length;o<a;++o){const a=i[o];s=zi(t,e,a,n,r,2*o,s),e=a[a.length-1]}return s}function Bi(t,e,i,n,r){let s;for(e+=n;e<i;e+=n)if(s=r(t.slice(e-n,e),t.slice(e,e+n)),s)return s;return!1}function Ui(t,e,i,n,r){const s=Wt([1/0,1/0,-1/0,-1/0],t,e,i,n);return!!le(r,s)&&(!!zt(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]||Bi(t,e,i,n,(function(t,e){return function(t,e,i){let n=!1;const r=Bt(t,e),s=Bt(t,i);if(r===Rt.INTERSECTING||s===Rt.INTERSECTING)n=!0;else{const o=t[0],a=t[1],l=t[2],h=t[3],u=e[0],c=e[1],d=i[0],f=i[1],g=(f-c)/(d-u);let p,m;s&Rt.ABOVE&&!(r&Rt.ABOVE)&&(p=d-(f-h)/g,n=p>=o&&p<=l),n||!(s&Rt.RIGHT)||r&Rt.RIGHT||(m=f-(d-l)*g,n=m>=a&&m<=h),n||!(s&Rt.BELOW)||r&Rt.BELOW||(p=d-(f-a)/g,n=p>=o&&p<=l),n||!(s&Rt.LEFT)||r&Rt.LEFT||(m=f-(d-o)*g,n=m>=a&&m<=h)}return n}(r,t,e)})))}function Gi(t,e,i,n,r){return!!(Ui(t,e,i,n,r)||Li(t,e,i,n,r[0],r[1])||Li(t,e,i,n,r[0],r[3])||Li(t,e,i,n,r[2],r[1])||Li(t,e,i,n,r[2],r[3]))}function Xi(t,e,i,n,r){if(!Gi(t,e,i[0],n,r))return!1;if(1===i.length)return!0;for(let e=1,s=i.length;e<s;++e)if(Fi(t,i[e-1],i[e],n,r)&&!Ui(t,i[e-1],i[e],n,r))return!1;return!0}function Yi(t,e,i,n){for(;e<i-n;){for(let r=0;r<n;++r){const s=t[e+r];t[e+r]=t[i-n+r],t[i-n+r]=s}e+=n,i-=n}}function Vi(t,e,i,n){let r=0,s=t[i-n],o=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];r+=(i-s)*(n+o),s=i,o=n}return 0===r?void 0:r>0}function ji(t,e,i,n,r){r=void 0!==r&&r;for(let s=0,o=i.length;s<o;++s){const o=i[s],a=Vi(t,e,o,n);if(0===s){if(r&&a||!r&&!a)return!1}else if(r&&!a||!r&&a)return!1;e=o}return!0}function qi(t,e,i,n,r){for(let s=0,o=i.length;s<o;++s){const o=i[s];if(!ji(t,e,o,n,r))return!1;o.length&&(e=o[o.length-1])}return!0}function Wi(t,e,i,n,r){r=void 0!==r&&r;for(let s=0,o=i.length;s<o;++s){const o=i[s],a=Vi(t,e,o,n);(0===s?r&&a||!r&&!a:r&&!a||!r&&a)&&Yi(t,e,o,n),e=o}return e}function $i(t,e,i,n,r){for(let s=0,o=i.length;s<o;++s)e=Wi(t,e,i[s],n,r);return e}class Zi extends ci{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?u(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Zi(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<Lt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gi(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return Oi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Ai(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Wi(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Ei(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Qt(this.getExtent());this.flatInteriorPoint_=zi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Di(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Ri(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[];let r=0;for(let s=0,o=i.length;s<o;++s){const o=i[s],a=new Ri(e.slice(r,o),t);n.push(a),r=o}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;ji(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Wi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=ki(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new Zi(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return Xi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=wi(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const Hi=Zi;function Ki(t){if(he(t))throw new Error("Cannot create polygon from empty extent");const e=t[0],i=t[1],n=t[2],r=t[3],s=[e,i,e,r,n,r,n,i,e,i];return new Zi(s,"XY",[s.length])}function Ji(t,e){setTimeout((function(){t(e)}),0)}function Qi(t){return!(t.sourceCenter&&t.targetCenter&&!de(t.sourceCenter,t.targetCenter))&&t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}function tn(t,e,i,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=t[0]*s-t[1]*o,l=t[1]*s+t[0]*o;return a+=(e[0]/2-i[0])*n,l+=(i[1]-e[1]/2)*n,o=-o,[a*s-l*o,l*s+a*o]}const en=class extends L{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Ce(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&function(t){ve=!(void 0===t||t)}(),t.center&&(t.center=Oe(t.center,this.projection_)),t.extent&&(t.extent=Ne(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const t in dt)delete e[t];this.setProperties(e,!0);const i=function(t){let e,i,n;let r=void 0!==t.minZoom?t.minZoom:0,s=void 0!==t.maxZoom?t.maxZoom:28;const o=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,h=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,u=void 0!==t.showFullExtent&&t.showFullExtent,c=Ce(t.projection,"EPSG:3857"),d=c.getExtent();let f=t.constrainOnlyCenter,g=t.extent;if(a||g||!c.isGlobal()||(f=!1,g=d),void 0!==t.resolutions){const o=t.resolutions;i=o[r],n=void 0!==o[s]?o[s]:o[o.length-1],e=t.constrainResolution?function(t,e,i,n){return e=void 0===e||e,function(r,s,o,a){if(void 0!==r){const h=t[0],u=t[t.length-1],c=i?je(h,i,o,n):h;if(a)return e?qe(r,c,u):K(r,u,c);const d=Math.min(c,r),f=Math.floor(l(t,d,s));return t[f]>c&&f<t.length-1?t[f+1]:t[f]}}}(o,h,!f&&g,u):We(i,n,h,!f&&g,u)}else{const a=(d?Math.max(ae(d),ne(d)):360*pt.degrees/c.getMetersPerUnit())/gt/Math.pow(2,0),l=a/Math.pow(2,28);i=t.maxResolution,void 0!==i?r=0:i=a/Math.pow(o,r),n=t.minResolution,void 0===n&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(o,s):a/Math.pow(o,s):l),s=r+Math.floor(Math.log(i/n)/Math.log(o)),n=i/Math.pow(o,s-r),e=t.constrainResolution?function(t,e,i,n,r,s){return n=void 0===n||n,i=void 0!==i?i:0,function(o,a,l,h){if(void 0!==o){const u=r?je(e,r,l,s):e;if(h)return n?qe(o,u,i):K(o,i,u);const c=1e-9,d=Math.ceil(Math.log(e/u)/Math.log(t)-c),f=-a*(.5-c)+.5,g=Math.min(u,o),p=Math.floor(Math.log(e/g)/Math.log(t)+f),m=Math.max(d,p);return K(e/Math.pow(t,m),i,u)}}}(o,i,n,h,!f&&g,u):We(i,n,h,!f&&g,u)}return{constraint:e,maxResolution:i,minResolution:n,minZoom:r,zoomFactor:o}}(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const n=function(t){if(void 0!==t.extent){const e=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return Ye(t.extent,t.constrainOnlyCenter,e)}const e=Ce(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Ye(t,!1,!1)}return Ve}(t),r=i.constraint,s=function(t){if(void 0===t.enableRotation||t.enableRotation){const e=t.constrainRotation;return void 0===e||!0===e?function(t){const e=tt(5);return function(t,i){return i||void 0===t?t:Math.abs(t)<=e?0:t}}():!1===e?Ze:"number"==typeof e?function(t){const e=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}(e):Ze}return $e}(t);this.constraints_={center:n,resolution:r,rotation:s},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const n=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),s=r/2*(n[3]-e[3]+e[1]-n[1]),o=r/2*(n[0]-e[0]+e[2]-n[2]);this.setCenterInternal([i[0]+s,i[1]-o])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let t=0;t<e.length;++t){let i=arguments[t];i.center&&(i=Object.assign({},i),i.center=Oe(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=Oe(i.anchor,this.getProjection())),e[t]=i}this.animateInternal.apply(this,e)}animateInternal(t){let e,i=arguments.length;i>1&&"function"==typeof arguments[i-1]&&(e=arguments[i-1],--i);let n=0;for(;n<i&&!this.isDef();++n){const t=arguments[n];t.center&&this.setCenterInternal(t.center),void 0!==t.zoom?this.setZoom(t.zoom):t.resolution&&this.setResolution(t.resolution),void 0!==t.rotation&&this.setRotation(t.rotation)}if(n===i)return void(e&&Ji(e,!0));let r=Date.now(),s=this.targetCenter_.slice(),o=this.targetResolution_,a=this.targetRotation_;const l=[];for(;n<i;++n){const t=arguments[n],i={start:r,complete:!1,anchor:t.anchor,duration:void 0!==t.duration?t.duration:1e3,easing:t.easing||Je,callback:e};if(t.center&&(i.sourceCenter=s,i.targetCenter=t.center.slice(),s=i.targetCenter),void 0!==t.zoom?(i.sourceResolution=o,i.targetResolution=this.getResolutionForZoom(t.zoom),o=i.targetResolution):t.resolution&&(i.sourceResolution=o,i.targetResolution=t.resolution,o=i.targetResolution),void 0!==t.rotation){i.sourceRotation=a;const e=et(t.rotation-a+Math.PI,2*Math.PI)-Math.PI;i.targetRotation=a+e,a=i.targetRotation}Qi(i)?i.complete=!0:r+=i.duration,l.push(i)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let t;this.setHint(0,-this.hints_[0]);for(let e=0,i=this.animations_.length;e<i;++e){const i=this.animations_[e];if(i[0].callback&&Ji(i[0].callback,!1),!t)for(let e=0,n=i.length;e<n;++e){const n=i[e];if(!n.complete){t=n.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let i=0,s=n.length;i<s;++i){const s=n[i];if(s.complete)continue;const o=t-s.start;let a=s.duration>0?o/s.duration:1;a>=1?(s.complete=!0,a=1):r=!1;const l=s.easing(a);if(s.sourceCenter){const t=s.sourceCenter[0],e=s.sourceCenter[1],i=s.targetCenter[0],n=s.targetCenter[1];this.nextCenter_=s.targetCenter;const r=t+l*(i-t),o=e+l*(n-e);this.targetCenter_=[r,o]}if(s.sourceResolution&&s.targetResolution){const t=1===l?s.targetResolution:s.sourceResolution+l*(s.targetResolution-s.sourceResolution);if(s.anchor){const e=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(t,0,e,!0);this.targetCenter_=this.calculateCenterZoom(i,s.anchor)}this.nextResolution_=s.targetResolution,this.targetResolution_=t,this.applyTargetState_(!0)}if(void 0!==s.sourceRotation&&void 0!==s.targetRotation){const t=1===l?et(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+l*(s.targetRotation-s.sourceRotation);if(s.anchor){const e=this.constraints_.rotation(t,!0);this.targetCenter_=this.calculateCenterRotate(e,s.anchor)}this.nextRotation_=s.targetRotation,this.targetRotation_=t}if(this.applyTargetState_(!0),e=!0,!s.complete)break}if(r){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const t=n[0].callback;t&&Ji(t,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const n=this.getCenterInternal();var r,s;return void 0!==n&&(i=[n[0]-e[0],n[1]-e[1]],fe(i,t-this.getRotation()),s=e,(r=i)[0]+=+s[0],r[1]+=+s[1]),i}calculateCenterZoom(t,e){let i;const n=this.getCenterInternal(),r=this.getResolution();return void 0!==n&&void 0!==r&&(i=[e[0]-t*(e[0]-n[0])/r,e[1]-t*(e[1]-n[1])/r]),i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],n=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t?Le(t,this.getProjection()):t}getCenterInternal(){return this.get(dt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return ze(this.calculateExtentInternal(t),this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();H(e,"The view center is not defined");const i=this.getResolution();H(void 0!==i,"The view resolution is not defined");const n=this.getRotation();return H(void 0!==n,"The view rotation is not defined"),ee(e,i,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(dt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ne(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=ae(t)/e[0],n=ne(t)/e[1];return Math.max(i,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(e/i)/Math.log(t);return function(i){return e/Math.pow(t,i*n)}}getRotation(){return this.get(dt.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(i/n)/e;return function(t){return Math.log(i/t)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const t=this.getViewportSizeMinusPadding_();n=tn(n,this.getViewportSize_(),[t[0]/2+r[3],t[1]/2+r[0]],e,i)}return{center:n.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e,i,n=this.minZoom_||0;if(this.resolutions_){const r=l(this.resolutions_,t,1);n=r,e=this.resolutions_[r],i=r==this.resolutions_.length-1?2:e/this.resolutions_[r+1]}else e=this.maxResolution_,i=this.zoomFactor_;return n+Math.log(e/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=K(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,K(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(H(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,"Invalid extent or geometry provided as `geometry`"),Array.isArray(t))H(!he(t),"Cannot fit empty extent provided as `geometry`"),i=Ki(Ne(t,this.getProjection()));else if("Circle"===t.getType()){const e=Ne(t.getExtent(),this.getProjection());i=Ki(e),i.rotate(this.getRotation(),Qt(e))}else{const e=Fe();i=e?t.clone().transform(e,this.getProjection()):t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),n=Math.sin(-e),r=t.getFlatCoordinates(),s=t.getStride();let o=1/0,a=1/0,l=-1/0,h=-1/0;for(let t=0,e=r.length;t<e;t+=s){const e=r[t]*i-r[t+1]*n,s=r[t]*n+r[t+1]*i;o=Math.min(o,e),a=Math.min(a,s),l=Math.max(l,e),h=Math.max(h,s)}return[o,a,l,h]}fitInternal(t,e){let i=(e=e||{}).size;i||(i=this.getViewportSizeMinusPadding_());const n=void 0!==e.padding?e.padding:[0,0,0,0],r=void 0!==e.nearest&&e.nearest;let s;s=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const o=this.rotatedExtentForGeometry(t);let a=this.getResolutionForExtentInternal(o,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);a=isNaN(a)?s:Math.max(a,s),a=this.getConstrainedResolution(a,r?0:1);const l=this.getRotation(),h=Math.sin(l),u=Math.cos(l),c=Qt(o);c[0]+=(n[1]-n[3])/2*a,c[1]+=(n[0]-n[2])/2*a;const d=c[0]*u-c[1]*h,f=c[1]*u+c[0]*h,p=this.getConstrainedCenter([d,f],a),m=e.callback?e.callback:g;void 0!==e.duration?this.animateInternal({resolution:a,center:p,duration:e.duration,easing:e.easing},m):(this.targetResolution_=a,this.targetCenter_=p,this.applyTargetState_(!1,!0),Ji(m,!0))}centerOn(t,e,i){this.centerOnInternal(Oe(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(tn(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,n){let r;const s=this.padding_;if(s&&t){const o=this.getViewportSizeMinusPadding_(-i),a=tn(t,n,[o[0]/2+s[3],o[1]/2+s[0]],e,i);r=[t[0]-a[0],t[1]-a[1]]}return r}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=Le(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Oe(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Oe(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t?Oe(t,this.getProjection()):t)}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),s=this.constraints_.resolution(this.targetResolution_,0,r,i),o=this.constraints_.center(this.targetCenter_,s,r,i,this.calculateCenterShift(this.targetCenter_,s,n,r));this.get(dt.ROTATION)!==n&&this.set(dt.ROTATION,n),this.get(dt.RESOLUTION)!==s&&(this.set(dt.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),o&&this.get(dt.CENTER)&&de(this.get(dt.CENTER),o)||this.set(dt.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;const n=e||0,r=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,n,s),a=this.constraints_.center(this.targetCenter_,o,s,!1,this.calculateCenterShift(this.targetCenter_,o,r,s));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=o,this.targetRotation_=r,this.targetCenter_=a,void this.applyTargetState_();i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===o&&this.getRotation()===r&&this.getCenterInternal()&&de(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:a,resolution:o,duration:t,easing:Ke,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,i){i=i&&Oe(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(1,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}};function nn(t,e){if(!t.visible)return!1;const i=e.resolution;if(i<t.minResolution||i>=t.maxResolution)return!1;const n=e.zoom;return n>t.minZoom&&n<=t.maxZoom}const rn=class extends at{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Z,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get(Z)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||"ready"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(I(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=E(t,y,this.handleSourceChange_,this),"ready"===t.getState()&&(this.sourceReady_=!0,setTimeout((()=>{this.dispatchEvent("sourceready")}),0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}isVisible(t){let e;const i=this.getMapInternal();let n;!t&&i&&(t=i.getView()),e=t instanceof en?{viewState:t.getState(),extent:t.calculateExtent()}:t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray()),n=e.layerStatesArray?e.layerStatesArray.find((t=>t.layer===this)):this.getLayerState();const r=this.getExtent();return nn(n,e.viewState)&&(!r||le(r,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const i=this.getSource();if(i&&(e=i.getAttributions()),!e)return[];let n=e(t instanceof en?t.getViewStateAndExtent():t);return Array.isArray(n)||(n=[n]),n}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set("map",t)}getMapInternal(){return this.get("map")}setMap(t){this.mapPrecomposeKey_&&(I(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(I(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=E(t,ut,(function(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);H(!e.some((function(t){return t.layer===i.layer})),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(i)}),this),this.mapRenderKey_=E(this,y,t.render,t),this.changed())}setSource(t){this.set(Z,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};var sn=__webpack_require__(2582);const on=0,an=1,ln=2,hn=3;function un(t){return t[0]>0&&t[1]>0}function cn(t,e,i){return void 0===i&&(i=[0,0]),i[0]=t[0]*e+.5|0,i[1]=t[1]*e+.5|0,i}function dn(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}class fn{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=dn(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new fn({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return R()}getImage(t){return R()}getHitDetectionImage(){return R()}getPixelRatio(t){return 1}getImageState(){return R()}getImageSize(){return R()}getOrigin(){return R()}getSize(){return R()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=dn(t)}listenImageChange(t){R()}load(){R()}unlistenImageChange(t){R()}ready(){return Promise.resolve()}}const gn=fn,pn={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var mn={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};mn.max=mn.whitepoint[2].D65,mn.rgb=function(t,e){e=e||mn.whitepoint[2].E;var i,n,r,s=t[0]/e[0],o=t[1]/e[1],a=t[2]/e[2];return n=-.96924363628087*s+1.87596750150772*o+.041555057407175*a,r=.055630079696993*s+-.20397695888897*o+1.056971514242878*a,i=(i=3.240969941904521*s+-1.537383177570093*o+-.498610760293*a)>.0031308?1.055*Math.pow(i,1/2.4)-.055:i*=12.92,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n*=12.92,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r*=12.92,[255*(i=Math.min(Math.max(0,i),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},pn.xyz=function(t,e){var i=t[0]/255,n=t[1]/255,r=t[2]/255,s=.21263900587151*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.71516867876775*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.072192315360733*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92),o=.019330818715591*i+.11919477979462*n+.95053215224966*r;return[(.41239079926595*i+.35758433938387*n+.18048078840183*r)*(e=e||mn.whitepoint[2].E)[0],s*e[1],o*e[2]]};const _n=mn,wn={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(t,e,i){var n,r,s,o,a,l,h,u,c;return s=t[0],o=t[1],a=t[2],0===s?[0,0,0]:(e=e||"D65",i=i||2,n=o/(13*s)+4*(h=_n.whitepoint[i][e][0])/(h+15*(u=_n.whitepoint[i][e][1])+3*(c=_n.whitepoint[i][e][2]))||0,r=a/(13*s)+9*u/(h+15*u+3*c)||0,[9*(l=s>8?u*Math.pow((s+16)/116,3):u*s*.0011070564598794539)*n/(4*r)||0,l,l*(12-3*n-20*r)/(4*r)||0])}};_n.luv=function(t,e,i){var n,r,s,o,a,l,h,u,c,d,f;e=e||"D65",i=i||2,d=4*(h=_n.whitepoint[i][e][0])/(h+15*(u=_n.whitepoint[i][e][1])+3*(c=_n.whitepoint[i][e][2])),f=9*u/(h+15*u+3*c),n=4*(o=t[0])/(o+15*(a=t[1])+3*(l=t[2]))||0,r=9*a/(o+15*a+3*l)||0;var g=a/u;return[s=g<=.008856451679035631?903.2962962962961*g:116*Math.pow(g,1/3)-16,13*s*(n-d),13*s*(r-f)]};var yn={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(t){var e,i=t[0],n=t[1];return e=t[2]/360*2*Math.PI,[i,n*Math.cos(e),n*Math.sin(e)]},xyz:function(t){return wn.xyz(yn.luv(t))}};const vn=yn;wn.lchuv=function(t){var e=t[0],i=t[1],n=t[2],r=Math.sqrt(i*i+n*n),s=360*Math.atan2(n,i)/2/Math.PI;return s<0&&(s+=360),[e,r,s]},_n.lchuv=function(t){return wn.lchuv(_n.luv(t))};var bn=__webpack_require__(8874);const xn=function(t){var e,i,n=[],r=1;if("number"==typeof t)return{space:"rgb",values:[t>>>16,(65280&t)>>>8,255&t],alpha:1};if("number"==typeof t)return{space:"rgb",values:[t>>>16,(65280&t)>>>8,255&t],alpha:1};if(t=String(t).toLowerCase(),bn[t])n=bn[t].slice(),i="rgb";else if("transparent"===t)r=0,i="rgb",n=[0,0,0];else if("#"===t[0]){var s=t.slice(1),o=s.length;r=1,o<=4?(n=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],4===o&&(r=parseInt(s[3]+s[3],16)/255)):(n=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],8===o&&(r=parseInt(s[6]+s[7],16)/255)),n[0]||(n[0]=0),n[1]||(n[1]=0),n[2]||(n[2]=0),i="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(t)){var a=e[1],l="cmyk"===(i=a.replace(/a$/,""))?4:"gray"===i?1:3;n=e[2].trim().split(/\s*[,\/]\s*|\s+/),"color"===i&&(i=n.shift()),r=(n=n.map((function(t,e){if("%"===t[t.length-1])return t=parseFloat(t)/100,3===e?t:"rgb"===i?255*t:"h"===i[0]?100*t:"l"!==i[0]||e?"lab"===i?125*t:"lch"===i?e<2?150*t:360*t:"o"!==i[0]||e?"oklab"===i?.4*t:"oklch"===i?e<2?.4*t:360*t:t:t:100*t;if("h"===i[e]||2===e&&"h"===i[i.length-1]){if(void 0!==Mn[t])return Mn[t];if(t.endsWith("deg"))return parseFloat(t);if(t.endsWith("turn"))return 360*parseFloat(t);if(t.endsWith("grad"))return 360*parseFloat(t)/400;if(t.endsWith("rad"))return 180*parseFloat(t)/Math.PI}return"none"===t?0:parseFloat(t)}))).length>l?n.pop():1}else/[0-9](?:\s|\/|,)/.test(t)&&(n=t.match(/([0-9]+)/g).map((function(t){return parseFloat(t)})),i=t.match(/([a-z])/gi)?.join("")?.toLowerCase()||"rgb");return{space:i,values:n,alpha:r}};var Mn={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};const kn={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(t){var e,i,n,r,s,o=t[0]/360,a=t[1]/100,l=t[2]/100,h=0;if(0===a)return[s=255*l,s,s];for(e=2*l-(i=l<.5?l*(1+a):l+a-l*a),r=[0,0,0];h<3;)(n=o+1/3*-(h-1))<0?n++:n>1&&n--,s=6*n<1?e+6*(i-e)*n:2*n<1?i:3*n<2?e+(i-e)*(2/3-n)*6:e,r[h++]=255*s;return r}};pn.hsl=function(t){var e,i,n=t[0]/255,r=t[1]/255,s=t[2]/255,o=Math.min(n,r,s),a=Math.max(n,r,s),l=a-o;return a===o?e=0:n===a?e=(r-s)/l:r===a?e=2+(s-n)/l:s===a&&(e=4+(n-r)/l),(e=Math.min(60*e,360))<0&&(e+=360),i=(o+a)/2,[e,100*(a===o?0:i<=.5?l/(a+o):l/(2-a-o)),100*i]};const Sn=1024,En={};let Cn=0;function In(t){if(4===t.length)return t;const e=t.slice();return e[3]=1,e}function An(t){const e=_n.lchuv(pn.xyz(t));return e[3]=t[3],e}function Tn(t){if(En.hasOwnProperty(t))return En[t];if(Cn>=Sn){let t=0;for(const e in En)0==(3&t++)&&(delete En[e],--Cn)}const e=function(t){var e;Array.isArray(t)&&t.raw&&(t=String.raw(...arguments)),t instanceof Number&&(t=+t);var i=xn(t);if(!i.space)return[];const n="h"===i.space[0]?kn.min:pn.min,r="h"===i.space[0]?kn.max:pn.max;return(e=Array(3))[0]=Math.min(Math.max(i.values[0],n[0]),r[0]),e[1]=Math.min(Math.max(i.values[1],n[1]),r[1]),e[2]=Math.min(Math.max(i.values[2],n[2]),r[2]),"h"===i.space[0]&&(e=kn.rgb(e)),e.push(Math.min(Math.max(i.alpha,0),1)),e}(t);if(4!==e.length)throw new Error('Failed to parse "'+t+'" as color');for(const i of e)if(isNaN(i))throw new Error('Failed to parse "'+t+'" as color');return Pn(e),En[t]=e,++Cn,e}function Rn(t){return Array.isArray(t)?t:Tn(t)}function Pn(t){return t[0]=K(t[0]+.5|0,0,255),t[1]=K(t[1]+.5|0,0,255),t[2]=K(t[2]+.5|0,0,255),t[3]=K(t[3],0,1),t}function Dn(t){let e=t[0];e!=(0|e)&&(e=e+.5|0);let i=t[1];i!=(0|i)&&(i=i+.5|0);let n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+i+","+n+","+(void 0===t[3]?1:Math.round(1e3*t[3])/1e3)+")"}const Fn="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",Ln=Fn.includes("firefox"),On=(Fn.includes("safari")&&!Fn.includes("chrom")&&(Fn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Fn)),Fn.includes("webkit")&&!Fn.includes("edge")),zn=Fn.includes("macintosh"),Nn="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,Bn="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,Un="undefined"!=typeof Image&&Image.prototype.decode,Gn=function(){let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}return t}();function Xn(t,e,i,n){let r;return r=i&&i.length?i.shift():Bn?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(r.width=t),e&&(r.height=e),r.getContext("2d",n)}let Yn;function Vn(){return Yn||(Yn=Xn(1,1)),Yn}function jn(t){const e=t.canvas;e.width=1,e.height=1,t.clearRect(0,0,1,1)}function qn(t,e){const i=e.parentNode;i&&i.replaceChild(t,e)}function Wn(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}function $n(t,e,i){return e+":"+t+":"+(i?Rn(i):"null")}const Zn=new class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];0!=(3&t++)||i.hasListener()||(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const n=$n(t,e,i);return n in this.cache_?this.cache_[n]:null}getPattern(t,e,i){const n=$n(t,e,i);return n in this.patternCache_?this.patternCache_[n]:null}set(t,e,i,n,r){const s=$n(t,e,i),o=s in this.cache_;this.cache_[s]=n,r&&(n.getImageState()===on&&n.load(),n.getImageState()===an?n.ready().then((()=>{this.patternCache_[s]=Vn().createPattern(n.getImage(1),"repeat")})):this.patternCache_[s]=Vn().createPattern(n.getImage(1),"repeat")),o||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};let Hn=null;class Kn extends w{constructor(t,e,i,n,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=void 0===n?on:n,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&this.imageState_===ln){Hn||(Hn=Xn(1,1,void 0,{willReadFrequently:!0})),Hn.drawImage(this.image_,0,0);try{Hn.getImageData(0,0,1,1),this.tainted_=!1}catch(t){Hn=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(y)}handleImageError_(){this.imageState_=hn,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ln,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=Xn(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===on){this.image_||this.initializeImage_(),this.imageState_=an;try{void 0!==this.src_&&(this.image_.src=this.src_)}catch(t){this.handleImageError_()}this.image_ instanceof HTMLImageElement&&function(t,e){return e&&(t.src=e),t.src&&Un?new Promise(((e,i)=>t.decode().then((()=>e(t))).catch((n=>t.complete&&t.width?e(t):i(n))))):function(t,e){return new Promise(((e,i)=>{function n(){s(),e(t)}function r(){s(),i(new Error("Image load error"))}function s(){t.removeEventListener("load",n),t.removeEventListener("error",r)}t.addEventListener("load",n),t.addEventListener("error",r)}))}(t)}(this.image_,this.src_).then((t=>{this.image_=t,this.handleImageLoad_()})).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==ln)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const n=i.getContext("2d");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=function(t){return"string"==typeof t?t:Dn(t)}(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise((t=>{this.imageState_===ln||this.imageState_===hn?t():this.addEventListener(y,(function e(){this.imageState_!==ln&&this.imageState_!==hn||(this.removeEventListener(y,e),t())}))}))),this.ready_}}function Jn(t,e,i,n,r,s){let o=void 0===e?void 0:Zn.get(e,i,r);return o||(o=new Kn(t,t instanceof HTMLImageElement?t.src||void 0:e,i,n,r),Zn.set(e,i,r,o,s)),s&&o&&!Zn.getPattern(e,i,r)&&Zn.set(e,i,r,o,s),o}function Qn(t){return t?Array.isArray(t)?Dn(t):"object"==typeof t&&"src"in t?function(t){if(!t.offset||!t.size)return Zn.getPattern(t.src,"anonymous",t.color);const e=t.src+":"+t.offset,i=Zn.getPattern(e,void 0,t.color);if(i)return i;const n=Zn.get(t.src,"anonymous",null);if(n.getImageState()!==ln)return null;const r=Xn(t.size[0],t.size[1]);return r.drawImage(n.getImage(1),t.offset[0],t.offset[1],t.size[0],t.size[1],0,0,t.size[0],t.size[1]),Jn(r.canvas,e,void 0,ln,t.color,!0),Zn.getPattern(e,void 0,t.color)}(t):t:null}const tr="ol-hidden",er="ol-unselectable",ir="ol-control",nr="ol-collapsed",rr=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),sr=["style","variant","weight","size","lineHeight","family"],or=function(t){const e=t.match(rr);if(!e)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let t=0,n=sr.length;t<n;++t){const n=e[t+1];void 0!==n&&(i[sr[t]]=n)}return i.families=i.family.split(/,\s?/),i},ar="10px sans-serif",lr="#000",hr="round",ur=[],cr="round",dr="#000",fr="center",gr="middle",pr=[0,0,0,0],mr=new L;let _r,wr=null;const yr={},vr=function(){const t="32px ",e=["monospace","serif"],i=e.length,n="wmytzilWMYTZIL@#/&?$%10";let r,s;function o(r,o,a){let l=!0;for(let h=0;h<i;++h){const i=e[h];if(s=Mr(r+" "+o+" "+t+i,n),a!=i){const e=Mr(r+" "+o+" "+t+a+","+i,n);l=l&&e!=s}}return!!l}function a(){let t=!0;const e=mr.getKeys();for(let i=0,n=e.length;i<n;++i){const n=e[i];mr.get(n)<100&&(o.apply(this,n.split("\n"))?(m(yr),wr=null,_r=void 0,mr.set(n,100)):(mr.set(n,mr.get(n)+1,!0),t=!1))}t&&(clearInterval(r),r=void 0)}return function(t){const e=or(t);if(!e)return;const i=e.families;for(let t=0,n=i.length;t<n;++t){const n=i[t],s=e.style+"\n"+e.weight+"\n"+n;void 0===mr.get(s)&&(mr.set(s,100,!0),o(e.style,e.weight,n)||(mr.set(s,0,!0),void 0===r&&(r=setInterval(a,32))))}}}(),br=function(){let t;return function(e){let i=yr[e];if(null==i){if(Bn){const t=or(e),n=xr(e,"g");i=(isNaN(Number(t.lineHeight))?1.2:Number(t.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else t||(t=document.createElement("div"),t.innerHTML="M",t.style.minHeight="0",t.style.maxHeight="none",t.style.height="auto",t.style.padding="0",t.style.border="none",t.style.position="absolute",t.style.display="block",t.style.left="-99999px"),t.style.font=e,document.body.appendChild(t),i=t.offsetHeight,document.body.removeChild(t);yr[e]=i}return i}}();function xr(t,e){return wr||(wr=Xn(1,1)),t!=_r&&(wr.font=t,_r=wr.font),wr.measureText(e)}function Mr(t,e){return xr(t,e).width}function kr(t,e,i){if(e in i)return i[e];const n=e.split("\n").reduce(((e,i)=>Math.max(e,Mr(t,i))),0);return i[e]=n,n}class Sr extends gn{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?an:ln,this.imageState_===an&&this.ready().then((()=>this.imageState_=ln)),this.render()}clone(){const t=this.getScale(),e=new Sr({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const i=this.renderOptions_,n=Xn(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let n=this.radius_,r=void 0===this.radius2_?n:this.radius2_;if(n<r){const t=n;n=r,r=t}const s=void 0===this.radius2_?this.points_:2*this.points_,o=2*Math.PI/s,a=r*Math.sin(o),l=n-Math.sqrt(r*r-a*a),h=Math.sqrt(a*a+l*l),u=h/a;if("miter"===t&&u<=i)return u*e;const c=e/2/u,d=e/2*(l/h),f=Math.sqrt((n+c)*(n+c)+d*d)-n;if(void 0===this.radius2_||"bevel"===t)return 2*f;const g=n*Math.sin(o),p=r-Math.sqrt(n*n-g*g),m=Math.sqrt(g*g+p*p)/g;if(m<=i){const t=m*e/2-r-n;return 2*Math.max(f,t)}return 2*f}createRenderOptions(){let t,e=hr,i=cr,n=0,r=null,s=0,o=0;this.stroke_&&(t=Qn(this.stroke_.getColor()??dr),o=this.stroke_.getWidth()??1,r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,i=this.stroke_.getLineJoin()??cr,e=this.stroke_.getLineCap()??hr,n=this.stroke_.getMiterLimit()??10);const a=this.calculateLineJoinSize_(i,o,n),l=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:o,size:Math.ceil(2*l+a),lineCap:e,lineDash:r,lineDashOffset:s,lineJoin:i,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let t=this.fill_.getColor();null===t&&(t=lr),e.fillStyle=Qn(t),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),n=0;"string"==typeof i&&(i=Rn(i)),null===i?n=1:Array.isArray(i)&&(n=4===i.length?i[3]:1),0===n&&(e=Xn(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const n=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const r=this.angle_-Math.PI/2,s=2*Math.PI/e;for(let o=0;o<e;o++){const e=r+o*s,a=o%2==0?i:n;t.lineTo(a*Math.cos(e),a*Math.sin(e))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=lr,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}const Er=Sr;class Cr extends Er{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Cr({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const Ir=Cr;class Ar{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,void 0!==t.color&&this.setColor(t.color)}clone(){const t=this.getColor();return new Ar({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(null!==t&&"object"==typeof t&&"src"in t){const e=Jn(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then((()=>{this.patternImage_=null})),e.getImageState()===on&&e.load(),e.getImageState()===an&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}const Tr=Ar;class Rr{constructor(t){t=t||{},this.color_=void 0!==t.color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Rr({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const Pr=Rr;class Dr{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Or,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new Dr({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Or,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let Fr=null;function Lr(t,e){if(!Fr){const t=new Tr({color:"rgba(255,255,255,0.4)"}),e=new Pr({color:"#3399CC",width:1.25});Fr=[new Dr({image:new Ir({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return Fr}function Or(t){return t.getGeometry()}const zr=Dr;function Nr(t,e,i,n){return void 0!==i&&void 0!==n?[i/t,n/e]:void 0!==i?i/t:void 0!==n?n/e:1}class Br extends gn{constructor(t){const e=void 0!==(t=t||{}).opacity?t.opacity:1,i=void 0!==t.rotation?t.rotation:0,n=void 0!==t.scale?t.scale:1,r=void 0!==t.rotateWithView&&t.rotateWithView;super({opacity:e,rotation:i,scale:n,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const s=void 0!==t.img?t.img:null;let o,a=t.src;if(H(!(void 0!==a&&s),"`image` and `src` cannot be provided at the same time"),void 0!==a&&0!==a.length||!s||(a=s.src||D(s)),H(void 0!==a&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),H(!((void 0!==t.width||void 0!==t.height)&&void 0!==t.scale),"`width` or `height` cannot be provided together with `scale`"),void 0!==t.src?o=on:void 0!==s&&(o=s instanceof HTMLImageElement?s.complete?s.src?ln:on:an:ln),this.color_=void 0!==t.color?Rn(t.color):null,this.iconImage_=Jn(s,a,this.crossOrigin_,o,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null,void 0!==t.width||void 0!==t.height){let e,i;if(t.size)[e,i]=t.size;else{const n=this.getImage(1);if(n.width&&n.height)e=n.width,i=n.height;else if(n instanceof HTMLImageElement){this.initialOptions_=t;const e=()=>{if(this.unlistenImageChange(e),!this.initialOptions_)return;const i=this.iconImage_.getSize();this.setScale(Nr(i[0],i[1],t.width,t.height))};return void this.listenImageChange(e)}}void 0!==e&&this.setScale(Nr(e,i,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Br({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const e=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!e)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=e[0]),"fraction"==this.anchorYUnits_&&(t[1]*=e[1])}if("top-left"!=this.anchorOrigin_){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[0]=-t[0]+e[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if("top-left"!=this.offsetOrigin_){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[0]=i[0]-e[0]-t[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();return this.size_?this.size_[0]*t[0]:this.iconImage_.getImageState()==ln?this.iconImage_.getSize()[0]*t[0]:void 0}getHeight(){const t=this.getScaleArray();return this.size_?this.size_[1]*t[1]:this.iconImage_.getImageState()==ln?this.iconImage_.getSize()[1]*t[1]:void 0}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(y,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(y,t)}ready(){return this.iconImage_.ready()}}const Ur=Br;class Gr{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=dn(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new Tr({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Gr({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=dn(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const Xr=Gr;let Yr=0;const Vr=0,jr=1<<Yr++,qr=1<<Yr++,Wr=1<<Yr++,$r=1<<Yr++,Zr=1<<Yr++,Hr=Math.pow(2,5)-1,Kr={[jr]:"boolean",[qr]:"number",[Wr]:"string",[$r]:"color",[Zr]:"number[]"},Jr=Object.keys(Kr).map(Number).sort(a);function Qr(t){const e=[];for(const n of Jr)(t&(i=n))===i&&e.push(Kr[n]);var i;return 0===e.length?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function ts(t,e){return!!(t&e)}function es(t,e){return t===e}class is{constructor(t,e){this.type=t,this.value=e}}class ns{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function rs(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function ss(t,e,i){switch(typeof t){case"boolean":return new is(jr,t);case"number":return new is(qr,t);case"string":{let e=Wr;return function(t){try{return Tn(t),!0}catch(t){return!1}}(t)&&(e|=$r),es(e&i,Vr)||(e&=i),new is(e,t)}}if(!Array.isArray(t))throw new Error("Expression must be an array or a primitive value");if(0===t.length)throw new Error("Empty expression");if("string"==typeof t[0])return function(t,e,i){const n=t[0],r=as[n];if(!r)throw new Error(`Unknown operator: ${n}`);return r(t,e,i)}(t,e,i);for(const e of t)if("number"!=typeof e)throw new Error("Expected an array of numbers");let n=Zr;return 3!==t.length&&4!==t.length||(n|=$r),i&&(n&=i),new is(n,t)}const os={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},as={[os.Get]:fs((([t,e])=>void 0!==e?function(t){switch(t){case"string":return Wr;case"color":return $r;case"number":return qr;case"boolean":return jr;case"number[]":return Zr;default:throw new Error(`Unrecognized type hint: ${t}`)}}(e.value):Hr),hs(1,2),(function(t,e){const i=ss(t[1],e);if(!(i instanceof is))throw new Error("Expected a literal argument for get operation");if("string"!=typeof i.value)throw new Error("Expected a string argument for get operation");return e.properties.add(i.value),3===t.length?[i,ss(t[2],e)]:[i]})),[os.Var]:fs((([t])=>t.type),hs(1,1),(function(t,e,i,n){const r=t[1];if("string"!=typeof r)throw new Error("Expected a string argument for var operation");if(e.variables.add(r),!("variables"in e.style)||void 0===e.style.variables[r])return[new is(Hr,r)];const s=ss(e.style.variables[r],e);if(s.value=r,n&&!ts(n,s.type))throw new Error(`The variable ${r} has type ${Qr(s.type)} but the following type was expected: ${Qr(n)}`);return[s]})),[os.Id]:fs(qr|Wr,ls,(function(t,e){e.featureId=!0})),[os.Concat]:fs(Wr,hs(2,1/0),us(Hr)),[os.GeometryType]:fs(Wr,ls,(function(t,e){e.geometryType=!0})),[os.Resolution]:fs(qr,ls),[os.Zoom]:fs(qr,ls),[os.Time]:fs(qr,ls),[os.Any]:fs(jr,hs(2,1/0),us(jr)),[os.All]:fs(jr,hs(2,1/0),us(jr)),[os.Not]:fs(jr,hs(1,1),us(jr)),[os.Equal]:fs(jr,hs(2,2),us(Hr),cs),[os.NotEqual]:fs(jr,hs(2,2),us(Hr),cs),[os.GreaterThan]:fs(jr,hs(2,2),us(Hr),cs),[os.GreaterThanOrEqualTo]:fs(jr,hs(2,2),us(Hr),cs),[os.LessThan]:fs(jr,hs(2,2),us(Hr),cs),[os.LessThanOrEqualTo]:fs(jr,hs(2,2),us(Hr),cs),[os.Multiply]:fs((t=>{let e=qr|$r;for(let i=0;i<t.length;i++)e&=t[i].type;return e}),hs(2,1/0),us(qr|$r),cs),[os.Coalesce]:fs((t=>{let e=Hr;for(let i=1;i<t.length;i+=2)e&=t[i].type;return e&=t[t.length-1].type,e}),hs(2,1/0),us(Hr),cs),[os.Divide]:fs(qr,hs(2,2),us(qr)),[os.Add]:fs(qr,hs(2,1/0),us(qr)),[os.Subtract]:fs(qr,hs(2,2),us(qr)),[os.Clamp]:fs(qr,hs(3,3),us(qr)),[os.Mod]:fs(qr,hs(2,2),us(qr)),[os.Pow]:fs(qr,hs(2,2),us(qr)),[os.Abs]:fs(qr,hs(1,1),us(qr)),[os.Floor]:fs(qr,hs(1,1),us(qr)),[os.Ceil]:fs(qr,hs(1,1),us(qr)),[os.Round]:fs(qr,hs(1,1),us(qr)),[os.Sin]:fs(qr,hs(1,1),us(qr)),[os.Cos]:fs(qr,hs(1,1),us(qr)),[os.Atan]:fs(qr,hs(1,2),us(qr)),[os.Sqrt]:fs(qr,hs(1,1),us(qr)),[os.Match]:fs((t=>{let e=Hr;for(let i=2;i<t.length;i+=2)e&=t[i].type;return e&=t[t.length-1].type,e}),hs(4,1/0),ds,(function(t,e,i,n){const r=t.length-1;let s=ss(t[1],e).type;const o=ss(t[t.length-1],e);let a=void 0!==n?n&o.type:o.type;const l=new Array(r-2);for(let i=0;i<r-2;i+=2){const n=ss(t[i+2],e),r=ss(t[i+3],e);s&=n.type,a&=r.type,l[i]=n,l[i+1]=r}const h=Wr|qr|jr;if(!ts(h,s))throw new Error(`Expected an input of type ${Qr(h)} for the interpolate operation, got ${Qr(s)} instead`);if(es(a,Vr))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(t));for(let i=0;i<r-2;i+=2){const n=ss(t[i+2],e,s),r=ss(t[i+3],e,a);l[i]=n,l[i+1]=r}return[ss(t[1],e,s),...l,ss(t[t.length-1],e,a)]})),[os.Between]:fs(jr,hs(3,3),us(qr)),[os.Interpolate]:fs((t=>{let e=$r|qr;for(let i=3;i<t.length;i+=2)e&=t[i].type;return e}),hs(6,1/0),ds,(function(t,e,i,n){const r=t[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],"number"!=typeof s)throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=ss(s,e);let o=ss(t[2],e);if(!ts(qr,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${Qr(o.type)} instead`);o=ss(t[2],e,qr);const a=new Array(t.length-3);for(let i=0;i<a.length;i+=2){let n=ss(t[i+3],e);if(!ts(qr,n.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${Qr(n.type)} at position ${i+2} instead`);let r=ss(t[i+4],e);if(!ts(qr|$r,r.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${Qr(r.type)} at position ${i+3} instead`);n=ss(t[i+3],e,qr),r=ss(t[i+4],e,qr|$r),a[i]=n,a[i+1]=r}return[s,o,...a]})),[os.Case]:fs((t=>{let e=Hr;for(let i=1;i<t.length;i+=2)e&=t[i].type;return e&=t[t.length-1].type,e}),hs(3,1/0),(function(t,e){const i=t[0],n=t.length-1;if(n%2==0)throw new Error(`An odd amount of arguments was expected for operation ${i}, got ${JSON.stringify(n)} instead`)}),(function(t,e,i,n){const r=ss(t[t.length-1],e);let s=void 0!==n?n&r.type:r.type;const o=new Array(t.length-1);for(let i=0;i<o.length-1;i+=2){const n=ss(t[i+1],e),r=ss(t[i+2],e);if(!ts(jr,n.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${Qr(n.type)} at position ${i} instead`);s&=r.type,o[i]=n,o[i+1]=r}if(es(s,Vr))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(t));for(let i=0;i<o.length-1;i+=2)o[i+1]=ss(t[i+2],e,s);return o[o.length-1]=ss(t[t.length-1],e,s),o})),[os.In]:fs(jr,hs(2,2),(function(t,e){let i=t[2];if(!Array.isArray(i))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if("string"==typeof i[0]){if("literal"!==i[0])throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(i[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');i=i[1]}let n=Wr|qr;const r=new Array(i.length);for(let t=0;t<r.length;t++){const s=ss(i[t],e);n&=s.type,r[t]=s}if(es(n,Vr))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(t));return[ss(t[1],e,n),...r]})),[os.Number]:fs(qr,hs(1,1/0),us(Hr)),[os.String]:fs(Wr,hs(1,1/0),us(Hr)),[os.Array]:fs((t=>3===t.length||4===t.length?Zr|$r:Zr),hs(1,1/0),us(qr)),[os.Color]:fs($r,hs(1,4),us(qr)),[os.Band]:fs(qr,hs(1,3),us(qr)),[os.Palette]:fs($r,hs(2,2),(function(t,e){const i=ss(t[1],e,qr);if(i.type!==qr)throw new Error(`The first argument of palette must be an number, got ${Qr(i.type)} instead`);const n=t[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let t=0;t<r.length;t++){const i=ss(n[t],e,$r);if(!(i instanceof is))throw new Error(`The palette color at index ${t} must be a literal value`);if(!ts(i.type,$r))throw new Error(`The palette color at index ${t} should be of type color, got ${Qr(i.type)} instead`);r[t]=i}return[i,...r]})),[os.ToString]:fs(Wr,hs(1,1),us(jr|qr|Wr|$r))};function ls(t,e){const i=t[0];if(1!==t.length)throw new Error(`Expected no arguments for ${i} operation`);return[]}function hs(t,e){return function(i,n){const r=i[0],s=i.length-1;if(t===e){if(s!==t)throw new Error(`Expected ${t} argument${1===t?"":"s"} for ${r}, got ${s}`)}else if(s<t||s>e)throw new Error(`Expected ${e===1/0?`${t} or more`:`${t} to ${e}`} arguments for ${r}, got ${s}`)}}function us(t){return function(e,i){const n=e[0],r=e.length-1,s=new Array(r);for(let o=0;o<r;++o){const r=ss(e[o+1],i);if(!ts(t,r.type)){const e=Qr(t),i=Qr(r.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${e} but expected ${i}`)}r.type&=t,s[o]=r}return s}}function cs(t,e,i){const n=t[0],r=t.length-1;let s=Hr;for(let t=0;t<i.length;++t)s&=i[t].type;if(s===Vr)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(r);for(let i=0;i<r;++i)o[i]=ss(t[i+1],e,s);return o}function ds(t,e){const i=t[0],n=t.length-1;if(n%2==1)throw new Error(`An even amount of arguments was expected for operation ${i}, got ${JSON.stringify(n)} instead`)}function fs(t,...e){return function(i,n,r){const s=i[0];let o=[];for(let t=0;t<e.length;t++)o=e[t](i,n,o,r)||o;let a="function"==typeof t?t(o):t;if(void 0!==r){if(!ts(a,r))throw new Error(`The following expression was expected to return ${Qr(r)}, but returns ${Qr(a)} instead: ${JSON.stringify(i)}`);a&=r}if(a===Vr)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(i)}`);return new ns(a,s,...o)}}function gs(t){if(!t)return"";const e=t.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return gs(t.getGeometries()[0]);default:return""}}function ps(t,e,i){const n=ss(t,i);if(!ts(e,n.type)){const t=Qr(e),i=Qr(n.type);throw new Error(`Expected expression to be of type ${t}, got ${i}`)}return ms(n,i)}function ms(t,e){if(t instanceof is){if(t.type===$r&&"string"==typeof t.value){const e=Tn(t.value);return function(){return e}}return function(){return t.value}}const i=t.operator;switch(i){case os.Number:case os.String:case os.Coalesce:return function(t,e){const i=t.operator,n=t.args.length,r=new Array(n);for(let i=0;i<n;++i)r[i]=ms(t.args[i],e);switch(i){case os.Coalesce:return t=>{for(let e=0;e<n;++e){const i=r[e](t);if(null!=i)return i}throw new Error("Expected one of the values to be non-null")};case os.Number:case os.String:return t=>{for(let e=0;e<n;++e){const n=r[e](t);if(typeof n===i)return n}throw new Error(`Expected one of the values to be a ${i}`)};default:throw new Error(`Unsupported assertion operator ${i}`)}}(t,e);case os.Get:case os.Var:return function(t,e){const i=t.args[0].value;switch(t.operator){case os.Get:return t=>t.properties[i];case os.Var:return t=>t.variables[i];default:throw new Error(`Unsupported accessor operator ${t.operator}`)}}(t);case os.Id:return t=>t.featureId;case os.GeometryType:return t=>t.geometryType;case os.Concat:{const i=t.args.map((t=>ms(t,e)));return t=>"".concat(...i.map((e=>e(t).toString())))}case os.Resolution:return t=>t.resolution;case os.Any:case os.All:case os.Between:case os.In:case os.Not:return function(t,e){const i=t.operator,n=t.args.length,r=new Array(n);for(let i=0;i<n;++i)r[i]=ms(t.args[i],e);switch(i){case os.Any:return t=>{for(let e=0;e<n;++e)if(r[e](t))return!0;return!1};case os.All:return t=>{for(let e=0;e<n;++e)if(!r[e](t))return!1;return!0};case os.Between:return t=>{const e=r[0](t),i=r[1](t),n=r[2](t);return e>=i&&e<=n};case os.In:return t=>{const e=r[0](t);for(let i=1;i<n;++i)if(e===r[i](t))return!0;return!1};case os.Not:return t=>!r[0](t);default:throw new Error(`Unsupported logical operator ${i}`)}}(t,e);case os.Equal:case os.NotEqual:case os.LessThan:case os.LessThanOrEqualTo:case os.GreaterThan:case os.GreaterThanOrEqualTo:return function(t,e){const i=t.operator,n=ms(t.args[0],e),r=ms(t.args[1],e);switch(i){case os.Equal:return t=>n(t)===r(t);case os.NotEqual:return t=>n(t)!==r(t);case os.LessThan:return t=>n(t)<r(t);case os.LessThanOrEqualTo:return t=>n(t)<=r(t);case os.GreaterThan:return t=>n(t)>r(t);case os.GreaterThanOrEqualTo:return t=>n(t)>=r(t);default:throw new Error(`Unsupported comparison operator ${i}`)}}(t,e);case os.Multiply:case os.Divide:case os.Add:case os.Subtract:case os.Clamp:case os.Mod:case os.Pow:case os.Abs:case os.Floor:case os.Ceil:case os.Round:case os.Sin:case os.Cos:case os.Atan:case os.Sqrt:return function(t,e){const i=t.operator,n=t.args.length,r=new Array(n);for(let i=0;i<n;++i)r[i]=ms(t.args[i],e);switch(i){case os.Multiply:return t=>{let e=1;for(let i=0;i<n;++i)e*=r[i](t);return e};case os.Divide:return t=>r[0](t)/r[1](t);case os.Add:return t=>{let e=0;for(let i=0;i<n;++i)e+=r[i](t);return e};case os.Subtract:return t=>r[0](t)-r[1](t);case os.Clamp:return t=>{const e=r[0](t),i=r[1](t);if(e<i)return i;const n=r[2](t);return e>n?n:e};case os.Mod:return t=>r[0](t)%r[1](t);case os.Pow:return t=>Math.pow(r[0](t),r[1](t));case os.Abs:return t=>Math.abs(r[0](t));case os.Floor:return t=>Math.floor(r[0](t));case os.Ceil:return t=>Math.ceil(r[0](t));case os.Round:return t=>Math.round(r[0](t));case os.Sin:return t=>Math.sin(r[0](t));case os.Cos:return t=>Math.cos(r[0](t));case os.Atan:return 2===n?t=>Math.atan2(r[0](t),r[1](t)):t=>Math.atan(r[0](t));case os.Sqrt:return t=>Math.sqrt(r[0](t));default:throw new Error(`Unsupported numeric operator ${i}`)}}(t,e);case os.Case:return function(t,e){const i=t.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=ms(t.args[r],e);return t=>{for(let e=0;e<i-1;e+=2)if(n[e](t))return n[e+1](t);return n[i-1](t)}}(t,e);case os.Match:return function(t,e){const i=t.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=ms(t.args[r],e);return t=>{const e=n[0](t);for(let r=1;r<i;r+=2)if(e===n[r](t))return n[r+1](t);return n[i-1](t)}}(t,e);case os.Interpolate:return function(t,e){const i=t.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=ms(t.args[r],e);return t=>{const e=n[0](t),r=n[1](t);let s,o;for(let a=2;a<i;a+=2){const i=n[a](t);let l=n[a+1](t);const h=Array.isArray(l);if(h&&(l=In(l)),i>=r)return 2===a?l:h?ws(e,r,s,o,i,l):_s(e,r,s,o,i,l);s=i,o=l}return o}}(t,e);case os.ToString:return function(t,e){const i=t.operator,n=t.args.length,r=new Array(n);for(let i=0;i<n;++i)r[i]=ms(t.args[i],e);if(i===os.ToString)return e=>{const i=r[0](e);return t.args[0].type===$r?Dn(i):i.toString()};throw new Error(`Unsupported convert operator ${i}`)}(t,e);default:throw new Error(`Unsupported operator ${i}`)}}function _s(t,e,i,n,r,s){const o=r-i;if(0===o)return n;const a=e-i;return n+(1===t?a/o:(Math.pow(t,a)-1)/(Math.pow(t,o)-1))*(s-n)}function ws(t,e,i,n,r,s){if(0==r-i)return n;const o=An(n),a=An(s);let l=a[2]-o[2];return l>180?l-=360:l<-180&&(l+=360),Pn(function(t){const e=_n.rgb(vn.xyz(t));return e[3]=t[3],e}([_s(t,e,i,o[0],r,a[0]),_s(t,e,i,o[1],r,a[1]),o[2]+_s(t,e,i,0,r,l),_s(t,e,i,n[3],r,s[3])]))}function ys(t){return!0}function vs(t){const e=rs(),i=function(t,e){const i=t.length,n=new Array(i);for(let r=0;r<i;++r){const i=t[r],s="filter"in i?ps(i.filter,jr,e):ys;let o;if(Array.isArray(i.style)){const t=i.style.length;o=new Array(t);for(let n=0;n<t;++n)o[n]=xs(i.style[n],e)}else o=[xs(i.style,e)];n[r]={filter:s,styles:o}}return function(e){const r=[];let s=!1;for(let o=0;o<i;++o)if((0,n[o].filter)(e)&&(!t[o].else||!s)){s=!0;for(const t of n[o].styles){const i=t(e);i&&r.push(i)}}return r}}(t,e),n={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""};return function(t,r){if(n.properties=t.getPropertiesInternal(),n.resolution=r,e.featureId){const e=t.getId();n.featureId=void 0!==e?e:null}return e.geometryType&&(n.geometryType=gs(t.getGeometry())),i(n)}}function bs(t){const e=rs(),i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=xs(t[r],e);const r={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""},s=new Array(i);return function(t,o){if(r.properties=t.getPropertiesInternal(),r.resolution=o,e.featureId){const e=t.getId();r.featureId=void 0!==e?e:null}let a=0;for(let t=0;t<i;++t){const e=n[t](r);e&&(s[a]=e,a+=1)}return s.length=a,s}}function xs(t,e){const i=Ms(t,"",e),n=ks(t,"",e),r=function(t,e){const i="text-",n=Es(t,i+"value",e);if(!n)return null;const r=Ms(t,i,e),s=Ms(t,i+"background-",e),o=ks(t,i,e),a=ks(t,i+"background-",e),l=Es(t,i+"font",e),h=Ss(t,i+"max-angle",e),u=Ss(t,i+"offset-x",e),c=Ss(t,i+"offset-y",e),d=Cs(t,i+"overflow",e),f=Es(t,i+"placement",e),g=Ss(t,i+"repeat",e),p=Ps(t,i+"scale",e),m=Cs(t,i+"rotate-with-view",e),_=Ss(t,i+"rotation",e),w=Es(t,i+"align",e),y=Es(t,i+"justify",e),v=Es(t,i+"baseline",e),b=As(t,i+"padding",e),x=Os(t,i+"declutter-mode"),M=new Xr({declutterMode:x});return function(t){if(M.setText(n(t)),r&&M.setFill(r(t)),s&&M.setBackgroundFill(s(t)),o&&M.setStroke(o(t)),a&&M.setBackgroundStroke(a(t)),l&&M.setFont(l(t)),h&&M.setMaxAngle(h(t)),u&&M.setOffsetX(u(t)),c&&M.setOffsetY(c(t)),d&&M.setOverflow(d(t)),f){const e=f(t);if("point"!==e&&"line"!==e)throw new Error("Expected point or line for text-placement");M.setPlacement(e)}if(g&&M.setRepeat(g(t)),p&&M.setScale(p(t)),m&&M.setRotateWithView(m(t)),_&&M.setRotation(_(t)),w){const e=w(t);if("left"!==e&&"center"!==e&&"right"!==e&&"end"!==e&&"start"!==e)throw new Error("Expected left, right, center, start, or end for text-align");M.setTextAlign(e)}if(y){const e=y(t);if("left"!==e&&"right"!==e&&"center"!==e)throw new Error("Expected left, right, or center for text-justify");M.setJustify(e)}if(v){const e=v(t);if("bottom"!==e&&"top"!==e&&"middle"!==e&&"alphabetic"!==e&&"hanging"!==e)throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");M.setTextBaseline(e)}return b&&M.setPadding(b(t)),M}}(t,e),s=function(t,e){return"icon-src"in t?function(t,e){const i="icon-",n=i+"src",r=Ns(t[n],n),s=Ts(t,i+"anchor",e),o=Ps(t,i+"scale",e),a=Ss(t,i+"opacity",e),l=Ts(t,i+"displacement",e),h=Ss(t,i+"rotation",e),u=Cs(t,i+"rotate-with-view",e),c=Fs(t,i+"anchor-origin"),d=Ls(t,i+"anchor-x-units"),f=Ls(t,i+"anchor-y-units"),g=function(t,e){const i=t[e];if(void 0!==i)return Us(i,e)}(t,i+"color"),p=function(t,e){const i=t[e];if(void 0!==i){if("string"!=typeof i)throw new Error(`Expected a string for ${e}`);return i}}(t,i+"cross-origin"),m=function(t,e){const i=t[e];if(void 0!==i)return zs(i,e)}(t,i+"offset"),_=Fs(t,i+"offset-origin"),w=Ds(t,i+"width"),y=Ds(t,i+"height"),v=function(t,e){const i=t[e];if(void 0!==i){if("number"==typeof i)return dn(i);if(!Array.isArray(i))throw new Error(`Expected a number or size array for ${e}`);if(2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])throw new Error(`Expected a number or size array for ${e}`);return i}}(t,i+"size"),b=Os(t,i+"declutter-mode"),x=new Ur({src:r,anchorOrigin:c,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:p,offset:m,offsetOrigin:_,height:y,width:w,size:v,declutterMode:b});return function(t){return a&&x.setOpacity(a(t)),l&&x.setDisplacement(l(t)),h&&x.setRotation(h(t)),u&&x.setRotateWithView(u(t)),o&&x.setScale(o(t)),s&&x.setAnchor(s(t)),x}}(t,e):"shape-points"in t?function(t,e){const i="shape-",n=i+"points",r=i+"radius",s=Bs(t[n],n),o=Bs(t[r],r),a=Ms(t,i,e),l=ks(t,i,e),h=Ps(t,i+"scale",e),u=Ts(t,i+"displacement",e),c=Ss(t,i+"rotation",e),d=Cs(t,i+"rotate-with-view",e),f=Ds(t,i+"radius2"),g=Ds(t,i+"angle"),p=Os(t,i+"declutter-mode"),m=new Er({points:s,radius:o,radius2:f,angle:g,declutterMode:p});return function(t){return a&&m.setFill(a(t)),l&&m.setStroke(l(t)),u&&m.setDisplacement(u(t)),c&&m.setRotation(c(t)),d&&m.setRotateWithView(d(t)),h&&m.setScale(h(t)),m}}(t,e):"circle-radius"in t?function(t,e){const i="circle-",n=Ms(t,i,e),r=ks(t,i,e),s=Ss(t,i+"radius",e),o=Ps(t,i+"scale",e),a=Ts(t,i+"displacement",e),l=Ss(t,i+"rotation",e),h=Cs(t,i+"rotate-with-view",e),u=Os(t,i+"declutter-mode"),c=new Ir({radius:5,declutterMode:u});return function(t){return s&&c.setRadius(s(t)),n&&c.setFill(n(t)),r&&c.setStroke(r(t)),a&&c.setDisplacement(a(t)),l&&c.setRotation(l(t)),h&&c.setRotateWithView(h(t)),o&&c.setScale(o(t)),c}}(t,e):null}(t,e),o=Ss(t,"z-index",e);if(!(i||n||r||s||_(t)))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(t));const a=new zr;return function(t){let e=!0;if(i){const n=i(t);n&&(e=!1),a.setFill(n)}if(n){const i=n(t);i&&(e=!1),a.setStroke(i)}if(r){const i=r(t);i&&(e=!1),a.setText(i)}if(s){const i=s(t);i&&(e=!1),a.setImage(i)}return o&&a.setZIndex(o(t)),e?null:a}}function Ms(t,e,i){let n;if(n=e+"fill-pattern-src"in t?function(t,e,i){const n=Es(t,e+"pattern-src",i),r=Rs(t,e+"pattern-offset",i),s=Rs(t,e+"pattern-size",i),o=Is(t,e+"color",i);return function(t){return{src:n(t),offset:r&&r(t),size:s&&s(t),color:o&&o(t)}}}(t,e+"fill-",i):Is(t,e+"fill-color",i),!n)return null;const r=new Tr;return function(t){const e=n(t);return"none"===e?null:(r.setColor(e),r)}}function ks(t,e,i){const n=Ss(t,e+"stroke-width",i),r=Is(t,e+"stroke-color",i);if(!n&&!r)return null;const s=Es(t,e+"stroke-line-cap",i),o=Es(t,e+"stroke-line-join",i),a=As(t,e+"stroke-line-dash",i),l=Ss(t,e+"stroke-line-dash-offset",i),h=Ss(t,e+"stroke-miter-limit",i),u=new Pr;return function(t){if(r){const e=r(t);if("none"===e)return null;u.setColor(e)}if(n&&u.setWidth(n(t)),s){const e=s(t);if("butt"!==e&&"round"!==e&&"square"!==e)throw new Error("Expected butt, round, or square line cap");u.setLineCap(e)}if(o){const e=o(t);if("bevel"!==e&&"round"!==e&&"miter"!==e)throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(e)}return a&&u.setLineDash(a(t)),l&&u.setLineDashOffset(l(t)),h&&u.setMiterLimit(h(t)),u}}function Ss(t,e,i){if(!(e in t))return;const n=ps(t[e],qr,i);return function(t){return Bs(n(t),e)}}function Es(t,e,i){if(!(e in t))return null;const n=ps(t[e],Wr,i);return function(t){return Ns(n(t),e)}}function Cs(t,e,i){if(!(e in t))return null;const n=ps(t[e],jr,i);return function(t){const i=n(t);if("boolean"!=typeof i)throw new Error(`Expected a boolean for ${e}`);return i}}function Is(t,e,i){if(!(e in t))return null;const n=ps(t[e],$r|Wr,i);return function(t){return Us(n(t),e)}}function As(t,e,i){if(!(e in t))return null;const n=ps(t[e],Zr,i);return function(t){return zs(n(t),e)}}function Ts(t,e,i){if(!(e in t))return null;const n=ps(t[e],Zr,i);return function(t){const i=zs(n(t),e);if(2!==i.length)throw new Error(`Expected two numbers for ${e}`);return i}}function Rs(t,e,i){if(!(e in t))return null;const n=ps(t[e],Zr,i);return function(t){return Gs(n(t),e)}}function Ps(t,e,i){if(!(e in t))return null;const n=ps(t[e],Zr|qr,i);return function(t){return i=n(t),r=e,"number"==typeof i?i:Gs(i,r);var i,r}}function Ds(t,e){const i=t[e];if(void 0!==i){if("number"!=typeof i)throw new Error(`Expected a number for ${e}`);return i}}function Fs(t,e){const i=t[e];if(void 0!==i){if("bottom-left"!==i&&"bottom-right"!==i&&"top-left"!==i&&"top-right"!==i)throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return i}}function Ls(t,e){const i=t[e];if(void 0!==i){if("pixels"!==i&&"fraction"!==i)throw new Error(`Expected pixels or fraction for ${e}`);return i}}function Os(t,e){const i=t[e];if(void 0!==i){if("string"!=typeof i)throw new Error(`Expected a string for ${e}`);if("declutter"!==i&&"obstacle"!==i&&"none"!==i)throw new Error(`Expected declutter, obstacle, or none for ${e}`);return i}}function zs(t,e){if(!Array.isArray(t))throw new Error(`Expected an array for ${e}`);const i=t.length;for(let n=0;n<i;++n)if("number"!=typeof t[n])throw new Error(`Expected an array of numbers for ${e}`);return t}function Ns(t,e){if("string"!=typeof t)throw new Error(`Expected a string for ${e}`);return t}function Bs(t,e){if("number"!=typeof t)throw new Error(`Expected a number for ${e}`);return t}function Us(t,e){if("string"==typeof t)return t;const i=zs(t,e),n=i.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return i}function Gs(t,e){const i=zs(t,e);if(2!==i.length)throw new Error(`Expected an array of two numbers for ${e}`);return i}const Xs="renderOrder",Ys=class extends rn{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Xs)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter==0&&(t.declutter[i]=new sn(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(Xs,t)}setStyle(t){this.style_=function(t){if(void 0===t)return Lr;if(!t)return null;if("function"==typeof t)return t;if(t instanceof zr)return t;if(!Array.isArray(t))return bs([t]);if(0===t.length)return[];const e=t.length,i=t[0];if(i instanceof zr){const i=new Array(e);for(let n=0;n<e;++n){const e=t[n];if(!(e instanceof zr))throw new Error("Expected a list of style instances");i[n]=e}return i}if("style"in i){const i=new Array(e);for(let n=0;n<e;++n){const e=t[n];if(!("style"in e))throw new Error("Expected a list of rules with a style property");i[n]=e}return vs(i)}return bs(t)}(t),this.styleFunction_=null===t?void 0:function(t){let e;if("function"==typeof t)e=t;else{let i;Array.isArray(t)?i=t:(H("function"==typeof t.getZIndex,"Expected an `Style` or an array of `Style`"),i=[t]),e=function(){return i}}return e}(this.style_),this.changed()}};function Vs(t,e){Zn.expire()}const js=class extends o{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){R()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;ei(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),ii(n,i)}forEachFeatureAtCoordinate(t,e,i,n,r,s,o,a){let l;const h=e.viewState;function u(t,e,i,n){return r.call(s,e,t?i:null,n)}const c=h.projection,d=ge(t.slice(),c),f=[[0,0]];if(c.canWrapX()&&n){const t=ae(c.getExtent());f.push([-t,0],[t,0])}const g=e.layerStatesArray,p=g.length,m=[],_=[];for(let n=0;n<f.length;n++)for(let r=p-1;r>=0;--r){const s=g[r],c=s.layer;if(c.hasRenderer()&&nn(s,h)&&o.call(a,c)){const r=c.getRenderer(),o=c.getSource();if(r&&o){const a=o.getWrapX()?d:t,h=u.bind(null,s.managed);_[0]=a[0]+f[n][0],_[1]=a[1]+f[n][1],l=r.forEachFeatureAtCoordinate(_,e,i,h,m)}if(l)return l}}if(0===m.length)return;const w=1/m.length;return m.forEach(((t,e)=>t.distanceSq+=e*w)),m.sort(((t,e)=>t.distanceSq-e.distanceSq)),m.some((t=>l=t.callback(t.feature,t.layer,t.geometry))),l}hasFeatureAtCoordinate(t,e,i,n,r,s){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,n,d,this,r,s)}getMap(){return this.map_}renderFrame(t){R()}scheduleExpireIconCache(t){Zn.canExpireCache()&&t.postRenderFunctions.push(Vs)}},qs=class extends r{constructor(t,e,i,n){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n}},Ws=class extends js{constructor(t){super(t),this.fontChangeListenerKey_=E(mr,s,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=er+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const n=new qs(t,void 0,e);i.dispatchEvent(n)}}disposeInternal(){I(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent(ut,t);const e=t.layerStatesArray.sort((function(t,e){return t.zIndex-e.zIndex}));e.some((t=>t.layer instanceof Ys&&t.layer.getDeclutter()))&&(t.declutter={});const i=t.viewState;this.children_.length=0;const n=[];let r=null;for(let s=0,o=e.length;s<o;++s){const o=e[s];t.layerIndex=s;const a=o.layer,l=a.getSourceState();if(!nn(o,i)||"ready"!=l&&"undefined"!=l){a.unrender();continue}const h=a.render(t,r);h&&(h!==r&&(this.children_.push(h),r=h),n.push(o))}this.declutter(t,n),function(t,e){const i=t.childNodes;for(let n=0;;++n){const r=i[n],s=e[n];if(!r&&!s)break;r!==s&&(r?s?t.insertBefore(s,r):(t.removeChild(r),--n):t.appendChild(s))}}(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){for(let i=e.length-1;i>=0;--i){const n=e[i],r=n.layer;r.getDeclutter()&&r.renderDeclutter(t,n)}e.forEach((e=>e.layer.renderDeferred(t)))}};class $s extends r{constructor(t,e){super(t),this.layer=e}}const Zs="layers";class Hs extends at{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Zs,this.handleLayersChanged_),i?Array.isArray(i)?i=new U(i.slice(),{unique:!0}):H("function"==typeof i.getArray,"Expected `layers` to be an array or a `Collection`"):i=new U(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(I),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(E(t,O,this.handleLayersAdd_,this),E(t,z,this.handleLayersRemove_,this));for(const t in this.listenerKeys_)this.listenerKeys_[t].forEach(I);m(this.listenerKeys_);const e=t.getArray();for(let t=0,i=e.length;t<i;t++){const i=e[t];this.registerLayerListeners_(i),this.dispatchEvent(new $s("addlayer",i))}this.changed()}registerLayerListeners_(t){const e=[E(t,s,this.handleLayerChange_,this),E(t,y,this.handleLayerChange_,this)];t instanceof Hs&&e.push(E(t,"addlayer",this.handleLayerGroupAdd_,this),E(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[D(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new $s("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new $s("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new $s("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=D(e);this.listenerKeys_[i].forEach(I),delete this.listenerKeys_[i],this.dispatchEvent(new $s("removelayer",e)),this.changed()}getLayers(){return this.get(Zs)}setLayers(t){const e=this.getLayers();if(e){const t=e.getArray();for(let e=0,i=t.length;e<i;++e)this.dispatchEvent(new $s("removelayer",t[e]))}this.set(Zs,t)}getLayersArray(t){return t=void 0!==t?t:[],this.getLayers().forEach((function(e){e.getLayersArray(t)})),t}getLayerStatesArray(t){const e=void 0!==t?t:[],i=e.length;this.getLayers().forEach((function(t){t.getLayerStatesArray(e)}));const n=this.getLayerState();let r=n.zIndex;t||void 0!==n.zIndex||(r=0);for(let t=i,s=e.length;t<s;t++){const i=e[t];i.opacity*=n.opacity,i.visible=i.visible&&n.visible,i.maxResolution=Math.min(i.maxResolution,n.maxResolution),i.minResolution=Math.max(i.minResolution,n.minResolution),i.minZoom=Math.max(i.minZoom,n.minZoom),i.maxZoom=Math.min(i.maxZoom,n.maxZoom),void 0!==n.extent&&(void 0!==i.extent?i.extent=re(i.extent,n.extent):i.extent=n.extent),void 0===i.zIndex&&(i.zIndex=r)}return e}getSourceState(){return"ready"}}const Ks=Hs,Js=class extends r{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}},Qs=class extends Js{constructor(t,e,i,n,r,s){super(t,e,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==n&&n,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},to={SINGLECLICK:"singleclick",CLICK:b,DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},eo="pointerdown",io=class extends w{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=E(i,eo,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=E(i,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(k,this.boundHandleTouchMove_,!!Gn&&{passive:!1})}emulateClick_(t){let e=new Qs(to.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Qs(to.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((()=>{this.clickTimeoutId_=void 0;const e=new Qs(to.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}),250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==to.POINTERUP||e.type==to.POINTERCANCEL){delete this.trackedTouches_[i];for(const t in this.trackedTouches_)if(this.trackedTouches_[t].target!==e.target){delete this.trackedTouches_[t];break}}else e.type!=to.POINTERDOWN&&e.type!=to.POINTERMOVE||(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Qs(to.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(I),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new Qs(to.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),0===this.dragListenerKeys_.length){const t=this.map_.getOwnerDocument();this.dragListenerKeys_.push(E(t,to.POINTERMOVE,this.handlePointerMove_,this),E(t,to.POINTERUP,this.handlePointerUp_,this),E(this.element_,to.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==t&&this.dragListenerKeys_.push(E(this.element_.getRootNode(),to.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Qs(to.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new Qs(to.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;e&&!e.defaultPrevented||"boolean"==typeof t.cancelable&&!0!==t.cancelable||t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(I(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(k,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(I(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(I),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},no="postrender",ro="loadstart",so="loadend",oo="layergroup",ao="size",lo="target",ho="view",uo=1/0,co=class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,m(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(t){H(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=uo&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,r=e[t],s=i[t],o=t;for(;t<n>>1;){const r=this.getLeftChildIndex_(t),s=this.getRightChildIndex_(t),o=s<n&&i[s]<i[r]?s:r;e[t]=e[o],i[t]=i[o],t=o}e[t]=r,i[t]=s,this.siftDown_(o,t)}siftDown_(t,e){const i=this.elements_,n=this.priorities_,r=i[e],s=n[e];for(;e>t;){const t=this.getParentIndex_(e);if(!(n[t]>s))break;i[e]=i[t],n[e]=n[t],e=t}i[e]=r,n[e]=s}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;const r=e.length;let s,o,a;for(o=0;o<r;++o)s=e[o],a=t(s),a==uo?delete this.queuedElements_[this.keyFunction_(s)]:(i[n]=a,e[n++]=s);e.length=n,i.length=n,this.heapify_()}},fo=0,go=1,po=2,mo=3,_o=4,wo=class extends co{constructor(t,e){super((function(e){return t.apply(null,e)}),(function(t){return t[0].getKey()})),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(y,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===po||i===mo||i===_o){i!==mo&&e.removeEventListener(y,this.boundHandleTileChange_);const t=e.getKey();t in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[t],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i,n,r,s=0;for(;this.tilesLoading_<t&&s<e&&this.getCount()>0;)n=this.dequeue()[0],r=n.getKey(),i=n.getState(),i!==fo||r in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++s,n.load())}},yo=class extends L{constructor(t){super();const e=t.element;!e||t.target||e.style.pointerEvents||(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Wn(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Wn(this.element);for(let t=0,e=this.listenerKeys.length;t<e;++t)I(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==g&&this.listenerKeys.push(E(t,no,this.render,this)),t.render())}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},vo=class extends yo{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=void 0!==t.className?t.className:"ol-attribution",i=void 0!==t.tipLabel?t.tipLabel:"Attributions",n=void 0!==t.expandClassName?t.expandClassName:e+"-expand",r=void 0!==t.collapseLabel?t.collapseLabel:"",s=void 0!==t.collapseClassName?t.collapseClassName:e+"-collapse";"string"==typeof r?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=s):this.collapseLabel_=r;const o=void 0!==t.label?t.label:"i";"string"==typeof o?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=n):this.label_=o;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(a),this.toggleButton_.addEventListener(b,this.handleClick_.bind(this),!1);const l=e+" "+er+" "+ir+(this.collapsed_&&this.collapsible_?" "+nr:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=l,h.appendChild(this.toggleButton_),h.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap((e=>e.getAttributions(t))))),i=!this.getMap().getAllLayers().some((t=>t.getSource()&&!1===t.getSource().getAttributionsCollapsible()));return this.overrideCollapsible_||this.setCollapsible(i),e}async updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=await Promise.all(this.collectSourceAttributions_(t).map((t=>{return e=()=>t,function(){let t;try{t=e()}catch(t){return Promise.reject(t)}return t instanceof Promise?t:Promise.resolve(t)}();var e}))),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!c(e,this.renderedAttributions_)){!function(t){for(;t.lastChild;)t.removeChild(t.lastChild)}(this.ulElement_);for(let t=0,i=e.length;t<i;++t){const i=document.createElement("li");i.innerHTML=e[t],this.ulElement_.appendChild(i)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(nr),this.collapsed_?qn(this.collapseLabel_,this.label_):qn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},bo=class extends yo{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=void 0!==t.className?t.className:"ol-rotate",i=void 0!==t.label?t.label:"",n=void 0!==t.compassClassName?t.compassClassName:"ol-compass";this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=t.tipLabel?t.tipLabel:"Reset rotation",s=document.createElement("button");s.className=e+"-reset",s.setAttribute("type","button"),s.title=r,s.appendChild(this.label_),s.addEventListener(b,this.handleClick_.bind(this),!1);const o=e+" "+er+" "+ir,a=this.element;a.className=o,a.appendChild(s),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(tr)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:Ke}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const t="rotate("+i+"rad)";if(this.autoHide_){const t=this.element.classList.contains(tr);t||0!==i?t&&0!==i&&this.element.classList.remove(tr):this.element.classList.add(tr)}this.label_.style.transform=t}this.rotation_=i}},xo=class extends yo{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=void 0!==t.className?t.className:"ol-zoom",i=void 0!==t.delta?t.delta:1,n=void 0!==t.zoomInClassName?t.zoomInClassName:e+"-in",r=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+"-out",s=void 0!==t.zoomInLabel?t.zoomInLabel:"+",o=void 0!==t.zoomOutLabel?t.zoomOutLabel:"",a=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",l=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=n,h.setAttribute("type","button"),h.title=a,h.appendChild("string"==typeof s?document.createTextNode(s):s),h.addEventListener(b,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=l,u.appendChild("string"==typeof o?document.createTextNode(o):o),u.addEventListener(b,this.handleClick_.bind(this,-i),!1);const c=e+" "+er+" "+ir,d=this.element;d.className=c,d.appendChild(h),d.appendChild(u),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const i=e.getZoom();if(void 0!==i){const n=e.getConstrainedZoom(i+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:n,duration:this.duration_,easing:Ke})):e.setZoom(n)}}},Mo="active";function ko(t,e,i,n){const r=t.getZoom();if(void 0===r)return;const s=t.getConstrainedZoom(r+e),o=t.getResolutionForZoom(s);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:o,anchor:i,duration:void 0!==n?n:250,easing:Ke})}const So=class extends L{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Mo)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Mo,t)}setMap(t){this.map_=t}},Eo=class extends So{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;if(t.type==to.DBLCLICK){const i=t.originalEvent,n=t.map,r=t.coordinate,s=i.shiftKey?-this.delta_:this.delta_;ko(n.getView(),s,r,this.duration_),i.preventDefault(),e=!0}return!e}};function Co(t){const e=t.length;let i=0,n=0;for(let r=0;r<e;r++)i+=t[r].clientX,n+=t[r].clientY;return{clientX:i/e,clientY:n/e}}const Io=class extends So{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==to.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==to.POINTERUP){const e=this.handleUpEvent(t);this.handlingDownUpSequence=e&&this.targetPointers.length>0}}else if(t.type==to.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==to.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function Ao(t){const e=arguments;return function(t){let i=!0;for(let n=0,r=e.length;n<r&&(i=i&&e[n](t),i);++n);return i}}const To=function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Ro=function(t){return!t.map.getTargetElement().hasAttribute("tabindex")||function(t){const e=t.map.getTargetElement(),i=t.map.getOwnerDocument().activeElement;return e.contains(i)}(t)},Po=d,Do=function(t){const e=t.originalEvent;return 0==e.button&&!(On&&zn&&e.ctrlKey)},Fo=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Lo=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Oo=function(t){const e=t.originalEvent,i=e.target.tagName;return"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i&&!e.target.isContentEditable},zo=function(t){const e=t.originalEvent;return H(void 0!==e,"mapBrowserEvent must originate from a pointer event"),"mouse"==e.pointerType},No=function(t){const e=t.originalEvent;return H(void 0!==e,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&0===e.button},Bo=class extends Io{constructor(t){super({stopDown:f}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Ao(Fo,No);this.condition_=t.onFocusOnly?Ao(Ro,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,n=e.getEventPixel(Co(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const e=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],i=t.map.getView();r=e,s=i.getResolution(),r[0]*=s,r[1]*=s,fe(e,i.getRotation()),i.adjustCenterInternal(e)}}else this.kinetic_&&this.kinetic_.begin();var r,s;this.lastCentroid=n,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const t=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),r=i.getCenterInternal(),s=e.getPixelFromCoordinateInternal(r),o=e.getCoordinateFromPixelInternal([s[0]-t*Math.cos(n),s[1]-t*Math.sin(n)]);i.animateInternal({center:i.getConstrainedCenter(o),duration:500,easing:Ke})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Uo=class extends Io{constructor(t){t=t||{},super({stopDown:f}),this.condition_=t.condition?t.condition:To,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(!zo(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===$e)return;const n=e.getSize(),r=t.pixel,s=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(void 0!==this.lastAngle_){const t=s-this.lastAngle_;i.adjustRotationInternal(-t)}this.lastAngle_=s}handleUpEvent(t){return!zo(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!!zo(t)&&(!(!Do(t)||!this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))}},Go=class extends o{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+i,n.top=Math.min(t[1],e[1])+i,n.width=Math.abs(e[0]-t[0])+i,n.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new Hi([i])}getGeometry(){return this.geometry_}};class Xo extends r{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}const Yo=class extends Io{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Go(t.className||"ol-dragbox"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Do,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const n=i[0]-e[0],r=i[1]-e[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Xo("boxdrag",t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Xo(e?"boxend":"boxcancel",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Xo("boxstart",t.coordinate,t)),!0)}onBoxEnd(t){}},Vo=class extends Yo{constructor(t){super({condition:(t=t||{}).condition?t.condition:Lo,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){const e=this.getMap().getView();let i=this.getGeometry();if(this.out_){const t=e.rotatedExtentForGeometry(i),n=e.getResolutionForExtentInternal(t),r=e.getResolution()/n;i=i.clone(),i.scale(r*r)}e.fitInternal(i,{duration:this.duration_,easing:Ke})}},jo="ArrowLeft",qo="ArrowRight",Wo="ArrowDown",$o=class extends So{constructor(t){super(),t=t||{},this.defaultCondition_=function(t){return Fo(t)&&Oo(t)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==x){const i=t.originalEvent,n=i.key;if(this.condition_(t)&&(n==Wo||n==jo||n==qo||"ArrowUp"==n)){const r=t.map.getView(),s=r.getResolution()*this.pixelDelta_;let o=0,a=0;n==Wo?a=-s:n==jo?o=-s:n==qo?o=s:a=s;const l=[o,a];fe(l,r.getRotation()),function(t,e,i){const n=t.getCenterInternal();if(n){const r=[n[0]+e[0],n[1]+e[1]];t.animateInternal({duration:void 0!==i?i:250,easing:Qe,center:t.getConstrainedCenter(r)})}}(r,l,this.duration_),i.preventDefault(),e=!0}}return!e}},Zo=class extends So{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(t){return!function(t){const e=t.originalEvent;return zn?e.metaKey:e.ctrlKey}(t)&&Oo(t)},this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;if(t.type==x||t.type==M){const i=t.originalEvent,n=i.key;if(this.condition_(t)&&("+"===n||"-"===n)){const r=t.map,s="+"===n?this.delta_:-this.delta_;ko(r.getView(),s,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}},Ho=class{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[e]-this.points_[i],s=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(s,r),this.initialVelocity_=Math.sqrt(r*r+s*s)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},Ko=class extends So{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;const e=t.condition?t.condition:Po;this.condition_=t.onFocusOnly?Ao(Ro,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t))return!0;if(t.type!==S)return!0;const e=t.map,i=t.originalEvent;let n;if(i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==S&&(n=i.deltaY,Ln&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(n/=Nn),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(n*=40)),0===n)return!1;this.lastDelta_=n;const r=Date.now();void 0===this.startTime_&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(n)<4?"trackpad":"wheel");const s=e.getView();if("trackpad"===this.mode_&&!s.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(s.getAnimating()&&s.cancelAnimations(),s.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),s.adjustZoom(-n/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1;this.totalDelta_+=n;const o=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),o),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-K(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),ko(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},Jo=class extends Io{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=f),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(void 0!==this.lastAngle_){const t=r-this.lastAngle_;this.rotationDelta_+=t,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=t}this.lastAngle_=r;const s=t.map,o=s.getView();o.getConstraints().rotation!==$e&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(Co(this.targetPointers))),this.rotating_&&(s.render(),o.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},Qo=class extends Io{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=f),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,s=i.clientY-n.clientY,o=Math.sqrt(r*r+s*s);void 0!==this.lastDistance_&&(e=this.lastDistance_/o),this.lastDistance_=o;const a=t.map,l=a.getView();1!=e&&(this.lastScaleDelta_=e),this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(Co(this.targetPointers))),a.render(),l.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const e=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};function ta(t){t instanceof rn?t.setMapInternal(null):t instanceof Ks&&t.getLayers().forEach(ta)}function ea(t,e){if(t instanceof rn)t.setMapInternal(e);else if(t instanceof Ks){const i=t.getLayers().getArray();for(let t=0,n=i.length;t<n;++t)ea(i[t],e)}}const ia=class extends L{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=function(t){let e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);const i={},n=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new Ks({layers:t.layers});let r,s,o;return i[oo]=n,i[lo]=t.target,i[ho]=t.view instanceof en?t.view:new en,void 0!==t.controls&&(Array.isArray(t.controls)?r=new U(t.controls.slice()):(H("function"==typeof t.controls.getArray,"Expected `controls` to be an array or an `ol/Collection.js`"),r=t.controls)),void 0!==t.interactions&&(Array.isArray(t.interactions)?s=new U(t.interactions.slice()):(H("function"==typeof t.interactions.getArray,"Expected `interactions` to be an array or an `ol/Collection.js`"),s=t.interactions)),void 0!==t.overlays?Array.isArray(t.overlays)?o=new U(t.overlays.slice()):(H("function"==typeof t.overlays.getArray,"Expected `overlays` to be an array or an `ol/Collection.js`"),o=t.overlays):o=new U,{controls:r,interactions:s,keyboardEventTarget:e,overlays:o,values:i}}(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Nn,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver((()=>this.updateSize())),this.controls=e.controls||function(t){t=t||{};const e=new U;return(void 0===t.zoom||t.zoom)&&e.push(new xo(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&e.push(new bo(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&e.push(new vo(t.attributionOptions)),e}(),this.interactions=e.interactions||function(t){t=t||{};const e=new U,i=new Ho(-.005,.05,100);return(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&e.push(new Uo),(void 0===t.doubleClickZoom||t.doubleClickZoom)&&e.push(new Eo({delta:t.zoomDelta,duration:t.zoomDuration})),(void 0===t.dragPan||t.dragPan)&&e.push(new Bo({onFocusOnly:t.onFocusOnly,kinetic:i})),(void 0===t.pinchRotate||t.pinchRotate)&&e.push(new Jo),(void 0===t.pinchZoom||t.pinchZoom)&&e.push(new Qo({duration:t.zoomDuration})),(void 0===t.keyboard||t.keyboard)&&(e.push(new $o),e.push(new Zo({delta:t.zoomDelta,duration:t.zoomDuration}))),(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&e.push(new Ko({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),(void 0===t.shiftDragZoom||t.shiftDragZoom)&&e.push(new Vo({duration:t.zoomDuration})),e}({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new wo(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(oo,this.handleLayerGroupChanged_),this.addChangeListener(ho,this.handleViewChanged_),this.addChangeListener(ao,this.handleSizeChanged_),this.addChangeListener(lo,this.handleTargetChanged_),this.setProperties(e.values);const i=this;!t.view||t.view instanceof en||t.view.then((function(t){i.setView(new en(t))})),this.controls.addEventListener(O,(t=>{t.element.setMap(this)})),this.controls.addEventListener(z,(t=>{t.element.setMap(null)})),this.interactions.addEventListener(O,(t=>{t.element.setMap(this)})),this.interactions.addEventListener(z,(t=>{t.element.setMap(null)})),this.overlays_.addEventListener(O,(t=>{this.addOverlayInternal_(t.element)})),this.overlays_.addEventListener(z,(t=>{const e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)})),this.controls.forEach((t=>{t.setMap(this)})),this.interactions.forEach((t=>{t.setMap(this)})),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){ea(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(t),r=void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,s=void 0!==i.layerFilter?i.layerFilter:d,o=!1!==i.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,o,e,null,s,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,(function(t){i.push(t)}),e),i}getAllLayers(){const t=[];return function e(i){i.forEach((function(i){i instanceof Ks?e(i.getLayers()):t.push(i)}))}(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t),n=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:d,r=void 0!==e.hitTolerance?e.hitTolerance:0,s=!1!==e.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,s,n,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i=this.getSize(),n=e.width/i[0],r=e.height/i[1],s="changedTouches"in t?t.changedTouches[0]:t;return[(s.clientX-e.left)/n,(s.clientY-e.top)/r]}getTarget(){return this.get(lo)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Le(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?ti(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(oo)}setLayers(t){const e=this.getLayerGroup();if(t instanceof U)return void e.setLayers(t);const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const i=t[e];if(!i.visible)continue;const n=i.layer.getRenderer();if(n&&!n.ready)return!0;const r=i.layer.getSource();if(r&&r.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Oe(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?ti(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ao)}getView(){return this.get(ho)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,n){return function(t,e,i,n,r){if(!t||!(i in t.wantedTiles))return uo;if(!t.wantedTiles[i][e.getKey()])return uo;const s=t.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}(this.frameState_,t,e,i,n)}handleBrowserEvent(t,e){e=e||t.type;const i=new Qs(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===eo||i===S||i===x){const t=this.getOwnerDocument(),i=this.viewport_.getRootNode?this.viewport_.getRootNode():t,n=e.target;if(this.overlayContainerStopEvent_.contains(n)||!(i===t?t.documentElement:i).contains(n))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t)){const e=this.getInteractions().getArray().slice();for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.getMap()===this&&n.getActive()&&this.getTargetElement()&&(!n.handleEvent(t)||t.propagationStopped))break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let i=this.maxTilesLoading_,n=i;if(t){const e=t.viewHints;if(e[0]||e[1]){const e=Date.now()-t.time>8;i=e?0:8,n=e?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,n))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener(ct)&&this.renderer_.dispatchRenderEvent(ct,t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new Js(so,this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new Js(ro,this,t))));const i=this.postRenderFunctions_;for(let e=0,n=i.length;e<n;++e)i[e](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)I(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(v,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(S,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Wn(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const t=this.targetElement_.getRootNode();t instanceof ShadowRoot&&this.resizeObserver_.unobserve(t.host),this.setSize(void 0)}const t=this.getTarget(),e="string"==typeof t?document.getElementById(t):t;if(this.targetElement_=e,e){e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Ws(this)),this.mapBrowserEventHandler_=new io(this,this.moveTolerance_);for(const t in to)this.mapBrowserEventHandler_.addEventListener(to[t],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(v,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(S,this.boundHandleBrowserEvent_,!!Gn&&{passive:!1});const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[E(t,x,this.handleBrowserEvent,this),E(t,M,this.handleBrowserEvent,this)];const i=e.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_.observe(e)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(I(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(I(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=E(t,s,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=E(t,y,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(I),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new $s("addlayer",t)),this.layerGroupPropertyListenerKeys_=[E(t,s,this.render,this),E(t,y,this.render,this),E(t,"addlayer",this.handleLayerAdd_,this),E(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const i=t[e].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){ta(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(void 0!==e&&un(e)&&i&&i.isDef()){const n=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),s=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:ee(s.center,s.resolution,s.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:s,viewHints:n,wantedTiles:{},mapId:D(this),renderTargets:{}},s.nextCenter&&s.nextResolution){const t=isNaN(s.nextRotation)?s.rotation:s.nextRotation;r.nextExtent=ee(s.nextCenter,s.nextResolution,t,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!he(this.previousExtent_)&&!Vt(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Js("movestart",this,n)),this.previousExtent_=Gt(this.previousExtent_)),this.previousExtent_&&!r.viewHints[0]&&!r.viewHints[1]&&!Vt(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Js("moveend",this,r)),Ft(r.extent,this.previousExtent_))),this.dispatchEvent(new Js(no,this,r)),this.renderComplete_=this.hasListener(ro)||this.hasListener(so)||this.hasListener(ct)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()}),0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new $s("removelayer",e)),this.set(oo,t)}setSize(t){this.set(ao,t)}setTarget(t){this.set(lo,t)}setView(t){if(!t||t instanceof en)return void this.set(ho,t);this.set(ho,new en);const e=this;t.then((function(t){e.setView(new en(t))}))}updateSize(){const t=this.getTargetElement();let e;if(t){const i=getComputedStyle(t),n=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),r=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);isNaN(n)||isNaN(r)||(e=[n,r],!un(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&ye("No map visible because the map container's width or height are 0."))}const i=this.getSize();!e||i&&c(e,i)||(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}},na="preload",ra="useInterimTilesOnError",sa=class extends rn{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get(na)}setPreload(t){this.set(na,t)}getUseInterimTilesOnError(){return this.get(ra)}setUseInterimTilesOnError(t){this.set(ra,t)}getData(t){return super.getData(t)}},oa=class extends T{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return R()}getData(t){return null}prepareFrame(t){return R()}renderFrame(t,e){return R()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(n,r)=>{const s=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,r,s)}}forEachFeatureAtCoordinate(t,e,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;e.getState()!==ln&&e.getState()!==hn||this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=ln&&e!=hn&&t.addEventListener(y,this.boundHandleImageChange_),e==on&&(t.load(),e=t.getState()),e==ln}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}},aa=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if("function"==typeof Vn()[e])return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,i),!0)})}pushMethodArgs_=(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this);getContext(){return this.context_}draw(t){this.instructions_.forEach((e=>{for(let i=0,n=e.length;i<n;i+=2){const n=e[i],r=e[i+1];if("function"==typeof t[n])t[n](...r);else{if("function"==typeof r){t[n]=r(t);continue}t[n]=r}}}))}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},la=[];let ha=null;const ua=class extends oa{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let n;ha||(ha=Xn(1,1,void 0,{willReadFrequently:!0})),ha.clearRect(0,0,1,1);try{ha.drawImage(t,e,i,1,1,0,0,1,1),n=ha.getImageData(0,0,1,1).data}catch(t){return ha=null,null}return n}getBackground(t){let e=this.getLayer().getBackground();return"function"==typeof e&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,i){const n=this.getLayer().getClassName();let r,s;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&c(Rn(t.style.backgroundColor),Rn(i)))){const e=t.firstElementChild;e instanceof HTMLCanvasElement&&(s=e.getContext("2d"))}if(s&&s.canvas.style.transform===e?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=n;let t=r.style;t.position="absolute",t.width="100%",t.height="100%",s=Xn();const e=s.canvas;r.appendChild(e),t=e.style,t.position="absolute",t.left="0",t.transformOrigin="top left",this.container=r,this.context=s}this.containerReused||!i||this.container.style.backgroundColor||(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const n=se(i),r=oe(i),s=Jt(i),o=Kt(i);ti(e.coordinateToPixelTransform,n),ti(e.coordinateToPixelTransform,r),ti(e.coordinateToPixelTransform,s),ti(e.coordinateToPixelTransform,o);const a=this.inversePixelTransform;ti(a,n),ti(a,r),ti(a,s),ti(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){const r=new qs(t,this.inversePixelTransform,i,e);n.dispatchEvent(r)}}preRender(t,e){this.frameState=e,e.declutter||this.dispatchRenderEvent_(lt,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(ht,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new aa),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(lt,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(ht,this.context,t))}getRenderTransform(t,e,i,n,r,s,o){const a=r/2,l=s/2,h=n/e,u=-h,c=-t[0]+o,d=-t[1];return ei(this.tempTransform,a,l,h,u,-i,c,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}},ca=class extends w{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(y)}release(){this.state===mo&&this.setState(_o)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==po)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==po){t.interimTile=null;break}t.getState()==go?e=t:t.getState()==fo?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==mo&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){R()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const n=e-i+1e3/60;return n>=this.transition_?1:He(n/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}},da=class extends ca{constructor(t,e,i,n,r,s){super(t,e,s),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,null!==n&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=po,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=mo,this.unlistenImage_(),this.image_=function(){const t=Xn(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=po:this.state=_o,this.unlistenImage_(),this.changed()}load(){this.state==mo&&(this.state=fo,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==fo&&(this.state=go,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=function(t,e,i){const n=t;let r=!0,s=!1,o=!1;const a=[C(n,"load",(function(){o=!0,s||e()}))];return n.src&&Un?(s=!0,n.decode().then((function(){r&&e()})).catch((function(t){r&&(o?e():i())}))):a.push(C(n,"error",i)),function(){r=!1,a.forEach(I)}}(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}},fa=class{constructor(t,e,i,n,r,s){this.sourceProj_=t,this.targetProj_=e;let o={};const a=Te(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return o[e]||(o[e]=a(t)),o[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&ae(n)>=ae(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ae(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ae(this.targetProj_.getExtent()):null;const l=se(i),h=oe(i),u=Jt(i),c=Kt(i),d=this.transformInv_(l),f=this.transformInv_(h),g=this.transformInv_(u),p=this.transformInv_(c),m=10+(s?Math.max(0,Math.ceil(Math.log2(Ht(i)/(s*s*256*256)))):0);if(this.addQuad_(l,h,u,c,d,f,g,p,m),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach((function(e,i,n){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])})),this.triangles_.forEach((e=>{if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const n=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-n<this.sourceWorldWidth_/2&&(e.source=i)}}))}o={}}addTriangle_(t,e,i,n,r,s){this.triangles_.push({source:[n,r,s],target:[t,e,i]})}addQuad_(t,e,i,n,r,s,o,a,l){const h=Pt([r,s,o,a]),u=this.sourceWorldWidth_?ae(h)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(l>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(f=ae(Pt([t,e,i,n]))/this.targetWorldWidth_>.25||f),!d&&this.sourceProj_.isGlobal()&&u&&(f=u>.25||f)),!f&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!le(h,this.maxSourceExtent_))return;let g=0;if(!(f||isFinite(r[0])&&isFinite(r[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])))if(l>0)f=!0;else if(g=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(s[0])&&isFinite(s[1])?0:4)+(isFinite(o[0])&&isFinite(o[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1),1!=g&&2!=g&&4!=g&&8!=g)return;if(l>0){if(!f){const e=[(t[0]+i[0])/2,(t[1]+i[1])/2],n=this.transformInv_(e);let s;s=d?(et(r[0],c)+et(o[0],c))/2-et(n[0],c):(r[0]+o[0])/2-n[0];const a=(r[1]+o[1])/2-n[1];f=s*s+a*a>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const h=[(e[0]+i[0])/2,(e[1]+i[1])/2],u=this.transformInv_(h),c=[(n[0]+t[0])/2,(n[1]+t[1])/2],d=this.transformInv_(c);this.addQuad_(t,e,h,c,r,s,u,d,l-1),this.addQuad_(c,h,i,n,d,u,o,a,l-1)}else{const h=[(t[0]+e[0])/2,(t[1]+e[1])/2],u=this.transformInv_(h),c=[(i[0]+n[0])/2,(i[1]+n[1])/2],d=this.transformInv_(c);this.addQuad_(t,h,c,n,r,u,d,a,l-1),this.addQuad_(h,e,i,c,u,s,o,d,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&g)&&this.addTriangle_(t,i,n,r,o,a),0==(14&g)&&this.addTriangle_(t,i,e,r,o,s),g&&(0==(13&g)&&this.addTriangle_(e,n,t,s,a,r),0==(7&g)&&this.addTriangle_(e,n,i,s,a,o))}calculateSourceExtent(){const t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,i,n){const r=e.source;qt(t,r[0]),qt(t,r[1]),qt(t,r[2])})),t}getTriangles(){return this.triangles_}};let ga;const pa=[];function ma(t,e,i,n,r){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(n,r),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,n)+1,Math.max(i,r)),t.restore()}function _a(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function wa(t,e,i,n){const r=Re(i,e,t);let s=Se(e,n,i);const o=e.getMetersPerUnit();void 0!==o&&(s*=o);const a=t.getMetersPerUnit();void 0!==a&&(s/=a);const l=t.getExtent();if(!l||Ot(l,r)){const e=Se(t,s,r)/s;isFinite(e)&&e>0&&(s/=e)}return s}const ya=class extends ca{constructor(t,e,i,n,r,s,o,a,l,h,u,c){super(r,fo,c),this.renderEdges_=void 0!==u&&u,this.pixelRatio_=o,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=s||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const d=n.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const p=f?re(d,f):d;if(0===Ht(p))return void(this.state=_o);const m=t.getExtent();m&&(g=g?re(g,m):m);const _=n.getResolution(this.wrappedTileCoord_[0]),w=function(t,e,i,n){const r=Qt(i);let s=wa(t,e,r,n);return(!isFinite(s)||s<=0)&&Zt(i,(function(i){return s=wa(t,e,i,n),isFinite(s)&&s>0})),s}(t,i,p,_);if(!isFinite(w)||w<=0)return void(this.state=_o);const y=void 0!==h?h:.5;if(this.triangulation_=new fa(t,i,p,g,w*y,_),0===this.triangulation_.getTriangles().length)return void(this.state=_o);this.sourceZ_=e.getZForResolution(w);let v=this.triangulation_.calculateSourceExtent();if(g&&(t.canWrapX()?(v[1]=K(v[1],g[1],g[3]),v[3]=K(v[3],g[1],g[3])):v=re(v,g)),Ht(v)){const t=e.getTileRangeForExtentAndZ(v,this.sourceZ_);for(let e=t.minX;e<=t.maxX;e++)for(let i=t.minY;i<=t.maxY;i++){const t=l(this.sourceZ_,e,i,o);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=_o)}else this.state=_o}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach((e=>{e&&e.getState()==po&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})})),this.sourceTiles_.length=0,0===t.length)this.state=mo;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n="number"==typeof i?i:i[0],r="number"==typeof i?i:i[1],s=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function(t,e,i,n,r,s,o,a,l,h,u,c,d,f){const g=Xn(Math.round(i*t),Math.round(i*e),pa);if(c||(g.imageSmoothingEnabled=!1),0===l.length)return g.canvas;function p(t){return Math.round(t*i)/i}g.scale(i,i),g.globalCompositeOperation="lighter";const m=[1/0,1/0,-1/0,-1/0];let _;l.forEach((function(t,e,i){jt(m,t.extent)}));const w=i/n,y=(c?1:1+Math.pow(2,-24))/w;if(!d||1!==l.length||0!==h){if(_=Xn(Math.round(ae(m)*w),Math.round(ne(m)*w),pa),c||(_.imageSmoothingEnabled=!1),r&&f){const t=(r[0]-m[0])*w,e=-(r[3]-m[3])*w,i=ae(r)*w,n=ne(r)*w;_.rect(t,e,i,n),_.clip()}l.forEach((function(t,e,i){const n=(t.extent[0]-m[0])*w,r=-(t.extent[3]-m[3])*w,s=ae(t.extent)*w,o=ne(t.extent)*w;t.image.width>0&&t.image.height>0&&_.drawImage(t.image,h,h,t.image.width-2*h,t.image.height-2*h,c?n:Math.round(n),c?r:Math.round(r),c?s:Math.round(n+s)-Math.round(n),c?o:Math.round(r+o)-Math.round(r))}))}const v=se(o);return a.getTriangles().forEach((function(t,e,i){const n=t.source,r=t.target;let o=n[0][0],a=n[0][1],h=n[1][0],u=n[1][1],d=n[2][0],f=n[2][1];const w=p((r[0][0]-v[0])/s),b=p(-(r[0][1]-v[1])/s),x=p((r[1][0]-v[0])/s),M=p(-(r[1][1]-v[1])/s),k=p((r[2][0]-v[0])/s),S=p(-(r[2][1]-v[1])/s),E=o,C=a;o=0,a=0,h-=E,u-=C,d-=E,f-=C;const I=function(t){const e=t.length;for(let i=0;i<e;i++){let n=i,r=Math.abs(t[i][i]);for(let s=i+1;s<e;s++){const e=Math.abs(t[s][i]);e>r&&(r=e,n=s)}if(0===r)return null;const s=t[n];t[n]=t[i],t[i]=s;for(let n=i+1;n<e;n++){const r=-t[n][i]/t[i][i];for(let s=i;s<e+1;s++)i==s?t[n][s]=0:t[n][s]+=r*t[i][s]}}const i=new Array(e);for(let n=e-1;n>=0;n--){i[n]=t[n][e]/t[n][n];for(let r=n-1;r>=0;r--)t[r][e]-=t[r][n]*i[n]}return i}([[h,u,0,0,x-w],[d,f,0,0,k-w],[0,0,h,u,M-b],[0,0,d,f,S-b]]);if(!I)return;if(g.save(),g.beginPath(),function(){if(void 0===ga){const t=Xn(6,6,pa);t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",ma(t,4,5,4,0),ma(t,4,5,0,5);const e=t.getImageData(0,0,3,3).data;ga=_a(e,0)||_a(e,4)||_a(e,8),jn(t),pa.push(t.canvas)}return ga}()||!c){g.moveTo(x,M);const t=4,e=w-x,i=b-M;for(let n=0;n<t;n++)g.lineTo(x+p((n+1)*e/t),M+p(n*i/(t-1))),n!=t-1&&g.lineTo(x+p((n+1)*e/t),M+p((n+1)*i/(t-1)));g.lineTo(k,S)}else g.moveTo(x,M),g.lineTo(w,b),g.lineTo(k,S);let A;if(g.clip(),g.transform(I[0],I[2],I[1],I[3],w,b),g.translate(m[0]-E,m[3]-C),_)A=_.canvas,g.scale(y,-y);else{const t=l[0],e=t.extent;A=t.image,g.scale(ae(e)/A.width,-ne(e)/A.height)}g.drawImage(A,0,0),g.restore()})),_&&(jn(_),pa.push(_.canvas)),u&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach((function(t,e,i){const n=t.target,r=(n[0][0]-v[0])/s,o=-(n[0][1]-v[1])/s,a=(n[1][0]-v[0])/s,l=-(n[1][1]-v[1])/s,h=(n[2][0]-v[0])/s,u=-(n[2][1]-v[1])/s;g.beginPath(),g.moveTo(a,l),g.lineTo(r,o),g.lineTo(h,u),g.closePath(),g.stroke()})),g.restore()),g.canvas}(n,r,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),s,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=po}this.changed()}load(){if(this.state==fo){this.state=go,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((e=>{const i=e.getState();if(i==fo||i==go){t++;const i=E(e,y,(function(n){const r=e.getState();r!=po&&r!=mo&&r!=_o||(I(i),t--,0===t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(i)}})),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,e,i){t.getState()==fo&&t.load()}))}}unlistenSources_(){this.sourcesListenerKeys_.forEach(I),this.sourcesListenerKeys_=null}release(){this.canvas_&&(jn(this.canvas_.getContext("2d")),pa.push(this.canvas_),this.canvas_=null),super.release()}};class va{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ba(t,e,i,n,r){return void 0!==r?(r.minX=t,r.maxX=e,r.minY=i,r.maxY=n,r):new va(t,e,i,n)}const xa=va,Ma=class extends ua{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new xa(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return i==po||i==_o||i==mo&&!n}getTile(t,e,i,n){const r=n.pixelRatio,s=n.viewState.projection,o=this.getLayer();let a=o.getSource().getTile(t,e,i,r,s);return a.getState()==mo&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=ti(e.pixelToCoordinateTransform,t.slice()),r=i.getExtent();if(r&&!Ot(r,n))return null;const s=e.pixelRatio,o=e.viewState.projection,a=e.viewState,l=i.getRenderSource(),h=l.getTileGridForProjection(a.projection),u=l.getTilePixelRatio(e.pixelRatio);for(let t=h.getZForResolution(a.resolution);t>=h.getMinZoom();--t){const e=h.getTileCoordForCoordAndZ(n,t),i=l.getTile(t,e[1],e[2],s,o);if(!(i instanceof da||i instanceof ya)||i instanceof ya&&i.getState()===_o)return null;if(i.getState()!==po)continue;const r=h.getOrigin(t),c=dn(h.getTileSize(t)),d=h.getResolution(t),f=Math.floor(u*((n[0]-r[0])/d-e[1]*c[0])),g=Math.floor(u*((r[1]-n[1])/d-e[2]*c[1])),p=Math.round(u*l.getGutterForProjection(a.projection));return this.getImageData(i.getImage(),f+p,g+p)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],n=t.viewState,r=n.projection,s=n.resolution,o=n.center,l=n.rotation,h=t.pixelRatio,u=this.getLayer(),c=u.getSource(),d=c.getRevision(),f=c.getTileGridForProjection(r),g=f.getZForResolution(s,c.zDirection),p=f.getResolution(g);let m=t.extent;const _=t.viewState.resolution,w=c.getTilePixelRatio(h),y=Math.round(ae(m)/_*h),v=Math.round(ne(m)/_*h),b=i.extent&&Ne(i.extent,r);b&&(m=re(m,Ne(i.extent,r)));const x=p*y/2/w,M=p*v/2/w,k=[o[0]-x,o[1]-M,o[0]+x,o[1]+M],S=f.getTileRangeForExtentAndZ(m,g),E={};E[g]={};const C=this.createLoadedTileFinder(c,r,E),I=this.tmpExtent,A=this.tmpTileRange_;this.newTiles_=!1;const T=l?ie(n.center,_,l,t.size):void 0;for(let e=S.minX;e<=S.maxX;++e)for(let n=S.minY;n<=S.maxY;++n){if(l&&!f.tileCoordIntersectsViewport([g,e,n],T))continue;const r=this.getTile(g,e,n,t);if(this.isDrawableTile(r)){const e=D(this);if(r.getState()==po){E[g][r.tileCoord.toString()]=r;let t=r.inTransition(e);t&&1!==i.opacity&&(r.endTransition(e),t=!1),this.newTiles_||!t&&this.renderedTiles.includes(r)||(this.newTiles_=!0)}if(1===r.getAlpha(e,t.time))continue}const s=f.getTileCoordChildTileRange(r.tileCoord,A,I);let o=!1;s&&(o=C(g+1,s)),o||f.forEachTileCoordParentTileRange(r.tileCoord,C,A,I)}const R=p/s*h/w;ei(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-y/2,-v/2);const P=ri(this.pixelTransform);this.useContainer(e,P,this.getBackground(t));const F=this.getRenderContext(t),L=this.context.canvas;ii(this.inversePixelTransform,this.pixelTransform),ei(this.tempTransform,y/2,v/2,R,R,0,-y/2,-v/2),L.width!=y||L.height!=v?(L.width=y,L.height=v):this.containerReused||F.clearRect(0,0,y,v),b&&this.clipUnrotated(F,t,b),c.getInterpolate()||(F.imageSmoothingEnabled=!1),this.preRender(F,t),this.renderedTiles.length=0;let O,z,N,B=Object.keys(E).map(Number);B.sort(a),1!==i.opacity||this.containerReused&&!c.getOpaque(t.viewState.projection)?(O=[],z=[]):B=B.reverse();for(let e=B.length-1;e>=0;--e){const i=B[e],n=c.getTilePixelSize(i,h,r),s=f.getResolution(i)/p,o=n[0]*s*R,a=n[1]*s*R,l=f.getTileCoordForCoordAndZ(se(k),i),u=f.getTileCoordExtent(l),d=ti(this.tempTransform,[w*(u[0]-k[0])/p,w*(k[3]-u[3])/p]),m=w*c.getGutterForProjection(r),_=E[i];for(const e in _){const n=_[e],r=n.tileCoord,s=l[1]-r[1],h=Math.round(d[0]-(s-1)*o),u=l[2]-r[2],f=Math.round(d[1]-(u-1)*a),p=Math.round(d[0]-s*o),w=Math.round(d[1]-u*a),y=h-p,v=f-w,b=g===i,x=b&&1!==n.getAlpha(D(this),t.time);let M=!1;if(!x)if(O){N=[p,w,p+y,w,p+y,w+v,p,w+v];for(let t=0,e=O.length;t<e;++t)if(g!==i&&i<z[t]){const e=O[t];le([p,w,p+y,w+v],[e[0],e[3],e[4],e[7]])&&(M||(F.save(),M=!0),F.beginPath(),F.moveTo(N[0],N[1]),F.lineTo(N[2],N[3]),F.lineTo(N[4],N[5]),F.lineTo(N[6],N[7]),F.moveTo(e[6],e[7]),F.lineTo(e[4],e[5]),F.lineTo(e[2],e[3]),F.lineTo(e[0],e[1]),F.clip())}O.push(N),z.push(i)}else F.clearRect(p,w,y,v);this.drawTileImage(n,t,p,w,y,v,m,b),O&&!x?(M&&F.restore(),this.renderedTiles.unshift(n)):this.renderedTiles.push(n),this.updateUsedTiles(t.usedTiles,c,n)}}return this.renderedRevision=d,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!Vt(this.renderedExtent_,k),this.renderedExtent_=k,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(t,c,f,h,r,m,g,u.getPreload()),this.scheduleExpireCache(t,c),this.postRender(this.context,t),i.extent&&F.restore(),F.imageSmoothingEnabled=!0,P!==L.style.transform&&(L.style.transform=P),this.container}drawTileImage(t,e,i,n,r,s,o,a){const l=this.getTileImage(t);if(!l)return;const h=this.getRenderContext(e),u=D(this),c=e.layerStatesArray[e.layerIndex],d=c.opacity*(a?t.getAlpha(u,e.time):1),f=d!==h.globalAlpha;f&&(h.save(),h.globalAlpha=d),h.drawImage(l,o,o,l.width-2*o,l.height-2*o,i,n,r,s),f&&h.restore(),d!==c.opacity?e.animate=!0:a&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(t,e,i){const n=D(t);n in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[n])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=D(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}manageTilePyramid(t,e,i,n,r,s,o,a,l){const h=D(e);h in t.wantedTiles||(t.wantedTiles[h]={});const u=t.wantedTiles[h],c=t.tileQueue,d=i.getMinZoom(),f=t.viewState.rotation,g=f?ie(t.viewState.center,t.viewState.resolution,f,t.size):void 0;let p,m,_,w,y,v,b=0;for(v=d;v<=o;++v)for(m=i.getTileRangeForExtentAndZ(s,v,m),_=i.getResolution(v),w=m.minX;w<=m.maxX;++w)for(y=m.minY;y<=m.maxY;++y)f&&!i.tileCoordIntersectsViewport([v,w,y],g)||(o-v<=a?(++b,p=e.getTile(v,w,y,n,r),p.getState()==fo&&(u[p.getKey()]=!0,c.isKeyQueued(p.getKey())||c.enqueue([p,h,i.getTileCoordCenter(p.tileCoord),_])),void 0!==l&&l(p)):e.useTile(v,w,y,r));e.updateCacheSize(b,r)}},ka=class extends sa{constructor(t){super(t)}createRenderer(){return new Ma(this)}};var Sa=__webpack_require__(3379),Ea=__webpack_require__.n(Sa),Ca=__webpack_require__(7795),Ia=__webpack_require__.n(Ca),Aa=__webpack_require__(569),Ta=__webpack_require__.n(Aa),Ra=__webpack_require__(3565),Pa=__webpack_require__.n(Ra),Da=__webpack_require__(9216),Fa=__webpack_require__.n(Da),La=__webpack_require__(4589),Oa=__webpack_require__.n(La),za=__webpack_require__(1828),Na={};Na.styleTagTransform=Oa(),Na.setAttributes=Pa(),Na.insert=Ta().bind(null,"head"),Na.domAPI=Ia(),Na.insertStyleElement=Fa(),Ea()(za.Z,Na),za.Z&&za.Z.locals&&za.Z.locals;var Ba=__webpack_require__(1788),Ua={};function Ga(t,e){let i=[],n=[],r=cv.matFromImageData(t);console.log(r);let s=cv.Mat.zeros(r.rows,r.cols,cv.CV_8UC3);console.log(s),cv.cvtColor(r,r,cv.COLOR_RGBA2GRAY,0),cv.threshold(r,r,0,255,cv.THRESH_BINARY);let o=new cv.MatVector,a=new cv.Mat;cv.findContours(r,o,a,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE);for(let t=0;t<o.size();++t){let e=new cv.Scalar(Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()));cv.drawContours(s,o,t,e,1,cv.LINE_8,a,10),n.push([e[0],e[1],e[2]])}return i=s,e&&cv.imshow(e,s),r.delete(),{contour:i.data,color:n}}function Xa(t,e){let i=cv.matFromImageData(t);console.log(i);let n=cv.Mat.zeros(i.rows,i.cols,cv.CV_8UC3);console.log(n),cv.cvtColor(i,i,cv.COLOR_RGBA2GRAY,0);let r=new cv.Size(3,3),s=new cv.Point(-1,-1);return cv.blur(i,i,r,s,cv.BORDER_DEFAULT),cv.Canny(i,n,50,100,3,!1),i.delete(),n}function Ya(){}function Va(t){return null==t?Ya:function(){return this.querySelector(t)}}function ja(){return[]}function qa(t){return null==t?ja:function(){return this.querySelectorAll(t)}}function Wa(t){return function(){return this.matches(t)}}function $a(t){return function(e){return e.matches(t)}}Ua.styleTagTransform=Oa(),Ua.setAttributes=Pa(),Ua.insert=Ta().bind(null,"head"),Ua.domAPI=Ia(),Ua.insertStyleElement=Fa(),Ea()(Ba.Z,Ua),Ba.Z&&Ba.Z.locals&&Ba.Z.locals;var Za=Array.prototype.find;function Ha(){return this.firstElementChild}var Ka=Array.prototype.filter;function Ja(){return Array.from(this.children)}function Qa(t){return new Array(t.length)}function tl(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function el(t,e,i,n,r,s){for(var o,a=0,l=e.length,h=s.length;a<h;++a)(o=e[a])?(o.__data__=s[a],n[a]=o):i[a]=new tl(t,s[a]);for(;a<l;++a)(o=e[a])&&(r[a]=o)}function il(t,e,i,n,r,s,o){var a,l,h,u=new Map,c=e.length,d=s.length,f=new Array(c);for(a=0;a<c;++a)(l=e[a])&&(f[a]=h=o.call(l,l.__data__,a,e)+"",u.has(h)?r[a]=l:u.set(h,l));for(a=0;a<d;++a)h=o.call(t,s[a],a,s)+"",(l=u.get(h))?(n[a]=l,l.__data__=s[a],u.delete(h)):i[a]=new tl(t,s[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(f[a])===l&&(r[a]=l)}function nl(t){return t.__data__}function rl(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function sl(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}tl.prototype={constructor:tl,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var ol="http://www.w3.org/1999/xhtml";const al={svg:"http://www.w3.org/2000/svg",xhtml:ol,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ll(t){var e=t+="",i=e.indexOf(":");return i>=0&&"xmlns"!==(e=t.slice(0,i))&&(t=t.slice(i+1)),al.hasOwnProperty(e)?{space:al[e],local:t}:t}function hl(t){return function(){this.removeAttribute(t)}}function ul(t){return function(){this.removeAttributeNS(t.space,t.local)}}function cl(t,e){return function(){this.setAttribute(t,e)}}function dl(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function fl(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}function gl(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function pl(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ml(t){return function(){this.style.removeProperty(t)}}function _l(t,e,i){return function(){this.style.setProperty(t,e,i)}}function wl(t,e,i){return function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function yl(t,e){return t.style.getPropertyValue(e)||pl(t).getComputedStyle(t,null).getPropertyValue(e)}function vl(t){return function(){delete this[t]}}function bl(t,e){return function(){this[t]=e}}function xl(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}function Ml(t){return t.trim().split(/^|\s+/)}function kl(t){return t.classList||new Sl(t)}function Sl(t){this._node=t,this._names=Ml(t.getAttribute("class")||"")}function El(t,e){for(var i=kl(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function Cl(t,e){for(var i=kl(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function Il(t){return function(){El(this,t)}}function Al(t){return function(){Cl(this,t)}}function Tl(t,e){return function(){(e.apply(this,arguments)?El:Cl)(this,t)}}function Rl(){this.textContent=""}function Pl(t){return function(){this.textContent=t}}function Dl(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Fl(){this.innerHTML=""}function Ll(t){return function(){this.innerHTML=t}}function Ol(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function zl(){this.nextSibling&&this.parentNode.appendChild(this)}function Nl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Bl(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===ol&&e.documentElement.namespaceURI===ol?e.createElement(t):e.createElementNS(i,t)}}function Ul(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Gl(t){var e=ll(t);return(e.local?Ul:Bl)(e)}function Xl(){return null}function Yl(){var t=this.parentNode;t&&t.removeChild(this)}function Vl(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function jl(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ql(t){return function(){var e=this.__on;if(e){for(var i,n=0,r=-1,s=e.length;n<s;++n)i=e[n],t.type&&i.type!==t.type||i.name!==t.name?e[++r]=i:this.removeEventListener(i.type,i.listener,i.options);++r?e.length=r:delete this.__on}}}function Wl(t,e,i){return function(){var n,r=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var o=0,a=r.length;o<a;++o)if((n=r[o]).type===t.type&&n.name===t.name)return this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=i),void(n.value=e);this.addEventListener(t.type,s,i),n={type:t.type,name:t.name,value:e,listener:s,options:i},r?r.push(n):this.__on=[n]}}function $l(t,e,i){var n=pl(t),r=n.CustomEvent;"function"==typeof r?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Zl(t,e){return function(){return $l(this,t,e)}}function Hl(t,e){return function(){return $l(this,t,e.apply(this,arguments))}}Sl.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Kl=[null];function Jl(t,e){this._groups=t,this._parents=e}function Ql(){return new Jl([[document.documentElement]],Kl)}Jl.prototype=Ql.prototype={constructor:Jl,select:function(t){"function"!=typeof t&&(t=Va(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,o,a=e[r],l=a.length,h=n[r]=new Array(l),u=0;u<l;++u)(s=a[u])&&(o=t.call(s,s.__data__,u,a))&&("__data__"in s&&(o.__data__=s.__data__),h[u]=o);return new Jl(n,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):qa(t);for(var e=this._groups,i=e.length,n=[],r=[],s=0;s<i;++s)for(var o,a=e[s],l=a.length,h=0;h<l;++h)(o=a[h])&&(n.push(t.call(o,o.__data__,h,a)),r.push(o));return new Jl(n,r)},selectChild:function(t){return this.select(null==t?Ha:function(t){return function(){return Za.call(this.children,t)}}("function"==typeof t?t:$a(t)))},selectChildren:function(t){return this.selectAll(null==t?Ja:function(t){return function(){return Ka.call(this.children,t)}}("function"==typeof t?t:$a(t)))},filter:function(t){"function"!=typeof t&&(t=Wa(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,o=e[r],a=o.length,l=n[r]=[],h=0;h<a;++h)(s=o[h])&&t.call(s,s.__data__,h,o)&&l.push(s);return new Jl(n,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,nl);var i,n=e?il:el,r=this._parents,s=this._groups;"function"!=typeof t&&(i=t,t=function(){return i});for(var o=s.length,a=new Array(o),l=new Array(o),h=new Array(o),u=0;u<o;++u){var c=r[u],d=s[u],f=d.length,g=rl(t.call(c,c&&c.__data__,u,r)),p=g.length,m=l[u]=new Array(p),_=a[u]=new Array(p);n(c,d,m,_,h[u]=new Array(f),g,e);for(var w,y,v=0,b=0;v<p;++v)if(w=m[v]){for(v>=b&&(b=v+1);!(y=_[b])&&++b<p;);w._next=y||null}}return(a=new Jl(a,r))._enter=l,a._exit=h,a},enter:function(){return new Jl(this._enter||this._groups.map(Qa),this._parents)},exit:function(){return new Jl(this._exit||this._groups.map(Qa),this._parents)},join:function(t,e,i){var n=this.enter(),r=this,s=this.exit();return"function"==typeof t?(n=t(n))&&(n=n.selection()):n=n.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==i?s.remove():i(s),n&&r?n.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,i=this._groups,n=e._groups,r=i.length,s=n.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var h,u=i[l],c=n[l],d=u.length,f=a[l]=new Array(d),g=0;g<d;++g)(h=u[g]||c[g])&&(f[g]=h);for(;l<r;++l)a[l]=i[l];return new Jl(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n,r=t[e],s=r.length-1,o=r[s];--s>=0;)(n=r[s])&&(o&&4^n.compareDocumentPosition(o)&&o.parentNode.insertBefore(n,o),o=n);return this},sort:function(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=sl);for(var i=this._groups,n=i.length,r=new Array(n),s=0;s<n;++s){for(var o,a=i[s],l=a.length,h=r[s]=new Array(l),u=0;u<l;++u)(o=a[u])&&(h[u]=o);h.sort(e)}return new Jl(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,s=n.length;r<s;++r){var o=n[r];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r,s=e[i],o=0,a=s.length;o<a;++o)(r=s[o])&&t.call(r,r.__data__,o,s);return this},attr:function(t,e){var i=ll(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((null==e?i.local?ul:hl:"function"==typeof e?i.local?gl:fl:i.local?dl:cl)(i,e))},style:function(t,e,i){return arguments.length>1?this.each((null==e?ml:"function"==typeof e?wl:_l)(t,e,null==i?"":i)):yl(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?vl:"function"==typeof e?xl:bl)(t,e)):this.node()[t]},classed:function(t,e){var i=Ml(t+"");if(arguments.length<2){for(var n=kl(this.node()),r=-1,s=i.length;++r<s;)if(!n.contains(i[r]))return!1;return!0}return this.each(("function"==typeof e?Tl:e?Il:Al)(i,e))},text:function(t){return arguments.length?this.each(null==t?Rl:("function"==typeof t?Dl:Pl)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Fl:("function"==typeof t?Ol:Ll)(t)):this.node().innerHTML},raise:function(){return this.each(zl)},lower:function(){return this.each(Nl)},append:function(t){var e="function"==typeof t?t:Gl(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var i="function"==typeof t?t:Gl(t),n=null==e?Xl:"function"==typeof e?e:Va(e);return this.select((function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)}))},remove:function(){return this.each(Yl)},clone:function(t){return this.select(t?jl:Vl)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,i){var n,r,s=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}}))}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?Wl:ql,n=0;n<o;++n)this.each(a(s[n],e,i));return this}var a=this.node().__on;if(a)for(var l,h=0,u=a.length;h<u;++h)for(n=0,l=a[h];n<o;++n)if((r=s[n]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?Hl:Zl)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n,r=t[e],s=0,o=r.length;s<o;++s)(n=r[s])&&(yield n)}};const th=Ql;var eh={value:()=>{}};function ih(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n||/[\s.]/.test(t))throw new Error("illegal type: "+t);n[t]=[]}return new nh(n)}function nh(t){this._=t}function rh(t,e){for(var i,n=0,r=t.length;n<r;++n)if((i=t[n]).name===e)return i.value}function sh(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=eh,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}nh.prototype=ih.prototype={constructor:nh,on:function(t,e){var i,n=this._,r=function(t,e){return t.trim().split(/^|\s+/).map((function(t){var i="",n=t.indexOf(".");if(n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}}))}(t+"",n),s=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=sh(n[i],t.name,e);else if(null==e)for(i in n)n[i]=sh(n[i],t.name,null);return this}for(;++s<o;)if((i=(t=r[s]).type)&&(i=rh(n[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new nh(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,r=new Array(i),s=0;s<i;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,i=(n=this._[t]).length;s<i;++s)n[s].value.apply(e,r)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,s=n.length;r<s;++r)n[r].value.apply(e,i)}};const oh=ih;var ah,lh,hh=0,uh=0,ch=0,dh=1e3,fh=0,gh=0,ph=0,mh="object"==typeof performance&&performance.now?performance:Date,_h="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function wh(){return gh||(_h(yh),gh=mh.now()+ph)}function yh(){gh=0}function vh(){this._call=this._time=this._next=null}function bh(t,e,i){var n=new vh;return n.restart(t,e,i),n}function xh(){gh=(fh=mh.now())+ph,hh=uh=0;try{!function(){wh(),++hh;for(var t,e=ah;e;)(t=gh-e._time)>=0&&e._call.call(void 0,t),e=e._next;--hh}()}finally{hh=0,function(){for(var t,e,i=ah,n=1/0;i;)i._call?(n>i._time&&(n=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:ah=e);lh=t,kh(n)}(),gh=0}}function Mh(){var t=mh.now(),e=t-fh;e>dh&&(ph-=e,fh=t)}function kh(t){hh||(uh&&(uh=clearTimeout(uh)),t-gh>24?(t<1/0&&(uh=setTimeout(xh,t-mh.now()-ph)),ch&&(ch=clearInterval(ch))):(ch||(fh=mh.now(),ch=setInterval(Mh,dh)),hh=1,_h(xh)))}function Sh(t,e,i){var n=new vh;return e=null==e?0:+e,n.restart((i=>{n.stop(),t(i+e)}),e,i),n}vh.prototype=bh.prototype={constructor:vh,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?wh():+i)+(null==e?0:+e),this._next||lh===this||(lh?lh._next=this:ah=this,lh=this),this._call=t,this._time=i,kh()},stop:function(){this._call&&(this._call=null,this._time=1/0,kh())}};var Eh=oh("start","end","cancel","interrupt"),Ch=[],Ih=0,Ah=3;function Th(t,e,i,n,r,s){var o=t.__transition;if(o){if(i in o)return}else t.__transition={};!function(t,e,i){var n,r=t.__transition;function s(l){var h,u,c,d;if(1!==i.state)return a();for(h in r)if((d=r[h]).name===i.name){if(d.state===Ah)return Sh(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[h]):+h<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[h])}if(Sh((function(){i.state===Ah&&(i.state=4,i.timer.restart(o,i.delay,i.time),o(l))})),i.state=2,i.on.call("start",t,t.__data__,i.index,i.group),2===i.state){for(i.state=Ah,n=new Array(c=i.tween.length),h=0,u=-1;h<c;++h)(d=i.tween[h].value.call(t,t.__data__,i.index,i.group))&&(n[++u]=d);n.length=u+1}}function o(e){for(var r=e<i.duration?i.ease.call(null,e/i.duration):(i.timer.restart(a),i.state=5,1),s=-1,o=n.length;++s<o;)n[s].call(t,r);5===i.state&&(i.on.call("end",t,t.__data__,i.index,i.group),a())}function a(){for(var n in i.state=6,i.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=i,i.timer=bh((function(t){i.state=1,i.timer.restart(s,i.delay,i.time),i.delay<=t&&s(t-i.delay)}),0,i.time)}(t,i,{name:e,index:n,group:r,on:Eh,tween:Ch,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Ih})}function Rh(t,e){var i=Dh(t,e);if(i.state>Ih)throw new Error("too late; already scheduled");return i}function Ph(t,e){var i=Dh(t,e);if(i.state>Ah)throw new Error("too late; already running");return i}function Dh(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function Fh(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var Lh,Oh=180/Math.PI,zh={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Nh(t,e,i,n,r,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(a=Math.sqrt(i*i+n*n))&&(i/=a,n/=a,l/=a),t*n<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Oh,skewX:Math.atan(l)*Oh,scaleX:o,scaleY:a}}function Bh(t,e,i,n){function r(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,n,r,s,o,a){if(t!==r||n!==s){var l=o.push("translate(",null,e,null,i);a.push({i:l-4,x:Fh(t,r)},{i:l-2,x:Fh(n,s)})}else(r||s)&&o.push("translate("+r+e+s+i)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,i,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:i.push(r(i)+"rotate(",null,n)-2,x:Fh(t,e)})):e&&i.push(r(i)+"rotate("+e+n)}(s.rotate,o.rotate,a,l),function(t,e,i,s){t!==e?s.push({i:i.push(r(i)+"skewX(",null,n)-2,x:Fh(t,e)}):e&&i.push(r(i)+"skewX("+e+n)}(s.skewX,o.skewX,a,l),function(t,e,i,n,s,o){if(t!==i||e!==n){var a=s.push(r(s)+"scale(",null,",",null,")");o.push({i:a-4,x:Fh(t,i)},{i:a-2,x:Fh(e,n)})}else 1===i&&1===n||s.push(r(s)+"scale("+i+","+n+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,i=-1,n=l.length;++i<n;)a[(e=l[i]).i]=e.x(t);return a.join("")}}}var Uh=Bh((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?zh:Nh(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),Gh=Bh((function(t){return null==t?zh:(Lh||(Lh=document.createElementNS("http://www.w3.org/2000/svg","g")),Lh.setAttribute("transform",t),(t=Lh.transform.baseVal.consolidate())?Nh((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):zh)}),", ",")",")");function Xh(t,e){var i,n;return function(){var r=Ph(this,t),s=r.tween;if(s!==i)for(var o=0,a=(n=i=s).length;o<a;++o)if(n[o].name===e){(n=n.slice()).splice(o,1);break}r.tween=n}}function Yh(t,e,i){var n,r;if("function"!=typeof i)throw new Error;return function(){var s=Ph(this,t),o=s.tween;if(o!==n){r=(n=o).slice();for(var a={name:e,value:i},l=0,h=r.length;l<h;++l)if(r[l].name===e){r[l]=a;break}l===h&&r.push(a)}s.tween=r}}function Vh(t,e,i){var n=t._id;return t.each((function(){var t=Ph(this,n);(t.value||(t.value={}))[e]=i.apply(this,arguments)})),function(t){return Dh(t,n).value[e]}}function jh(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function qh(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function Wh(){}var $h=.7,Zh=1/$h,Hh="\\s*([+-]?\\d+)\\s*",Kh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Jh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Qh=/^#([0-9a-f]{3,8})$/,tu=new RegExp(`^rgb\\(${Hh},${Hh},${Hh}\\)$`),eu=new RegExp(`^rgb\\(${Jh},${Jh},${Jh}\\)$`),iu=new RegExp(`^rgba\\(${Hh},${Hh},${Hh},${Kh}\\)$`),nu=new RegExp(`^rgba\\(${Jh},${Jh},${Jh},${Kh}\\)$`),ru=new RegExp(`^hsl\\(${Kh},${Jh},${Jh}\\)$`),su=new RegExp(`^hsla\\(${Kh},${Jh},${Jh},${Kh}\\)$`),ou={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function au(){return this.rgb().formatHex()}function lu(){return this.rgb().formatRgb()}function hu(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Qh.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?uu(e):3===i?new fu(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?cu(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?cu(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=tu.exec(t))?new fu(e[1],e[2],e[3],1):(e=eu.exec(t))?new fu(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=iu.exec(t))?cu(e[1],e[2],e[3],e[4]):(e=nu.exec(t))?cu(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=ru.exec(t))?yu(e[1],e[2]/100,e[3]/100,1):(e=su.exec(t))?yu(e[1],e[2]/100,e[3]/100,e[4]):ou.hasOwnProperty(t)?uu(ou[t]):"transparent"===t?new fu(NaN,NaN,NaN,0):null}function uu(t){return new fu(t>>16&255,t>>8&255,255&t,1)}function cu(t,e,i,n){return n<=0&&(t=e=i=NaN),new fu(t,e,i,n)}function du(t,e,i,n){return 1===arguments.length?((r=t)instanceof Wh||(r=hu(r)),r?new fu((r=r.rgb()).r,r.g,r.b,r.opacity):new fu):new fu(t,e,i,null==n?1:n);var r}function fu(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}function gu(){return`#${wu(this.r)}${wu(this.g)}${wu(this.b)}`}function pu(){const t=mu(this.opacity);return`${1===t?"rgb(":"rgba("}${_u(this.r)}, ${_u(this.g)}, ${_u(this.b)}${1===t?")":`, ${t})`}`}function mu(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function _u(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function wu(t){return((t=_u(t))<16?"0":"")+t.toString(16)}function yu(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new bu(t,e,i,n)}function vu(t){if(t instanceof bu)return new bu(t.h,t.s,t.l,t.opacity);if(t instanceof Wh||(t=hu(t)),!t)return new bu;if(t instanceof bu)return t;var e=(t=t.rgb()).r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),s=Math.max(e,i,n),o=NaN,a=s-r,l=(s+r)/2;return a?(o=e===s?(i-n)/a+6*(i<n):i===s?(n-e)/a+2:(e-i)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new bu(o,a,l,t.opacity)}function bu(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}function xu(t){return(t=(t||0)%360)<0?t+360:t}function Mu(t){return Math.max(0,Math.min(1,t||0))}function ku(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}function Su(t,e,i,n,r){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*i+(1+3*t+3*s-3*o)*n+o*r)/6}jh(Wh,hu,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:au,formatHex:au,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return vu(this).formatHsl()},formatRgb:lu,toString:lu}),jh(fu,du,qh(Wh,{brighter(t){return t=null==t?Zh:Math.pow(Zh,t),new fu(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?$h:Math.pow($h,t),new fu(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new fu(_u(this.r),_u(this.g),_u(this.b),mu(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:gu,formatHex:gu,formatHex8:function(){return`#${wu(this.r)}${wu(this.g)}${wu(this.b)}${wu(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:pu,toString:pu})),jh(bu,(function(t,e,i,n){return 1===arguments.length?vu(t):new bu(t,e,i,null==n?1:n)}),qh(Wh,{brighter(t){return t=null==t?Zh:Math.pow(Zh,t),new bu(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?$h:Math.pow($h,t),new bu(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new fu(ku(t>=240?t-240:t+120,r,n),ku(t,r,n),ku(t<120?t+240:t-120,r,n),this.opacity)},clamp(){return new bu(xu(this.h),Mu(this.s),Mu(this.l),mu(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=mu(this.opacity);return`${1===t?"hsl(":"hsla("}${xu(this.h)}, ${100*Mu(this.s)}%, ${100*Mu(this.l)}%${1===t?")":`, ${t})`}`}}));const Eu=t=>()=>t;function Cu(t,e){var i=e-t;return i?function(t,e){return function(i){return t+i*e}}(t,i):Eu(isNaN(t)?e:t)}const Iu=function t(e){var i=function(t){return 1==(t=+t)?Cu:function(e,i){return i-e?function(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}(e,i,t):Eu(isNaN(e)?i:e)}}(e);function n(t,e){var n=i((t=du(t)).r,(e=du(e)).r),r=i(t.g,e.g),s=i(t.b,e.b),o=Cu(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=s(e),t.opacity=o(e),t+""}}return n.gamma=t,n}(1);function Au(t){return function(e){var i,n,r=e.length,s=new Array(r),o=new Array(r),a=new Array(r);for(i=0;i<r;++i)n=du(e[i]),s[i]=n.r||0,o[i]=n.g||0,a[i]=n.b||0;return s=t(s),o=t(o),a=t(a),n.opacity=1,function(t){return n.r=s(t),n.g=o(t),n.b=a(t),n+""}}}Au((function(t){var e=t.length-1;return function(i){var n=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),r=t[n],s=t[n+1],o=n>0?t[n-1]:2*r-s,a=n<e-1?t[n+2]:2*s-r;return Su((i-n/e)*e,o,r,s,a)}})),Au((function(t){var e=t.length;return function(i){var n=Math.floor(((i%=1)<0?++i:i)*e),r=t[(n+e-1)%e],s=t[n%e],o=t[(n+1)%e],a=t[(n+2)%e];return Su((i-n/e)*e,r,s,o,a)}}));var Tu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ru=new RegExp(Tu.source,"g");function Pu(t,e){var i,n,r,s=Tu.lastIndex=Ru.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(i=Tu.exec(t))&&(n=Ru.exec(e));)(r=n.index)>s&&(r=e.slice(s,r),a[o]?a[o]+=r:a[++o]=r),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,l.push({i:o,x:Fh(i,n)})),s=Ru.lastIndex;return s<e.length&&(r=e.slice(s),a[o]?a[o]+=r:a[++o]=r),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var i,n=0;n<e;++n)a[(i=l[n]).i]=i.x(t);return a.join("")})}function Du(t,e){var i;return("number"==typeof e?Fh:e instanceof hu?Iu:(i=hu(e))?(e=i,Iu):Pu)(t,e)}function Fu(t){return function(){this.removeAttribute(t)}}function Lu(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ou(t,e,i){var n,r,s=i+"";return function(){var o=this.getAttribute(t);return o===s?null:o===n?r:r=e(n=o,i)}}function zu(t,e,i){var n,r,s=i+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===n?r:r=e(n=o,i)}}function Nu(t,e,i){var n,r,s;return function(){var o,a,l=i(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===n&&a===r?s:(r=a,s=e(n=o,l));this.removeAttribute(t)}}function Bu(t,e,i){var n,r,s;return function(){var o,a,l=i(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===n&&a===r?s:(r=a,s=e(n=o,l));this.removeAttributeNS(t.space,t.local)}}function Uu(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&function(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}(t,r)),i}return r._value=e,r}function Gu(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&function(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}(t,r)),i}return r._value=e,r}function Xu(t,e){return function(){Rh(this,t).delay=+e.apply(this,arguments)}}function Yu(t,e){return e=+e,function(){Rh(this,t).delay=e}}function Vu(t,e){return function(){Ph(this,t).duration=+e.apply(this,arguments)}}function ju(t,e){return e=+e,function(){Ph(this,t).duration=e}}var qu=th.prototype.constructor;function Wu(t){return function(){this.style.removeProperty(t)}}var $u=0;function Zu(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function Hu(){return++$u}var Ku=th.prototype;Zu.prototype=function(t){return th().transition(t)}.prototype={constructor:Zu,select:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=Va(t));for(var n=this._groups,r=n.length,s=new Array(r),o=0;o<r;++o)for(var a,l,h=n[o],u=h.length,c=s[o]=new Array(u),d=0;d<u;++d)(a=h[d])&&(l=t.call(a,a.__data__,d,h))&&("__data__"in a&&(l.__data__=a.__data__),c[d]=l,Th(c[d],e,i,d,c,Dh(a,i)));return new Zu(s,this._parents,e,i)},selectAll:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=qa(t));for(var n=this._groups,r=n.length,s=[],o=[],a=0;a<r;++a)for(var l,h=n[a],u=h.length,c=0;c<u;++c)if(l=h[c]){for(var d,f=t.call(l,l.__data__,c,h),g=Dh(l,i),p=0,m=f.length;p<m;++p)(d=f[p])&&Th(d,e,i,p,f,g);s.push(f),o.push(l)}return new Zu(s,o,e,i)},selectChild:Ku.selectChild,selectChildren:Ku.selectChildren,filter:function(t){"function"!=typeof t&&(t=Wa(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,o=e[r],a=o.length,l=n[r]=[],h=0;h<a;++h)(s=o[h])&&t.call(s,s.__data__,h,o)&&l.push(s);return new Zu(n,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,s=Math.min(n,r),o=new Array(n),a=0;a<s;++a)for(var l,h=e[a],u=i[a],c=h.length,d=o[a]=new Array(c),f=0;f<c;++f)(l=h[f]||u[f])&&(d[f]=l);for(;a<n;++a)o[a]=e[a];return new Zu(o,this._parents,this._name,this._id)},selection:function(){return new qu(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,i=Hu(),n=this._groups,r=n.length,s=0;s<r;++s)for(var o,a=n[s],l=a.length,h=0;h<l;++h)if(o=a[h]){var u=Dh(o,e);Th(o,t,i,h,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Zu(n,this._parents,t,i)},call:Ku.call,nodes:Ku.nodes,node:Ku.node,size:Ku.size,empty:Ku.empty,each:Ku.each,on:function(t,e){var i=this._id;return arguments.length<2?Dh(this.node(),i).on.on(t):this.each(function(t,e,i){var n,r,s=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Rh:Ph;return function(){var o=s(this,t),a=o.on;a!==n&&(r=(n=a).copy()).on(e,i),o.on=r}}(i,t,e))},attr:function(t,e){var i=ll(t),n="transform"===i?Gh:Du;return this.attrTween(t,"function"==typeof e?(i.local?Bu:Nu)(i,n,Vh(this,"attr."+t,e)):null==e?(i.local?Lu:Fu)(i):(i.local?zu:Ou)(i,n,e))},attrTween:function(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var n=ll(t);return this.tween(i,(n.local?Uu:Gu)(n,e))},style:function(t,e,i){var n="transform"==(t+="")?Uh:Du;return null==e?this.styleTween(t,function(t,e){var i,n,r;return function(){var s=yl(this,t),o=(this.style.removeProperty(t),yl(this,t));return s===o?null:s===i&&o===n?r:r=e(i=s,n=o)}}(t,n)).on("end.style."+t,Wu(t)):"function"==typeof e?this.styleTween(t,function(t,e,i){var n,r,s;return function(){var o=yl(this,t),a=i(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=yl(this,t)),o===l?null:o===n&&l===r?s:(r=l,s=e(n=o,a))}}(t,n,Vh(this,"style."+t,e))).each(function(t,e){var i,n,r,s,o="style."+e,a="end."+o;return function(){var l=Ph(this,t),h=l.on,u=null==l.value[o]?s||(s=Wu(e)):void 0;h===i&&r===u||(n=(i=h).copy()).on(a,r=u),l.on=n}}(this._id,t)):this.styleTween(t,function(t,e,i){var n,r,s=i+"";return function(){var o=yl(this,t);return o===s?null:o===n?r:r=e(n=o,i)}}(t,n,e),i).on("end.style."+t,null)},styleTween:function(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;return this.tween(n,function(t,e,i){var n,r;function s(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&function(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}(t,s,i)),n}return s._value=e,s}(t,e,null==i?"":i))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Vh(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,i;function n(){var n=t.apply(this,arguments);return n!==i&&(e=(i=n)&&function(t){return function(e){this.textContent=t.call(this,e)}}(n)),e}return n._value=t,n}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n,r=Dh(this.node(),i).tween,s=0,o=r.length;s<o;++s)if((n=r[s]).name===t)return n.value;return null}return this.each((null==e?Xh:Yh)(i,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Xu:Yu)(e,t)):Dh(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Vu:ju)(e,t)):Dh(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Ph(this,t).ease=e}}(e,t)):Dh(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var i=e.apply(this,arguments);if("function"!=typeof i)throw new Error;Ph(this,t).ease=i}}(this._id,t))},end:function(){var t,e,i=this,n=i._id,r=i.size();return new Promise((function(s,o){var a={value:o},l={value:function(){0==--r&&s()}};i.each((function(){var i=Ph(this,n),r=i.on;r!==t&&((e=(t=r).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),i.on=e})),0===r&&s()}))},[Symbol.iterator]:Ku[Symbol.iterator]};var Ju={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Qu(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}th.prototype.interrupt=function(t){return this.each((function(){!function(t,e){var i,n,r,s=t.__transition,o=!0;if(s){for(r in e=null==e?null:e+"",s)(i=s[r]).name===e?(n=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(n?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete s[r]):o=!1;o&&delete t.__transition}}(this,t)}))},th.prototype.transition=function(t){var e,i;t instanceof Zu?(e=t._id,t=t._name):(e=Hu(),(i=Ju).time=wh(),t=null==t?null:t+"");for(var n=this._groups,r=n.length,s=0;s<r;++s)for(var o,a=n[s],l=a.length,h=0;h<l;++h)(o=a[h])&&Th(o,t,e,h,a,i||Qu(o,e));return new Zu(n,this._parents,t,e)};const{abs:tc,max:ec,min:ic}=Math;function nc(t){return{type:t}}function rc(t,e,i){this.k=t,this.x=e,this.y=i}function sc(t){let e=[];for(let i=0;i<t.length;i+=4){let n=t[i],r=t[i+1],s=t[i+2];t[i+3],e.push([n,r,s])}return e}function oc(t,e,i,n){return sc(e)[Math.floor(t[1])*i+Math.floor(t[0])]}["w","e"].map(nc),["n","s"].map(nc),["n","w","e","s","nw","ne","sw","se"].map(nc),rc.prototype={constructor:rc,scale:function(t){return 1===t?this:new rc(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new rc(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new rc(1,0,0),rc.prototype;const ac={getBit(t){return this.data[lc(t)]&1<<hc(t)?1:0},setBit(t){this.data[lc(t)]|=1<<hc(t)},clearBit(t){this.data[lc(t)]&=~(1<<hc(t))},toggleBit(t){this.data[lc(t)]^=1<<hc(t)},getBitXY(t,e){return t>=this.width||e>=this.height?0:this.getBit(e*this.width+t)},setBitXY(t,e){this.setBit(e*this.width+t)},clearBitXY(t,e){this.clearBit(e*this.width+t)},toggleBitXY(t,e){this.toggleBit(e*this.width+t)}};function lc(t){return t>>3}function hc(t){return 7-(7&t)}function uc(t,e,i){return"function"==typeof t.toBlob?new Promise((function(n){t.toBlob(n,e,i)})):Promise.resolve(function(t){var e=t.match(/data:([^;]+)/)[1],i=t.replace(/^[^,]+,/,"");return function(t,e){t=t||[],"string"==typeof(e=e||{})&&(e={type:e});try{return new Blob(t,e)}catch(r){if("TypeError"!==r.name)throw r;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)i.append(t[n]);return i.getBlob(e.type)}}([cc(atob(i))],{type:e})}(t.toDataURL(e,i)))}function cc(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),r=-1;++r<e;)n[r]=t.charCodeAt(r);return i}var dc=__webpack_require__(4665),fc=__webpack_require__(2155);function gc(t){let e=t.length;for(;--e>=0;)t[e]=0}const pc=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),mc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),_c=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wc=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yc=new Array(576);gc(yc);const vc=new Array(60);gc(vc);const bc=new Array(512);gc(bc);const xc=new Array(256);gc(xc);const Mc=new Array(29);gc(Mc);const kc=new Array(30);function Sc(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}let Ec,Cc,Ic;function Ac(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}gc(kc);const Tc=t=>t<256?bc[t]:bc[256+(t>>>7)],Rc=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Pc=(t,e,i)=>{t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,Rc(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},Dc=(t,e,i)=>{Pc(t,i[2*e],i[2*e+1])},Fc=(t,e)=>{let i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1},Lc=(t,e,i)=>{const n=new Array(16);let r,s,o=0;for(r=1;r<=15;r++)o=o+i[r-1]<<1,n[r]=o;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=Fc(n[e]++,e))}},Oc=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},zc=t=>{t.bi_valid>8?Rc(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Nc=(t,e,i,n)=>{const r=2*e,s=2*i;return t[r]<t[s]||t[r]===t[s]&&n[e]<=n[i]},Bc=(t,e,i)=>{const n=t.heap[i];let r=i<<1;for(;r<=t.heap_len&&(r<t.heap_len&&Nc(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!Nc(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n},Uc=(t,e,i)=>{let n,r,s,o,a=0;if(0!==t.sym_next)do{n=255&t.pending_buf[t.sym_buf+a++],n+=(255&t.pending_buf[t.sym_buf+a++])<<8,r=t.pending_buf[t.sym_buf+a++],0===n?Dc(t,r,e):(s=xc[r],Dc(t,s+256+1,e),o=pc[s],0!==o&&(r-=Mc[s],Pc(t,r,o)),n--,s=Tc(n),Dc(t,s,i),o=mc[s],0!==o&&(n-=kc[s],Pc(t,n,o)))}while(a<t.sym_next);Dc(t,256,e)},Gc=(t,e)=>{const i=e.dyn_tree,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,l,h=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<s;o++)0!==i[2*o]?(t.heap[++t.heap_len]=h=o,t.depth[o]=0):i[2*o+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=h<2?++h:0,i[2*l]=1,t.depth[l]=0,t.opt_len--,r&&(t.static_len-=n[2*l+1]);for(e.max_code=h,o=t.heap_len>>1;o>=1;o--)Bc(t,i,o);l=s;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Bc(t,i,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,i[2*l]=i[2*o]+i[2*a],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,i[2*o+1]=i[2*a+1]=l,t.heap[1]=l++,Bc(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const i=e.dyn_tree,n=e.max_code,r=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length;let h,u,c,d,f,g,p=0;for(d=0;d<=15;d++)t.bl_count[d]=0;for(i[2*t.heap[t.heap_max]+1]=0,h=t.heap_max+1;h<573;h++)u=t.heap[h],d=i[2*i[2*u+1]+1]+1,d>l&&(d=l,p++),i[2*u+1]=d,u>n||(t.bl_count[d]++,f=0,u>=a&&(f=o[u-a]),g=i[2*u],t.opt_len+=g*(d+f),s&&(t.static_len+=g*(r[2*u+1]+f)));if(0!==p){do{for(d=l-1;0===t.bl_count[d];)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[l]--,p-=2}while(p>0);for(d=l;0!==d;d--)for(u=t.bl_count[d];0!==u;)c=t.heap[--h],c>n||(i[2*c+1]!==d&&(t.opt_len+=(d-i[2*c+1])*i[2*c],i[2*c+1]=d),u--)}})(t,e),Lc(i,h,t.bl_count)},Xc=(t,e,i)=>{let n,r,s=-1,o=e[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=o,o=e[2*(n+1)+1],++a<l&&r===o||(a<h?t.bl_tree[2*r]+=a:0!==r?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=r,0===o?(l=138,h=3):r===o?(l=6,h=3):(l=7,h=4))},Yc=(t,e,i)=>{let n,r,s=-1,o=e[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),n=0;n<=i;n++)if(r=o,o=e[2*(n+1)+1],!(++a<l&&r===o)){if(a<h)do{Dc(t,r,t.bl_tree)}while(0!=--a);else 0!==r?(r!==s&&(Dc(t,r,t.bl_tree),a--),Dc(t,16,t.bl_tree),Pc(t,a-3,2)):a<=10?(Dc(t,17,t.bl_tree),Pc(t,a-3,3)):(Dc(t,18,t.bl_tree),Pc(t,a-11,7));a=0,s=r,0===o?(l=138,h=3):r===o?(l=6,h=3):(l=7,h=4)}};let Vc=!1;const jc=(t,e,i,n)=>{Pc(t,0+(n?1:0),3),zc(t),Rc(t,i),Rc(t,~i),i&&t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i};var qc={_tr_init:t=>{Vc||((()=>{let t,e,i,n,r;const s=new Array(16);for(i=0,n=0;n<28;n++)for(Mc[n]=i,t=0;t<1<<pc[n];t++)xc[i++]=n;for(xc[i-1]=n,r=0,n=0;n<16;n++)for(kc[n]=r,t=0;t<1<<mc[n];t++)bc[r++]=n;for(r>>=7;n<30;n++)for(kc[n]=r<<7,t=0;t<1<<mc[n]-7;t++)bc[256+r++]=n;for(e=0;e<=15;e++)s[e]=0;for(t=0;t<=143;)yc[2*t+1]=8,t++,s[8]++;for(;t<=255;)yc[2*t+1]=9,t++,s[9]++;for(;t<=279;)yc[2*t+1]=7,t++,s[7]++;for(;t<=287;)yc[2*t+1]=8,t++,s[8]++;for(Lc(yc,287,s),t=0;t<30;t++)vc[2*t+1]=5,vc[2*t]=Fc(t,5);Ec=new Sc(yc,pc,257,286,15),Cc=new Sc(vc,mc,0,30,15),Ic=new Sc(new Array(0),_c,0,19,7)})(),Vc=!0),t.l_desc=new Ac(t.dyn_ltree,Ec),t.d_desc=new Ac(t.dyn_dtree,Cc),t.bl_desc=new Ac(t.bl_tree,Ic),t.bi_buf=0,t.bi_valid=0,Oc(t)},_tr_stored_block:jc,_tr_flush_block:(t,e,i,n)=>{let r,s,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),Gc(t,t.l_desc),Gc(t,t.d_desc),o=(t=>{let e;for(Xc(t,t.dyn_ltree,t.l_desc.max_code),Xc(t,t.dyn_dtree,t.d_desc.max_code),Gc(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*wc[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),r=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=r&&(r=s)):r=s=i+5,i+4<=r&&-1!==e?jc(t,e,i,n):4===t.strategy||s===r?(Pc(t,2+(n?1:0),3),Uc(t,yc,vc)):(Pc(t,4+(n?1:0),3),((t,e,i,n)=>{let r;for(Pc(t,e-257,5),Pc(t,i-1,5),Pc(t,n-4,4),r=0;r<n;r++)Pc(t,t.bl_tree[2*wc[r]+1],3);Yc(t,t.dyn_ltree,e-1),Yc(t,t.dyn_dtree,i-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Uc(t,t.dyn_ltree,t.dyn_dtree)),Oc(t),n&&zc(t)},_tr_tally:(t,e,i)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=i,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(xc[i]+256+1)]++,t.dyn_dtree[2*Tc(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{Pc(t,2,3),Dc(t,256,yc),(t=>{16===t.bi_valid?(Rc(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},Wc=(t,e,i,n)=>{let r=65535&t|0,s=t>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{r=r+e[n++]|0,s=s+r|0}while(--o);r%=65521,s%=65521}return r|s<<16|0};const $c=new Uint32Array((()=>{let t,e=[];for(var i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e})());var Zc=(t,e,i,n)=>{const r=$c,s=n+i;t^=-1;for(let i=n;i<s;i++)t=t>>>8^r[255&(t^e[i])];return-1^t},Hc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Kc={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Jc,_tr_stored_block:Qc,_tr_flush_block:td,_tr_tally:ed,_tr_align:id}=qc,{Z_NO_FLUSH:nd,Z_PARTIAL_FLUSH:rd,Z_FULL_FLUSH:sd,Z_FINISH:od,Z_BLOCK:ad,Z_OK:ld,Z_STREAM_END:hd,Z_STREAM_ERROR:ud,Z_DATA_ERROR:cd,Z_BUF_ERROR:dd,Z_DEFAULT_COMPRESSION:fd,Z_FILTERED:gd,Z_HUFFMAN_ONLY:pd,Z_RLE:md,Z_FIXED:_d,Z_DEFAULT_STRATEGY:wd,Z_UNKNOWN:yd,Z_DEFLATED:vd}=Kc,bd=258,xd=262,Md=42,kd=113,Sd=666,Ed=(t,e)=>(t.msg=Hc[e],e),Cd=t=>2*t-(t>4?9:0),Id=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Ad=t=>{let e,i,n,r=t.w_size;e=t.hash_size,n=e;do{i=t.head[--n],t.head[n]=i>=r?i-r:0}while(--e);e=r,n=e;do{i=t.prev[--n],t.prev[n]=i>=r?i-r:0}while(--e)};let Td=(t,e,i)=>(e<<t.hash_shift^i)&t.hash_mask;const Rd=t=>{const e=t.state;let i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},Pd=(t,e)=>{td(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Rd(t.strm)},Dd=(t,e)=>{t.pending_buf[t.pending++]=e},Fd=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Ld=(t,e,i,n)=>{let r=t.avail_in;return r>n&&(r=n),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),i),1===t.state.wrap?t.adler=Wc(t.adler,e,r,i):2===t.state.wrap&&(t.adler=Zc(t.adler,e,r,i)),t.next_in+=r,t.total_in+=r,r)},Od=(t,e)=>{let i,n,r=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const l=t.strstart>t.w_size-xd?t.strstart-(t.w_size-xd):0,h=t.window,u=t.w_mask,c=t.prev,d=t.strstart+bd;let f=h[s+o-1],g=h[s+o];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do{if(i=e,h[i+o]===g&&h[i+o-1]===f&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do{}while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<d);if(n=bd-(d-s),s=d-bd,n>o){if(t.match_start=e,o=n,n>=a)break;f=h[s+o-1],g=h[s+o]}}}while((e=c[e&u])>l&&0!=--r);return o<=t.lookahead?o:t.lookahead},zd=t=>{const e=t.w_size;let i,n,r;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-xd)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Ad(t),n+=e),0===t.strm.avail_in)break;if(i=Ld(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=i,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=Td(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=Td(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<xd&&0!==t.strm.avail_in)},Nd=(t,e)=>{let i,n,r,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,a=t.strm.avail_in;do{if(i=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r)break;if(r=t.strm.avail_out-r,n=t.strstart-t.block_start,i>n+t.strm.avail_in&&(i=n+t.strm.avail_in),i>r&&(i=r),i<s&&(0===i&&e!==od||e===nd||i!==n+t.strm.avail_in))break;o=e===od&&i===n+t.strm.avail_in?1:0,Qc(t,0,0,o),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,Rd(t.strm),n&&(n>i&&(n=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,i-=n),i&&(Ld(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(0===o);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:e!==nd&&e!==od&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(Ld(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,s=r>t.w_size?t.w_size:r,n=t.strstart-t.block_start,(n>=s||(n||e===od)&&e!==nd&&0===t.strm.avail_in&&n<=r)&&(i=n>r?r:n,o=e===od&&0===t.strm.avail_in&&i===n?1:0,Qc(t,t.block_start,i,o),t.block_start+=i,Rd(t.strm)),o?3:1)},Bd=(t,e)=>{let i,n;for(;;){if(t.lookahead<xd){if(zd(t),t.lookahead<xd&&e===nd)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=Td(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-xd&&(t.match_length=Od(t,i)),t.match_length>=3)if(n=ed(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=Td(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Td(t,t.ins_h,t.window[t.strstart+1]);else n=ed(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Pd(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===od?(Pd(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Pd(t,!1),0===t.strm.avail_out)?1:2},Ud=(t,e)=>{let i,n,r;for(;;){if(t.lookahead<xd){if(zd(t),t.lookahead<xd&&e===nd)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=Td(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-xd&&(t.match_length=Od(t,i),t.match_length<=5&&(t.strategy===gd||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,n=ed(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=Td(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(Pd(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=ed(t,0,t.window[t.strstart-1]),n&&Pd(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ed(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===od?(Pd(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Pd(t,!1),0===t.strm.avail_out)?1:2};function Gd(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}const Xd=[new Gd(0,0,0,0,Nd),new Gd(4,4,8,4,Bd),new Gd(4,5,16,8,Bd),new Gd(4,6,32,32,Bd),new Gd(4,4,16,16,Ud),new Gd(8,16,32,32,Ud),new Gd(8,16,128,128,Ud),new Gd(8,32,128,256,Ud),new Gd(32,128,258,1024,Ud),new Gd(32,258,258,4096,Ud)];function Yd(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=vd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Id(this.dyn_ltree),Id(this.dyn_dtree),Id(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Id(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Id(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Vd=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Md&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==kd&&e.status!==Sd?1:0},jd=t=>{if(Vd(t))return Ed(t,ud);t.total_in=t.total_out=0,t.data_type=yd;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?Md:kd,t.adler=2===e.wrap?0:1,e.last_flush=-2,Jc(e),ld},qd=t=>{const e=jd(t);var i;return e===ld&&((i=t.state).window_size=2*i.w_size,Id(i.head),i.max_lazy_match=Xd[i.level].max_lazy,i.good_match=Xd[i.level].good_length,i.nice_match=Xd[i.level].nice_length,i.max_chain_length=Xd[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),e},Wd=(t,e,i,n,r,s)=>{if(!t)return ud;let o=1;if(e===fd&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),r<1||r>9||i!==vd||n<8||n>15||e<0||e>9||s<0||s>_d||8===n&&1!==o)return Ed(t,ud);8===n&&(n=9);const a=new Yd;return t.state=a,a.strm=t,a.status=Md,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=s,a.method=i,qd(t)};var $d={deflateInit:(t,e)=>Wd(t,e,vd,15,8,wd),deflateInit2:Wd,deflateReset:qd,deflateResetKeep:jd,deflateSetHeader:(t,e)=>Vd(t)||2!==t.state.wrap?ud:(t.state.gzhead=e,ld),deflate:(t,e)=>{if(Vd(t)||e>ad||e<0)return t?Ed(t,ud):ud;const i=t.state;if(!t.output||0!==t.avail_in&&!t.input||i.status===Sd&&e!==od)return Ed(t,0===t.avail_out?dd:ud);const n=i.last_flush;if(i.last_flush=e,0!==i.pending){if(Rd(t),0===t.avail_out)return i.last_flush=-1,ld}else if(0===t.avail_in&&Cd(e)<=Cd(n)&&e!==od)return Ed(t,dd);if(i.status===Sd&&0!==t.avail_in)return Ed(t,dd);if(i.status===Md&&0===i.wrap&&(i.status=kd),i.status===Md){let e=vd+(i.w_bits-8<<4)<<8,n=-1;if(n=i.strategy>=pd||i.level<2?0:i.level<6?1:6===i.level?2:3,e|=n<<6,0!==i.strstart&&(e|=32),e+=31-e%31,Fd(i,e),0!==i.strstart&&(Fd(i,t.adler>>>16),Fd(i,65535&t.adler)),t.adler=1,i.status=kd,Rd(t),0!==i.pending)return i.last_flush=-1,ld}if(57===i.status)if(t.adler=0,Dd(i,31),Dd(i,139),Dd(i,8),i.gzhead)Dd(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Dd(i,255&i.gzhead.time),Dd(i,i.gzhead.time>>8&255),Dd(i,i.gzhead.time>>16&255),Dd(i,i.gzhead.time>>24&255),Dd(i,9===i.level?2:i.strategy>=pd||i.level<2?4:0),Dd(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Dd(i,255&i.gzhead.extra.length),Dd(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Zc(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Dd(i,0),Dd(i,0),Dd(i,0),Dd(i,0),Dd(i,0),Dd(i,9===i.level?2:i.strategy>=pd||i.level<2?4:0),Dd(i,3),i.status=kd,Rd(t),0!==i.pending)return i.last_flush=-1,ld;if(69===i.status){if(i.gzhead.extra){let e=i.pending,n=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+n>i.pending_buf_size;){let r=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+r),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>e&&(t.adler=Zc(t.adler,i.pending_buf,i.pending-e,e)),i.gzindex+=r,Rd(t),0!==i.pending)return i.last_flush=-1,ld;e=0,n-=r}let r=new Uint8Array(i.gzhead.extra);i.pending_buf.set(r.subarray(i.gzindex,i.gzindex+n),i.pending),i.pending+=n,i.gzhead.hcrc&&i.pending>e&&(t.adler=Zc(t.adler,i.pending_buf,i.pending-e,e)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let e,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(t.adler=Zc(t.adler,i.pending_buf,i.pending-n,n)),Rd(t),0!==i.pending)return i.last_flush=-1,ld;n=0}e=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Dd(i,e)}while(0!==e);i.gzhead.hcrc&&i.pending>n&&(t.adler=Zc(t.adler,i.pending_buf,i.pending-n,n)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let e,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(t.adler=Zc(t.adler,i.pending_buf,i.pending-n,n)),Rd(t),0!==i.pending)return i.last_flush=-1,ld;n=0}e=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Dd(i,e)}while(0!==e);i.gzhead.hcrc&&i.pending>n&&(t.adler=Zc(t.adler,i.pending_buf,i.pending-n,n))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(Rd(t),0!==i.pending))return i.last_flush=-1,ld;Dd(i,255&t.adler),Dd(i,t.adler>>8&255),t.adler=0}if(i.status=kd,Rd(t),0!==i.pending)return i.last_flush=-1,ld}if(0!==t.avail_in||0!==i.lookahead||e!==nd&&i.status!==Sd){let n=0===i.level?Nd(i,e):i.strategy===pd?((t,e)=>{let i;for(;;){if(0===t.lookahead&&(zd(t),0===t.lookahead)){if(e===nd)return 1;break}if(t.match_length=0,i=ed(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(Pd(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===od?(Pd(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Pd(t,!1),0===t.strm.avail_out)?1:2})(i,e):i.strategy===md?((t,e)=>{let i,n,r,s;const o=t.window;for(;;){if(t.lookahead<=bd){if(zd(t),t.lookahead<=bd&&e===nd)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=t.strstart-1,n=o[r],n===o[++r]&&n===o[++r]&&n===o[++r])){s=t.strstart+bd;do{}while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<s);t.match_length=bd-(s-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=ed(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=ed(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(Pd(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===od?(Pd(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Pd(t,!1),0===t.strm.avail_out)?1:2})(i,e):Xd[i.level].func(i,e);if(3!==n&&4!==n||(i.status=Sd),1===n||3===n)return 0===t.avail_out&&(i.last_flush=-1),ld;if(2===n&&(e===rd?id(i):e!==ad&&(Qc(i,0,0,!1),e===sd&&(Id(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Rd(t),0===t.avail_out))return i.last_flush=-1,ld}return e!==od?ld:i.wrap<=0?hd:(2===i.wrap?(Dd(i,255&t.adler),Dd(i,t.adler>>8&255),Dd(i,t.adler>>16&255),Dd(i,t.adler>>24&255),Dd(i,255&t.total_in),Dd(i,t.total_in>>8&255),Dd(i,t.total_in>>16&255),Dd(i,t.total_in>>24&255)):(Fd(i,t.adler>>>16),Fd(i,65535&t.adler)),Rd(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?ld:hd)},deflateEnd:t=>{if(Vd(t))return ud;const e=t.state.status;return t.state=null,e===kd?Ed(t,cd):ld},deflateSetDictionary:(t,e)=>{let i=e.length;if(Vd(t))return ud;const n=t.state,r=n.wrap;if(2===r||1===r&&n.status!==Md||n.lookahead)return ud;if(1===r&&(t.adler=Wc(t.adler,e,i,0)),n.wrap=0,i>=n.w_size){0===r&&(Id(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(i-n.w_size,i),0),e=t,i=n.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=i,t.next_in=0,t.input=e,zd(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=Td(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,zd(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,n.wrap=r,ld},deflateInfo:"pako deflate (from Nodeca project)"};const Zd=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Hd={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const e in i)Zd(i,e)&&(t[e]=i[e])}}return t},flattenChunks:t=>{let e=0;for(let i=0,n=t.length;i<n;i++)e+=t[i].length;const i=new Uint8Array(e);for(let e=0,n=0,r=t.length;e<r;e++){let r=t[e];i.set(r,n),n+=r.length}return i}};let Kd=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Kd=!1}const Jd=new Uint8Array(256);for(let t=0;t<256;t++)Jd[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Jd[254]=Jd[254]=1;var Qd={string2buf:t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,i,n,r,s,o=t.length,a=0;for(r=0;r<o;r++)i=t.charCodeAt(r),55296==(64512&i)&&r+1<o&&(n=t.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),a+=i<128?1:i<2048?2:i<65536?3:4;for(e=new Uint8Array(a),s=0,r=0;s<a;r++)i=t.charCodeAt(r),55296==(64512&i)&&r+1<o&&(n=t.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},buf2string:(t,e)=>{const i=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let n,r;const s=new Array(2*i);for(r=0,n=0;n<i;){let e=t[n++];if(e<128){s[r++]=e;continue}let o=Jd[e];if(o>4)s[r++]=65533,n+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&n<i;)e=e<<6|63&t[n++],o--;o>1?s[r++]=65533:e<65536?s[r++]=e:(e-=65536,s[r++]=55296|e>>10&1023,s[r++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Kd)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let i="";for(let n=0;n<e;n++)i+=String.fromCharCode(t[n]);return i})(s,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let i=e-1;for(;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+Jd[t[i]]>e?i:e}},tf=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ef=Object.prototype.toString,{Z_NO_FLUSH:nf,Z_SYNC_FLUSH:rf,Z_FULL_FLUSH:sf,Z_FINISH:of,Z_OK:af,Z_STREAM_END:lf,Z_DEFAULT_COMPRESSION:hf,Z_DEFAULT_STRATEGY:uf,Z_DEFLATED:cf}=Kc;function df(t){this.options=Hd.assign({level:hf,method:cf,chunkSize:16384,windowBits:15,memLevel:8,strategy:uf},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tf,this.strm.avail_out=0;let i=$d.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==af)throw new Error(Hc[i]);if(e.header&&$d.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Qd.string2buf(e.dictionary):"[object ArrayBuffer]"===ef.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=$d.deflateSetDictionary(this.strm,t),i!==af)throw new Error(Hc[i]);this._dict_set=!0}}function ff(t,e){const i=new df(e);if(i.push(t,!0),i.err)throw i.msg||Hc[i.err];return i.result}df.prototype.push=function(t,e){const i=this.strm,n=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?of:nf,"string"==typeof t?i.input=Qd.string2buf(t):"[object ArrayBuffer]"===ef.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(s===rf||s===sf)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=$d.deflate(i,s),r===lf)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=$d.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===af;if(0!==i.avail_out){if(s>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},df.prototype.onData=function(t){this.chunks.push(t)},df.prototype.onEnd=function(t){t===af&&(this.result=Hd.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var gf={Deflate:df,deflate:ff,deflateRaw:function(t,e){return(e=e||{}).raw=!0,ff(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,ff(t,e)},constants:Kc};const pf=16209;var mf=function(t,e){let i,n,r,s,o,a,l,h,u,c,d,f,g,p,m,_,w,y,v,b,x,M,k,S;const E=t.state;i=t.next_in,k=t.input,n=i+(t.avail_in-5),r=t.next_out,S=t.output,s=r-(e-t.avail_out),o=r+(t.avail_out-257),a=E.dmax,l=E.wsize,h=E.whave,u=E.wnext,c=E.window,d=E.hold,f=E.bits,g=E.lencode,p=E.distcode,m=(1<<E.lenbits)-1,_=(1<<E.distbits)-1;t:do{f<15&&(d+=k[i++]<<f,f+=8,d+=k[i++]<<f,f+=8),w=g[d&m];e:for(;;){if(y=w>>>24,d>>>=y,f-=y,y=w>>>16&255,0===y)S[r++]=65535&w;else{if(!(16&y)){if(0==(64&y)){w=g[(65535&w)+(d&(1<<y)-1)];continue e}if(32&y){E.mode=16191;break t}t.msg="invalid literal/length code",E.mode=pf;break t}v=65535&w,y&=15,y&&(f<y&&(d+=k[i++]<<f,f+=8),v+=d&(1<<y)-1,d>>>=y,f-=y),f<15&&(d+=k[i++]<<f,f+=8,d+=k[i++]<<f,f+=8),w=p[d&_];i:for(;;){if(y=w>>>24,d>>>=y,f-=y,y=w>>>16&255,!(16&y)){if(0==(64&y)){w=p[(65535&w)+(d&(1<<y)-1)];continue i}t.msg="invalid distance code",E.mode=pf;break t}if(b=65535&w,y&=15,f<y&&(d+=k[i++]<<f,f+=8,f<y&&(d+=k[i++]<<f,f+=8)),b+=d&(1<<y)-1,b>a){t.msg="invalid distance too far back",E.mode=pf;break t}if(d>>>=y,f-=y,y=r-s,b>y){if(y=b-y,y>h&&E.sane){t.msg="invalid distance too far back",E.mode=pf;break t}if(x=0,M=c,0===u){if(x+=l-y,y<v){v-=y;do{S[r++]=c[x++]}while(--y);x=r-b,M=S}}else if(u<y){if(x+=l+u-y,y-=u,y<v){v-=y;do{S[r++]=c[x++]}while(--y);if(x=0,u<v){y=u,v-=y;do{S[r++]=c[x++]}while(--y);x=r-b,M=S}}}else if(x+=u-y,y<v){v-=y;do{S[r++]=c[x++]}while(--y);x=r-b,M=S}for(;v>2;)S[r++]=M[x++],S[r++]=M[x++],S[r++]=M[x++],v-=3;v&&(S[r++]=M[x++],v>1&&(S[r++]=M[x++]))}else{x=r-b;do{S[r++]=S[x++],S[r++]=S[x++],S[r++]=S[x++],v-=3}while(v>2);v&&(S[r++]=S[x++],v>1&&(S[r++]=S[x++]))}break}}break}}while(i<n&&r<o);v=f>>3,i-=v,f-=v<<3,d&=(1<<f)-1,t.next_in=i,t.next_out=r,t.avail_in=i<n?n-i+5:5-(i-n),t.avail_out=r<o?o-r+257:257-(r-o),E.hold=d,E.bits=f};const _f=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),wf=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yf=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),vf=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var bf=(t,e,i,n,r,s,o,a)=>{const l=a.bits;let h,u,c,d,f,g,p=0,m=0,_=0,w=0,y=0,v=0,b=0,x=0,M=0,k=0,S=null;const E=new Uint16Array(16),C=new Uint16Array(16);let I,A,T,R=null;for(p=0;p<=15;p++)E[p]=0;for(m=0;m<n;m++)E[e[i+m]]++;for(y=l,w=15;w>=1&&0===E[w];w--);if(y>w&&(y=w),0===w)return r[s++]=20971520,r[s++]=20971520,a.bits=1,0;for(_=1;_<w&&0===E[_];_++);for(y<_&&(y=_),x=1,p=1;p<=15;p++)if(x<<=1,x-=E[p],x<0)return-1;if(x>0&&(0===t||1!==w))return-1;for(C[1]=0,p=1;p<15;p++)C[p+1]=C[p]+E[p];for(m=0;m<n;m++)0!==e[i+m]&&(o[C[e[i+m]]++]=m);if(0===t?(S=R=o,g=20):1===t?(S=_f,R=wf,g=257):(S=yf,R=vf,g=0),k=0,m=0,p=_,f=s,v=y,b=0,c=-1,M=1<<y,d=M-1,1===t&&M>852||2===t&&M>592)return 1;for(;;){I=p-b,o[m]+1<g?(A=0,T=o[m]):o[m]>=g?(A=R[o[m]-g],T=S[o[m]-g]):(A=96,T=0),h=1<<p-b,u=1<<v,_=u;do{u-=h,r[f+(k>>b)+u]=I<<24|A<<16|T|0}while(0!==u);for(h=1<<p-1;k&h;)h>>=1;if(0!==h?(k&=h-1,k+=h):k=0,m++,0==--E[p]){if(p===w)break;p=e[i+o[m]]}if(p>y&&(k&d)!==c){for(0===b&&(b=y),f+=_,v=p-b,x=1<<v;v+b<w&&(x-=E[v+b],!(x<=0));)v++,x<<=1;if(M+=1<<v,1===t&&M>852||2===t&&M>592)return 1;c=k&d,r[c]=y<<24|v<<16|f-s|0}}return 0!==k&&(r[f+k]=p-b<<24|64<<16|0),a.bits=y,0};const{Z_FINISH:xf,Z_BLOCK:Mf,Z_TREES:kf,Z_OK:Sf,Z_STREAM_END:Ef,Z_NEED_DICT:Cf,Z_STREAM_ERROR:If,Z_DATA_ERROR:Af,Z_MEM_ERROR:Tf,Z_BUF_ERROR:Rf,Z_DEFLATED:Pf}=Kc,Df=16180,Ff=16190,Lf=16191,Of=16192,zf=16194,Nf=16199,Bf=16200,Uf=16206,Gf=16209,Xf=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Yf(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Vf=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Df||e.mode>16211?1:0},jf=t=>{if(Vf(t))return If;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Df,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Sf},qf=t=>{if(Vf(t))return If;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,jf(t)},Wf=(t,e)=>{let i;if(Vf(t))return If;const n=t.state;return e<0?(i=0,e=-e):(i=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?If:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,qf(t))},$f=(t,e)=>{if(!t)return If;const i=new Yf;t.state=i,i.strm=t,i.window=null,i.mode=Df;const n=Wf(t,e);return n!==Sf&&(t.state=null),n};let Zf,Hf,Kf=!0;const Jf=t=>{if(Kf){Zf=new Int32Array(512),Hf=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(bf(1,t.lens,0,288,Zf,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;bf(2,t.lens,0,32,Hf,0,t.work,{bits:5}),Kf=!1}t.lencode=Zf,t.lenbits=9,t.distcode=Hf,t.distbits=5},Qf=(t,e,i,n)=>{let r;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>n&&(r=n),s.window.set(e.subarray(i-n,i-n+r),s.wnext),(n-=r)?(s.window.set(e.subarray(i-n,i),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var tg={inflateReset:qf,inflateReset2:Wf,inflateResetKeep:jf,inflateInit:t=>$f(t,15),inflateInit2:$f,inflate:(t,e)=>{let i,n,r,s,o,a,l,h,u,c,d,f,g,p,m,_,w,y,v,b,x,M,k=0;const S=new Uint8Array(4);let E,C;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Vf(t)||!t.output||!t.input&&0!==t.avail_in)return If;i=t.state,i.mode===Lf&&(i.mode=Of),o=t.next_out,r=t.output,l=t.avail_out,s=t.next_in,n=t.input,a=t.avail_in,h=i.hold,u=i.bits,c=a,d=l,M=Sf;t:for(;;)switch(i.mode){case Df:if(0===i.wrap){i.mode=Of;break}for(;u<16;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(2&i.wrap&&35615===h){0===i.wbits&&(i.wbits=15),i.check=0,S[0]=255&h,S[1]=h>>>8&255,i.check=Zc(i.check,S,2,0),h=0,u=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",i.mode=Gf;break}if((15&h)!==Pf){t.msg="unknown compression method",i.mode=Gf;break}if(h>>>=4,u-=4,x=8+(15&h),0===i.wbits&&(i.wbits=x),x>15||x>i.wbits){t.msg="invalid window size",i.mode=Gf;break}i.dmax=1<<i.wbits,i.flags=0,t.adler=i.check=1,i.mode=512&h?16189:Lf,h=0,u=0;break;case 16181:for(;u<16;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(i.flags=h,(255&i.flags)!==Pf){t.msg="unknown compression method",i.mode=Gf;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=Gf;break}i.head&&(i.head.text=h>>8&1),512&i.flags&&4&i.wrap&&(S[0]=255&h,S[1]=h>>>8&255,i.check=Zc(i.check,S,2,0)),h=0,u=0,i.mode=16182;case 16182:for(;u<32;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}i.head&&(i.head.time=h),512&i.flags&&4&i.wrap&&(S[0]=255&h,S[1]=h>>>8&255,S[2]=h>>>16&255,S[3]=h>>>24&255,i.check=Zc(i.check,S,4,0)),h=0,u=0,i.mode=16183;case 16183:for(;u<16;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&i.flags&&4&i.wrap&&(S[0]=255&h,S[1]=h>>>8&255,i.check=Zc(i.check,S,2,0)),h=0,u=0,i.mode=16184;case 16184:if(1024&i.flags){for(;u<16;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}i.length=h,i.head&&(i.head.extra_len=h),512&i.flags&&4&i.wrap&&(S[0]=255&h,S[1]=h>>>8&255,i.check=Zc(i.check,S,2,0)),h=0,u=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(f=i.length,f>a&&(f=a),f&&(i.head&&(x=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(s,s+f),x)),512&i.flags&&4&i.wrap&&(i.check=Zc(i.check,n,f,s)),a-=f,s+=f,i.length-=f),i.length))break t;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===a)break t;f=0;do{x=n[s+f++],i.head&&x&&i.length<65536&&(i.head.name+=String.fromCharCode(x))}while(x&&f<a);if(512&i.flags&&4&i.wrap&&(i.check=Zc(i.check,n,f,s)),a-=f,s+=f,x)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===a)break t;f=0;do{x=n[s+f++],i.head&&x&&i.length<65536&&(i.head.comment+=String.fromCharCode(x))}while(x&&f<a);if(512&i.flags&&4&i.wrap&&(i.check=Zc(i.check,n,f,s)),a-=f,s+=f,x)break t}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;u<16;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(4&i.wrap&&h!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Gf;break}h=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=Lf;break;case 16189:for(;u<32;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}t.adler=i.check=Xf(h),h=0,u=0,i.mode=Ff;case Ff:if(0===i.havedict)return t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,i.hold=h,i.bits=u,Cf;t.adler=i.check=1,i.mode=Lf;case Lf:if(e===Mf||e===kf)break t;case Of:if(i.last){h>>>=7&u,u-=7&u,i.mode=Uf;break}for(;u<3;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}switch(i.last=1&h,h>>>=1,u-=1,3&h){case 0:i.mode=16193;break;case 1:if(Jf(i),i.mode=Nf,e===kf){h>>>=2,u-=2;break t}break;case 2:i.mode=16196;break;case 3:t.msg="invalid block type",i.mode=Gf}h>>>=2,u-=2;break;case 16193:for(h>>>=7&u,u-=7&u;u<32;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Gf;break}if(i.length=65535&h,h=0,u=0,i.mode=zf,e===kf)break t;case zf:i.mode=16195;case 16195:if(f=i.length,f){if(f>a&&(f=a),f>l&&(f=l),0===f)break t;r.set(n.subarray(s,s+f),o),a-=f,s+=f,l-=f,o+=f,i.length-=f;break}i.mode=Lf;break;case 16196:for(;u<14;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(i.nlen=257+(31&h),h>>>=5,u-=5,i.ndist=1+(31&h),h>>>=5,u-=5,i.ncode=4+(15&h),h>>>=4,u-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Gf;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;u<3;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}i.lens[I[i.have++]]=7&h,h>>>=3,u-=3}for(;i.have<19;)i.lens[I[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,E={bits:i.lenbits},M=bf(0,i.lens,0,19,i.lencode,0,i.work,E),i.lenbits=E.bits,M){t.msg="invalid code lengths set",i.mode=Gf;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;k=i.lencode[h&(1<<i.lenbits)-1],m=k>>>24,_=k>>>16&255,w=65535&k,!(m<=u);){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(w<16)h>>>=m,u-=m,i.lens[i.have++]=w;else{if(16===w){for(C=m+2;u<C;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(h>>>=m,u-=m,0===i.have){t.msg="invalid bit length repeat",i.mode=Gf;break}x=i.lens[i.have-1],f=3+(3&h),h>>>=2,u-=2}else if(17===w){for(C=m+3;u<C;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}h>>>=m,u-=m,x=0,f=3+(7&h),h>>>=3,u-=3}else{for(C=m+7;u<C;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}h>>>=m,u-=m,x=0,f=11+(127&h),h>>>=7,u-=7}if(i.have+f>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Gf;break}for(;f--;)i.lens[i.have++]=x}}if(i.mode===Gf)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=Gf;break}if(i.lenbits=9,E={bits:i.lenbits},M=bf(1,i.lens,0,i.nlen,i.lencode,0,i.work,E),i.lenbits=E.bits,M){t.msg="invalid literal/lengths set",i.mode=Gf;break}if(i.distbits=6,i.distcode=i.distdyn,E={bits:i.distbits},M=bf(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,E),i.distbits=E.bits,M){t.msg="invalid distances set",i.mode=Gf;break}if(i.mode=Nf,e===kf)break t;case Nf:i.mode=Bf;case Bf:if(a>=6&&l>=258){t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,i.hold=h,i.bits=u,mf(t,d),o=t.next_out,r=t.output,l=t.avail_out,s=t.next_in,n=t.input,a=t.avail_in,h=i.hold,u=i.bits,i.mode===Lf&&(i.back=-1);break}for(i.back=0;k=i.lencode[h&(1<<i.lenbits)-1],m=k>>>24,_=k>>>16&255,w=65535&k,!(m<=u);){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(_&&0==(240&_)){for(y=m,v=_,b=w;k=i.lencode[b+((h&(1<<y+v)-1)>>y)],m=k>>>24,_=k>>>16&255,w=65535&k,!(y+m<=u);){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}h>>>=y,u-=y,i.back+=y}if(h>>>=m,u-=m,i.back+=m,i.length=w,0===_){i.mode=16205;break}if(32&_){i.back=-1,i.mode=Lf;break}if(64&_){t.msg="invalid literal/length code",i.mode=Gf;break}i.extra=15&_,i.mode=16201;case 16201:if(i.extra){for(C=i.extra;u<C;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;k=i.distcode[h&(1<<i.distbits)-1],m=k>>>24,_=k>>>16&255,w=65535&k,!(m<=u);){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(0==(240&_)){for(y=m,v=_,b=w;k=i.distcode[b+((h&(1<<y+v)-1)>>y)],m=k>>>24,_=k>>>16&255,w=65535&k,!(y+m<=u);){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}h>>>=y,u-=y,i.back+=y}if(h>>>=m,u-=m,i.back+=m,64&_){t.msg="invalid distance code",i.mode=Gf;break}i.offset=w,i.extra=15&_,i.mode=16203;case 16203:if(i.extra){for(C=i.extra;u<C;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Gf;break}i.mode=16204;case 16204:if(0===l)break t;if(f=d-l,i.offset>f){if(f=i.offset-f,f>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Gf;break}f>i.wnext?(f-=i.wnext,g=i.wsize-f):g=i.wnext-f,f>i.length&&(f=i.length),p=i.window}else p=r,g=o-i.offset,f=i.length;f>l&&(f=l),l-=f,i.length-=f;do{r[o++]=p[g++]}while(--f);0===i.length&&(i.mode=Bf);break;case 16205:if(0===l)break t;r[o++]=i.length,l--,i.mode=Bf;break;case Uf:if(i.wrap){for(;u<32;){if(0===a)break t;a--,h|=n[s++]<<u,u+=8}if(d-=l,t.total_out+=d,i.total+=d,4&i.wrap&&d&&(t.adler=i.check=i.flags?Zc(i.check,r,d,o-d):Wc(i.check,r,d,o-d)),d=l,4&i.wrap&&(i.flags?h:Xf(h))!==i.check){t.msg="incorrect data check",i.mode=Gf;break}h=0,u=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;u<32;){if(0===a)break t;a--,h+=n[s++]<<u,u+=8}if(4&i.wrap&&h!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Gf;break}h=0,u=0}i.mode=16208;case 16208:M=Ef;break t;case Gf:M=Af;break t;case 16210:return Tf;default:return If}return t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,i.hold=h,i.bits=u,(i.wsize||d!==t.avail_out&&i.mode<Gf&&(i.mode<Uf||e!==xf))&&Qf(t,t.output,t.next_out,d-t.avail_out),c-=t.avail_in,d-=t.avail_out,t.total_in+=c,t.total_out+=d,i.total+=d,4&i.wrap&&d&&(t.adler=i.check=i.flags?Zc(i.check,r,d,t.next_out-d):Wc(i.check,r,d,t.next_out-d)),t.data_type=i.bits+(i.last?64:0)+(i.mode===Lf?128:0)+(i.mode===Nf||i.mode===zf?256:0),(0===c&&0===d||e===xf)&&M===Sf&&(M=Rf),M},inflateEnd:t=>{if(Vf(t))return If;let e=t.state;return e.window&&(e.window=null),t.state=null,Sf},inflateGetHeader:(t,e)=>{if(Vf(t))return If;const i=t.state;return 0==(2&i.wrap)?If:(i.head=e,e.done=!1,Sf)},inflateSetDictionary:(t,e)=>{const i=e.length;let n,r,s;return Vf(t)?If:(n=t.state,0!==n.wrap&&n.mode!==Ff?If:n.mode===Ff&&(r=1,r=Wc(r,e,i,0),r!==n.check)?Af:(s=Qf(t,e,i,i),s?(n.mode=16210,Tf):(n.havedict=1,Sf)))},inflateInfo:"pako inflate (from Nodeca project)"},eg=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ig=Object.prototype.toString,{Z_NO_FLUSH:ng,Z_FINISH:rg,Z_OK:sg,Z_STREAM_END:og,Z_NEED_DICT:ag,Z_STREAM_ERROR:lg,Z_DATA_ERROR:hg,Z_MEM_ERROR:ug}=Kc;function cg(t){this.options=Hd.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tf,this.strm.avail_out=0;let i=tg.inflateInit2(this.strm,e.windowBits);if(i!==sg)throw new Error(Hc[i]);if(this.header=new eg,tg.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Qd.string2buf(e.dictionary):"[object ArrayBuffer]"===ig.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=tg.inflateSetDictionary(this.strm,e.dictionary),i!==sg)))throw new Error(Hc[i])}function dg(t,e){const i=new cg(e);if(i.push(t),i.err)throw i.msg||Hc[i.err];return i.result}cg.prototype.push=function(t,e){const i=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=e===~~e?e:!0===e?rg:ng,"[object ArrayBuffer]"===ig.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),s=tg.inflate(i,o),s===ag&&r&&(s=tg.inflateSetDictionary(i,r),s===sg?s=tg.inflate(i,o):s===hg&&(s=ag));i.avail_in>0&&s===og&&i.state.wrap>0&&0!==t[i.next_in];)tg.inflateReset(i),s=tg.inflate(i,o);switch(s){case lg:case hg:case ag:case ug:return this.onEnd(s),this.ended=!0,!1}if(a=i.avail_out,i.next_out&&(0===i.avail_out||s===og))if("string"===this.options.to){let t=Qd.utf8border(i.output,i.next_out),e=i.next_out-t,r=Qd.buf2string(i.output,t);i.next_out=e,i.avail_out=n-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(s!==sg||0!==a){if(s===og)return s=tg.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},cg.prototype.onData=function(t){this.chunks.push(t)},cg.prototype.onEnd=function(t){t===sg&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Hd.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var fg={Inflate:cg,inflate:dg,inflateRaw:function(t,e){return(e=e||{}).raw=!0,dg(t,e)},ungzip:dg,constants:Kc};const{Deflate:gg,deflate:pg,deflateRaw:mg,gzip:_g}=gf,{Inflate:wg,inflate:yg,inflateRaw:vg,ungzip:bg}=fg;var xg=pg,Mg=wg,kg=yg;const Sg=[137,80,78,71,13,10,26,10],Eg=[];for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;Eg[t]=e}const Cg=4294967295;function Ig(t,e){return(function(t,e,i){let n=4294967295;for(let t=0;t<i;t++)n=Eg[255&(n^e[t])]^n>>>8;return n}(0,t,e)^Cg)>>>0}var Ag,Tg,Rg,Pg;!function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"}(Ag||(Ag={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"}(Tg||(Tg={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"}(Rg||(Rg={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"}(Pg||(Pg={}));const Dg=new Uint8Array(0),Fg=new Uint16Array([255]),Lg=255===new Uint8Array(Fg.buffer)[0];class Og extends fc.IOBuffer{constructor(t,e={}){super(t);const{checkCrc:i=!1}=e;this._checkCrc=i,this._inflator=new Mg,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=Tg.UNKNOWN,this._filterMethod=Rg.UNKNOWN,this._interlaceMethod=Pg.UNKNOWN,this._colorType=Ag.UNKNOWN,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<Sg.length;t++)if(this.readUint8()!==Sg[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${Sg[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),i=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-i!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);if(this._checkCrc){const i=this.readUint32(),n=t+4,r=Ig(new Uint8Array(this.buffer,this.byteOffset+this.offset-n-4,n),n);if(r!==i)throw new Error(`CRC mismatch for chunk ${e}. Expected ${i}, found ${r}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=function(t){if(1!==t&&2!==t&&4!==t&&8!==t&&16!==t)throw new Error(`invalid bit depth: ${t}`);return t}(this.readUint8());const e=this.readUint8();let i;switch(this._colorType=e,e){case Ag.GREYSCALE:i=1;break;case Ag.TRUECOLOUR:i=3;break;case Ag.INDEXED_COLOUR:i=1;break;case Ag.GREYSCALE_ALPHA:i=2;break;case Ag.TRUECOLOUR_ALPHA:i=4;break;default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==Tg.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!=0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const e=t/3;this._hasPalette=!0;const i=[];this._palette=i;for(let t=0;t<e;t++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){switch(this._colorType){case Ag.GREYSCALE:case Ag.TRUECOLOUR:if(t%2!=0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${t}`);if(t/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${t/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let e=0;e<t/2;e++)this._transparency[e]=this.readUint16();break;case Ag.INDEXED_COLOUR:{if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const t=this.readByte();this._palette[e].push(t)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(t){let e,i="";for(;"\0"!==(e=this.readChar());)i+=e;const n=this.readUint8();if(n!==Tg.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${n}`);const r=this.readBytes(t-i.length-2);this._png.iccEmbeddedProfile={name:i,profile:kg(r)}}decodetEXt(t){let e,i="";for(;"\0"!==(e=this.readChar());)i+=e;this._png.text[i]=this.readChars(t-i.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),i=this.readByte();this._png.resolution={x:t,y:e,unit:i}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==Rg.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod!==Pg.NO_INTERLACE)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this.decodeInterlaceNull(t)}decodeInterlaceNull(t){const e=this._png.height,i=this._png.channels*this._png.depth/8,n=this._png.width*i,r=new Uint8Array(this._png.height*n);let s,o,a=Dg,l=0;for(let h=0;h<e;h++){switch(s=t.subarray(l+1,l+1+n),o=r.subarray(h*n,(h+1)*n),t[l]){case 0:zg(s,o,n);break;case 1:Ng(s,o,n,i);break;case 2:Bg(s,o,a,n);break;case 3:Ug(s,o,a,n,i);break;case 4:Gg(s,o,a,n,i);break;default:throw new Error(`Unsupported filter: ${t[l]}`)}a=o,l+=n+1}if(this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency),16===this._png.depth){const t=new Uint16Array(r.buffer);if(Lg)for(let e=0;e<t.length;e++)t[e]=(255&(h=t[e]))<<8|h>>8&255;this._png.data=t}else this._png.data=r;var h}}function zg(t,e,i){for(let n=0;n<i;n++)e[n]=t[n]}function Ng(t,e,i,n){let r=0;for(;r<n;r++)e[r]=t[r];for(;r<i;r++)e[r]=t[r]+e[r-n]&255}function Bg(t,e,i,n){let r=0;if(0===i.length)for(;r<n;r++)e[r]=t[r];else for(;r<n;r++)e[r]=t[r]+i[r]&255}function Ug(t,e,i,n,r){let s=0;if(0===i.length){for(;s<r;s++)e[s]=t[s];for(;s<n;s++)e[s]=t[s]+(e[s-r]>>1)&255}else{for(;s<r;s++)e[s]=t[s]+(i[s]>>1)&255;for(;s<n;s++)e[s]=t[s]+(e[s-r]+i[s]>>1)&255}}function Gg(t,e,i,n,r){let s=0;if(0===i.length){for(;s<r;s++)e[s]=t[s];for(;s<n;s++)e[s]=t[s]+e[s-r]&255}else{for(;s<r;s++)e[s]=t[s]+i[s]&255;for(;s<n;s++)e[s]=t[s]+Xg(e[s-r],i[s],i[s-r])&255}}function Xg(t,e,i){const n=t+e-i,r=Math.abs(n-t),s=Math.abs(n-e),o=Math.abs(n-i);return r<=s&&r<=o?t:s<=o?e:i}const Yg={level:3};class Vg extends fc.IOBuffer{constructor(t,e={}){super(),this._colorType=Ag.UNKNOWN,this._zlibOptions={...Yg,...e.zlib},this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(Sg)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(Tg.DEFLATE),this.writeByte(Rg.ADAPTIVE),this.writeByte(Pg.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:e,channels:i,depth:n,data:r}=this._png,s=i*t,o=(new fc.IOBuffer).setBigEndian();let a=0;for(let t=0;t<e;t++)if(o.writeByte(0),8===n)a=qg(r,o,s,a);else{if(16!==n)throw new Error("unreachable");a=Wg(r,o,s,a)}const l=o.toArray(),h=xg(l,this._zlibOptions);this.encodeIDAT(h)}_checkData(t){const{colorType:e,channels:i,depth:n}=function(t){const{channels:e=4,depth:i=8}=t;if(4!==e&&3!==e&&2!==e&&1!==e)throw new RangeError(`unsupported number of channels: ${e}`);if(8!==i&&16!==i)throw new RangeError(`unsupported bit depth: ${i}`);const n={channels:e,depth:i,colorType:Ag.UNKNOWN};switch(e){case 4:n.colorType=Ag.TRUECOLOUR_ALPHA;break;case 3:n.colorType=Ag.TRUECOLOUR;break;case 1:n.colorType=Ag.GREYSCALE;break;case 2:n.colorType=Ag.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}(t),r={width:jg(t.width,"width"),height:jg(t.height,"height"),channels:i,data:t.data,depth:n,text:{}};this._colorType=e;const s=r.width*r.height*i;if(r.data.length!==s)throw new RangeError(`wrong data size. Found ${r.data.length}, expected ${s}`);return r}writeCrc(t){this.writeUint32(Ig(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function jg(t,e){if(Number.isInteger(t)&&t>0)return t;throw new TypeError(`${e} must be a positive integer`)}function qg(t,e,i,n){for(let r=0;r<i;r++)e.writeByte(t[n++]);return n}function Wg(t,e,i,n){for(let r=0;r<i;r++)e.writeUint16(t[n++]);return n}var $g;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"}($g||($g={}));var Zg=__webpack_require__(7870);let Hg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Kg=new Uint8Array(256);for(let t=0;t<Hg.length;t++)Kg[Hg.charCodeAt(t)]=t;function Jg(t,e){return`data:${e};base64,${function(t){let e,i=t.length,n="";for(e=0;e<i;e+=3)n+=Hg[t[e]>>2],n+=Hg[(3&t[e])<<4|t[e+1]>>4],n+=Hg[(15&t[e+1])<<2|t[e+2]>>6],n+=Hg[63&t[e+2]];return i%3==2?n=`${n.substring(0,n.length-1)}=`:i%3==1&&(n=`${n.substring(0,n.length-2)}==`),n}(t)}`}const Qg=self.ImageData,tp=self.Image;function ep(t,e){let i=self.document.createElement("canvas");return i.width=t,i.height=e,i}function ip(t,e={}){const i={width:t.width,height:t.height,data:t.getRGBAData()};return(0,Zg.encode)(i,e.quality).data}function np(t,e){const i={width:t.width,height:t.height,channels:t.channels,depth:t.bitDepth,data:t.data};return 1!==i.depth&&32!==i.depth||(i.depth=8,i.channels=4,i.data=t.getRGBAData()),function(t,e){return new Vg(t,e).encode()}(i,e)}const rp={save(t,e={}){const{useCanvas:i=!1,encoder:n}=e;let{format:r}=e;if(!r){const e=/\.(?<format>[a-zA-Z]+)$/.exec(t);e&&(r=e.groups.format.toLowerCase())}if(!r)throw new Error("file format not provided");return new Promise(((t,e)=>{let s,o;switch(r.toLowerCase()){case"png":i?s=this.getCanvas().pngStream():o=np(this,n);break;case"jpg":case"jpeg":i?s=this.getCanvas().jpegStream():o=ip(this,n);break;case"bmp":o=(0,dc.c)(this,n);break;default:throw new RangeError(`invalid output format: ${r}`)}if(s){let i=function(){throw new Error("createWriteStream does not exist in the browser")}();i.on("finish",t),i.on("error",e),s.pipe(i)}else o&&function(){throw new Error("writeFile does not exist in the browser")}()}))},toDataURL(t="image/png",e={}){"object"==typeof t&&(e=t,t="image/png");const{useCanvas:i=!1,encoder:n}=e;function r(e,i){return Jg(e(i,n),t)}return"image/bmp"===(t=function(t){return t.includes("/")||(t=`image/${t}`),t}(t))?r(dc.c,this):"image/png"!==t||i?"image/jpeg"!==t||i?this.getCanvas().toDataURL(t):r(ip,this):r(np,this)},toBuffer(t={}){const{format:e="png",encoder:i}=t;switch(e.toLowerCase()){case"png":return np(this,i);case"jpeg":case"jpg":return ip(this,i);case"bmp":return(0,dc.c)(this,i);default:throw new RangeError(`invalid output format: ${e}`)}},toBase64(t="image/png",e={}){if(e.async)return this.toDataURL(t,e).then((function(t){return t.substring(t.indexOf(",")+1)}));{const i=this.toDataURL(t,e);return i.substring(i.indexOf(",")+1)}},toBlob(t="image/png",e=.8){return uc(this.getCanvas(),t,e)},getCanvas(){const t=new Qg(this.getRGBAData({clamped:!0}),this.width,this.height);let e=ep(this.width,this.height);return e.getContext("2d").putImageData(t,0,0),e}};var sp=__webpack_require__(2251),op=__webpack_require__.n(sp);let ap={configurable:!0,enumerable:!1,get:void 0};const lp="GREY",hp="RGB",up="HSL",cp="HSV",dp="CMYK",fp="BINARY",gp="RGBA",pp={};pp[fp]={components:1,alpha:0,bitDepth:1,colorModel:lp},pp.GREYA={components:1,alpha:1,bitDepth:8,colorModel:lp},pp.GREY={components:1,alpha:0,bitDepth:8,colorModel:lp},pp[gp]={components:3,alpha:1,bitDepth:8,colorModel:hp},pp.RGB={components:3,alpha:0,bitDepth:8,colorModel:hp},pp.CMYK={components:4,alpha:0,bitDepth:8,colorModel:dp},pp.CMYKA={components:4,alpha:1,bitDepth:8,colorModel:dp};const mp=[1,8,16,32];var _p=__webpack_require__(9464),wp=__webpack_require__(9184),yp=__webpack_require__.n(wp);const vp={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},bp={};for(let t in vp)bp[vp[t]]=Number(t);const xp={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},Mp={};for(let t in xp)Mp[xp[t]]=Number(t);const kp={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},Sp={};for(let t in kp)Sp[kp[t]]=Number(t);const Ep={standard:n,exif:e,gps:i};class Cp{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if("number"==typeof t)return this.fields.get(t);if("string"==typeof t)return this.fields.get(Ep[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=Ep[this.kind].tagsById;for(let e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}let Ip=new Map([[1,[1,Ap]],[2,[1,function(t,e){let i=[],n="";for(let r=0;r<e;r++){let e=String.fromCharCode(t.readUint8());"\0"===e?(i.push(n),n=""):n+=e}return 1===i.length?i[0]:i}]],[3,[2,function(t,e){if(1===e)return t.readUint16();let i=new Uint16Array(e);for(let n=0;n<e;n++)i[n]=t.readUint16();return i}]],[4,[4,function(t,e){if(1===e)return t.readUint32();let i=new Uint32Array(e);for(let n=0;n<e;n++)i[n]=t.readUint32();return i}]],[5,[8,function(t,e){if(1===e)return t.readUint32()/t.readUint32();let i=new Array(e);for(let n=0;n<e;n++)i[n]=t.readUint32()/t.readUint32();return i}]],[6,[1,function(t,e){if(1===e)return t.readInt8();let i=new Int8Array(e);for(let n=0;n<e;n++)i[n]=t.readInt8();return i}]],[7,[1,Ap]],[8,[2,function(t,e){if(1===e)return t.readInt16();let i=new Int16Array(e);for(let n=0;n<e;n++)i[n]=t.readInt16();return i}]],[9,[4,function(t,e){if(1===e)return t.readInt32();let i=new Int32Array(e);for(let n=0;n<e;n++)i[n]=t.readInt32();return i}]],[10,[8,function(t,e){if(1===e)return t.readInt32()/t.readInt32();let i=new Array(e);for(let n=0;n<e;n++)i[n]=t.readInt32()/t.readInt32();return i}]],[11,[4,function(t,e){if(1===e)return t.readFloat32();let i=new Float32Array(e);for(let n=0;n<e;n++)i[n]=t.readFloat32();return i}]],[12,[8,function(t,e){if(1===e)return t.readFloat64();let i=new Float64Array(e);for(let n=0;n<e;n++)i[n]=t.readFloat64();return i}]]]);function Ap(t,e){if(1===e)return t.readUint8();let i=new Uint8Array(e);for(let n=0;n<e;n++)i[n]=t.readUint8();return i}let Tp=[];const Rp=[511,1023,2047,4095],Pp=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class Dp{constructor(t){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=258,this.currentBitLength=9,this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new fc.IOBuffer(t.byteLength),this.initializeTable()}decode(){let t=0,e=0;for(;257!==(t=this.getNextCode());)if(256===t){if(this.initializeTable(),t=this.getNextCode(),257===t)break;this.writeString(this.stringFromCode(t)),e=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(t)[0])),e=t;else{const i=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(i),this.addStringToTable(i),e=t}const i=this.outData.toArray();return new DataView(i.buffer,i.byteOffset,i.byteLength)}initializeTable(){!function(){if(0===Tp.length){for(let t=0;t<256;t++)Tp.push([t]);const t=[];for(let e=256;e<4096;e++)Tp.push(t)}}(),this.tableLength=258,this.currentBitLength=9}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return Tp[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(Tp[this.tableLength++]=t,Tp.length>4096)throw Tp=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===Pp[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|255&this.stripArray[this.bytePointer++],this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|255&this.stripArray[this.bytePointer++],this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&Rp[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function Fp(t){return new Dp(t).decode()}const Lp=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class Op extends Cp{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,e=Lp.exec(this.dateTime);if(null===e)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&"number"!=typeof t?t[0]:t}get alpha(){const t=this.extraSamples;return!!t&&0!==t[0]}get associatedAlpha(){const t=this.extraSamples;return!!t&&1===t[0]}get extraSamples(){return zp(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return zp(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return zp(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const i=[];for(let n=0;n<t;n++)i.push([e[n],e[n+t],e[n+2*t]]);return i}}function zp(t){return"number"==typeof t?[t]:t}function Np(t){const e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=kg(e);return new DataView(i.buffer,i.byteOffset,i.byteLength)}const Bp={ignoreImageData:!1,onlyFirst:!1};class Up extends fc.IOBuffer{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),2===t)return!0;if(1===t)return!1;throw Gp("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw Gp("ifdCount",t)}decode(t={}){t=Object.assign({},Bp,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t,!0)),t.onlyFirst)return[e[0]];return e}decodeHeader(){const t=this.readUint16();if(18761===t)this.setLittleEndian();else{if(19789!==t)throw new Error(`invalid byte order: 0x${t.toString(16)}`);this.setBigEndian()}if(42!==this.readUint16())throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,e){let i;if(this.seek(this._nextIFD),e)i=new Op;else{if(!t.kind)throw new Error("kind is missing");i=new Cp(t.kind)}const n=this.readUint16();for(let t=0;t<n;t++)this.decodeIFDEntry(i);if(!t.ignoreImageData){if(!(i instanceof Op))throw new Error("must be a tiff ifd");this.decodeImageData(i)}return this._nextIFD=this.readUint32(),i}decodeIFDEntry(t){const e=this.offset,i=this.readUint16(),n=this.readUint16(),r=this.readUint32();if(n<1||n>12)return void this.skip(4);const s=function(t,e){const i=Ip.get(t);if(!i)throw new Error(`type not found: ${t}`);return i[0]*e}(n,r);s>4&&this.seek(this.readUint32());const o=function(t,e,i){const n=Ip.get(e);if(!n)throw new Error(`type not found: ${e}`);return n[1](t,i)}(this,n,r);if(t.fields.set(i,o),34665===i||34853===i){let e=this.offset,n="exif";34665===i?n="exif":34853===i&&(n="gps"),this._nextIFD=o,t[n]=this.decodeIFD({kind:n,ignoreImageData:!0},!1),this.offset=e}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;if(e&&1!==e)throw Gp("orientation",e);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw Gp("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),0===t.type){const e=t.bitsPerSample,i=Math.pow(2,e)-1;for(let e=0;e<t.data.length;e++)t.data[e]=i-t.data[e]}}readStripData(t){const e=t.width,i=t.height,n=t.bitsPerSample,r=t.sampleFormat,s=e*i*t.samplesPerPixel,o=function(t,e,i){if(8===e)return new Uint8Array(t);if(16===e)return new Uint16Array(t);if(32===e&&3===i)return new Float32Array(t);throw Gp("bit depth / sample format",`${e} / ${i}`)}(s,n,r),a=t.rowsPerStrip*e*t.samplesPerPixel,l=t.stripOffsets,h=t.stripByteCounts||function(t){if(1!==t.compression)throw new Error("missing mandatory StripByteCounts field in compressed image");const e=t.rowsPerStrip*t.width*t.samplesPerPixel*(t.bitsPerSample/8);return new Array(t.stripOffsets.length).fill(e)}(t);let u=s,c=0;for(let e=0;e<l.length;e++){let i=new DataView(this.buffer,this.byteOffset+l[e],h[e]),s=u>a?a:u;u-=s;let d=i;switch(t.compression){case 1:break;case 5:d=Fp(i);break;case 8:d=Np(i);break;case 2:throw Gp("Compression","CCITT Group 3");case 32773:throw Gp("Compression","PackBits");default:throw Gp("Compression",t.compression)}c=this.fillUncompressed(n,r,o,d,c,s)}t.data=o}fillUncompressed(t,e,i,n,r,s){if(8===t)return function(t,e,i,n){for(let r=0;r<n;r++)t[i++]=e.getUint8(r);return i}(i,n,r,s);if(16===t)return function(t,e,i,n,r){for(let s=0;s<2*n;s+=2)t[i++]=e.getUint16(s,r);return i}(i,n,r,s,this.isLittleEndian());if(32===t&&3===e)return function(t,e,i,n,r){for(let s=0;s<4*n;s+=4)t[i++]=e.getFloat32(s,r);return i}(i,n,r,s,this.isLittleEndian());throw Gp("bitDepth",t)}applyPredictor(t){const e=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:if(8===e)!function(t,e,i){let n=0;for(;n<t.length;){for(let r=i;r<e*i;r+=i)for(let e=0;e<i;e++)t[n+r+e]=t[n+r+e]+t[n+r-(i-e)]&255;n+=e*i}}(t.data,t.width,t.components);else{if(16!==e)throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${e}`);!function(t,e,i){let n=0;for(;n<t.length;){for(let r=i;r<e*i;r+=i)for(let e=0;e<i;e++)t[n+r+e]=t[n+r+e]+t[n+r-(i-e)]&65535;n+=e*i}}(t.data,t.width,t.components)}break;default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:e,components:i,maxSampleValue:n}=t;for(let t=0;t<e.length;t+=i){const r=e[t+i-1];for(let s=0;s<i-1;s++)e[t+s]=Math.round(e[t+s]*n/r)}}}}function Gp(t,e){return new Error(`Unsupported ${t}: ${e}`)}function Xp(t={}){let{algorithm:e="matchToPrevious",ignoreBorder:i=[0,0]}=t;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n="matchToPrevious"===e,r=this[0],s=[];s[0]={position:[0,0],image:this[0]};let o=[0,0];for(let t=1;t<this.length;t++){let e=r.getBestMatch(this[t],{border:i});s[t]={position:[e[0]+o[0],e[1]+o[1]],image:this[t]},n&&(o[0]+=e[0],o[1]+=e[1],r=this[t])}let a=0,l=0,h=0,u=0;for(let t=0;t<s.length;t++){let e=s[t];e.position[0]>a&&(a=e.position[0]),e.position[0]<l&&(l=e.position[0]),e.position[1]>h&&(h=e.position[1]),e.position[1]<u&&(u=e.position[1])}l=0-l,u=0-u;for(let t=0;t<s.length;t++){let e=s[t];e.crop=e.image.crop({x:a-e.position[0],y:h-e.position[1],width:r.width-l-a,height:r.height-u-h})}let c=[];for(let t=0;t<s.length;t++)c[t]=s[t].crop;return new tm(c)}function Yp(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].min;for(let e=1;e<this.length;e++)for(let i=0;i<t.length;i++)t[i]=Math.min(t[i],this[e].min[i]);return t}function Vp(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].max;for(let e=1;e<this.length;e++)for(let i=0;i<t.length;i++)t[i]=Math.max(t[i],this[e].max[i]);return t}function jp(t){let e=t.reduce(((t,e)=>t+e));if(0===e)throw new Error("unreachable");let i,n=0,r=0,s=e/2;for(;;){if(t[n]>0){if(void 0!==i)return(i+n)/2;if(r+=t[n],r>s)return n;r===s&&(i=n)}n++}}function qp(t){let e=0,i=0;for(let n=0;n<t.length;n++)e+=t[n],i+=t[n]*n;return 0===e?0:i/e}function Wp(){this.checkProcessable("median",{bitDepth:[8,16]});let t=this.getHistograms({maxSlots:this[0].maxValue+1}),e=new Array(t.length);for(let i=0;i<t.length;i++){let n=t[i];e[i]=jp(n)}return e}function $p(t){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistogram(t);for(let i=1;i<this.length;i++){let n=this[i].getHistogram(t);for(let t=0;t<e.length;t++)e[t]+=n[t]}return e}function Zp(t){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistograms(t),i=e[0].length;for(let n=1;n<this.length;n++){let r=this[n].getHistograms(t);for(let t=0;t<e.length;t++)for(let n=0;n<i;n++)e[t][n]+=r[t][n]}return e}function Hp(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let t=new Uint32Array(this[0].data.length);for(let e=0;e<this.length;e++){let i=this[e];for(let e=0;e<this[0].data.length;e++)t[e]+=i.data[e]}let e=rv.createFrom(this[0]),i=e.data;for(let e=0;e<this[0].data.length;e++)i[e]=t[e]/this.length;return e}function Kp(){this.checkProcessable("max",{bitDepth:[8,16]});let t=rv.createFrom(this[0]);t.data.fill(0);for(const e of this)for(let i=0;i<t.data.length;i++)t.data[i]=Math.max(e.data[i],t.data[i]);return t}function Jp(){this.checkProcessable("max",{bitDepth:[8,16]});let t=rv.createFrom(this[0]);t.data.fill(t.maxValue);for(const e of this)for(let i=0;i<t.data.length;i++)t.data[i]=Math.min(e.data[i],t.data[i]);return t}let Qp={configurable:!0,enumerable:!1,get:void 0};class tm extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let e=0;e<t.length;e++)this[e]=t[e]}else"number"==typeof t?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(rv.load)).then((t=>new tm(t)))}static extendMethod(t,e,i={}){let{inPlace:n=!1,returnThis:r=!0,partialArgs:s=[]}=i;return tm.prototype[t]=n?function(...t){this.computed=null;let i=e.apply(this,[...s,...t]);return r?this:i}:function(...t){return e.apply(this,[...s,...t])},tm}static extendProperty(t,e,i={}){let{partialArgs:n=[]}=i;return Qp.get=function(){if(null===this.computed)this.computed={};else if(op()(t,this.computed))return this.computed[t];let i=e.apply(this,n);return this.computed[t]=i,i},Object.defineProperty(tm.prototype,t,Qp),tm}checkProcessable(t,e={}){if("string"!=typeof t)throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(0===this.size)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,e);for(let i=1;i<this.length;i++){if((void 0===e.sameSize||e.sameSize)&&this[0].width!==this[i].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((void 0===e.sameSize||e.sameSize)&&this[0].height!==this[i].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((void 0===e.sameAlpha||e.sameAlpha)&&this[0].alpha!==this[i].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((void 0===e.sameBitDepth||e.sameBitDepth)&&this[0].bitDepth!==this[i].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((void 0===e.sameColorModel||e.sameColorModel)&&this[0].colorModel!==this[i].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((void 0===e.sameNumberChannels||e.sameNumberChannels)&&this[0].channels!==this[i].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(tm.prototype.map=function(t,e){if("function"!=typeof t)throw new TypeError(`${t} is not a function`);let i=new tm(this.length);for(let n=0;n<this.length;n++)i[n]=t.call(e,this[n],n,this);return i}),function(t){t.extendMethod("matchAndCrop",Xp),t.extendMethod("getMin",Yp),t.extendMethod("getMax",Vp),t.extendMethod("getMedian",Wp),t.extendMethod("getHistogram",$p),t.extendMethod("getHistograms",Zp),t.extendMethod("getAverage",Hp),t.extendMethod("getAverageImage",Hp),t.extendMethod("getMaxImage",Kp),t.extendMethod("getMinImage",Jp)}(tm);const em=/^data:[a-z]+\/(?:[a-z]+);base64,/;function im(t,e,i){const n=yp()(t);if(n)switch(n.mime){case"image/png":return function(t){const e=function(t,e){return new Og(t,void 0).decode()}(t);let i,n=e.channels,r=0;return 2===n||4===n?(i=n-1,r=1):i=n,e.palette?function(t){const e=t.width*t.height,i=t.palette[0].length,n=new Uint8Array(e*i),r=8/t.depth,s=t.depth<8?r:1,o=parseInt("1".repeat(t.depth),2),a=4===i;let l=0;for(let i=0;i<e;i++){const e=Math.floor(i/s);let h=t.data[e];t.depth<8&&(h=h>>>t.depth*(r-1-i%r)&o);const u=t.palette[h];n[l++]=u[0],n[l++]=u[1],n[l++]=u[2],a&&(n[l++]=u[3])}return new rv(t.width,t.height,n,{components:3,alpha:a,bitDepth:8})}(e):new rv(e.width,e.height,e.data,{components:i,alpha:r,bitDepth:e.depth})}(t);case"image/jpeg":return function(t){const e=(0,_p.decode)(t);let i;e.exif&&(i=nm(e.exif));const n=(0,Zg.decode)(t,{useTArray:!0,maxMemoryUsageInMB:1024});let r=new rv(n.width,n.height,n.data,{meta:i});if(i&&i.tiff.tags.Orientation){const t=i.tiff.tags.Orientation;t>2&&(r=r.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[t])),[2,4,5,7].includes(t)&&(r=r.flipX())}return r}(t);case"image/tiff":return function(t,e){let i=function(t,e){return new Up(t).decode(void 0)}(t);return 1===i.length?rm(i[0],e):new tm(i.map((function(t){return rm(t,e)})))}(t,i);default:return sm(r(n.mime))}return sm(r("application/octet-stream"));function r(i){return e||Jg(t,i)}}function nm(t){const e={tiff:{fields:t.fields,tags:t.map}};return t.exif&&(e.exif=t.exif),t.gps&&(e.gps=t.gps),e}function rm(t,e){if(e||3!==t.type)return new rv(t.width,t.height,t.data,{components:2===t.type?3:1,alpha:t.alpha,colorModel:2===t.type?hp:lp,bitDepth:t.bitsPerSample.length?t.bitsPerSample[0]:t.bitsPerSample,meta:nm(t)});{const e=new Uint16Array(3*t.width*t.height),i=t.palette;let n=0;for(let r=0;r<t.data.length;r++){const s=i[t.data[r]];e[n++]=s[0],e[n++]=s[1],e[n++]=s[2]}return new rv(t.width,t.height,e,{components:3,alpha:t.alpha,colorModel:hp,bitDepth:16,meta:nm(t)})}}function sm(t,e){return e=e||{},new Promise((function(i,n){let r=new tp;r.onload=function(){let t=r.width,n=r.height,s=ep(t,n).getContext("2d");s.drawImage(r,0,0,t,n);let o=s.getImageData(0,0,t,n).data;i(new rv(t,n,o,e))},r.onerror=function(){n(new Error(`Could not load ${t}`))},r.src=t}))}const om={getValueXY(t,e,i){return this.data[(e*this.width+t)*this.channels+i]},setValueXY(t,e,i,n){return this.data[(e*this.width+t)*this.channels+i]=n,this.computed=null,this},getValue(t,e){return this.data[t*this.channels+e]},setValue(t,e,i){return this.data[t*this.channels+e]=i,this.computed=null,this},getPixelXY(t,e){return this.getPixel(e*this.width+t)},setPixelXY(t,e,i){return this.setPixel(e*this.width+t,i)},getPixel(t){const e=new Array(this.channels),i=t*this.channels;for(let t=0;t<this.channels;t++)e[t]=this.data[i+t];return e},setPixel(t,e){const i=t*this.channels;for(let t=0;t<e.length;t++)this.data[i+t]=e[t];return this.computed=null,this}};function am(t){return{width:t.width,height:t.height,components:t.components,alpha:t.alpha,colorModel:t.colorModel,bitDepth:t.bitDepth}}function lm(t,e,i,n={}){const{out:r}=e;if(void 0===r)return n.copy?t.clone():rv.createFrom(t,i);{if(!rv.isImage(r))throw new TypeError("out must be an Image object");const e=Object.assign(am(t),i);for(const t in e)if(r[t]!==e[t])throw new RangeError(`cannot use out. Its ${t} must be "${e[t]}" (found "${r[t]}")`);return r}}function hm(t,e,i){if(void 0!==e.inPlace&&"boolean"!=typeof e.inPlace)throw new TypeError("inPlace option must be a boolean");if(e.inPlace){if(void 0!==e.out)throw new TypeError("out option must not be set if inPlace option is true");return t}return lm(t,e,null,i)}function um(t={}){this.checkProcessable("abs",{bitDepth:[32]});const e=hm(this,t);return function(t,e){for(let i=0;i<t.data.length;i++)e.data[i]=Math.abs(t.data[i])}(this,e),e}function cm(t={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const e=hm(this,t);return 1===this.bitDepth?function(t,e){for(let i=0;i<t.data.length;i++)e.data[i]=~t.data[i]}(this,e):(function(t,e){for(let i=0;i<t.data.length;i+=t.channels)for(let n=0;n<t.components;n++)e.data[i+n]=t.maxValue-t.data[i+n]}(this,e),this!==e&&function(t,e){if(1===t.alpha&&1===e.alpha)for(let i=0;i<t.size;i++)e.data[i*e.channels+e.components]=t.data[i*t.channels+t.components]}(this,e)),e}function dm(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let t=0;t<this.height;t++){let e=t*this.width*this.channels;for(let t=0;t<Math.floor(this.width/2);t++){let i=t*this.channels+e,n=(this.width-t-1)*this.channels+e;for(let t=0;t<this.channels;t++){let e=this.data[i+t];this.data[i+t]=this.data[n+t],this.data[n+t]=e}}}return this}function fm(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let t=0;t<Math.floor(this.height/2);t++)for(let e=0;e<this.width;e++){let i=e*this.channels+t*this.width*this.channels,n=e*this.channels+(this.height-1-t)*this.channels*this.width;for(let t=0;t<this.channels;t++){let e=this.data[i+t];this.data[i+t]=this.data[n+t],this.data[n+t]=e}}return this}function gm(t={}){const{radius:e=1}=t;if(e<1)throw new Error("radius must be greater than 1");const i=2*e+1,n=new Array(i);for(let t=0;t<i;t++){n[t]=new Array(i);for(let e=0;e<i;e++)n[t][e]=1/(i*i)}return this.convolution(n)}var pm=__webpack_require__(5520),mm=__webpack_require__.n(pm);function _m(t,e={}){let{channels:i,allowAlpha:n,defaultAlpha:r}=e;return"boolean"!=typeof n&&(n=!0),void 0===i?function(t,e){let i=e?t.channels:t.components,n=new Array(i);for(let t=0;t<i;t++)n[t]=t;return n}(t,r):function(t,e,i){Array.isArray(e)||(e=[e]);for(let n=0;n<e.length;n++)e[n]=wm(t,e[n],i);return e}(t,i,n)}function wm(t,e,i=!0){if(void 0===e)throw new RangeError(`validateChannel : the channel has to be >=0 and <${t.channels}`);if("string"==typeof e){switch(t.colorModel){case lp:break;case hp:if("rgb".includes(e))switch(e){case"r":e=0;break;case"g":e=1;break;case"b":e=2}break;case up:if("hsl".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"l":e=2}break;case cp:if("hsv".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"v":e=2}break;case dp:if("cmyk".includes(e))switch(e){case"c":e=0;break;case"m":e=1;break;case"y":e=2;break;case"k":e=3}break;default:throw new Error(`Unexpected color model: ${t.colorModel}`)}if("a"===e){if(!t.alpha)throw new Error("validateChannel : the image does not contain alpha channel");e=t.components}if("string"==typeof e)throw new Error(`validateChannel : undefined channel: ${e}`)}if(e>=t.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${t.channels}`);if(!i&&e>=t.components)throw new RangeError("validateChannel : alpha channel may not be selected");return e}function ym(t={}){let{radius:e=1,border:i="copy",channels:n}=t;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),e<1)throw new Error("radius must be greater than 0");n=_m(this,n);let r=e,s=e,o=rv.createFrom(this),a=new Array((2*r+1)*(2*s+1));for(let t=0;t<n.length;t++){let e=n[t];for(let t=s;t<this.height-s;t++)for(let i=r;i<this.width-r;i++){let n=0;for(let o=-s;o<=s;o++)for(let s=-r;s<=r;s++){let r=((t+o)*this.width+i+s)*this.channels+e;a[n++]=this.data[r]}let l=(t*this.width+i)*this.channels+e;o.data[l]=mm()(a)}}if(this.alpha&&!n.includes(this.channels))for(let t=this.components;t<this.data.length;t+=this.channels)o.data[t]=this.data[t];return o.setBorder({size:[r,s],algorithm:i}),o}function vm(t={}){let{radius:e=1,sigma:i,channels:n,border:r="copy"}=t;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=function(t,e){const i=2*t+1,n=new Array(i),r=e||.3*(.5*(i-1)-1)+.8,s=-.5/(r*r);let o=0;for(let e=0;e<i;e++){const i=e-t,r=Math.exp(s*i*i);n[e]=r,o+=r}for(let t=0;t<i;t++)n[t]/=o;return n}(e,i);return this.convolution([s,s],{border:r,channels:n,algorithm:"separable"})}const bm=[[-1,0,1],[-2,0,2],[-1,0,1]],xm=[[-1,-2,-1],[0,0,0],[1,2,1]],Mm=[[3,0,-3],[10,0,-10],[3,0,-3]],km=[[3,10,3],[0,0,0],[-3,-10,-3]];var Sm=__webpack_require__(414),Em=__webpack_require__(8336),Cm=__webpack_require__.n(Em);function Im(t,e){return Math.round(Math.min(Math.max(t,0),e.maxValue))}function Am(t,e,i){if(void 0===i){const n=t.length+e.length-1;i=new Array(n)}!function(t){for(var e=0;e<t.length;e++)t[e]=0}(i);for(var n=0;n<t.length;n++)for(var r=0;r<e.length;r++)i[n+r]+=t[n]*e[r];return i}function Tm(t,e,i,n){const r=new Array(t.length);let s,o,a,l;l=e[1],a=(l.length-1)/2,o=new Array(i+l.length-1),s=new Array(i);for(let e=0;e<n;e++){for(let n=0;n<i;n++)s[n]=t[e*i+n];Am(s,l,o);for(let t=0;t<i;t++)r[e*i+t]=o[a+t]}l=e[0],a=(l.length-1)/2,o=new Array(n+l.length-1),s=new Array(n);for(let t=0;t<i;t++){for(let e=0;e<n;e++)s[e]=r[e*i+t];Am(s,l,o);for(let e=0;e<n;e++)r[e*i+t]=o[a+e]}return r}__webpack_require__(9645),__webpack_require__(995);var Rm=__webpack_require__(8406);Rm.AbstractMatrix,Rm.CHO,Rm.CholeskyDecomposition,Rm.DistanceMatrix,Rm.EVD,Rm.EigenvalueDecomposition,Rm.LU,Rm.LuDecomposition;const Pm=Rm.Matrix,Dm=(Rm.MatrixColumnSelectionView,Rm.MatrixColumnView,Rm.MatrixFlipColumnView,Rm.MatrixFlipRowView,Rm.MatrixRowSelectionView,Rm.MatrixRowView,Rm.MatrixSelectionView,Rm.MatrixSubView,Rm.MatrixTransposeView,Rm.NIPALS,Rm.Nipals,Rm.QR,Rm.QrDecomposition,Rm.SVD),Fm=Rm.SingularValueDecomposition,Lm=(Rm.SymmetricMatrix,Rm.WrapperMatrix1D,Rm.WrapperMatrix2D,Rm.correlation,Rm.covariance,Rm.Matrix,Rm.Matrix,Rm.determinant,Rm.inverse),Om=(Rm.linearDependencies,Rm.pseudoInverse,Rm.solve);function zm(t,e={}){let{channels:i,bitDepth:n,normalize:r=!1,divisor:s=1,border:o="copy",algorithm:a="auto"}=e,l={};n&&(l.bitDepth=n);let h,u,c=rv.createFrom(this,l);if(i=_m(this,i),"separable"!==a)({kernel:t}=function(t){let e,i;if(!Array.isArray(t))throw new Error(`validateKernel: Invalid Kernel: ${t}`);if(Array.isArray(t[0])){if(0==(1&t.length)||0==(1&t[0].length))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");e=Math.floor(t.length/2),i=Math.floor(t[0].length/2)}else{let n=Math.sqrt(t.length);if(!Cm()(n))throw new RangeError("validateKernel: Kernel array should be a square");i=e=Math.floor(Math.sqrt(t.length)/2);let r=new Array(n);for(let e=0;e<n;e++){r[e]=new Array(n);for(let i=0;i<n;i++)r[e][i]=t[e*n+i]}t=r}return{kernel:t,kWidth:i,kHeight:e}}(t));else if(!Array.isArray(t)||2!==t.length)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if("auto"===a){let e=function(t){const e=new Dm(t,{autoTranspose:!0});if(1!==e.rank)return null;const i=Math.sqrt(e.s[0]);return[e.U.to2DArray().map((t=>t[0]*i)),e.V.to2DArray().map((t=>t[0]*i))]}(t);null!==e?(a="separable",t=e):a=(t.length>9||t[0].length>9)&&this.width<=4096&&this.height<=4096?"fft":"direct"}"separable"===a?(h=Math.floor(t[0].length/2),u=Math.floor(t[1].length/2)):(h=Math.floor(t.length/2),u=Math.floor(t[0].length/2));let d,f,g,p,m,_,w=c.isClamped,y=new Array(this.height*this.width);for(p=0;p<i.length;p++){for(m=i[p],g=0;g<this.height;g++)for(f=0;f<this.width;f++)d=g*this.width+f,y[d]=this.data[d*this.channels+m];if("direct"===a)_=(0,Sm.direct)(y,t,{rows:this.height,cols:this.width,normalize:r,divisor:s});else if("separable"===a){if(_=Tm(y,t,this.width,this.height),r){s=0;for(let e=0;e<t[0].length;e++)for(let i=0;i<t[1].length;i++)s+=t[0][e]*t[1][i]}if(1!==s)for(let t=0;t<_.length;t++)_[t]/=s}else _=(0,Sm.fft)(y,t,{rows:this.height,cols:this.width,normalize:r,divisor:s});for(g=0;g<this.height;g++)for(f=0;f<this.width;f++)d=g*this.width+f,c.data[d*this.channels+m]=w?Im(_[d],c):_[d]}if(this.alpha&&!i.includes(this.channels))for(f=this.components;f<this.data.length;f+=this.channels)c.data[f]=this.data[f];return"periodic"!==o&&c.setBorder({size:[u,h],algorithm:o}),c}function Nm(t={}){let{direction:e="xy",border:i="copy",kernelX:n,kernelY:r,channels:s,bitDepth:o=this.bitDepth}=t;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),e){case"x":if(!n)throw new Error("kernelX option is missing");return zm.call(this,n,{channels:s,border:i,bitDepth:o});case"y":if(!r)throw new Error("kernelY option is missing");return zm.call(this,r,{channels:s,border:i,bitDepth:o});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!r)throw new Error("kernelY option is missing");const t=zm.call(this,n,{channels:s,border:i,bitDepth:32}),e=zm.call(this,r,{channels:s,border:i,bitDepth:32});return t.hypotenuse(e,{bitDepth:o,channels:s})}default:throw new Error(`Unknown parameter direction: ${e}`)}}function Bm(t){return Nm.call(this,Object.assign({},t,{kernelX:bm,kernelY:xm}))}function Um(t){return Nm.call(this,Object.assign({},t,{kernelX:Mm,kernelY:km}))}Rm.wrap;var Gm=__webpack_require__(2664),Xm=__webpack_require__.n(Gm);function Ym(t={}){let{algorithm:e="range",channels:i,min:n=this.min,max:r=this.max}=t;if(this.checkProcessable("level",{bitDepth:[8,16,32]}),i=_m(this,{channels:i}),i.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter(((t,e)=>i.includes(e)))),Array.isArray(r)&&r.length===this.channels&&(r=r.filter(((t,e)=>i.includes(e))))),"range"!==e)throw new Error(`level: algorithm not implement: ${e}`);return n<0&&(n=0),r>this.maxValue&&(r=this.maxValue),Array.isArray(n)||(n=Xm()(i.length,n)),Array.isArray(r)||(r=Xm()(i.length,r)),function(t,e,i,n){let r=1e-5,s=new Array(n.length);for(let o=0;o<n.length;o++)0===e[o]&&i[o]===t.maxValue||i[o]===e[o]?s[o]=0:s[o]=(t.maxValue+1-r)/(i[o]-e[o]),e[o]+=.499995/s[o];for(let i=0;i<n.length;i++){let r=n[i];if(0!==s[i])for(let n=0;n<t.data.length;n+=t.channels)t.data[n+r]=Math.min(Math.max(0,(t.data[n+r]-e[i])*s[i]+.5|0),t.maxValue)}}(this,n,r,i),this}var Vm=__webpack_require__(7811),jm=__webpack_require__.n(Vm);function qm(t){if(isNaN(t)){if(t instanceof rv)return t.data;if(!jm()(t))throw new Error("checkNumberArray: the value should be either a number, array or Image");return t}if(t<=0)throw new Error("checkNumberArray: the value must be greater than 0");return t}function Wm(t,e={}){let{channels:i}=e;if(this.checkProcessable("add",{bitDepth:[8,16]}),i=_m(this,{channels:i}),t=qm(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("add: the data size is different");for(let e=0;e<i.length;e++){let n=i[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+n]=Math.max(0,Math.min(this.maxValue,this.data[e+n]+t[e+n]>>0))}}else for(let e=0;e<i.length;e++){let n=i[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+n]=Math.min(this.maxValue,this.data[e+n]+t>>0)}return this}function $m(t,e={}){let{channels:i}=e;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),i=_m(this,{channels:i}),t=qm(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("subtract: the data size is different");for(let e=0;e<i.length;e++){let n=i[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+n]=Math.max(0,Math.min(this.maxValue,this.data[e+n]-t[e+n]>>0))}}else for(let e=0;e<i.length;e++){let n=i[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+n]=Math.max(0,this.data[e+n]-t>>0)}return this}function Zm(t,e={}){let{channels:i,absolute:n=!1}=e;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==t.width||this.height!==t.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("subtractImage: both images must have the same number of channels");let r=this.clone();i=_m(this,{channels:i});for(let e=0;e<i.length;e++)for(let s=i[e];s<this.data.length;s+=this.channels){let e=this.data[s]-t.data[s];r.data[s]=n?Math.abs(e):Math.max(e,0)}return r}function Hm(t,e={}){let{bitDepth:i=this.bitDepth,channels:n}=e;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==t.width||this.height!==t.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("hypotenuse: both images must have the same number of channels");let r=rv.createFrom(this,{bitDepth:i});n=_m(this,{channels:n});let s=r.isClamped;for(let e=0;e<n.length;e++)for(let i=n[e];i<this.data.length;i+=this.channels){let e=Math.hypot(this.data[i],t.data[i]);r.data[i]=s?Math.min(Math.max(Math.round(e),0),r.maxValue):e}return r}function Km(t,e={}){let{channels:i}=e;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),t<=0)throw new Error("multiply: the value must be greater than 0");if(i=_m(this,{channels:i}),t=qm(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("multiply: the data size is different");for(let e=0;e<i.length;e++){let n=i[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+n]=Math.max(0,Math.min(this.maxValue,this.data[e+n]*t[e+n]>>0))}}else for(let e=0;e<i.length;e++){let n=i[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+n]=Math.min(this.maxValue,this.data[e+n]*t>>0)}return this}function Jm(t,e={}){let{channels:i}=e;if(this.checkProcessable("divide",{bitDepth:[8,16]}),i=_m(this,{channels:i}),t=qm(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("divide: the: the data size is different");for(let e=0;e<i.length;e++){let n=i[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+n]=Math.max(0,Math.min(this.maxValue,this.data[e+n]/t[e+n]>>0))}}else for(let e=0;e<i.length;e++){let n=i[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+n]=Math.min(this.maxValue,this.data[e+n]/t>>0)}return this}var Qm=__webpack_require__(4091);class t_{constructor(){if(new.target===t_)throw new Error("BaseRegression must be subclassed")}predict(t){if("number"==typeof t)return this._predict(t);if((0,Qm.isAnyArray)(t)){const e=[];for(let i=0;i<t.length;i++)e.push(this._predict(t[i]));return e}throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,e){if(!(0,Qm.isAnyArray)(t)||!(0,Qm.isAnyArray)(e)||t.length!==e.length)throw new Error("x and y must be arrays of the same length");const i=t.length,n=new Array(i);for(let e=0;e<i;e++)n[e]=this._predict(t[e]);let r=0,s=0,o=0,a=0,l=0,h=0,u=0;for(let t=0;t<i;t++)r+=n[t],s+=e[t],l+=n[t]*n[t],h+=e[t]*e[t],u+=n[t]*e[t],0!==e[t]&&(o+=(e[t]-n[t])*(e[t]-n[t])/e[t]),a+=(e[t]-n[t])*(e[t]-n[t]);const c=(i*u-r*s)/Math.sqrt((i*l-r*r)*(i*h-s*s));return{r:c,r2:c*c,chi2:o,rmsd:Math.sqrt(a/i)}}}var e_=__webpack_require__(6952),i_=__webpack_require__.n(e_);const n_={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class r_ extends t_{constructor(t,e,i){if(super(),!0===t)this.alpha=e.alpha,this.inputs=e.inputs,this.kernelType=e.kernelType,this.kernelOptions=e.kernelOptions,this.kernel=new(i_())(e.kernelType,e.kernelOptions);else{t=Pm.checkMatrix(t),i=Object.assign({},n_,i);const n=new(i_())(i.kernelType,i.kernelOptions),r=n.compute(t),s=t.rows;r.add(Pm.eye(s,s).mul(i.lambda)),this.alpha=Om(r,e),this.inputs=t,this.kernelType=i.kernelType,this.kernelOptions=i.kernelOptions,this.kernel=n}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if("kernelRidgeRegression"!==t.name)throw new TypeError("not a KRR model");return new r_(!0,t)}}function s_(t,e,i){const n=new r_(t,e,i),r=new Array(this.size);for(let t=0;t<this.width;t++)for(let e=0;e<this.height;e++)r[e*this.width+t]=[t,e];const s=n.predict(r),o=rv.createFrom(this);for(let t=0;t<this.size;t++)o.data[t]=Math.min(this.maxValue,Math.max(0,s[t][0]));return o}function o_(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:i=1}=t;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;t:for(const t of e)for(const e of t)if(1!==e){n=!1;break t}let r=this;for(let t=0;t<i;t++)if(1===this.bitDepth)if(n){const t=r.clone();r=u_(r,t,e.length,e[0].length)}else r=h_(r,rv.createFrom(r),e);else r=n?l_(r,rv.createFrom(r),e.length,e[0].length):a_(r,rv.createFrom(r),e);return r}function a_(t,e,i){const n=i.length,r=i[0].length;let s=(n-1)/2,o=(r-1)/2;for(let a=0;a<t.height;a++)for(let l=0;l<t.width;l++){let h=0;for(let e=0;e<r;e++)for(let r=0;r<n;r++){if(1!==i[r][e])continue;let n=r-s+l,u=e-o+a;if(n<0||u<0||n>=t.width||u>=t.height)continue;const c=t.getValueXY(n,u,0);c>h&&(h=c)}e.setValueXY(l,a,0,h)}return e}function l_(t,e,i,n){const r=(i-1)/2,s=(n-1)/2,o=[];for(let e=0;e<t.width;e++)o.push(0);for(let i=0;i<t.height;i++){for(let e=0;e<t.width;e++){let n=0;for(let r=Math.max(0,i-s);r<Math.min(t.height,i+s+1);r++){const i=t.getValueXY(e,r,0);i>n&&(n=i)}o[e]=n}for(let n=0;n<t.width;n++){let s=0;for(let e=Math.max(0,n-r);e<Math.min(t.width,n+r+1);e++)o[e]>s&&(s=o[e]);e.setValueXY(n,i,0,s)}}return e}function h_(t,e,i){const n=i.length,r=i[0].length;let s=(n-1)/2,o=(r-1)/2;for(let a=0;a<t.height;a++)for(let l=0;l<t.width;l++){let h=0;t:for(let e=0;e<r;e++)for(let r=0;r<n;r++){if(1!==i[r][e])continue;let n=r-s+l,u=e-o+a;if(!(u<0||n<0||n>=t.width||u>=t.height)&&1===t.getBitXY(n,u)){h=1;break t}}1===h&&e.setBitXY(l,a)}return e}function u_(t,e,i,n){const r=(i-1)/2,s=(n-1)/2,o=[];for(let e=0;e<t.width;e++)o.push(1);for(let i=0;i<t.height;i++){for(let e=0;e<t.width;e++){o[e]=0;for(let n=Math.max(0,i-s);n<Math.min(t.height,i+s+1);n++)if(1===t.getBitXY(e,n)){o[e]=1;break}}for(let n=0;n<t.width;n++)if(1!==e.getBitXY(n,i))for(let s=Math.max(0,n-r);s<Math.min(t.width,n+r+1);s++)if(1===o[s]){e.setBitXY(n,i);break}}return e}function c_(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:i=1}=t;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;t:for(const t of e)for(const e of t)if(1!==e){n=!1;break t}let r=this;for(let t=0;t<i;t++)if(1===this.bitDepth)if(n){const t=r.clone();r=p_(r,t,e.length,e[0].length)}else r=g_(r,rv.createFrom(r),e);else r=n?f_(r,rv.createFrom(r),e.length,e[0].length):d_(r,rv.createFrom(r),e);return r}function d_(t,e,i){const n=i.length,r=i[0].length;let s=(n-1)/2,o=(r-1)/2;for(let a=0;a<t.height;a++)for(let l=0;l<t.width;l++){let h=t.maxValue;for(let e=0;e<r;e++)for(let r=0;r<n;r++){if(1!==i[r][e])continue;let n=r-s+l,u=e-o+a;if(n<0||u<0||n>=t.width||u>=t.height)continue;const c=t.getValueXY(n,u,0);c<h&&(h=c)}e.setValueXY(l,a,0,h)}return e}function f_(t,e,i,n){const r=(i-1)/2,s=(n-1)/2,o=[];for(let e=0;e<t.width;e++)o.push(0);for(let i=0;i<t.height;i++){for(let e=0;e<t.width;e++){let n=t.maxValue;for(let r=Math.max(0,i-s);r<Math.min(t.height,i+s+1);r++){const i=t.getValueXY(e,r,0);i<n&&(n=i)}o[e]=n}for(let n=0;n<t.width;n++){let s=t.maxValue;for(let e=Math.max(0,n-r);e<Math.min(t.width,n+r+1);e++)o[e]<s&&(s=o[e]);e.setValueXY(n,i,0,s)}}return e}function g_(t,e,i){const n=i.length,r=i[0].length;let s=(n-1)/2,o=(r-1)/2;for(let a=0;a<t.height;a++)for(let l=0;l<t.width;l++){let h=1;t:for(let e=0;e<r;e++)for(let r=0;r<n;r++){if(1!==i[r][e])continue;let n=r-s+l,u=e-o+a;if(!(u<0||n<0||n>=t.width||u>=t.height)&&0===t.getBitXY(n,u)){h=0;break t}}1===h&&e.setBitXY(l,a)}return e}function p_(t,e,i,n){const r=(i-1)/2,s=(n-1)/2,o=[];for(let e=0;e<t.width;e++)o.push(0);for(let i=0;i<t.height;i++){for(let e=0;e<t.width;e++){o[e]=1;for(let n=Math.max(0,i-s);n<Math.min(t.height,i+s+1);n++)if(0===t.getBitXY(e,n)){o[e]=0;break}}for(let n=0;n<t.width;n++)if(0!==e.getBitXY(n,i))for(let s=Math.max(0,n-r);s<Math.min(t.width,n+r+1);s++)if(0===o[s]){e.clearBitXY(n,i);break}}return e}function m_(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:i=1}=t;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let t=0;t<i;t++)n=n.erode({kernel:e}),n=n.dilate({kernel:e});return n}function __(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:i=1}=t;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let t=0;t<i;t++)n=n.dilate({kernel:e}).erode({kernel:e});return n}function w_(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:i=1}=t;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),e.length%2==0||e[0].length%2==0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let t=0;t<i;t++){let t=n.open({kernel:e});n=t.subtractImage(n,{absolute:!0})}return n}function y_(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:i=1}=t;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let t=0;t<i;t++){const t=n.close({kernel:e});n=t.subtractImage(n,{absolute:!0})}return n}function v_(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:i=1}=t;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let t=0;t<i;t++){let t=n.dilate({kernel:e}),i=n.erode({kernel:e});n=t.subtractImage(i,{absolute:!0})}return n}function b_(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function x_(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function M_(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function k_(t,e,i,n,r,s,o,a,l,h,u,c){let[d,f]=[(i*t+n*e+r)/(l*t+h*e+1),(s*t+o*e+a)/(l*t+h*e+1)];return u.getValueXY(Math.floor(d),Math.floor(f),c)}function S_(t,e={}){let{calculateRatio:i=!0}=e;if(4!==t.length)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${t.length} elements`);let n,r,[s,o,a,l]=t,h=[s,o,a,l],[u,c,d,f]=function(t){let e=0,i=0,n=0,r=0,s=t[0][0],o=0;for(let e=1;e<t.length;e++)t[e][0]<s&&(s=t[e][0],o=e);let a=t[(o+1)%t.length][0],l=(o+1)%t.length;for(let e=1;e<t.length;e++)t[e][0]<a&&e!==o&&(a=t[e][0],l=e);return t[l][1]<t[o][1]?(e=t[l],r=t[o],o!==(l+1)%4?(i=t[(l+1)%4],n=t[(l+2)%4]):(i=t[(l+2)%4],n=t[(l+3)%4])):(r=t[l],e=t[o],l!==(o+1)%4?(i=t[(o+1)%4],n=t[(o+2)%4]):(i=t[(o+2)%4],n=t[(o+3)%4])),[e,i,n,r]}(h);i?[n,r]=function(t,e,i,n,r,s){let o=Math.max(b_(t,e),b_(n,i)),a=Math.max(b_(t,n),b_(e,i)),l=0,h=0,u=Math.ceil(r/2),c=Math.ceil(s/2),d=o/a,f=[t[0],t[1],1],g=[e[0],e[1],1],p=[n[0],n[1],1],m=[i[0],i[1],1],_=M_(x_(f,m),p)/M_(x_(g,m),p),w=M_(x_(f,m),g)/M_(x_(p,m),g),y=[_*g[0]-f[0],_*g[1]-f[1],_*g[2]-f[2]],v=[w*p[0]-f[0],w*p[1]-f[1],w*p[2]-f[2]],b=y[0],x=y[1],M=y[2],k=v[0],S=v[1],E=v[2],C=1/(M*E)*(b*k-(b*E+M*k)*u+M*E*u*u+(x*S-(x*E+M*S)*c+M*E*c*c));C=C>=0?Math.sqrt(C):Math.sqrt(-C);let I=new Pm([[C,0,u],[0,C,c],[0,0,1]]),A=I.transpose(),T=Lm(A),R=Lm(I),P=Pm.rowVector(y),D=Pm.rowVector(v),F=Math.sqrt(M_(P.mmul(T).mmul(R).to1DArray(),y)/M_(D.mmul(T).mmul(R).to1DArray(),v));return 0===F||0===d?(l=Math.ceil(o),h=Math.ceil(a)):F<d?(l=Math.ceil(o),h=Math.ceil(l/F)):(h=Math.ceil(a),l=Math.ceil(F*h)),[l,h]}(u,c,d,f,this.width,this.height):(n=Math.ceil(Math.max(b_(u,c),b_(f,d))),r=Math.ceil(Math.max(b_(u,f),b_(c,d))));let g=rv.createFrom(this,{width:n,height:r}),[p,m]=u,[_,w]=c,[y,v]=d,[b,x]=f,[M,k]=[0,0],[S,E]=[0,n-1],[C,I]=[r-1,n-1],[A,T]=[r-1,0],R=new Pm([[M,k,1,0,0,0,-M*p,-k*p],[S,E,1,0,0,0,-S*_,-E*_],[C,I,1,0,0,0,-C*y,-k*y],[A,T,1,0,0,0,-A*b,-T*b],[0,0,0,M,k,1,-M*m,-k*m],[0,0,0,S,E,1,-S*w,-E*w],[0,0,0,C,I,1,-C*v,-I*v],[0,0,0,A,T,1,-A*x,-T*x]]),P=Pm.columnVector([p,_,y,b,m,w,v,x]),D=new Fm(R).solve(P),[F,L,O,z,N,B,U,G]=D.to1DArray(),X=new Pm(r,n);for(let t=0;t<this.channels;t++){for(let e=0;e<r;e++)for(let i=0;i<n;i++)X.set(e,i,k_(e,i,F,L,O,z,N,B,U,G,this,t));g.setMatrix(X,{channel:t})}return g}function E_(t={}){let{x:e=0,y:i=0,width:n=this.width-e,height:r=this.height-i}=t;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),e=Math.round(e),i=Math.round(i),n=Math.round(n),r=Math.round(r),e>this.width-1||i>this.height-1)throw new RangeError(`crop: origin (x:${e}, y:${i}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||r<=0)throw new RangeError(`crop: width and height (width:${n}; height:${r}) must be positive numbers`);if(e<0||i<0)throw new RangeError(`crop: x and y (x:${e}, y:${i}) must be positive numbers`);if(n>this.width-e||r>this.height-i)throw new RangeError(`crop: (x: ${e}, y:${i}, width:${n}, height:${r}) size is out of range`);let s=this;return s=1===this.bitDepth?function(t,e,i,n,r,s){let o=r*t.channels,a=n+s,l=0,h=i*t.channels;for(let i=n;i<a;i++){let n=i*t.width*t.channels+h,r=n+o;for(;n<r;n++)t.getBit(n)&&e.setBit(l),++l}return e}(this,new rv(n,r,{kind:"BINARY",parent:this}),e,i,n,r):function(t,e,i,n,r,s){let o=r*t.channels,a=n+s,l=0,h=i*t.channels;for(let i=n;i<a;i++){let n=i*t.width*t.channels+h,r=n+o;for(;n<r;n++)e.data[l++]=t.data[n]}return e}(this,rv.createFrom(this,{width:n,height:r,position:[e,i]}),e,i,n,r),s}function C_(t={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:e=this.maxValue}=t;let i=function(t,e,i){for(let n=0;n<t.width;n++)for(let r=0;r<t.height;r++)if(t.getValueXY(n,r,i)>=e)return n;return-1}(this,e,this.components);if(-1===i)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=function(t,e,i,n){for(let r=0;r<t.height;r++)for(let s=n;s<t.width;s++)if(t.getValueXY(s,r,i)>=e)return r;return-1}(this,e,this.components,i),r=function(t,e,i,n){for(let r=t.height-1;r>=0;r--)for(let s=n;s<t.width;s++)if(t.getValueXY(s,r,i)>=e)return r;return-1}(this,e,this.components,i),s=function(t,e,i,n,r,s){for(let o=t.width-1;o>=n;o--)for(let n=r;n<=s;n++)if(t.getValueXY(o,n,i)>=e)return o;return-1}(this,e,this.components,i,n,r);return this.crop({x:i,y:n,width:s-i+1,height:r-n+1})}function I_(t,e){if(e<0||e>=t.channels)throw new RangeError(`channel must be included between 0 and ${t.channels-1}. Current value: ${e}`)}const A_={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function T_(t){if("string"!=typeof t)throw new TypeError("interpolation must be a string");if(t=t.toLowerCase(),!A_[t])throw new RangeError(`invalid interpolation algorithm: ${t}`);return A_[t]}function R_(t,e,i){const n=this.width/e,r=this.height/i;if(this.bitDepth>1)for(let s=0;s<e;s++){const e=Math.floor((s+.5)*n);for(let n=0;n<i;n++){const i=Math.floor((n+.5)*r);for(let r=0;r<this.channels;r++)t.setValueXY(s,n,r,this.getValueXY(e,i,r))}}else for(let s=0;s<e;s++){const e=Math.floor((s+.5)*n);for(let n=0;n<i;n++){const i=Math.floor((n+.5)*r);this.getBitXY(e,i)&&t.setBitXY(s,n)}}}function P_(t={}){const{factor:e=1,interpolation:i=A_.nearestneighbor,preserveAspectRatio:n=!0}=t,r=T_(i);let s=t.width,o=t.height;if(s||(s=o&&n?Math.round(o*(this.width/this.height)):this.width),o||(o=n?Math.round(s*(this.height/this.width)):this.height),({width:s,height:o}=function(t,e,i){t=function(t){if("string"==typeof t){const e=t[t.length-1];t=parseFloat(t),"%"===e&&(t/=100)}return t}(t);let n=Math.round(t*e),r=Math.round(t*i);return n<=0&&(n=1),r<=0&&(r=1),{width:n,height:r}}(e,s,o)),s===this.width&&o===this.height){const t=this.clone();return t.position=[0,0],t}let a=Math.round((this.width-s)/2),l=Math.round((this.height-o)/2);const h=rv.createFrom(this,{width:s,height:o,position:[a,l]});if(r!==A_.nearestneighbor)throw new Error(`unsupported resize interpolation: ${r}`);return R_.call(this,h,s,o),h}function D_(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[hp]});let t=rv.createFrom(this,{colorModel:cp}),e=0,i=this.data;for(let n=0;n<i.length;n+=this.channels){let r=i[n],s=i[n+1],o=i[n+2],a=Math.min(r,s,o),l=Math.max(r,s,o),h=l-a,u=0,c=0===l?0:h/l,d=l;if(l!==a){switch(l){case r:u=(s-o)/h+(s<o?6:0);break;case s:u=(o-r)/h+2;break;case o:u=(r-s)/h+4;break;default:throw new Error("unreachable")}u/=6}t.data[e++]=u*this.maxValue,t.data[e++]=c*this.maxValue,t.data[e++]=d,this.alpha&&(t.data[e++]=i[n+3])}return t}function F_(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[hp]});let t=rv.createFrom(this,{colorModel:up}),e=Math.floor(this.maxValue/2),i=0,n=this.data;for(let r=0;r<n.length;r+=this.channels){let s=n[r],o=n[r+1],a=n[r+2],l=Math.max(s,o,a),h=Math.min(s,o,a),u=0,c=0,d=(l+h)/2;if(l!==h){let t=l-h;switch(c=d>e?t/(2-l-h):t/(l+h),l){case s:u=(o-a)/t+(o<a?6:0);break;case o:u=(a-s)/t+2;break;case a:u=(s-o)/t+4;break;default:throw new Error("unreachable")}u/=6}t.data[i++]=u*this.maxValue,t.data[i++]=c*this.maxValue,t.data[i++]=d,this.alpha&&(t.data[i++]=n[r+3])}return t}function L_(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[hp]});let t=rv.createFrom(this,{components:4,colorModel:dp}),e=0,i=this.data;for(let n=0;n<i.length;n+=this.channels){let r=i[n],s=i[n+1],o=i[n+2],a=Math.min(this.maxValue-r,this.maxValue-s,this.maxValue-o),l=(this.maxValue-r-a)/(1-a/this.maxValue),h=(this.maxValue-s-a)/(1-a/this.maxValue),u=(this.maxValue-o-a)/(1-a/this.maxValue);t.data[e++]=Math.round(l),t.data[e++]=Math.round(h),t.data[e++]=Math.round(u),t.data[e++]=Math.round(a),this.alpha&&(t.data[e++]=i[n+3])}return t}function O_(){return new rv(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const z_={luma709:(t,e,i)=>6966*t+23436*e+2366*i>>15,luma601:(t,e,i)=>9798*t+19235*e+3735*i>>15,maximum:(t,e,i)=>Math.max(t,e,i),minimum:(t,e,i)=>Math.min(t,e,i),average:(t,e,i)=>(t+e+i)/3>>0,minmax:(t,e,i)=>(Math.max(t,e,i)+Math.min(t,e,i))/2,red:t=>t,green:(t,e)=>e,blue:(t,e,i)=>i,cyan(t,e,i,n){let r=z_.black(t,e,i,n);return(n.maxValue-t-r)/(1-r/n.maxValue)>>0},magenta(t,e,i,n){let r=z_.black(t,e,i,n);return(n.maxValue-e-r)/(1-r/n.maxValue)>>0},yellow(t,e,i,n){let r=z_.black(t,e,i,n);return(n.maxValue-i-r)/(1-r/n.maxValue)>>0},black:(t,e,i,n)=>Math.min(n.maxValue-t,n.maxValue-e,n.maxValue-i),hue(t,e,i,n){let r=z_.min(t,e,i),s=z_.max(t,e,i);if(s===r)return 0;let o=0,a=s-r;switch(s){case t:o=(e-i)/a+(e<i?6:0);break;case e:o=(i-t)/a+2;break;case i:o=(t-e)/a+4;break;default:throw new Error("unreachable")}return o/6*n.maxValue>>0},saturation(t,e,i,n){let r=z_.min(t,e,i),s=z_.max(t,e,i);return 0===s?0:(s-r)/s*n.maxValue},lightness(t,e,i){let n=z_.min(t,e,i);return(z_.max(t,e,i)+n)/2}};Object.defineProperty(z_,"luminosity",{enumerable:!1,value:z_.lightness}),Object.defineProperty(z_,"luminance",{enumerable:!1,value:z_.lightness}),Object.defineProperty(z_,"min",{enumerable:!1,value:z_.minimum}),Object.defineProperty(z_,"max",{enumerable:!1,value:z_.maximum}),Object.defineProperty(z_,"brightness",{enumerable:!1,value:z_.maximum});const N_={};function B_(t={}){let{algorithm:e="luma709",keepAlpha:i=!1,mergeAlpha:n=!0}=t;if("string"!=typeof e&&"function"!=typeof e)throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),1===this.components&&(e="red"),i&=this.alpha,n&=this.alpha,i&&(n=!1);let r,s=lm(this,t,{components:1,alpha:i,colorModel:lp});if("function"==typeof e)r=e;else if(r=z_[e.toLowerCase()],!r)throw new Error(`unsupported grey algorithm: ${e}`);let o=0;for(let t=0;t<this.data.length;t+=this.channels)n?s.data[o++]=Im(r(this.data[t],this.data[t+1],this.data[t+2],this)*this.data[t+this.components]/this.maxValue,this):(s.data[o++]=Im(r(this.data[t],this.data[t+1],this.data[t+2],this),this),s.alpha&&(s.data[o++]=this.data[t+this.components]));return s}function U_(t){let e=!1,i=0;for(let e=1;e<t.length-1;e++)if(t[e-1]<t[e]&&t[e+1]<t[e]&&(i++,i>2))return!1;return 2===i&&(e=!0),e}function G_(t,e){let i=0;for(let n=0;n<=e;n++)i+=t[n];return i}function X_(t,e){let i=0;for(let n=0;n<=e;n++)i+=n*t[n];return i}function Y_(t,e){let i=0;for(let n=0;n<=e;n++)i+=n*n*t[n];return i}function V_(t){let e=new Array(t.length);for(let i=1;i<t.length-1;i++)e[i]=(t[i-1]+t[i]+t[i+1])/3;return e[0]=(t[0]+t[1])/3,e[t.length-1]=(t[t.length-2]+t[t.length-1])/3,e}function j_(t){let e=t.length,i=!1,n=0;for(let i=1;i<e-1;i++)if(t[i-1]<t[i]&&t[i+1]<t[i]&&(n++,n>2))return!1;return 2===n&&(i=!0),i}function q_(t,e){let i=0;for(let n=0;n<=e;n++)i+=t[n];return i}Object.keys(z_).forEach((t=>{N_[t]=t}));const W_={huang:function(t){let e=0;for(let i=0;i<t.length;i++)if(0!==t[i]){e=i;break}let i=t.length-1;for(let n=t.length-1;n>=e;n--)if(0!==t[n]){i=n;break}let n=1/(i-e),r=new Array(t.length),s=0,o=0;for(let i=e;i<t.length;i++)s+=i*t[i],o+=t[i],r[i]=s/o;let a=new Array(t.length);s=o=0;for(let e=i;e>0;e--)s+=e*t[e],o+=t[e],a[e-1]=s/o;let l=-1,h=Number.MAX_VALUE;for(let e=0;e<t.length;e++){let i,s=0;for(let o=0;o<=e;o++)i=1/(1+n*Math.abs(o-r[e])),i<1e-6||i>.999999||(s+=t[o]*(-i*Math.log(i)-(1-i)*Math.log(1-i)));for(let r=e+1;r<t.length;r++)i=1/(1+n*Math.abs(r-a[e])),i<1e-6||i>.999999||(s+=t[r]*(-i*Math.log(i)-(1-i)*Math.log(1-i)));s<h&&(h=s,l=e)}return l},intermodes:function(t){let e=t.slice(),i=0;for(;!U_(e);){let n=0,r=0,s=e[0];for(let i=0;i<t.length-1;i++)n=r,r=s,s=e[i+1],e[i]=(n+r+s)/3;if(e[t.length-1]=(r+s)/3,i++,i>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let i=1;i<t.length-1;i++)e[i-1]<e[i]&&e[i+1]<e[i]&&(n+=i);return Math.floor(n/2)},isodata:function(t){let e,i,n,r,s=0;for(let e=1;e<t.length;e++)if(t[e]>0){s=e+1;break}for(;;){e=0,n=0;for(let i=0;i<s;i++)n+=t[i],e+=t[i]*i;r=0,i=0;for(let e=s+1;e<t.length;e++)i+=t[e],r+=t[e]*e;if(n>0&&i>0&&(e/=n,r/=i,s===Math.round((e+r)/2)))break;if(s++,s>t.length-2)throw new Error("Threshold not found")}return s},li:function(t,e){let i,n,r,s,o,a,l,h,u,c,d,f;d=.5,c=0;for(let e=0;e<t.length;e++)c+=e*t[e];c/=e,l=c;do{a=l,i=a+.5|0,n=0,s=0;for(let e=0;e<=i;e++)n+=e*t[e],s+=t[e];h=0===s?0:n/s,r=0,o=0;for(let e=i+1;e<t.length;e++)r+=e*t[e],o+=t[e];u=0===o?0:r/o,f=(h-u)/(Math.log(h)-Math.log(u)),l=f<-Number.EPSILON?f-.5|0:f+.5|0}while(Math.abs(l-a)>.5);return i},maxentropy:function(t,e){let i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=t[n]/e;let n=new Array(t.length),r=new Array(t.length);n[0]=i[0],r[0]=1-n[0];for(let e=1;e<t.length;e++)n[e]=n[e-1]+i[e],r[e]=1-n[e];let s=0;for(let e=0;e<t.length;e++)if(Math.abs(n[e])>=Number.EPSILON){s=e;break}let o=t.length-1;for(let e=t.length-1;e>=s;e--)if(Math.abs(r[e])>=Number.EPSILON){o=e;break}let a,l,h,u=-1,c=Number.MIN_VALUE;for(let e=s;e<=o;e++){l=0;for(let r=0;r<=e;r++)0!==t[r]&&(l-=i[r]/n[e]*Math.log(i[r]/n[e]));h=0;for(let n=e+1;n<t.length;n++)0!==t[n]&&(h-=i[n]/r[e]*Math.log(i[n]/r[e]));a=l+h,c<a&&(c=a,u=e)}return u},mean:function(t,e){let i=0;for(let e=0;e<t.length;e++)i+=e*t[e];return Math.floor(i/e)},minerror:function(t,e){let i,n,r,s,o,a,l,h,u,c,d,f,g=-2,p=0;for(let e=0;e<t.length;e++)p+=e*t[e];for(p/=e,i=p;i!==g;){let e=G_(t,i),p=G_(t,t.length-1),m=X_(t,i),_=X_(t,t.length-1),w=Y_(t,i);if(n=m/e,r=(_-m)/(p-e),s=e/p,o=(p-e)/p,a=w/e-n*n,l=(Y_(t,t.length-1)-w)/(p-e)-r*r,h=1/a-1/l,u=n/a-r/l,c=n*n/a-r*r/l+Math.log10(a*(o*o)/(l*(s*s))),d=u*u-h*c,d<0)return i;g=i,f=(u+Math.sqrt(d))/h,i=isNaN(f)?g:Math.floor(f)}return i},minimum:function(t){if(t.length<2)return 0;let e=0,i=-1,n=-1,r=new Array(t.length);for(let e=0;e<t.length;e++)r[e]=t[e],t[e]>0&&(n=e);for(;!j_(r);)if(r=V_(r),e++,e>1e4)return i;return i=function(t,e){let i;for(let n=1;n<e;n++)if(t[n-1]>t[n]&&t[n+1]>=t[n]){i=n;break}return i}(r,n),i},moments:function(t,e){let i,n,r,s,o,a,l=0,h=0,u=0,c=0,d=-1,f=t.length,g=new Array(f);for(let i=0;i<f;i++)g[i]=t[i]/e;for(let t=0;t<f;t++)l+=t*g[t],h+=t*t*g[t],u+=t*t*t*g[t];n=1*h-l*l,r=(-h*h+l*u)/n,s=(1*-u+h*l)/n,o=.5*(-s-Math.sqrt(s*s-4*r)),a=.5*(-s+Math.sqrt(s*s-4*r)),i=(a-l)/(a-o);for(let t=0;t<f;t++)if(c+=g[t],c>i){d=t;break}return d},otsu:function(t,e){let i=0,n=0,r=0,s=0,o=0;for(let e=0;e<t.length;e++)o+=e*t[e];for(let a=0;a<t.length;a++){n+=t[a];const l=e-n;if(0===n||0===l)continue;i+=a*t[a];const h=(o-i)/l,u=n*l*(i/n-h)*(i/n-h);u>=r&&(s=a,r=u)}return s},percentile:function(t){let e=-1,i=new Array(t.length),n=q_(t,t.length-1),r=1;for(let s=0;s<t.length;s++)i[s]=Math.abs(q_(t,s)/n-.5),i[s]<r&&(r=i[s],e=s);return e},renyientropy:function(t,e){let i,n,r,s=new Array(t.length),o=new Array(t.length),a=new Array(t.length),l=0,h=0,u=0,c=0,d=0,f=0;for(let i=0;i<t.length;i++)s[i]=t[i]/e;o[0]=s[0],a[0]=1-o[0];for(let e=1;e<t.length;e++)o[e]=o[e-1]+s[e],a[e]=1-o[e];n=0;for(let e=0;e<t.length;e++)if(Math.abs(o[e])>=Number.EPSILON){n=e;break}r=t.length-1;for(let e=t.length-1;e>=n;e--)if(Math.abs(a[e])>=Number.EPSILON){r=e;break}for(let e=n;e<=r;e++){let i=0,n=0,r=0;for(let a=0;a<=e;a++)0!==t[a]&&(i-=s[a]/o[e]*Math.log(s[a]/o[e])),n+=Math.sqrt(s[a]/o[e]),r+=s[a]*s[a]/(o[e]*o[e]);let g=0,p=0,m=0;for(let i=e+1;i<t.length;i++)0!==t[i]&&(g-=s[i]/a[e]*Math.log(s[i]/a[e])),p+=Math.sqrt(s[i]/a[e]),m+=s[i]*s[i]/(a[e]*a[e]);let _=i+g,w=2*(n*p>0?Math.log(n*p):0),y=-1*(r*m>0?Math.log(r*m):0);_>c&&(c=_,l=e),w>d&&(d=w,h=e),y>f&&(f=y,u=e)}let g,p=[l,h,u];p.sort(((t,e)=>t-e)),g=Math.abs(p[0]-p[1])<=5?Math.abs(p[1]-p[2])<=5?[1,2,1]:[0,1,3]:Math.abs(p[1]-p[2])<=5?[3,1,0]:[1,2,1];let m=o[p[2]]-o[p[0]];return i=Math.round(p[0]*(o[p[0]]+.25*m*g[0])+.25*p[1]*m*g[1]+p[2]*(a[p[2]]+.25*m*g[2])),i},shanbhag:function(t,e){let i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=t[n]/e;let n=new Array(t.length),r=new Array(t.length);n[0]=i[0],r[0]=1-n[0];for(let e=1;e<t.length;e++)n[e]=n[e-1]+i[e],r[e]=1-n[e];let s=0;for(let e=0;e<t.length;e++)if(Math.abs(n[e])>=Number.EPSILON){s=e;break}let o=t.length-1;for(let e=t.length-1;e>=s;e--)if(Math.abs(r[e])>=Number.EPSILON){o=e;break}let a,l,h,u,c=-1,d=Number.MAX_VALUE;for(let e=s;e<=o;e++){h=0,a=.5/n[e];for(let t=1;t<=e;t++)h-=i[t]*Math.log(1-a*n[t-1]);h*=a,u=0,a=.5/r[e];for(let n=e+1;n<t.length;n++)u-=i[n]*Math.log(1-a*r[n]);u*=a,l=Math.abs(h-u),l<d&&(d=l,c=e)}return c},triangle:function(t){let e=0,i=0,n=0,r=0;for(let i=0;i<t.length;i++)if(t[i]>0){e=i;break}e>0&&e--;for(let e=t.length-1;e>0;e--)if(t[e]>0){r=e;break}r<t.length-1&&r++;for(let e=0;e<t.length;e++)t[e]>i&&(n=e,i=t[e]);let s,o,a,l=!1;if(n-e<r-n){l=!0;let i=0,s=t.length-1;for(;i<s;){let e=t[i];t[i]=t[s],t[s]=e,i++,s--}e=t.length-1-r,n=t.length-1-n}if(e===n)return e;s=t[n],o=e-n,a=Math.sqrt(s*s+o*o),s/=a,o/=a,a=s*e+o*t[e];let h=e,u=0;for(let i=e+1;i<=n;i++){let e=s*i+o*t[i]-a;e>u&&(h=i,u=e)}if(h--,l){let e=0,i=t.length-1;for(;e<i;){let n=t[e];t[e]=t[i],t[i]=n,e++,i--}return t.length-1-h}return h},yen:function(t,e){let i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=t[n]/e;let n=new Array(t.length);n[0]=i[0];for(let e=1;e<t.length;e++)n[e]=n[e-1]+i[e];let r=new Array(t.length);r[0]=i[0]*i[0];for(let e=1;e<t.length;e++)r[e]=r[e-1]+i[e]*i[e];let s=new Array(t.length);s[t.length-1]=0;for(let e=t.length-2;e>=0;e--)s[e]=s[e+1]+i[e+1]*i[e+1];let o,a=-1,l=Number.MIN_VALUE;for(let e=0;e<t.length;e++)o=-1*(r[e]*s[e]>0?Math.log(r[e]*s[e]):0)+2*(n[e]*(1-n[e])>0?Math.log(n[e]*(1-n[e])):0),o>l&&(l=o,a=e);return a}},$_={};function Z_(t={}){let{algorithm:e=$_.otsu}=t;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let i=W_[e.toLowerCase()];if(i)return i(this.getHistogram(),this.size);throw new Error(`unknown thresholding algorithm: ${e}`)}Object.keys(W_).forEach((t=>{$_[t]=t}));const H_="threshold";function K_(t={}){let{algorithm:e=H_,threshold:i=.5,useAlpha:n=!0,invert:r=!1}=t;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),i=e===H_?function(t,e){if(!e)throw Error("getThreshold : the maxValue should be specified");if("string"==typeof t){if("%"!==t[t.length-1])throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(t)/100*e}if("number"==typeof t)return t<1?t*e:t;throw Error("getThreshold : the value is not valid")}(i,this.maxValue):Z_.call(this,t);let s=new rv(this.width,this.height,{kind:"BINARY",parent:this}),o=0;if(this.alpha&&n)for(let t=0;t<this.data.length;t+=this.channels){let e=this.data[t]+(this.maxValue-this.data[t])*(this.maxValue-this.data[t+1])/this.maxValue;(r&&e<=i||!r&&e>=i)&&s.setBit(o),o++}else for(let t=0;t<this.data.length;t+=this.channels)(r&&this.data[t]<=i||!r&&this.data[t]>=i)&&s.setBit(o),o++;return s}function J_(t={}){let{size:e=0,algorithm:i="copy",color:n}=t;if(this.checkProcessable("pad",{bitDepth:[8,16]}),"set"===i){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let t=0;t<n.length;t++)0===n[t]&&(n[t]=.001)}else n=Xm()(this.channels,null);Array.isArray(e)||(e=[e,e]);let r=this.width+2*e[0],s=this.height+2*e[1],o=this.channels,a=rv.createFrom(this,{width:r,height:s});!function(t,e,i,n){let r=t.width,s=t.height,o=e.width,a=t.channels;for(let l=0;l<r;l++)for(let h=0;h<s;h++)for(let s=0;s<a;s++){let u=(h*r+l)*a+s,c=((n+h)*o+i+l)*a+s;e.data[c]=t.data[u]}}(this,a,e[0],e[1]);for(let t=e[0];t<r-e[0];t++)for(let i=0;i<o;i++){let l=n[i]||a.data[(e[1]*r+t)*o+i];for(let n=0;n<e[1];n++)a.data[(n*r+t)*o+i]=l;l=n[i]||a.data[((s-e[1]-1)*r+t)*o+i];for(let n=s-e[1];n<s;n++)a.data[(n*r+t)*o+i]=l}for(let t=0;t<s;t++)for(let i=0;i<o;i++){let s=n[i]||a.data[(t*r+e[0])*o+i];for(let n=0;n<e[0];n++)a.data[(t*r+n)*o+i]=s;s=n[i]||a.data[(t*r+r-e[0]-1)*o+i];for(let n=r-e[0];n<r;n++)a.data[(t*r+n)*o+i]=s}return a}function Q_(t=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(t))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===t)return this.clone();let e=rv.createFrom(this,{bitDepth:t});switch(t){case 8:if(1===this.bitDepth)for(let t=0;t<this.size;t++)this.getBit(t)&&(e.data[t]=255);else for(let t=0;t<this.data.length;t++)e.data[t]=this.data[t]>>8;break;case 16:if(1===this.bitDepth)for(let t=0;t<this.size;t++)this.getBit(t)&&(e.data[t]=65535);else for(let t=0;t<this.data.length;t++)e.data[t]=this.data[t]<<8|this.data[t];break;default:throw new Error("colorDepth conversion unexpected case")}return e}function tw(t,e={}){const{interpolation:i=A_.nearestneighbor,width:n=this.width,height:r=this.height}=e;if("number"!=typeof t)throw new TypeError("degrees must be a number");const s=T_(i),o=t*Math.PI/180,a=Math.floor(Math.abs(n*Math.cos(o))+Math.abs(r*Math.sin(o))),l=Math.floor(Math.abs(r*Math.cos(o))+Math.abs(n*Math.sin(o))),h=Math.cos(-o),u=Math.sin(-o);let c=a/2,d=l/2;a%2==0?(c-=.5,l%2==0?d-=.5:d=Math.floor(d)):(c=Math.floor(c),l%2==0?d-=.5:d=Math.floor(d));const f=Math.floor(n/2-c),g=Math.floor(r/2-d);if(1===this.bitDepth){const t=new rv(a,l,{kind:"BINARY",parent:this});switch(s){case A_.nearestneighbor:return function(t,e,i,n,r,s,o,a){for(let l=0;l<e.width;l+=1)for(let h=0;h<e.height;h+=1){let u=Math.round((l-r)*o-(h-s)*a+r)+i,c=Math.round((h-s)*o+(l-r)*a+s)+n;(u<0||u>=t.width||c<0||c>=t.height||t.getBitXY(u,c))&&e.setBitXY(l,h)}return e}(this,t,f,g,c,d,h,u);case A_.bilinear:return function(t,e,i,n,r,s,o,a){let l=t.width;for(let h=0;h<e.height;h++)for(let u=0;u<e.width;u++){let c=(u-r)*o-(h-s)*a+r+i,d=(h-s)*o+(u-r)*a+s+n,f=0|c,g=0|d,p=c-f,m=d-g;if(c<0||c>=t.width||d<0||d>=t.height)e.setBitXY(u,h);else{let i=g*t.width+f,n=t.getBit(i),r=t.getBit(i+1),s=t.getBit(i+l);(n|p&r-n|m&s-n|p&m&n-r-s+t.getBit(i+1+l))>0&&e.setBitXY(u,h)}}return e}(this,t,f,g,c,d,h,u);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}else{const t=rv.createFrom(this,{width:a,height:l});switch(s){case A_.nearestneighbor:return function(t,e,i,n,r,s,o,a){for(let l=0;l<e.width;l+=1)for(let h=0;h<e.height;h+=1)for(let u=0;u<t.channels;u++){let c=Math.round((l-r)*o-(h-s)*a+r)+i,d=Math.round((h-s)*o+(l-r)*a+s)+n;c<0||c>=t.width||d<0||d>=t.height?1===t.alpha&&u===t.channels-1?e.setValueXY(l,h,u,0):e.setValueXY(l,h,u,t.maxValue):e.setValueXY(l,h,u,t.getValueXY(c,d,u))}return e}(this,t,f,g,c,d,h,u);case A_.bilinear:return function(t,e,i,n,r,s,o,a){let l=t.width*t.channels;for(let h=0;h<e.height;h++)for(let u=0;u<e.width;u++){let c=(u-r)*o-(h-s)*a+r+i,d=(h-s)*o+(u-r)*a+s+n,f=0|c,g=0|d,p=c-f,m=d-g;for(let i=0;i<t.channels;i++)if(c<0||c>=t.width||d<0||d>=t.height)1===t.alpha&&i===t.channels-1?e.setValueXY(u,h,i,0):e.setValueXY(u,h,i,t.maxValue);else{let n=(g*t.width+f)*t.channels+i,r=t.data[n],s=t.data[n+t.channels],o=t.data[n+l],a=r+p*(s-r)+m*(o-r)+p*m*(r-s-o+t.data[n+l+t.channels])|0;e.setValueXY(u,h,i,a)}}return e}(this,t,f,g,c,d,h,u);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}}function ew(t,e){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),"number"!=typeof t)throw new TypeError("angle must be a number");switch(t<0&&(t=360*Math.ceil(-t/360)+t),t%360){case 0:return this.clone();case 90:return nw.call(this);case 180:return rw.call(this);case 270:return iw.call(this);default:return tw.call(this,t,e)}}function iw(){if(1===this.bitDepth){const t=new rv(this.height,this.width,{kind:"BINARY",parent:this}),e=t.height-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)this.getBitXY(n,i)&&t.setBitXY(i,e-n);return t}{const t=rv.createFrom(this,{width:this.height,height:this.width}),e=t.height-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)for(let r=0;r<this.channels;r++)t.setValueXY(i,e-n,r,this.getValueXY(n,i,r));return t}}function nw(){if(1===this.bitDepth){const t=new rv(this.height,this.width,{kind:"BINARY",parent:this}),e=t.width-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)this.getBitXY(n,i)&&t.setBitXY(e-i,n);return t}{const t=rv.createFrom(this,{width:this.height,height:this.width}),e=t.width-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)for(let r=0;r<this.channels;r++)t.setValueXY(e-i,n,r,this.getValueXY(n,i,r));return t}}function rw(){if(1===this.bitDepth){const t=new rv(this.width,this.height,{kind:"BINARY",parent:this}),e=t.width-1,i=t.height-1;for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++)this.getBitXY(r,n)&&t.setBitXY(e-r,i-n);return t}{const t=rv.createFrom(this),e=t.width-1,i=t.height-1;for(let n=0;n<this.height;n++)for(let r=0;r<this.width;r++)for(let s=0;s<this.channels;s++)t.setValueXY(e-r,i-n,s,this.getValueXY(r,n,s));return t}}function sw(t,e={}){const i=am(t);this.checkProcessable("insert",i);let{x:n=0,y:r=0}=e;const s=hm(this,e,{copy:!0}),o=Math.min(s.height,r+t.height),a=Math.min(s.width,n+t.width);if(1===s.bitDepth)for(let e=r;e<o;e++)for(let i=n;i<a;i++)t.getBitXY(i-n,e-r)?s.setBitXY(i,e):s.clearBitXY(i,e);else for(let e=r;e<o;e++)for(let i=n;i<a;i++)s.setPixelXY(i,e,t.getPixelXY(i-n,e-r));return s}function ow(t={}){let{size:e=0,algorithm:i="copy",color:n}=t;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),"set"===i){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let t=0;t<n.length;t++)0===n[t]&&(n[t]=.001)}else n=Xm()(this.channels,null);Array.isArray(e)||(e=[e,e]);let r=e[0],s=e[1],o=this.channels;for(let t=r;t<this.width-r;t++)for(let e=0;e<o;e++){let i=n[e]||this.data[(t+this.width*s)*o+e];for(let n=0;n<s;n++)this.data[(n*this.width+t)*o+e]=i;i=n[e]||this.data[(t+this.width*(this.height-s-1))*o+e];for(let n=this.height-s;n<this.height;n++)this.data[(n*this.width+t)*o+e]=i}for(let t=0;t<this.height;t++)for(let e=0;e<o;e++){let i=n[e]||this.data[(t*this.width+r)*o+e];for(let n=0;n<r;n++)this.data[(t*this.width+n)*o+e]=i;i=n[e]||this.data[(t*this.width+this.width-r-1)*o+e];for(let n=this.width-r;n<this.width;n++)this.data[(t*this.width+n)*o+e]=i}return this}function aw(t={}){let{preserveAlpha:e=!0}=t;if(this.checkProcessable("split",{bitDepth:[8,16]}),1===this.components)return new tm([this.clone()]);let i=new tm,n=this.data;if(this.alpha&&e)for(let t=0;t<this.components;t++){let e=rv.createFrom(this,{components:1,alpha:!0,colorModel:lp}),r=0;for(let i=0;i<n.length;i+=this.channels)e.data[r++]=n[i+t],e.data[r++]=n[i+this.components];i.push(e)}else for(let t=0;t<this.channels;t++){let e=rv.createFrom(this,{components:1,alpha:!1,colorModel:lp}),r=0;for(let i=0;i<n.length;i+=this.channels)e.data[r++]=n[i+t];i.push(e)}return i}function lw(t,e={}){let{keepAlpha:i=!1,mergeAlpha:n=!1}=e;i&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),t=wm(this,t);let r=rv.createFrom(this,{components:1,alpha:i,colorModel:lp}),s=0;for(let e=0;e<this.data.length;e+=this.channels)n?r.data[s++]=this.data[e+t]*this.data[e+this.components]/this.maxValue:(r.data[s++]=this.data[e+t],i&&(r.data[s++]=this.data[e+this.components]));return r}function hw(t=uw,e={}){let{mergeAlpha:i=!1,keepAlpha:n=!1}=e;i&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let r=rv.createFrom(this,{components:1,alpha:n,colorModel:lp}),s=0;for(let e=0;e<this.size;e++){let o=t(this.getPixel(e));i?r.data[s++]=o*this.data[e*this.channels+this.components]/this.maxValue:(r.data[s++]=o,n&&(r.data[s++]=this.data[e*this.channels+this.components]))}return r}function uw(t){return(t[0]+t[1]+t[2])/3}function cw(t,e){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),e.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),e.width!==this.width||e.height!==this.height)throw new Error("Images must have exactly the same width and height");let i=t=wm(this,t);for(let t=0;t<e.data.length;t++)this.data[i]=e.data[t],i+=this.channels;return this}function dw(t,e={}){let{shift:i=[0,0],average:n,channels:r,defaultAlpha:s,normalize:o,border:a=[0,0]}=e;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(a)||(a=[a,a]),r=_m(this,{channels:r,defaultAlpha:s}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");void 0===n&&(n=!0);let l=Math.max(a[0],-i[0]),h=Math.min(this.width-a[0],this.width-i[0]),u=Math.max(a[1],-i[1]),c=Math.min(this.height-a[1],this.height-i[1]),d=Xm()(r.length,0);for(let e=0;e<r.length;e++){let n=r[e],s=o?this.sum[n]:Math.max(this.sum[n],t.sum[n]),a=o?t.sum[n]:Math.max(this.sum[n],t.sum[n]);if(0!==s&&0!==a)for(let r=l;r<h;r++)for(let o=u;o<c;o++){let l=r*this.multiplierX+o*this.multiplierY+n,h=l+i[0]*this.multiplierX+i[1]*this.multiplierY;d[e]+=Math.min(this.data[l]/s,t.data[h]/a)}}return n?d.reduce(((t,e)=>t+e))/d.length:d}function fw(t={}){let{sampling:e=[10,10],painted:i=!1,mask:n}=t;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(e)||(e=[e,e]);const r=e[0],s=e[1],o=[],a=[],l=this.width/r,h=this.height/s;let u=Math.floor(l/2);for(let t=0;t<r;t++){let t=Math.floor(h/2);for(let e=0;e<s;e++){let e=Math.round(u),i=Math.round(t);n&&!n.getBitXY(e,i)||(o.push([e,i]),a.push(this.getPixelXY(e,i))),t+=h}u+=l}const c={xyS:o,zS:a};return i&&(c.painted=this.rgba8().paintPoints(o)),c}function gw(t,e,i){const n=new Array(t);for(let i=0;i<t;i++)n[i]=new Array(e);if(i)for(let r=0;r<t;r++)for(let t=0;t<e;t++)n[r][t]=i;return n.width=t,n.height=e,Object.setPrototypeOf(n,gw.prototype),n}function pw(t,e={}){let{border:i}=e;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");let n=new gw(t.width,t.height,-1/0),r=Math.floor(t.width/2),s=Math.floor(t.height/2),o=r,a=s,l=!1;for(;!l;){let e=n.localSearch(r,s,-1/0);for(let r=0;r<e.length;r++){let s=e[r],l=this.getSimilarity(t,{border:i,shift:[o-s[0],a-s[1]]});n[s[0]][s[1]]=l}let h=n.localMax(r,s);h.position[0]!==r||h.position[1]!==s?(r=h.position[0],s=h.position[1]):l=!0}return[r-o,s-a]}function mw(t,e=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),function(t,e){if(e<0||e>=t.height)throw new RangeError(`row must be included between 0 and ${t.height-1}. Current value: ${e}`)}(this,t),I_(this,e);let i=new Array(this.width),n=0,r=t*this.width*this.channels+e,s=r+this.width*this.channels;for(let t=r;t<s;t+=this.channels)i[n++]=this.data[t];return i}function _w(t,e=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),function(t,e){if(e<0||e>=t.width)throw new RangeError(`column must be included between 0 and ${t.width-1}. Current value: ${e}`)}(this,t),I_(this,e);let i=new Array(this.height),n=0,r=this.width*this.channels;for(let s=e+t*this.channels;s<this.data.length;s+=r)i[n++]=this.data[s];return i}function ww(t={}){let{channel:e}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),void 0===e){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}let i=new Pm(this.height,this.width);for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)i.set(t,n,this.getValueXY(n,t,e));return i}function yw(t,e={}){t=new Pm(t);let{channel:i}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),void 0===i){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");i=0}if(this.width!==t.columns||this.height!==t.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)this.setValueXY(n,e,i,t.get(e,n));return this}function vw(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let t=new Array(this.size),e=0;for(let i=0;i<this.data.length;i+=this.channels){let n=new Array(this.components);for(let t=0;t<this.components;t++)n[t]=this.data[i+t];t[e++]=n}return t}function bw(t){let e=this,i=e.getClosestCommonParent(t),n=e.getRelativePosition(i,{defaultFurther:!0}),r=xw(e,n),s=t.getRelativePosition(i,{defaultFurther:!0}),o=xw(t,s),a=function(t,e){let i=0,n=0,r=[];for(;i<t.length&&n<e.length;)t[i][0]===e[n][0]&&t[i][1]===e[n][1]?(r.push(t[i]),i++,n++):t[i][0]<e[n][0]||t[i][0]===e[n][0]&&t[i][1]<e[n][1]?i++:n++;return r}(r,o),l={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let i=0;i<a.length;i++){let r=a[i],o=[r[0]-n[0],r[1]-n[1]],h=[r[0]-s[0],r[1]-s[1]],u=e.getBitXY(o[0],o[1]),c=t.getBitXY(h[0],h[1]);1===u&&1===c&&l.commonWhitePixels.push(r)}for(let t=0;t<r.length;t++){let i,n;0!==t&&(i=Math.floor(t/e.width),n=t%e.width),1===e.getBitXY(i,n)&&l.whitePixelsMask1.push(r[t])}for(let e=0;e<o.length;e++){let i=0,n=0;0!==e&&(i=Math.floor(e/t.width),n=e%t.width),1===t.getBitXY(i,n)&&l.whitePixelsMask2.push(o[e])}return l}function xw(t,e){let i=[];for(let n=0;n<t.height;n++)for(let r=0;r<t.width;r++){let t=[n,r];i.push([t[0]+e[0],t[1]+e[1]])}return i}function Mw(t){let e,i=kw(this),n=kw(t);if(e=i>=n?Sw(this,i):Sw(t,n),0===i||0===n)return e;let r=this,s=t;for(;i!==n;)if(i>n){if(r=r.parent,null===r)return e;i-=1}else{if(s=s.parent,null===s)return e;n-=1}for(;r!==s&&null!==r&&null!==s;)if(r=r.parent,s=s.parent,null===r||null===s)return e;return r!==s?e:r}function kw(t){let e=0,i=t;for(;null!=i.parent;)i=i.parent,e++;return e}function Sw(t,e){let i=t;for(;e>0;)i=i.parent,e-=1;return i}gw.prototype.localMin=function(t,e){let i=this[t][e],n=[t,e];for(let r=Math.max(0,t-1);r<Math.min(this.length,t+2);r++)for(let t=Math.max(0,e-1);t<Math.min(this[0].length,e+2);t++)this[r][t]<i&&(i=this[r][t],n=[r,t]);return{position:n,value:i}},gw.prototype.localMax=function(t,e){let i=this[t][e],n=[t,e];for(let r=Math.max(0,t-1);r<Math.min(this.length,t+2);r++)for(let t=Math.max(0,e-1);t<Math.min(this[0].length,e+2);t++)this[r][t]>i&&(i=this[r][t],n=[r,t]);return{position:n,value:i}},gw.prototype.localSearch=function(t,e,i){let n=[];for(let r=Math.max(0,t-1);r<Math.min(this.length,t+2);r++)for(let t=Math.max(0,e-1);t<Math.min(this[0].length,e+2);t++)this[r][t]===i&&n.push([r,t]);return n};const Ew={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Cw=[[-1,0,1],[-2,0,2],[-1,0,1]],Iw=[[-1,-2,-1],[0,0,0],[1,2,1]],Aw={bitDepth:32,mode:"periodic"};function Tw(t){return function(t,e){t.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),e=Object.assign({},Ew,e);const i=t.width,n=t.height,r=t.maxValue,s={sigma:e.gaussianBlur,radius:3},o=t.gaussianFilter(s),a=o.convolution(Iw,Aw),l=o.convolution(Cw,Aw),h=l.hypotenuse(a),u=t.constructor,c=new u(i,n,{kind:"GREY",bitDepth:32}),d=new u(i,n,{kind:"GREY",bitDepth:32}),f=new u(i,n,{kind:"GREY"});for(var g=1;g<i-1;g++)for(var p=1;p<n-1;p++){var m=(Math.round(Math.atan2(l.getValueXY(g,p,0),a.getValueXY(g,p,0))*(5/Math.PI))+5)%5;0===m&&(h.getValueXY(g,p,0)<=h.getValueXY(g,p-1,0)||h.getValueXY(g,p,0)<=h.getValueXY(g,p+1,0))||1===m&&(h.getValueXY(g,p,0)<=h.getValueXY(g-1,p+1,0)||h.getValueXY(g,p,0)<=h.getValueXY(g+1,p-1,0))||2===m&&(h.getValueXY(g,p,0)<=h.getValueXY(g-1,p,0)||h.getValueXY(g,p,0)<=h.getValueXY(g+1,p,0))||3===m&&(h.getValueXY(g,p,0)<=h.getValueXY(g-1,p-1,0)||h.getValueXY(g,p,0)<=h.getValueXY(g+1,p+1,0))||c.setValueXY(g,p,0,h.getValueXY(g,p,0))}for(g=0;g<i*n;++g){var _=c.data[g],w=0;_>e.highThreshold&&(w++,f.data[g]=r),_>e.lowThreshold&&w++,d.data[g]=w}var y=[];for(g=1;g<i-1;++g)for(p=1;p<n-1;++p)if(1===d.getValueXY(g,p,0))t:for(var v=g-1;v<g+2;++v)for(var b=p-1;b<p+2;++b)if(2===d.getValueXY(v,b,0)){y.push([g,p]),f.setValueXY(g,p,0,r);break t}for(;y.length>0;){var x=[];for(g=0;g<y.length;++g)for(p=-1;p<2;++p)for(v=-1;v<2;++v)if(0!==p||0!==v){var M=y[g][0]+p,k=y[g][1]+v;1===d.getValueXY(M,k,0)&&0===f.getValueXY(M,k,0)&&(x.push([M,k]),f.setValueXY(M,k,0,r))}y=x}return f}(this,t)}function Rw(t,e={}){let{position:i}=e;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!i&&(i=t.getRelativePosition(this),!i))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let e=rv.createFrom(this,{width:t.width,height:t.height,alpha:1,position:i,parent:this});for(let n=0;n<t.width;n++)for(let r=0;r<t.height;r++){for(let t=0;t<this.channels;t++){let s=this.getValueXY(n+i[0],r+i[1],t);e.setValueXY(n,r,t,s)}t.getBitXY(n,r)||e.setValueXY(n,r,this.components,0)}return e}{let e=rv.createFrom(this,{width:t.width,height:t.height,position:i,parent:this});for(let n=0;n<t.height;n++)for(let r=0;r<t.width;r++)t.getBitXY(r,n)&&this.getBitXY(r+i[0],n+i[1])&&e.setBitXY(r,n);return e}}var Pw=__webpack_require__(8737),Dw=__webpack_require__.n(Pw);function Fw(t={}){const{x:e=0,y:i=0,inPlace:n=!0}=t,r=n?this:rv.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(e,i))return r;const s=new(Dw());for(s.push(new Lw(e,i));s.length>0;){const t=s.shift();r.setBitXY(t.x,t.y);for(let e=t.x+1;e<this.width&&!r.getBitXY(e,t.y)&&!this.getBitXY(e,t.y);e++)r.setBitXY(e,t.y),t.y+1<this.height&&!this.getBitXY(e,t.y+1)&&s.push(new Lw(e,t.y+1)),t.y-1>=0&&!this.getBitXY(e,t.y-1)&&s.push(new Lw(e,t.y-1));for(let e=t.x-1;e>=0&&!r.getBitXY(e,t.y)&&!this.getBitXY(e,t.y);e++)r.setBitXY(e,t.y),t.y+1<this.height&&!this.getBitXY(e,t.y+1)&&s.push(new Lw(e,t.y+1)),t.y-1>=0&&!this.getBitXY(e,t.y-1)&&s.push(new Lw(e,t.y-1))}return r}function Lw(t,e){this.x=t,this.y=e}function Ow(){return Ow=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Ow.apply(this,arguments)}function zw(t,e,i){var n=function(t,e,i){return{h:t,s:2*(e*=(i<50?i:100-i)/100)/(i+e)*100,v:i+e}}(t,e,i);return function(t,e,i){var n,r=(i/=100)*(e/=100),s=t/60,o=r*(1-Math.abs(s%2-1)),a=i-r;return n=s>=0&&s<1?[r,o,0]:s>=1&&s<2?[o,r,0]:s>=2&&s<3?[0,r,o]:t>=3&&s<4?[0,o,r]:t>=4&&s<5?[o,0,r]:t>=5&&s<=6?[r,0,o]:[0,0,0],{r:Math.round(255*(n[0]+a)),g:Math.round(255*(n[1]+a)),b:Math.round(255*(n[2]+a))}}(n.h,n.s,n.v)}var Nw={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function Bw(t){let e=function(t){var e=Nw[t.toLowerCase()];if(e)return{r:e[0],g:e[1],b:e[2],a:100}}(i=t)||function(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:100}}(i)||function(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:100}}(i)||function(t){var e=t.match(/rgb\(([^)]+)\)/);if(e){var i=e[1].split(/ *, */).map(Number);return{r:i[0],g:i[1],b:i[2],a:100}}}(i)||function(t){var e=t.match(/rgba\(([^)]+)\)/);if(e){var i=e[1].split(/ *, */).map(Number);return{r:i[0],g:i[1],b:i[2],a:100*i[3]}}}(i)||function(t){var e=t.match(/hsl\(([^)]+)\)/);if(e){var i=e[1].split(/ *, */);return Ow({},zw(parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)),{a:100})}}(i)||function(t){var e=t.match(/hsla\(([^)]+)\)/);if(e){var i=e[1].split(/ *, */),n=parseInt(i[0],10),r=parseInt(i[1],10),s=parseInt(i[2],10),o=parseInt(100*parseFloat(i[3]),10);return Ow({},zw(n,r,s),{a:o})}}(i);var i;return[e.r,e.g,e.b,Math.round(255*e.a/100)]}function Uw(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function Gw(t,e,i){let n,r,s,o,a,l;return i/=100,0==(e/=100)?o=a=l=255*i:(r=i<=.5?i*(e+1):i+e-i*e,n=2*i-r,s=t/360,o=Uw(n,r,s+1/3),a=Uw(n,r,s),l=Uw(n,r,s-1/3)),{r:o,g:a,b:l}}function Xw(t){let{color:e,colors:i,randomColors:n,numberColors:r=50}=t;if(e&&!Array.isArray(e)&&(e=Bw(e)),e)return[e];if(i)return i=i.map((function(t){return Array.isArray(t)?t:Bw(t)})),i;if(n){i=new Array(r);for(let t=0;t<r;t++)i[t]=[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())]}return function(t){let e=new Array(t),i=0;for(let n=0;n<360;n+=360/t){i++;let t=Gw(n,100,30+i%4*15);e[i-1]=[Math.round(255*t.r),Math.round(255*t.g),Math.round(255*t.b)]}return e}(r)}function Yw(t,e,i={}){let{color:n="blue",colors:r,font:s="12px Helvetica",rotate:o=0}=i;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:hp}),!Array.isArray(t))throw Error("paintLabels: labels must be an array");if(!Array.isArray(e))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=Bw(n)),r=r?r.map((function(t){return Array.isArray(t)?t:Bw(t)})):[n],t.length!==e.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(o)||(o=[o]);let a=this.getCanvas().getContext("2d");for(let i=0;i<t.length;i++){a.save();let n=r[i%r.length];a.fillStyle=`rgba(${n[0]},${n[1]},${n[2]},${n[3]/this.maxValue})`,a.font=s[i%s.length];let l=e[i];a.translate(l[0],l[1]),a.rotate(o[i%o.length]/180*Math.PI),a.fillText(t[i],0,0),a.restore()}return this.data=Uint8Array.from(a.getImageData(0,0,this.width,this.height).data),this}function Vw(t,e={}){let{alpha:i=255,labels:n=[],labelsPosition:r=[],labelColor:s="blue",labelFont:o="12px Helvetica"}=e;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:hp});let a=Xw(Object.assign({},e,{numberColors:t.length}));Array.isArray(t)||(t=[t]);for(let e=0;e<t.length;e++){let n=t[e],r=a[e%a.length];for(let t=0;t<n.width;t++)for(let e=0;e<n.height;e++)if(n.getBitXY(t,e))for(let s=0;s<Math.min(this.components,r.length);s++)if(255===i)this.setValueXY(t+n.position[0],e+n.position[1],s,r[s]);else{let o=this.getValueXY(t+n.position[0],e+n.position[1],s);o=Math.round((o*(255-i)+r[s]*i)/255),this.setValueXY(t+n.position[0],e+n.position[1],s,o)}}if(Array.isArray(n)&&n.length>0){let e=this.getCanvas().getContext("2d");e.fillStyle=s,e.font=o;for(let i=0;i<Math.min(t.length,n.length);i++){let s=r[i]?r[i]:t[i].position;e.fillText(n[i],s[0],s[1])}this.data=Uint8Array.from(e.getImageData(0,0,this.width,this.height).data)}return this}function jw(t,e){let i=new Array(t);for(let n=0;n<t;n++)i[n]=new Array(e).fill(0);return i}const qw=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],Ww=[[0,1,0],[1,1,1],[0,1,0]];class $w{constructor(t={}){let{kind:e="cross",shape:i,size:n,width:r,height:s,filled:o=!0}=t;if(n&&(r=n,s=n),i)switch(i.toLowerCase()){case"square":case"rectangle":this.matrix=function(t,e,i){const n=jw(e,t);if(i.filled)for(let i=0;i<e;i++)for(let e=0;e<t;e++)n[i][e]=1;else{for(let i of[0,e-1])for(let e=0;e<t;e++)n[i][e]=1;for(let i=0;i<e;i++)for(let e of[0,t-1])n[i][e]=1}return n}(r,s,{filled:o});break;case"circle":case"ellipse":this.matrix=function(t,e,i){const n=jw(e,t);let r=1-e%2,s=1-t%2,o=Math.floor((t-1)/2),a=Math.floor((e-1)/2),l=o*o,h=a*a;if(i.filled)for(let e=0;e<=a;e++)for(let i=o-Math.floor(Math.sqrt(l-l*e*e/h));i<=o;i++)n[a-e][i]=1,n[a+e+r][i]=1,n[a-e][t-i-1]=1,n[a+e+r][t-i-1]=1;else{for(let e=0;e<=a;e++){let i=o-Math.floor(Math.sqrt(l-l*e*e/h));n[a-e][i]=1,n[a+e+r][i]=1,n[a-e][t-i-1]=1,n[a+e+r][t-i-1]=1}for(let t=0;t<=o;t++){let i=a-Math.floor(Math.sqrt(h-h*t*t/l));n[i][o-t]=1,n[i][o+t+s]=1,n[e-i-1][o-t]=1,n[e-i-1][o+t+s]=1}}return n}(r,s,{filled:o});break;case"triangle":this.matrix=function(t,e,i){if(!i.filled)throw new Error("Non filled triangle is not implemented");const n=jw(e,t);for(let i=0;i<e;i++){let r=Math.floor((1-i/e)*t/2);for(let e=r;e<t-r;e++)n[i][e]=1}return n}(r,s,{filled:o});break;default:throw new Error(`Shape: unexpected shape: ${i}`)}else{if(!e)throw new Error("Shape: expected a kind or a shape option");switch(e.toLowerCase()){case"cross":this.matrix=qw;break;case"smallcross":this.matrix=Ww;break;default:throw new Error(`Shape: unexpected kind: ${e}`)}}this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,e=[];for(let i=0;i<t.length;i++)for(let n=0;n<t[0].length;n++)t[i][n]&&e.push([n-this.halfWidth,i-this.halfHeight]);return e}getMask(){let t=new rv(this.width,this.height,{kind:fp});for(let e=0;e<this.matrix.length;e++)for(let i=0;i<this.matrix[0].length;i++)this.matrix[e][i]&&t.setBitXY(i,e);return t}}function Zw(t,e={}){let{shape:i}=e;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=Xw(Object.assign({},e,{numberColors:t.length})),r=new $w(i).getPoints(),s=Math.min(this.channels,n[0].length);for(let e=0;e<t.length;e++){let i=n[e%n.length],o=t[e][0],a=t[e][1];for(let t=0;t<r.length;t++){let e=r[t][0],n=r[t][1];if(o+e>=0&&a+n>=0&&o+e<this.width&&a+n<this.height){let t=(o+e+(a+n)*this.width)*this.channels;for(let e=0;e<s;e++)this.data[t+e]=i[e]}}}return this}function Hw(t,e={}){let{color:i=[this.maxValue,0,0],closed:n=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let r=Math.min(this.channels,i.length);for(let e=0;e<t.length-1+n;e++){let n=t[e],s=t[(e+1)%t.length],o=s[0]-n[0],a=s[1]-n[1],l=Math.max(Math.abs(o),Math.abs(a)),h=o/l,u=a/l,c=n[0],d=n[1];for(let t=0;t<=l;t++){let t=Math.round(c),e=Math.round(d);if(t>=0&&e>=0&&t<this.width&&e<this.height)if(1===this.bitDepth)this.setBitXY(t,e);else{let n=(t+e*this.width)*this.channels;for(let t=0;t<r;t++)this.data[n+t]=i[t]}c+=h,d+=u}}return this}function Kw(t,e={}){let i=Object.assign({},e);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=Xw(Object.assign({},e,{numberColors:t.length}));for(let e=0;e<t.length;e++)i.color=n[e%n.length],this.paintPolyline(t[e],i);return this}function Jw(t,e={}){let{color:i=[this.maxValue,0,0],filled:n=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),e.closed=!0;let r=function(t){let e=[];for(let i=0;i<t.length;i++)t[i][0]===t[(i+1)%t.length][0]&&t[i][1]===t[(i+1)%t.length][1]||t[i][0]===t[(i-1+t.length)%t.length][0]&&t[i][1]===t[(i-1+t.length)%t.length][1]||t[(i+1)%t.length][0]===t[(i-1+t.length)%t.length][0]&&t[(i-1+t.length)%t.length][1]===t[(i+1)%t.length][1]||e.push(t[i]);return e}(t);if(!1===n)return this.paintPolyline(t,e);{let n=Array(this.height);for(let t=0;t<this.height;t++){n[t]=[];for(let e=0;e<this.width;e++)n[t].push(0)}for(let t=0;t<r.length;t++){const e=Qw(r[t],r[(t+1)%r.length]);for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)ty(i,t,e,this.height)&&(n[t][i]=0===n[t][i]?1:0)}for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)if(1===n[t][e])if(1===this.bitDepth)this.setBitXY(e,t);else{let n=Math.min(this.channels,i.length),r=(e+t*this.width)*this.channels;for(let t=0;t<n;t++)this.data[r+t]=i[t]}return this.paintPolyline(t,e)}}function Qw(t,e){if(t[0]===e[0])return{a:0,b:t[0],vertical:!0};{const i=(e[1]-t[1])/(e[0]-t[0]);return{a:i,b:t[1]-i*t[0],vertical:!1}}}function ty(t,e,i,n){if(!0===i.vertical)return i.b<=t;if(0===i.a)return!1;{const r=(e-i.b)/i.a;return r<t&&r>=0&&r<=n}}function ey(t,e={}){let i=Object.assign({},e);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=Xw(Object.assign({},e,{numberColors:t.length}));for(let e=0;e<t.length;e++)i.color=n[e%n.length],this.paintPolygon(t[e],i);return this}function iy(t={}){let{maxSlots:e=256,channel:i,useAlpha:n=!0}=t;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),void 0===i){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");i=0}return ry.call(this,i,{useAlpha:n,maxSlots:e})}function ny(t={}){const{maxSlots:e=256,useAlpha:i=!0}=t;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(i?this.components:this.channels);for(let t=0;t<n.length;t++)n[t]=ry.call(this,t,{useAlpha:i,maxSlots:e});return n}function ry(t,e){let{useAlpha:i,maxSlots:n}=e;if(1===this.bitDepth){let t=[0,0];for(let e=0;e<this.height;e++)for(let i=0;i<this.width;i++){let n=this.getBitXY(e,i);0===n?t[0]+=1:1===n&&(t[1]+=1)}return t}let r=Math.log2(n);if(!Cm()(r))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>r&&(s=this.bitDepth-r);let o=this.data,a=Xm()(Math.pow(2,Math.min(this.bitDepth,r)),0);if(i&&this.alpha){let e=this.channels-t-1;for(let i=t;i<o.length;i+=this.channels)a[o[i]>>s]+=o[i+e]/this.maxValue}else for(let e=t;e<o.length;e+=this.channels)a[o[e]>>s]++;return a}function sy(t={}){let{useAlpha:e=!0,nbSlots:i=512}=t;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(i)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let r=this.bitDepth-n,s=this.data,o=Xm()(Math.pow(8,n),0),a=Math.pow(2,2*n),l=Math.pow(2,n);for(let t=0;t<s.length;t+=this.channels){let i=(s[t]>>r)*a+(s[t+1]>>r)*l+(s[t+2]>>r);e&&this.alpha?o[i]+=s[t+this.channels-1]/this.maxValue:o[i]++}return o}function oy(){this.checkProcessable("min",{bitDepth:[8,16,32]});let t=Xm()(this.channels,1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let i=0;i<this.channels;i++)this.data[e+i]<t[i]&&(t[i]=this.data[e+i]);return t}function ay(){this.checkProcessable("max",{bitDepth:[8,16,32]});let t=Xm()(this.channels,-1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let i=0;i<this.channels;i++)this.data[e+i]>t[i]&&(t[i]=this.data[e+i]);return t}function ly(){this.checkProcessable("sum",{bitDepth:[8,16]});let t=Xm()(this.channels,0);for(let e=0;e<this.data.length;e+=this.channels)for(let i=0;i<this.channels;i++)t[i]+=this.data[e+i];return t}function hy(t=0,e=0){this.checkProcessable("getMoment",{bitDepth:[1]});let i=0;for(let n=0;n<this.width;n++)for(let r=0;r<this.height;r++)1===this.getBitXY(n,r)&&(i+=n**t*r**e);return i}function uy(t={}){let{mask:e,region:i=3,removeClosePoints:n=0,invert:r=!1,maxEquals:s=2}=t,o=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),i*=4;let a=r?0:1,l=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],h=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],u=i<=8?1:2,c=[];for(let t=u;t<o.height-u;t++)for(let n=u;n<o.width-u;n++){if(e&&e.getBitXY(n,t)!==a)continue;let u=0,d=0,f=o.data[n+t*o.width];for(let e=0;e<i;e++)r?o.data[n+l[e]+(t+h[e])*o.width]>f&&u++:o.data[n+l[e]+(t+h[e])*o.width]<f&&u++,o.data[n+l[e]+(t+h[e])*o.width]===f&&d++;u+d===i&&d<=s&&c.push([n,t])}if(n>0)for(let t=0;t<c.length;t++)for(let e=t+1;e<c.length;e++)Math.sqrt(Math.pow(c[t][0]-c[e][0],2)+Math.pow(c[t][1]-c[e][1],2))<n&&(c[t][0]=c[t][0]+c[e][0]>>1,c[t][1]=c[t][1]+c[e][1]>>1,c.splice(e,1),e--);return c}function cy(){let t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length);for(let i=0;i<t.length;i++){let n=t[i];e[i]=qp(n)}return e}function dy(){let t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length);for(let i=0;i<t.length;i++){let n=t[i];e[i]=jp(n)}return e}function fy(){this.checkProcessable("points",{bitDepth:[1]});const t=[];for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++)1===this.getBitXY(e,i)&&t.push([e,i]);return t}function gy(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const t=[];for(let e=0;e<this.height;e++)for(let i=0;i<this.width;i++)if(1===this.getBitXY(i,e))for(t.push([i,e]),1!==this.getBitXY(i+1,e)?(t.push([i+1,e]),t.push([i+1,e+1]),1!==this.getBitXY(i,e+1)&&t.push([i,e+1])):1!==this.getBitXY(i,e+1)&&(t.push([i,e+1]),t.push([i+1,e+1]));i<this.width-2&&1===this.getBitXY(i+1,e)&&1===this.getBitXY(i+2,e);)i++;return t}function py(t,e={}){if(this===t)return[0,0];let i=[0,0],n=this;for(;n;){if(n===t)return i;n.position&&(i[0]+=n.position[0],i[1]+=n.position[1]),n=n.parent}return!!e.defaultFurther&&i}function my(t={}){let{alpha:e=1}=t;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let i=0;if(void 0!==e){for(let t=this.components;t<this.data.length;t+=this.channels)this.data[t]===e&&i++;return i}return this.size}function _y(t,e={}){const{sorted:i}=e;i||(t=t.slice().sort(yy));const n=t.length,r=new Array(2*n);let s=0;for(let e=0;e<n;e++){const i=t[e];for(;s>=2&&wy(r[s-2],r[s-1],i)<=0;)s--;r[s++]=i}const o=s+1;for(let e=n-2;e>=0;e--){const i=t[e];for(;s>=o&&wy(r[s-2],r[s-1],i)<=0;)s--;r[s++]=i}return r.slice(0,s-1)}function wy(t,e,i){return(e[1]-t[1])*(i[0]-t[0])-(e[0]-t[0])*(i[1]-t[1])}function yy(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}function vy(){return _y(this.extendedPoints,{sorted:!1})}function by(t,e){return[t[0]-e[0],t[1]-e[1]]}function xy(t){let e=Math.sqrt(t[0]**2+t[1]**2);return[t[0]/e,t[1]/e]}function My(t,e,i){void 0===i&&(i=new Array(e.length));let n=Math.cos(t),r=Math.sin(t);for(let t=0;t<i.length;++t)i[t]=[n*e[t][0]-r*e[t][1],r*e[t][0]+n*e[t][1]];return i}function ky(t){let e=0;for(let i=0;i<t.length;i++){let n=t[i][0],r=t[i][1],s=t[i===t.length-1?0:i+1][0],o=t[i===t.length-1?0:i+1][1];e+=Math.sqrt((s-n)**2+(o-r)**2)}return e}function Sy(t){let e=0;for(let i=0;i<t.length;i++)e+=t[i][0]*t[i===t.length-1?0:i+1][1]*.5,e-=t[i===t.length-1?0:i+1][0]*t[i][1]*.5;return Math.abs(e)}function Ey(t){let e=1/0,i=1/0,n=-1/0,r=-1/0;for(let s=0;s<t.length;s++)t[s][0]<e&&(e=t[s][0]),t[s][0]>n&&(n=t[s][0]),t[s][1]<i&&(i=t[s][1]),t[s][1]>r&&(r=t[s][1]);return[[e,i],[n,r]]}function Cy(t={}){const{originalPoints:e=vy.call(this)}=t;if(0===e.length)return[];if(1===e.length)return[e[0],e[0],e[0],e[0]];const i=new Array(e.length);let n,r=1/0,s=0;for(let t=0;t<i.length;t++){let o=Iy(e[t],e[(t+1)%i.length]);My(-o,e,i);let a=i[t][0],l=i[t][1],h=i[(t+1)%i.length][0],u=i[(t+1)%i.length][1],c=!0,d=0,f=0,g=0;for(let t=0;t<i.length;t++){let e=(i[t][0]-a)/(h-a);!0===c?(c=!1,d=e,f=e):(e<d&&(d=e),e>f&&(f=e));let n=(-(h-a)*i[t][1]+h*l-u*a)/(h-a);Math.abs(n)>Math.abs(g)&&(g=n)}let p=[a+d*(h-a),l],m=[a+f*(h-a),l],_=Math.abs(g*(d-f)*(h-a));_<r&&(s=o,r=_,n=[p,m,[m[0],m[1]-g],[p[0],p[1]-g]])}return My(s,n,n),n}function Iy(t,e){let i=xy(by(e,t)),n=Math.acos(i[0]);return i[1]<0?-n:n}var Ay=__webpack_require__(2229),Ty=__webpack_require__.n(Ay),Ry=__webpack_require__(4707),Py=__webpack_require__.n(Ry);function Dy(t,e){let i=xy(by(e,t)),n=Math.acos(i[0]);return i[1]<0?-n:n}class Fy{constructor(t,e){this.map=t,this.id=e,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:e=1,kind:i=""}=t;let n;switch(i){case"contour":n=this.contourMask;break;case"box":n=this.boxMask;break;case"filled":n=this.filledMask;break;case"center":n=this.centerMask;break;case"mbr":n=this.mbrFilledMask;break;case"hull":n=this.convexHullFilledMask;break;case"hullContour":n=this.convexHullMask;break;case"mbrContour":n=this.mbrMask;break;case"feret":n=this.feretMask;break;default:n=this.mask}return e<1&&(n=n.resize({factor:e}),n.parent=this.mask.parent,n.position[0]+=this.minX,n.position[1]+=this.minY),n}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,e=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let i=this.internalIDs;for(let n=0;n<t.length;n++)i.includes(t[n])||(this.computed.externalIDs.push(t[n]),this.computed.externalLengths.push(e[n]))}get externalIDs(){return this.computed.externalIDs||this._computExternalIDs(),this.computed.externalIDs}get externalLengths(){return this.computed.externalLengths||this._computExternalIDs(),this.computed.externalLengths}_computeBorderIDs(){let t=function(t){let e=t.map,i=e.data,n=new Set,r=new Map,s=new Set,o=[1,0,-1,0],a=[0,1,0,-1];for(let l=t.minX;l<=t.maxX;l++)for(let h=t.minY;h<=t.maxY;h++)if(i[l+h*e.width]===t.id)for(let u=0;u<4;u++){let c=l+o[u],d=h+a[u];if(c>=0&&d>=0&&c<e.width&&d<e.height){let o=c+d*e.width;if(i[o]!==t.id&&!s.has(o)){s.add(o),n.add(i[o]);let t=r.get(i[o]);t?r.set(i[o],++t):r.set(i[o],1)}}}let l=Array.from(n),h=l.map((function(t){return r.get(t)}));return{ids:l,lengths:h}}(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs||this._computeBorderIDs(),this.computed.borderIDs}get borderLengths(){return this.computed.borderLengths||this._computeBorderIDs(),this.computed.borderLengths}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=function(t){let e=new Set,i=t.map,n=i.data;for(let r of[0,t.height-1])for(let s=0;s<t.width;s++){let o=(r+t.minY)*i.width+s+t.minX;if(s-t.minX>0&&n[o]===t.id&&n[o-1]!==t.id){let t=n[o-1];e.add(t)}if(i.width-s-t.minX>1&&n[o]===t.id&&n[o+1]!==t.id){let t=n[o+1];e.add(t)}}for(let r of[0,t.width-1])for(let s=0;s<t.height;s++){let o=(s+t.minY)*i.width+r+t.minX;if(s-t.minY>0&&n[o]===t.id&&n[o-i.width]!==t.id){let t=n[o-i.width];e.add(t)}if(i.height-s-t.minY>1&&n[o]===t.id&&n[o+i.width]!==t.id){let t=n[o+i.width];e.add(t)}}return Array.from(e)}(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=function(t){let e=[t.id],i=t.map,n=i.data;if(t.height>2)for(let r=0;r<t.width;r++){let s=t.minY*i.width+r+t.minX;if(e.includes(n[s])){let r=n[s+i.width];e.includes(r)||t.boxIDs.includes(r)||e.push(r)}}let r=new Array(4);for(let s=1;s<t.width-1;s++)for(let o=1;o<t.height-1;o++){let a=(o+t.minY)*i.width+s+t.minX;if(e.includes(n[a])){r[0]=n[a-1],r[1]=n[a+1],r[2]=n[a-i.width],r[3]=n[a+i.width];for(let i=0;i<4;i++){let n=r[i];e.includes(n)||t.boxIDs.includes(n)||e.push(n)}}}return e}(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=function(t){let e=0,i=t.map,n=i.data,r=[0];t.height>1&&(r[1]=t.height-1);for(let s of r)for(let r=1;r<t.width-1;r++)n[(s+t.minY)*i.width+r+t.minX]===t.id&&e++;let s=[0];t.width>1&&(s[1]=t.width-1);for(let r of s)for(let s=0;s<t.height;s++)n[(s+t.minY)*i.width+r+t.minX]===t.id&&e++;return e}(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=function(t){let e=0,i=t.map,n=i.data;for(let r=1;r<t.width-1;r++)for(let s=1;s<t.height-1;s++){let o=(s+t.minY)*i.width+r+t.minX;n[o]===t.id&&(t.externalIDs.includes(n[o-1])||t.externalIDs.includes(n[o+1])||t.externalIDs.includes(n[o-i.width])||t.externalIDs.includes(n[o+i.width]))&&e++}return e+t.box}(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=function(t){let e=0,i=t.map.width,n=t.map.data;for(let r=1;r<t.width-1;r++)for(let s=1;s<t.height-1;s++){let o=(s+t.minY)*i+r+t.minX;t.internalIDs.includes(n[o])&&n[o]!==t.id&&e++}return{number:t.internalIDs.length-1,surface:e}}(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=function(t){let e=0,i=t.map,n=i.data;for(let r=1;r<t.width-1;r++)for(let s=1;s<t.height-1;s++){let o=(s+t.minY)*i.width+r+t.minX;n[o]===t.id&&(n[o-1]===t.id&&n[o+1]===t.id&&n[o-i.width]===t.id&&n[o+i.width]===t.id||e++)}return e+t.box}(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new rv(this.width,this.height,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++)this.map.data[e+this.minX+(i+this.minY)*this.map.width]===this.id&&(e>0&&e<this.width-1&&i>0&&i<this.height-1&&this.map.data[e-1+this.minX+(i+this.minY)*this.map.width]===this.id&&this.map.data[e+1+this.minX+(i+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(i-1+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(i+1+this.minY)*this.map.width]===this.id||t.setBitXY(e,i));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new rv(this.width,this.height,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)t.setBitXY(e,0),t.setBitXY(e,this.height-1);for(let e=0;e<this.height;e++)t.setBitXY(0,e),t.setBitXY(this.width-1,e);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new rv(this.width,this.height,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++)this.map.data[e+this.minX+(i+this.minY)*this.map.width]===this.id&&t.setBitXY(e,i);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new rv(this.width,this.height,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++){let n=e+this.minX+(i+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[n])&&t.setBitXY(e,i)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new $w({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++)this.map.data[e+this.minX+(i+this.minY)*this.map.width]===this.id&&(e>0&&e<this.width-1&&i>0&&i<this.height-1&&this.map.data[e-1+this.minX+(i+this.minY)*this.map.width]===this.id&&this.map.data[e+1+this.minX+(i+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(i-1+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(i+1+this.minY)*this.map.width]===this.id||(t.push([e,i]),t.push([e+1,i]),t.push([e,i+1]),t.push([e+1,i+1])));const e=_y(t);this.computed.convexHull={polyline:e,surface:Sy(e),perimeter:ky(e)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,e=new rv(this.width+1,this.height+1,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent});e.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=e}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const t=this.convexHull,e=new rv(this.width,this.height,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent});for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)1!==Py()(t.polyline,[i,n])&&e.setBitXY(i,n);this.computed.convexHullFilledMask=e}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let t=Cy({originalPoints:this.convexHull.polyline});if(0===t.length)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let e=t[0],i=t[1],n=t[2],r=Math.sqrt((e[0]-i[0])**2+(e[1]-i[1])**2),s=Math.sqrt((n[0]-i[0])**2+(n[1]-i[1])**2);this.computed.mbr={width:r,height:s,elongation:1-r/s,aspectRatio:r/s,surface:r*s,perimeter:2*(r+s),rectangle:t}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=function(t={}){const{originalPoints:e=vy.call(this)}=t;if(0===e.length)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(1===e.length)return{min:1,max:1,minLine:[e[0],e[0]],maxLine:[e[0],e[0]],aspectRatio:1};const i=new Array(e.length);let n=1/0,r=0,s=[];for(let t=0;t<e.length;t++){let o=Dy(e[t],e[(t+1)%e.length]);My(-o,e,i);let a=0,l=[];for(let n=0;n<e.length;n++){let e=Math.abs(i[t][1]-i[n][1]);e>a&&(a=e,l=[],l.push([i[n][0],i[t][1]],[i[n][0],i[n][1]]))}a<n&&(n=a,r=o,s=l)}My(r,s,s);let o=0,a=[],l=0;for(let t=0;t<e.length-1;t++)for(let i=t+1;i<e.length;i++){let n=(e[t][0]-e[i][0])**2+(e[t][1]-e[i][1])**2;n>l&&(l=n,o=Math.sqrt(n),a=[e[t],e[i]])}return{min:n,minLine:s,max:o,maxLine:a,aspectRatio:n/o}}({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=function(t){let e=t.map,i=e.data,n=0,r=0,s=0,o=0;for(let a=0;a<t.width;a++)for(let l=0;l<t.height;l++){let h=(l+t.minY)*e.width+a+t.minX;if(i[h]===t.id){let u=0;switch((0===a||t.externalIDs.includes(i[h-1]))&&u++,(a===t.width-1||t.externalIDs.includes(i[h+1]))&&u++,(0===l||t.externalIDs.includes(i[h-e.width]))&&u++,(l===t.height-1||t.externalIDs.includes(i[h+e.width]))&&u++,u){case 1:n++;break;case 2:r++;break;case 3:s++;break;case 4:o++}}}return{one:n,two:r,three:s,four:o}}(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,e=2-Math.sqrt(2);return t.one+2*t.two+3*t.three+4*t.four-e*(t.two+2*t.three+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new rv(this.width+1,this.height+1,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=function(t){for(let e=0;e<t.length;e++)t[e][0]=Math.round(t[e][0]),t[e][1]=Math.round(t[e][1]);return t}(this.mbr.rectangle);if(t.length>0){const e=Ey(t),i=new rv(e[1][0]-e[0][0]+1,e[1][1]-e[0][1]+1,{kind:fp,position:[this.minX+e[0][0],this.minY+e[0][1]],parent:this.map.parent});t=function(t,e){void 0===e&&(e=new Array(t.length).fill(0).map((()=>[])));let i=Ey(t),n=i[0][0],r=i[0][1];for(let i=0;i<t.length;i++)e[i][0]=t[i][0]-n,e[i][1]=t[i][1]-r;return e}(t),i.paintPolyline(t,{closed:!0}),this.computed.mbrMask=i}else this.computed.mbrMask=new rv(1,1,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const t=new rv(this.width,this.height,{kind:fp,position:[this.minX,this.minY],parent:this.map.parent}),e=this.mask.minimalBoundingRectangle();for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)1!==Py()(e,[i,n])&&t.setBitXY(i,n);this.computed.mbrFilledMask=t}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let t=[];for(let e=0;e<this.height;e++)for(let i=0;i<this.width;i++){let n=(e+this.minY)*this.map.width+i+this.minX;this.map.data[n]===this.id&&t.push([i,e])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t,e=0;const i=this.points;for(let n=0;n<i.length;n++)for(let r=n+1;r<i.length;r++){let s=Math.pow(i[n][0]-i[r][0],2)+Math.pow(i[n][1]-i[r][1],2);s>=e&&(e=s,t=[i[n],i[r]])}this.computed.maxLengthPoints=t}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,e=180*-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])/Math.PI;this.computed.angle=e}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}class Ly{constructor(t,e){this.roiMap=t,this.options=e,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,e={};this.roiMap.positive=0,this.roiMap.negative=0;for(let i=0;i<t.length;i++)t[i]&&!e[t[i]]&&(e[t[i]]=!0,t[i]>0?this.roiMap.positive++:this.roiMap.negative++);let i={};for(let t in e)i[t]=new Fy(this.roiMap,1*t);let n=this.roiMap.width,r=this.roiMap.height;for(let e=0;e<r;e++)for(let r=0;r<n;r++){let s=e*n+r;if(0!==t[s]){const n=i[t[s]];r<n.minX&&(n.minX=r),r>n.maxX&&(n.maxX=r),e<n.minY&&(n.minY=e),e>n.maxY&&(n.maxY=e),n.meanX+=r,n.meanY+=e,n.surface++}}let s=[];for(let t in e)i[t].meanX/=i[t].surface,i[t].meanY/=i[t].surface,s.push(i[t]);return s}}function Oy(t={}){const{algorithm:e="commonBorderLength",minCommonBorderLength:i=5,maxCommonBorderLength:n=100,minCommonBorderRatio:r=.3,maxCommonBorderRatio:s=1}=t;let o=function(t,e,r){return t[r]>=i&&t[r]<=n};"function"==typeof e&&(o=e),"commonborderratio"===e.toLowerCase()&&(o=function(t,e,i){let n=Math.min(t[i]/t[e],1);return n>=r&&n<=s});const a=this,l=a.commonBorderLength;let h={},u={};for(let t of Object.keys(l)){let e=l[t],i=Object.keys(e);for(let n of i)if(n!==t&&o(e,t,n)){let e=n;u[n]&&(e=u[n]);let i=t;if(u[t]&&(i=u[t]),Number(e)!==i){let t=Math.min(e,i),n=Math.max(e,i);if(h[t]||(h[t]={}),h[t][n]=!0,u[n]=t,h[n]){for(let e of Object.keys(h[n]))h[t][e]=!0,u[e]=t;delete h[n]}}}}let c=a.minMax,d=-c.min,f=c.max+d,g=new Array(f+1).fill(0);for(let t of Object.keys(u))g[Number(t)+d]=u[t];let p=a.data;for(let t=0;t<p.length;t++){let e=p[t];if(0!==e){let i=g[e+d];0!==i&&(p[t]=i)}}return a.computed={},a}class zy{constructor(t,e){this.parent=t,this.width=t.width,this.height=t.height,this.data=e,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;for(let i=0;i<this.data.length;i++)this.data[i]<t&&(t=this.data[i]),this.data[i]>e&&(e=this.data[i]);return{min:t,max:e}}get commonBorderLength(){return function(t){let e=t.data,i=[1,0,-1,0],n=[0,1,0,-1],r=t.minMax,s=-r.min,o=r.max+s,a=[];for(let t=0;t<=o;t++)a.push(Object.create(null));for(let r=0;r<t.width;r++)for(let o=0;o<t.height;o++){let l=e[r+o*t.width];if(0!==l){let h=Object.create(null),u=!1;for(let c=0;c<4;c++){let d=r+i[c],f=o+n[c];if(d>=0&&f>=0&&d<t.width&&f<t.height){let i=e[d+f*t.width];l!==i&&(u=!0,0!==i&&void 0===h[i]&&(h[i]=!0,a[i+s][l]?a[i+s][l]++:a[i+s][l]=1))}else u=!0}u&&(a[l+s][l]?a[l+s][l]++:a[l+s][l]=1)}}let l={};for(let t=0;t<a.length;t++)Object.keys(a[t]).length>0&&(l[t-s]=a[t]);return l}(this)}mergeRoi(t={}){return Oy.call(this,t)}mergeRois(t){const e=t[0],i=t.slice(1);for(let t=0;t<this.data.length;t++)i.includes(this.data[t])&&(this.data[t]=e)}rowsInfo(){let t=new Array(this.height),e=0;for(let i=0;i<this.data.length;i+=this.width){let n={row:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=n;let r={},s={},o=[],a=this.data[i],l=0;for(let t=i;t<i+this.width;t++){let e=this.data[t];a!==e&&(a=e,o.push(l),l=0),l++,e>0?(n.positivePixel++,r[e]||(r[e]=!0)):e<0?(n.negativePixel++,s[e]||(s[e]=!0)):n.zeroPixel++}o.push(l),n.medianChange=o.sort(((t,e)=>t-e))[Math.floor(o.length/2)],n.positiveRoiIDs=Object.keys(r),n.negativeRoiIDs=Object.keys(s),n.positiveRoi=n.positiveRoiIDs.length,n.negativeRoi=n.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),e=0;for(let i=0;i<this.width;i++){let n={col:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=n;let r={},s={},o=[],a=this.data[i],l=0;for(let t=i;t<i+this.data.length;t+=this.width){let e=this.data[t];a!==e&&(a=e,o.push(l),l=0),l++,e>0?(n.positivePixel++,r[e]||(r[e]=!0)):e<0?(n.negativePixel++,s[e]||(s[e]=!0)):n.zeroPixel++}o.push(l),n.medianChange=o.sort(((t,e)=>t-e))[Math.floor(o.length/2)],n.positiveRoiIDs=Object.keys(r),n.negativeRoiIDs=Object.keys(s),n.positiveRoi=n.positiveRoiIDs.length,n.negativeRoi=n.negativeRoiIDs.length}return t}}function Ny(t,e={}){const{allowCorners:i=!1}=e,n=65535;let r=new Int16Array(t.size),s=0,o=0,a=new Uint16Array(65536),l=new Uint16Array(65536);for(let e=0;e<t.width;e++)for(let i=0;i<t.height;i++)0===r[i*t.width+e]&&h(e,i);function h(e,h){let u=0,c=0,d=t.getBitXY(e,h),f=d?++s:--o;if(s>32767||o<-32768)throw new Error("Too many regions of interest");for(a[0]=e,l[0]=h;u<=c;){let e=a[u&n],s=l[u&n];if(r[s*t.width+e]=f,e>0&&0===r[s*t.width+e-1]&&t.getBitXY(e-1,s)===d&&(c++,a[c&n]=e-1,l[c&n]=s,r[s*t.width+e-1]=-32768),s>0&&0===r[(s-1)*t.width+e]&&t.getBitXY(e,s-1)===d&&(c++,a[c&n]=e,l[c&n]=s-1,r[(s-1)*t.width+e]=-32768),e<t.width-1&&0===r[s*t.width+e+1]&&t.getBitXY(e+1,s)===d&&(c++,a[c&n]=e+1,l[c&n]=s,r[s*t.width+e+1]=-32768),s<t.height-1&&0===r[(s+1)*t.width+e]&&t.getBitXY(e,s+1)===d&&(c++,a[c&n]=e,l[c&n]=s+1,r[(s+1)*t.width+e]=-32768),i&&(e>0&&s>0&&0===r[(s-1)*t.width+e-1]&&t.getBitXY(e-1,s-1)===d&&(c++,a[c&n]=e-1,l[c&n]=s-1,r[(s-1)*t.width+e-1]=-32768),e<t.width-1&&s>0&&0===r[(s-1)*t.width+e+1]&&t.getBitXY(e+1,s-1)===d&&(c++,a[c&n]=e+1,l[c&n]=s-1,r[(s-1)*t.width+e+1]=-32768),e>0&&s<t.height-1&&0===r[(s+1)*t.width+e-1]&&t.getBitXY(e-1,s+1)===d&&(c++,a[c&n]=e-1,l[c&n]=s+1,r[(s+1)*t.width+e-1]=-32768),e<t.width-1&&s<t.height-1&&0===r[(s+1)*t.width+e+1]&&t.getBitXY(e+1,s+1)===d&&(c++,a[c&n]=e+1,l[c&n]=s+1,r[(s+1)*t.width+e+1]=-32768)),u++,c-u>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new zy(t,r)}var By=__webpack_require__(530),Uy=__webpack_require__.n(By);const Gy=[-1,0],Xy=[0,-1],Yy=[null,null],Vy=[-1,-1,0,1],jy=[0,-1,-1,-1],qy=[null,null,null,null];function Wy(t,e={}){const{allowCorners:i=!1}=e;let n,r,s,o=4;if(i&&(o=8),8===o)n=Vy,r=jy,s=qy;else{if(4!==o)throw new RangeError(`unsupported neighbours count: ${o}`);n=Gy,r=Xy,s=Yy}const a=t.size,l=t.width,h=t.height,u=new Array(a),c=new Uint32Array(a),d=new(Uy());let f=1;for(let e=0;e<h;e++)for(let i=0;i<l;i++){const o=i+e*l;if(t.getBit(o)){let t=null;for(let o=0;o<s.length;o++){const a=i+n[o],c=e+r[o];if(a>=0&&c>=0&&a<l&&c<h){let e=u[a+c*l];e?(s[o]=e,(!t||s[o].value<t.value)&&(t=s[o])):s[o]=null}}if(t){u[o]=t;for(let e=0;e<s.length;e++)s[e]&&s[e]!==t&&d.union(t,s[e])}else u[o]=d.add(f++)}}for(let e=0;e<h;e++)for(let i=0;i<l;i++){const n=i+e*l;t.getBit(n)&&(c[n]=d.find(u[n]).value)}return new zy(t,c)}function $y(t={}){let{allowCorner:e=!0,onlyTop:i=!1,invert:n=!1}=t,r=this;r.checkProcessable("fromMaxima",{components:[1]});const s=1,o=2;let a=0,l=0,h=new Int16Array(r.size),u=new Int8Array(r.size),c=new Float32Array(r.size),d=1048575,f=new Uint16Array(d+1),g=new Uint16Array(d+1),p=0,m=0,_=new Uint16Array(d+1),w=new Uint16Array(d+1),y=0,v=0;for(function({maxima:t=!0}){for(let i=1;i<r.height-1;i++)for(let n=1;n<r.width-1;n++){let s=n+i*r.width;if(0===u[s]){let o=t?r.data[s]:-r.data[n+i*r.width];if(r.data[i*r.width+n-1]>o)continue;if(r.data[i*r.width+n+1]>o)continue;if(r.data[(i-1)*r.width+n]>o)continue;if(r.data[(i+1)*r.width+n]>o)continue;if(e){if(r.data[(i-1)*r.width+n-1]>o)continue;if(r.data[(i-1)*r.width+n+1]>o)continue;if(r.data[(i+1)*r.width+n-1]>o)continue;if(r.data[(i+1)*r.width+n+1]>o)continue}h[s]=t?++a:--l,b(n,i)||(t?--a:++l)}}}(r);p<m;)x(f[p&d],g[p&d],o),p++;return new zy(r,h);function b(t,e){let i=m;y=0,v=1,_[0]=t,w[0]=e;let n=!0;for(;y<v;)n&=x(_[y&d],w[y&d],s),y++;if(!n){for(let t=0;t<v;t++){let e=_[t&d],i=w[t&d]*r.width+e;h[i]=0}m=i}return n}function x(t,e,n){let a=h[e*r.width+t],l=r.data[e*r.width+t];for(let p=e-1;p<=e+1;p++)for(let e=t-1;e<=t+1;e++){let t=p*r.width+e;if(0===u[t])switch(u[t]=1,c[t]=r.data[t]-l,n){case s:if(0===c[t]){if(0===e||0===p||e===r.width-1||p===r.height-1)return!1;h[t]=a,_[v&d]=e,w[v&d]=p,v++}else{if(c[t]>0)return!1;i||(h[t]=a,f[m&d]=e,g[m&d]=p,m++)}break;case o:c[t]<=0&&(h[t]=a,f[m&d]=e,g[m&d]=p,m++);break;default:throw new Error("unreachable")}}return!0}}function Zy(t,e={}){let i=new $w(e),n=new Int16Array(this.size),r=0,s=i.getPoints();for(let e=0;e<t.length;e++){r++;let i=t[e][0],o=t[e][1];for(let t=0;t<s.length;t++){let e=s[t][0],a=s[t][1];i+e>=0&&o+a>=0&&i+e<this.width&&o+a<this.height&&(n[i+e+(o+a)*this.width]=r)}}return new zy(this,n)}var Hy=__webpack_require__(5307),Ky=__webpack_require__.n(Hy);const Jy=[1,0,-1,0,1,1,-1,-1],Qy=[0,1,0,-1,1,-1,1,-1];function tv(t={}){let{points:e,mask:i,image:n,fillMaxValue:r=this.maxValue,invert:s=!1}=t,o=n||this;o.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,e||(e=o.getLocalMaxima({invert:s,mask:i}));let a=s?0:1,l=new Int16Array(o.size),h=o.width,u=o.height,c=new(Ky())({comparator:(t,e)=>t[2]-e[2],strategy:Ky().BinaryHeapStrategy});for(let t=0;t<e.length;t++){let i=e[t][0]+e[t][1]*h;l[i]=t+1;let n=o.data[i];(s&&n<=r||!s&&n>=r)&&c.queue([e[t][0],e[t][1],n])}for(;c.length>0;){let t=c.dequeue(),e=t[0]+t[1]*h;for(let n=0;n<4;n++){let d=t[0]+Jy[n],f=t[1]+Qy[n];if(d>=0&&f>=0&&d<h&&f<u){let u=d+f*h;if(!i||i.getBit(u)===a){let i=o.data[u];(s&&i<=r||!s&&i>=r)&&0===l[u]&&(l[u]=l[e],c.queue([t[0]+Jy[n],t[1]+Qy[n],i]))}}}}return new zy(o,l)}class ev{constructor(t,e={}){this._image=t,this._options=e,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let e=Object.assign({},this._options,t),i=$y.call(this._image,t);this._layers[e.label]=new Ly(i,e)}fromPoints(t,e={}){let i=Object.assign({},this._options,e),n=Zy.call(this._image,t,e);return this._layers[i.label]=new Ly(n,i),this}putMap(t,e={}){let i=new zy(this._image,t),n=Object.assign({},this._options,e);return this._layers[n.label]=new Ly(i,n),this}fromWaterShed(t={}){let e=Object.assign({},this._options,t),i=tv.call(this._image,t);this._layers[e.label]=new Ly(i,e)}fromMask(t,e={}){let i=Object.assign({},this._options,e),n=Ny.call(this._image,t,e);return this._layers[i.label]=new Ly(n,i),this}fromMaskConnectedComponentLabelingAlgorithm(t,e={}){let i=Object.assign({},this._options,e),n=Wy.call(this._image,t,e);return this._layers[i.label]=new Ly(n,i),this}getMap(t={}){let e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let e=this.getRois(t);if(e){let t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i].id;return t}throw new Error("ROIs not found")}getRois(t={}){let{label:e=this._options.label,positive:i=!0,negative:n=!0,minSurface:r=0,maxSurface:s=Number.POSITIVE_INFINITY,minWidth:o=0,maxWidth:a=Number.POSITIVE_INFINITY,minHeight:l=0,maxHeight:h=Number.POSITIVE_INFINITY,minRatio:u=0,maxRatio:c=Number.POSITIVE_INFINITY}=t;if(!this._layers[e])throw new Error(`this Roi layer (${e}) does not exist`);const d=this._layers[e].roi,f=[];for(const t of d)(t.id<0&&n||t.id>0&&i)&&t.surface>=r&&t.surface<=s&&t.width>=o&&t.width<=a&&t.height>=l&&t.height<=h&&t.ratio>=u&&t.ratio<=c&&f.push(t);return f}getRoi(t,e={}){const{label:i=this._options.label}=e;if(!this._layers[i])throw new Error(`this Roi layer (${i}) does not exist`);const n=this._layers[i].roi.find((e=>e.id===t));if(!n)throw new Error(`found no Roi with id ${t}`);return n}getMasks(t={}){let e=this.getRois(t),i=new Array(e.length);for(let n=0;n<e.length;n++)i[n]=e[n].getMask(t);return i}getAnalysisMasks(t={}){const{analysisProperty:e}=t;let i=`${e}Mask`,n=this.getRois(t);return 0!==n.length&&n[0][i]?n.map((t=>t[i])):[]}getData(t={}){let e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap.data}paint(t={}){let{labelProperty:e,analysisProperty:i}=t;this._painted||(this._painted=this._image.rgba8());let n=this.getMasks(t);if(e){const i=this.getRois(t);t.labels=i.map((t=>function(t,e=""){let i=e.split(".");for(let e of i){if(void 0===t[e])return;t=t[e]}return t}(t,e)));const n=Math.max(...t.labels);let r=!1,s=!1;if(e.includes("surface")?r=!0:/(?:perimeter|min|max|external|width|height|length)/.test(e)&&(s=!0),isFinite(n)){let e="";if("pixel"!==t.unit&&t.pixelSize&&(s||r)){e=r?`${t.unit}^2`:t.unit;let i=r?"m^2":"m",n=r?t.pixelSize**2:t.pixelSize;const s=Ty().swiftConverter(i,e);t.labels=t.labels.map((t=>s(n*t)))}t.labels=n>50?t.labels.map((t=>Math.round(t)+e)):n>10?t.labels.map((t=>t.toFixed(1)+e)):t.labels.map((t=>t.toFixed(2)+e))}t.labelsPosition=i.map((t=>[t.meanX,t.meanY]))}if(this._painted.paintMasks(n,t),i){let e=this.getAnalysisMasks(t);this._painted.paintMasks(e,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let e=new rv(this._image.width,this._image.height,{kind:"BINARY"}),i=this.getMasks(t);for(let t=0;t<i.length;t++){let n=i[t];for(let t=0;t<n.width;t++)for(let i=0;i<n.height;i++)n.getBitXY(t,i)&&e.setBitXY(t+n.position[0],i+n.position[1])}return e}resetPainted(t={}){const{image:e}=t;this._painted=e?this.image.rgba8():this._image.rgba8()}mergeRoi(t={}){const e=this.getMap(t);return e.mergeRoi(t),this.putMap(e.data,t),this}mergeRois(t,e={}){if(!Array.isArray(t)||t.some((t=>!Number.isInteger(t))))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach((t=>this.getRoi(t)));const i=this.getMap(e);return i.mergeRois(t),this.putMap(i.data,e),this}findCorrespondingRoi(t,e={}){let i=this.getRois(e),n=[];for(let e=0;e<i.length;e++){let r=i[e],s=iv(r.minX,r.minY,r.points,t,Math.sign(r.id));n.push(s)}return n}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error(`no layer with label ${t}`)}}function iv(t,e,i,n,r){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let r=0;r<i.length;r++){let o=i[r],a=o[0]+t+(o[1]+e)*n.width,l=n.data[a];(l>0||l<0)&&(s.id.includes(l)?s.surface[s.id.indexOf(l)]+=1:(s.id.push(l),s.surface.push(1)))}for(let t=0;t<s.id.length;t++)Math.sign(s.id[t])===r?s.same+=s.surface[t]:s.opposite+=s.surface[t],s.roiSurfaceCovered[t]=s.surface[t]/i.length;return s.total=s.opposite+s.same,s}const nv=Object.prototype.toString;class rv{constructor(e,i,n,r){if(1===arguments.length?(r=e,({width:e,height:i,data:n}=r)):n&&!n.length&&(r=n,({data:n}=r)),void 0===e&&(e=1),void 0===i&&(i=1),void 0===r&&(r={}),"object"!=typeof r||null===r)throw new TypeError("options must be an object");if(!Number.isInteger(e)||e<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(i)||i<=0)throw new RangeError("height must be a positive integer");const{kind:s=gp}=r;if("string"!=typeof s)throw new TypeError("kind must be a string");const o=function(t){const e=pp[t];if(!e)throw new RangeError(`invalid image kind: ${t}`);return e}(s),a=Object.assign({},r);for(const t in o)void 0===a[t]&&(a[t]=o[t]);!function(e){const{components:i,alpha:n,bitDepth:r,colorModel:s}=e;if(!Number.isInteger(i)||i<=0)throw new RangeError(`invalid components: ${i}. Must be a positive integer`);if(0!==n&&1!==n&&"boolean"!=typeof n)throw new TypeError(`invalid alpha: ${n}: must be a boolean, 0 or 1`);if(!mp.includes(r))throw new RangeError(`invalid bitDepth: ${r}. Must be one of ${mp.join(", ")}`);if(!t[s])throw new RangeError(`invalid colorModel: ${s}. Must be one of ${Object.keys(t).join(", ")}`)}(a);const{components:l,bitDepth:h,colorModel:u}=a,c=a.alpha+0,d=e*i,f=l+c,g=32===h?Number.MAX_VALUE:2**h-1;if(void 0===n)n=function(t,e,i,n,r,s){const o=n*t;let a;switch(r){case 1:a=new Uint8Array(Math.ceil(o/8));break;case 8:a=new Uint8Array(o);break;case 16:a=new Uint16Array(o);break;case 32:a=new Float32Array(o);break;default:throw new Error(`Cannot create pixel array for bit depth ${r}`)}if(i)for(let t=e;t<a.length;t+=n)a[t]=s;return a}(d,l,c,f,h,g);else{const t=function(t,e,i){let n=e*t;return 1===i&&(n=Math.ceil(n/8)),n}(d,f,h);if(n.length!==t)throw new RangeError(`incorrect data size: ${n.length}. Should be ${t}`)}this.width=e,this.height=i,this.data=n,this.size=d,this.components=l,this.alpha=c,this.bitDepth=h,this.maxValue=g,this.colorModel=u,this.channels=f,this.meta=r.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:r.parent||null}),this.position=r.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return"[object IJSImage]"===nv.call(t)}static fromCanvas(t){const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new rv(e.width,e.height,e.data)}static createFrom(t,e){const i=am(t);return Object.assign(i,{parent:t,position:[0,0]},e),new rv(i)}getRoiManager(t){return new ev(this,t)}clone(){const t=this.data.slice();return new rv(this.width,this.height,t,this)}apply(t){for(let e=0;e<this.height;e++)for(let i=0;i<this.width;i++){let n=(e*this.width+i)*this.channels;t.call(this,n)}}}!function(t){for(const e in om)t.prototype[e]=om[e]}(rv),function(t){for(const e in ac)t.prototype[e]=ac[e]}(rv),function(t){for(const e in rp)t.prototype[e]=rp[e]}(rv),rv.prototype.checkProcessable=function(t,e={}){let{bitDepth:i,alpha:n,colorModel:r,components:s,channels:o}=e;if("string"!=typeof t||0===t.length)throw new TypeError("processName must be a string");if(i&&(Array.isArray(i)||(i=[i]),!i.includes(this.bitDepth)))throw new TypeError(`The process: ${t} can only be applied if bit depth is in: ${i}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${t} can only be applied if alpha is in: ${n}`);if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.colorModel)))throw new TypeError(`The process: ${t} can only be applied if color model is in: ${r}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let e=`The process: ${t} can only be applied if the number of components is in: ${s}`;throw 1===s.length&&1===s[0]?new TypeError(`${e}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(e)}if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.channels)))throw new TypeError(`The process: ${t} can only be applied if the number of channels is in: ${o}`)},rv.prototype.getRGBAData=function(t={}){const{clamped:e}=t;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const i=this.width*this.height*4;let n=e?new Uint8ClampedArray(i):new Uint8Array(i);return 1===this.bitDepth?function(t,e){for(let i=0;i<t.size;i++){const n=t.getBit(i);e[4*i]=255*n,e[4*i+1]=255*n,e[4*i+2]=255*n}}(this,n):32===this.bitDepth?(this.checkProcessable("getRGBAData",{alpha:0}),1===this.components?function(t,e){const i=t.min[0],n=t.max[0]-i;for(let r=0;r<t.size;r++){const s=Math.floor(255*(t.data[r]-i)/n);e[4*r]=s,e[4*r+1]=s,e[4*r+2]=s}}(this,n):3===this.components&&(this.checkProcessable("getRGBAData",{colorModel:[hp]}),function(t,e){const i=Math.min(...t.min),n=Math.max(...t.max)-i;for(let r=0;r<t.size;r++){const s=Math.floor(255*(t.data[3*r]-i)/n),o=Math.floor(255*(t.data[3*r+1]-i)/n),a=Math.floor(255*(t.data[3*r+2]-i)/n);e[4*r]=s,e[4*r+1]=o,e[4*r+2]=a}}(this,n))):1===this.components?function(t,e){for(let i=0;i<t.size;i++)e[4*i]=t.data[i*t.channels]>>>t.bitDepth-8,e[4*i+1]=t.data[i*t.channels]>>>t.bitDepth-8,e[4*i+2]=t.data[i*t.channels]>>>t.bitDepth-8}(this,n):3===this.components&&(this.checkProcessable("getRGBAData",{colorModel:[hp]}),function(t,e){for(let i=0;i<t.size;i++)e[4*i]=t.data[i*t.channels]>>>t.bitDepth-8,e[4*i+1]=t.data[i*t.channels+1]>>>t.bitDepth-8,e[4*i+2]=t.data[i*t.channels+2]>>>t.bitDepth-8}(this,n)),1===this.alpha?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),function(t,e){for(let i=0;i<t.size;i++)e[4*i+3]=t.data[i*t.channels+t.components]>>t.bitDepth-8}(this,n)):function(t,e){for(let i=0;i<t.size;i++)e[4*i+3]=255}(this,n),n},rv.load=function(t,e){if("string"==typeof t)return function(t,e){const i=t.slice(0,64).match(em);let n;return n=null!==i?Promise.resolve(function(t){let e,i,n,r,s=.75*t.length,o=t.length,a=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);const l=new Uint8Array(s);for(let s=0;s<o;s+=4)e=Kg[t.charCodeAt(s)],i=Kg[t.charCodeAt(s+1)],n=Kg[t.charCodeAt(s+2)],r=Kg[t.charCodeAt(s+3)],l[a++]=e<<2|i>>4,l[a++]=(15&i)<<4|n>>2,l[a++]=(3&n)<<6|63&r;return l}(t.slice(i[0].length))):function(t,{withCredentials:e=!1}={}){return new Promise((function(i,n){let r=new self.XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.withCredentials=e,r.onload=function(t){200!==this.status?n(t):i(this.response)},r.onerror=n,r.send()}))}(t,e),n.then((n=>im(new Uint8Array(n),i?t:void 0,e&&e.ignorePalette)))}(t,e);if(t instanceof ArrayBuffer)return Promise.resolve(im(new Uint8Array(t),void 0,e&&e.ignorePalette));if(t.buffer)return Promise.resolve(im(t,void 0,e&&e.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')},rv.extendMethod=function(t,e,i={}){let{inPlace:n=!1,returnThis:r=!0,partialArgs:s=[]}=i;return rv.prototype[t]=n?function(...t){this.computed=null;let i=e.apply(this,[...s,...t]);return r?this:i}:function(...t){return e.apply(this,[...s,...t])},rv},rv.extendProperty=function(t,e,i={}){let{partialArgs:n=[]}=i;return ap.get=function(){if(null===this.computed)this.computed={};else if(op()(t,this.computed))return this.computed[t];let i=e.apply(this,n);return this.computed[t]=i,i},Object.defineProperty(rv.prototype,t,ap),rv},function(t){let e={inPlace:!0};t.extendMethod("invert",cm),t.extendMethod("abs",um),t.extendMethod("level",Ym,e),t.extendMethod("add",Wm,e),t.extendMethod("subtract",$m,e),t.extendMethod("subtractImage",Zm),t.extendMethod("multiply",Km,e),t.extendMethod("divide",Jm,e),t.extendMethod("hypotenuse",Hm),t.extendMethod("background",s_),t.extendMethod("flipX",dm),t.extendMethod("flipY",fm),t.extendMethod("blurFilter",gm),t.extendMethod("medianFilter",ym),t.extendMethod("gaussianFilter",vm),t.extendMethod("sobelFilter",Bm),t.extendMethod("gradientFilter",Nm),t.extendMethod("scharrFilter",Um),t.extendMethod("dilate",o_),t.extendMethod("erode",c_),t.extendMethod("open",m_),t.extendMethod("close",__),t.extendMethod("topHat",w_),t.extendMethod("blackHat",y_),t.extendMethod("morphologicalGradient",v_),t.extendMethod("warpingFourPoints",S_),t.extendMethod("crop",E_),t.extendMethod("cropAlpha",C_),t.extendMethod("resize",P_).extendMethod("scale",P_),t.extendMethod("hsv",D_),t.extendMethod("hsl",F_),t.extendMethod("cmyk",L_),t.extendMethod("rgba8",O_),t.extendMethod("grey",B_).extendMethod("gray",B_),t.extendMethod("mask",K_),t.extendMethod("pad",J_),t.extendMethod("colorDepth",Q_),t.extendMethod("setBorder",ow,e),t.extendMethod("rotate",ew),t.extendMethod("rotateLeft",iw),t.extendMethod("rotateRight",nw),t.extendMethod("insert",sw),t.extendMethod("getRow",mw),t.extendMethod("getColumn",_w),t.extendMethod("getMatrix",ww),t.extendMethod("setMatrix",yw),t.extendMethod("getPixelsArray",vw),t.extendMethod("getIntersection",bw),t.extendMethod("getClosestCommonParent",Mw),t.extendMethod("getThreshold",Z_),t.extendMethod("split",aw),t.extendMethod("getChannel",lw),t.extendMethod("combineChannels",hw),t.extendMethod("setChannel",cw),t.extendMethod("getSimilarity",dw),t.extendMethod("getPixelsGrid",fw),t.extendMethod("getBestMatch",pw),t.extendMethod("cannyEdge",Tw),t.extendMethod("convolution",zm),t.extendMethod("extract",Rw),t.extendMethod("floodFill",Fw),t.extendMethod("paintLabels",Yw,e),t.extendMethod("paintMasks",Vw,e),t.extendMethod("paintPoints",Zw,e),t.extendMethod("paintPolyline",Hw,e),t.extendMethod("paintPolylines",Kw,e),t.extendMethod("paintPolygon",Jw,e),t.extendMethod("paintPolygons",ey,e),t.extendMethod("countAlphaPixels",my),t.extendMethod("monotoneChainConvexHull",vy),t.extendMethod("minimalBoundingRectangle",Cy),t.extendMethod("getHistogram",iy).extendProperty("histogram",iy),t.extendMethod("getHistograms",ny).extendProperty("histograms",ny),t.extendMethod("getColorHistogram",sy).extendProperty("colorHistogram",sy),t.extendMethod("getMin",oy).extendProperty("min",oy),t.extendMethod("getMax",ay).extendProperty("max",ay),t.extendMethod("getSum",ly).extendProperty("sum",ly),t.extendMethod("getMoment",hy).extendProperty("moment",hy),t.extendMethod("getLocalMaxima",uy),t.extendMethod("getMedian",dy).extendProperty("median",dy),t.extendMethod("getMean",cy).extendProperty("mean",cy),t.extendMethod("getPoints",fy).extendProperty("points",fy),t.extendMethod("getExtendedPoints",gy).extendProperty("extendedPoints",gy),t.extendMethod("getRelativePosition",py)}(rv);var sv=__webpack_require__(6732),ov=__webpack_require__.n(sv);const av={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function lv(t,e,i){return t.post("data",[e,i]).then((function(t){for(let e in t)t[e]=new rv(t[e]);return t}))}const hv={run:function(t,e,i){e=Object.assign({},av,e);const n=this.manager;return Array.isArray(t)?Promise.all(t.map((function(t){const r=lv(n,t,e);return"function"==typeof i&&r.then(i),r}))):lv(n,t,e)},work:function(){worker.on("data",(function(t,e,i){e=new IJS(e);const n={},r=[],s=e.grey(),o=s.sobelFilter();f("sobel",o);const a=o.level().mask({threshold:i.threshold});f("mask",a);const l=o.getRoiManager();l.fromMask(a);const h=l.getMask(i.roi);f("realMask",h);const u=s.getPixelsGrid({sampling:i.sampling,mask:h}),c=e.getBackground(u.xyS,u.zS,i.regression);f("background",c);const d=e.subtract(c);function f(t,e){i.include.includes(t)&&(n[t]=e,r.push(e.data.buffer))}n.result=d,r.push(d.data.buffer),t(n,r)}))}},uv=hv;class dv{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(null===this._url)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if("string"!=typeof t)throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,e){let i,n,r={};function s(...t){return i||(this.checkUrl(),n=this.url,i=new(ov())(e.work,{deps:n}),r.manager=i),e.run.call(r,...t)}s.reset=function(){i&&(i.terminate(),i=new(ov())(e.work,{deps:n}),r.manager=i)},dv.prototype[t]=s}}function fv(t,e,i){let n=[],r=new ImageData(t.width,t.height),s=[gv(e[0],e[1],e[2]),pv(e[0],e[1],e[2]),mv(e[0],e[1],e[2])];for(let e=0;e<t.data.length;e+=4){let o=t.data[e],a=t.data[e+1],l=t.data[e+2],h=[gv(o,a,l),pv(o,a,l),mv(o,a,l)],u=Math.sqrt(.5053*Math.pow(h[0]-s[0],2)+.299*Math.pow(h[1]-s[1],2)+.1957*Math.pow(h[2]-s[2],2));n.push(u),Math.abs(u)===i&&(r.data[e]=255,r.data[e+3]=255)}return r}function gv(t,e,i){return.29889531*t+.58662247*e+.11448223*i}function pv(t,e,i){return.59597799*t-.2741761*e-.32180189*i}function mv(t,e,i){return.21147017*t-.52261711*e+.31114694*i}function _v(t,e,i,n){let r=t.contour,s=(t.color,{}),o=(n[2]-n[0])/e,a=(n[3]-n[1])/i;for(let t=0;t<r.length;t+=3){let e=r[t],i=r[t+1],n=r[t+2],o=[e,i,n];0===e&&0===i&&0===n||(o.toString()in s?s[o.toString()].push(t/3):s[o.toString()]=[t/3])}let l={type:"FeatureCollection",name:"polygonFeatures",crs:{type:"name",properties:{name:"EPSG:3857"}},features:[]};for(const t in s){let i=[];for(let n=0;n<s[t].length;n++){let r=s[t][n]%e,o=Math.floor(s[t][n]/e);i.push([r,o])}if(i.length<=3)continue;let r=wv(i),h=[];for(let t=0;t<r.length;t++){let e=r[t][0],i=r[t][1];e=n[0]+e*o,i=n[3]-i*a,h.push([e,i])}l.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[h]},proprties:{prop:""}})}return l}function wv(t){let e=t.slice(),i=[],n=e[0];i.push(n),e[0]=[NaN,NaN];let r=0,s=e.length-1,o=0;function a(t){return[[t[0]-1,t[1]-1],[t[0],t[1]-1],[t[0]+1,t[1]-1],[t[0]-1,t[1]],t,[t[0]+1,t[1]],[t[0]-1,t[1]+1],[t[0],t[1]+1],[t[0]+1,t[1]+1]]}for(let n=0;n<=i.length;n++){o++;let l=i.length,h=a(i[n]);t:for(let n=0;n<h.length;n++)for(let r=1;r<e.length&&4!==n;r++)if(h[n][0]===e[r][0]&&h[n][1]===e[r][1]&&NaN!=e[r][0]&&NaN!=e[r][1]){i.push(t[r]),e[r]=[NaN,NaN],s-=1;break t}if(i.length-l==0&&(i.pop(),n-=2,r+=1),o===e.length-1){console.log("breaked");break}}return i}!function(t){t.extendMethod("background",uv)}(dv),new dv;var yv=__webpack_require__(9152);const vv=class{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return H(void 0!==i,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return H(void 0!==e,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){H(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}};function bv(t,e,i,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=i,n):[t,e,i]}function xv(t,e,i){return t+"/"+e+"/"+i}function Mv(t){return xv(t[0],t[1],t[2])}function kv(t){return(t[1]<<t[0])+t[2]}const Sv=class extends vv{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0===this.getCount())return;const t=(e=this.peekFirstKey(),e.split("/").map(Number))[0];var e;this.forEach((e=>{e.tileCoord[0]!==t&&(this.remove(Mv(e.tileCoord)),e.release())}))}};function Ev(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}const Cv=class extends L{constructor(t){super(),this.projection=ke(t.projection),this.attributions_=Ev(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise((function(t,i){e.viewResolver=t,e.viewRejector=i}))}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Ev(t),this.changed()}setState(t){this.state_=t,this.changed()}},Iv=[0,0,0],Av=class{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,H(function(t,e,i){const n=((t,e)=>e-t)||a;return t.every((function(e,i){if(0===i)return!0;const r=n(t[i-1],e);return!(r>0||0===r)}))}(this.resolutions_),"`resolutions` must be sorted in descending order"),!t.origins)for(let t=0,i=this.resolutions_.length-1;t<i;++t)if(e){if(this.resolutions_[t]/this.resolutions_[t+1]!==e){e=void 0;break}}else e=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,H(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;void 0===i||this.origin_||this.origins_||(this.origin_=se(i)),H(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,H(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:gt,H(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(((t,e)=>{const n=new xa(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(i){const t=this.getTileRangeForExtentAndZ(i,e);n.minX=Math.max(t.minX,n.minX),n.maxX=Math.min(t.maxX,n.maxX),n.minY=Math.max(t.minY,n.minY),n.maxY=Math.min(t.maxY,n.maxY)}return n})):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const n=this.getTileRangeForExtentAndZ(t,e);for(let t=n.minX,r=n.maxX;t<=r;++t)for(let r=n.minY,s=n.maxY;r<=s;++r)i([e,t,r])}forEachTileCoordParentTileRange(t,e,i,n){let r,s,o,a=null,l=t[0]-1;for(2===this.zoomFactor_?(s=t[1],o=t[2]):a=this.getTileCoordExtent(t,n);l>=this.minZoom;){if(void 0!==s&&void 0!==o?(s=Math.floor(s/2),o=Math.floor(o/2),r=ba(s,s,o,o,i)):r=this.getTileRangeForExtentAndZ(a,l,i),e(l,r))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*t[1],n=2*t[2];return ba(i,i+1,n,n+1,e)}const n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const n=t[0],r=t[1],s=t[2];if(e===n)return ba(r,s,r,s,i);if(this.zoomFactor_){const t=Math.pow(this.zoomFactor_,e-n),o=Math.floor(r*t),a=Math.floor(s*t);return e<n?ba(o,o,a,a,i):ba(o,Math.floor(t*(r+1))-1,a,Math.floor(t*(s+1))-1,i)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Iv);const n=Iv[1],r=Iv[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Iv),ba(n,Iv[1],r,Iv[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=dn(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=dn(this.getTileSize(t[0]),this.tmpSize_),s=i[0]+t[1]*r[0]*n,o=i[1]-(t[2]+1)*r[1]*n;return Ut(s,o,s+r[0]*n,o+r[1]*n,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,r){const s=this.getZForResolution(i),o=i/this.getResolution(s),a=this.getOrigin(s),l=dn(this.getTileSize(s),this.tmpSize_);let h=o*(t-a[0])/i/l[0],u=o*(a[1]-e)/i/l[1];return n?(h=ot(h,5)-1,u=ot(u,5)-1):(h=st(h,5),u=st(u,5)),bv(s,h,u,r)}getTileCoordForXYAndZ_(t,e,i,n,r){const s=this.getOrigin(i),o=this.getResolution(i),a=dn(this.getTileSize(i),this.tmpSize_);let l=(t-s[0])/o/a[0],h=(s[1]-e)/o/a[1];return n?(l=ot(l,5)-1,h=ot(h,5)-1):(l=st(l,5),h=st(h,5)),bv(i,l,h,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){return K(l(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Gi(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}};function Tv(t){let e=t.getDefaultTileGrid();return e||(e=function(t,e,i,n){return function(t,e,i,n){n=void 0!==n?n:"top-left";const r=Pv(t,undefined,i);return new Av({extent:t,origin:te(t,n),resolutions:r,tileSize:i})}(Dv(t),0,void 0,void 0)}(t),t.setDefaultTileGrid(e)),e}function Rv(t){const e=t||{},i=e.extent||ke("EPSG:3857").getExtent(),n={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Pv(i,e.maxZoom,e.tileSize,e.maxResolution)};return new Av(n)}function Pv(t,e,i,n){e=void 0!==e?e:ft,i=dn(void 0!==i?i:gt);const r=ne(t),s=ae(t);n=n>0?n:Math.max(s/i[0],r/i[1]);const o=e+1,a=new Array(o);for(let t=0;t<o;++t)a[t]=n/Math.pow(2,t);return a}function Dv(t){let e=(t=ke(t)).getExtent();if(!e){const i=180*pt.degrees/t.getMetersPerUnit();e=Ut(-i,-i,i,i)}return e}class Fv extends r{constructor(t,e){super(t),this.tile=e}}const Lv=class extends Cv{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;this.tileGrid&&dn(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new Sv(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,n){const r=this.getTileCacheForProjection(t);if(!r)return!1;let s,o,a,l=!0;for(let t=i.minX;t<=i.maxX;++t)for(let h=i.minY;h<=i.maxY;++h)o=xv(e,t,h),a=!1,r.containsKey(o)&&(s=r.get(o),a=s.getState()===po,a&&(a=!1!==n(s))),a||(l=!1);return l}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,n,r){return R()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Tv(t)}getTileCacheForProjection(t){const e=this.getProjection();return H(null===e||Ie(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),s=dn(n.getTileSize(t),this.tmpSize);return 1==r?s:cn(s,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function(t,e,i){const n=e[0],r=t.getTileCoordCenter(e),s=Dv(i);if(!Ot(s,r)){const e=ae(s),i=Math.ceil((s[0]-r[0])/e);return r[0]+=e*i,t.getTileCoordForCoordAndZ(r,n)}return e}(i,t,e)),function(t,e){const i=t[0],n=t[1],r=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;const s=e.getFullTileRange(i);return!s||s.containsXY(n,r)}(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,n){}};function Ov(t,e){const i=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return t.replace(i,o[0].toString()).replace(n,o[1].toString()).replace(r,o[2].toString()).replace(s,(function(){const t=o[0],i=e.getFullTileRange(t);if(!i)throw new Error("The {-y} placeholder requires a tile grid with extent");return(i.getHeight()-o[2]-1).toString()}))}}function zv(t){return 1===t.length?t[0]:function(e,i,n){if(!e)return;const r=et(kv(e),t.length);return t[r](e,i,n)}}class Nv extends Lv{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Nv.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=D(e),n=e.getState();let r;n==go?(this.tileLoadingKeys_[i]=!0,r="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==mo?"tileloaderror":n==po?"tileloadend":void 0),null!=r&&this.dispatchEvent(new Fv(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){const e=function(t){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(t);if(i){const n=i[1].charCodeAt(0),r=i[2].charCodeAt(0);let s;for(s=n;s<=r;++s)e.push(t.replace(i[0],String.fromCharCode(s)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(t),i){const n=parseInt(i[2],10);for(let r=parseInt(i[1],10);r<=n;r++)e.push(t.replace(i[0],r.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){const i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=Ov(t[r],e);return zv(n)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const n=xv(t,e,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const Bv=Nv;function Uv(t,e){t.getImage().src=e}const Gv=class extends Bv{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Uv,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:da,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const t in this.tileCacheForProjection){const n=this.tileCacheForProjection[t];n.expireCache(n==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Ie(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!Ie(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ie(e,t)))return this.tileGrid;const i=D(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Tv(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Ie(e,t))return this.tileCache;const i=D(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Sv(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(t,e,i,n,r,s){const o=[t,e,i],a=this.getTileCoordForTileUrlFunction(o,r),l=a?this.tileUrlFunction(a,n,r):void 0,h=new this.tileClass(o,void 0!==l?fo:_o,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=s,h.addEventListener(y,this.handleTileChange.bind(this)),h}getTile(t,e,i,n,r){const s=this.getProjection();if(!s||!r||Ie(s,r))return this.getTileInternal(t,e,i,n,s||r);const o=this.getTileCacheForProjection(r),a=[t,e,i];let l;const h=Mv(a);o.containsKey(h)&&(l=o.get(h));const u=this.getKey();if(l&&l.key==u)return l;const c=this.getTileGridForProjection(s),d=this.getTileGridForProjection(r),f=this.getTileCoordForTileUrlFunction(a,r),g=new ya(s,c,r,d,a,f,this.getTilePixelRatio(n),this.getGutter(),((t,e,i,n)=>this.getTileInternal(t,e,i,n,s)),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return g.key=u,l?(g.interimTile=l,g.refreshInterimChain(),o.replace(h,g)):o.set(h,g),g}getTileInternal(t,e,i,n,r){let s=null;const o=xv(t,e,i),a=this.getKey();if(this.tileCache.containsKey(o)){if(s=this.tileCache.get(o),s.key!=a){const l=s;s=this.createTile_(t,e,i,n,r,a),l.getState()==fo?s.interimTile=l.interimTile:s.interimTile=l,s.refreshInterimChain(),this.tileCache.replace(o,s)}}else s=this.createTile_(t,e,i,n,r,a),this.tileCache.set(o,s);return s}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(t,e){const i=ke(t);if(i){const t=D(i);t in this.tileGridForProjection||(this.tileGridForProjection[t]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},Xv=class extends Gv{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:Rv({extent:Dv(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}},Yv=class extends Xv{constructor(t){let e;e=void 0!==(t=t||{}).attributions?t.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'];const i=void 0!==t.crossOrigin?t.crossOrigin:"anonymous",n=void 0!==t.url?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:void 0!==t.maxZoom?t.maxZoom:19,opaque:void 0===t.opaque||t.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:n,wrapX:t.wrapX,zDirection:t.zDirection})}},Vv=class extends Gv{constructor(t){const e=void 0!==t.hidpi&&t.hidpi;super({cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:!0,projection:ke("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.hidpi_=e,this.culture_=void 0!==t.culture?t.culture:"en-us",this.maxZoom_=void 0!==t.maxZoom?t.maxZoom:-1,this.apiKey_=t.key,this.imagerySet_=t.imagerySet,this.placeholderTiles_=t.placeholderTiles;const i="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(i).then((t=>t.json())).then((t=>this.handleImageryMetadataResponse(t)))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(t){if(200!=t.statusCode||"OK"!=t.statusDescription||"ValidCredentials"!=t.authenticationResultCode||1!=t.resourceSets.length||1!=t.resourceSets[0].resources.length)return void this.setState("error");const e=t.resourceSets[0].resources[0],i=-1==this.maxZoom_?e.zoomMax:this.maxZoom_,n=Dv(this.getProjection()),r=this.hidpi_?2:1,s=e.imageWidth==e.imageHeight?e.imageWidth/r:[e.imageWidth/r,e.imageHeight/r],o=Rv({extent:n,minZoom:e.zoomMin,maxZoom:i,tileSize:s});this.tileGrid=o;const a=this.culture_,l=this.hidpi_,h=this.placeholderTiles_;if(this.tileUrlFunction=zv(e.imageUrlSubdomains.map((function(t){const i=[0,0,0],n=e.imageUrl.replace("{subdomain}",t).replace("{culture}",a);return function(t,e,r){if(!t)return;bv(t[0],t[1],t[2],i);const s=new URL(n.replace("{quadkey}",function(t){const e=t[0],i=new Array(e);let n,r,s=1<<e-1;for(n=0;n<e;++n)r=48,t[1]&s&&(r+=1),t[2]&s&&(r+=2),i[n]=String.fromCharCode(r),s>>=1;return i.join("")}(i))),o=s.searchParams;return l&&(o.set("dpi","d1"),o.set("device","mobile")),!0===h?o.delete("n"):!1===h&&o.set("n","z"),s.toString()}}))),e.imageryProviders){const t=Ae(ke("EPSG:4326"),this.getProjection());this.setAttributions((i=>{const n=[],r=i.viewState,s=this.getTileGrid(),o=s.getZForResolution(r.resolution,this.zDirection),a=s.getTileCoordForCoordAndZ(r.center,o)[0];return e.imageryProviders.map((function(e){let r=!1;const s=e.coverageAreas;for(let e=0,n=s.length;e<n;++e){const n=s[e];if(a>=n.zoomMin&&a<=n.zoomMax){const e=n.bbox;if(le(ue([e[1],e[0],e[3],e[2]],t),i.extent)){r=!0;break}}}r&&n.push(e.attribution)})),n.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>'),n}))}this.setState("ready")}};const jv=class extends Gv{constructor(t){super({attributions:(t=t||{}).attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.params_=Object.assign({},t.params),this.hidpi_=void 0===t.hidpi||t.hidpi,this.tmpExtent_=[1/0,1/0,-1/0,-1/0],this.setKey(this.getKeyForParams_())}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}getParams(){return this.params_}getRequestUrl_(t,e,i,n,r,s){const o=this.urls;if(!o)return;let a;return a=1==o.length?o[0]:o[et(kv(t),o.length)],function(t,e,i,n,r,s){const o=r.getCode().split(/:(?=\d+$)/).pop(),a=i/n,l=[rt(ae(e)/a,4),rt(ne(e)/a,4)];return s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*n:90*n),function(t,e){const i=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&i.push(t+"="+encodeURIComponent(e[t]))}));const n=i.join("&");return t=t.replace(/[?&]$/,""),(t+=t.includes("?")?"&":"?")+n}(t.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage"),s)}(a,i,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(t[0]),n,r,s)}getTilePixelRatio(t){return this.hidpi_?t:1}updateParams(t){Object.assign(this.params_,t),this.setKey(this.getKeyForParams_())}tileUrlFunction(t,e,i){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),n.getResolutions().length<=t[0])return;1==e||this.hidpi_||(e=1);const r=n.getTileCoordExtent(t,this.tmpExtent_);let s=dn(n.getTileSize(t[0]),this.tmpSize);1!=e&&(s=cn(s,e,this.tmpSize));const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(o,this.params_),this.getRequestUrl_(t,s,r,e,i,o)}},qv=class{constructor(){this.apikeys={BingMapKey:"AoTrgwP6rdBDsqtY-wq-Z5aA31YHoSzOyKStmu8t0-ZLUbO2LS4PbYoNYNe2SPSx",ArcGISKey:"AAPK3890bdd7605a4e3d9adb68f5790780eczWSlc-Uyepn0n8XMnNwNaiymNVrEy4ihJruVsf2PVK_lD086faryQVtQkssjkq84"}}getKeys(){return this.apikeys}};async function Wv(t,e,i){t.once("rendercomplete",(function(){const n=t.getSize();e.width=n[0],e.height=n[1];const r=i;Array.prototype.forEach.call(t.getViewport().querySelectorAll(".ol-layer canvas, canvas.ol-layer"),(function(t){if(t.width>0){const e=t.parentNode.style.opacity||t.style.opacity;let i;r.globalAlpha=""===e?1:Number(e);const n=t.style.transform;i=n?n.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number):[parseFloat(t.style.width)/t.width,0,0,parseFloat(t.style.height)/t.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(r,i);const s=t.parentNode.style.backgroundColor;s&&(r.fillStyle=s,r.fillRect(0,0,t.width,t.height)),r.drawImage(t,0,0)}})),r.globalAlpha=1,r.setTransform(1,0,0,1,0,0)})),t.renderSync()}let $v=document.createElement("div");$v.style.width="300px",$v.style.background="white";let Zv=document.createElement("h3");Zv.textContent="Select features from both map",Zv.style.color="#32a852",Zv.style.fontWeight="bold";let Hv=document.createElement("h3");Hv.className="h3",Hv.textContent="Enter parameters for Map 1";let Kv=document.createElement("h3");function Jv(t,e,i){let n=document.createElement("div"),r=document.createElement("input");return r.setAttribute("id",t),r.placeholder=i,r.style.marginLeft="10px",r.style.marginBottom="10px",r.className="input",r.value=e,sessionStorage.setItem(t,e),r.addEventListener("input",(t=>{sessionStorage.setItem(r.id,r.value)})),r.value,n.append(r),n}function Qv(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function tb(t,e){let i=Math.floor(e/2),n=[];for(let e=t[0]-i;e<=t[0]+i;e++)for(let r=t[1]-i;r<=t[1]+i;r++)n.push([e,r]);return n}function eb(t){let e=t/2,i=[],n=Math.floor(e);for(let e=0;e<t;e++){let e=[];for(let i=0;i<t;i++)e.push(0);i.push(e)}for(let r=0;r<t;r++)for(let s=0;s<t;s++){let o,a=n-r,l=n-s,h=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),u=n-1;if(Math.sqrt(Math.pow(u,2)+Math.pow(u,2)),h<=e&&0===r|r===t-1)i[r][s]=1;else if(h<=e){i[r][s]=1,o=s,i[r][t-1-o]=1;break}}return i}Kv.className="h3",Kv.textContent="Enter parameters for Map 2";class ib extends L{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new ib(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(I(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=E(t,y,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(t){if("function"==typeof t)return t;let e;return Array.isArray(t)?e=t:(H("function"==typeof t.getZIndex,"Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[t]),function(){return e}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const nb=ib,rb={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},sb=[rb.FILL],ob=[rb.STROKE],ab=[rb.BEGIN_PATH],lb=[rb.CLOSE_PATH],hb=rb,ub=class{drawCustom(t,e,i,n,r){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},cb=class extends ub{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let s=r.length;for(let o=0,a=t.length;o<a;o+=e)n[0]=t[o],n[1]=t[o+1],Ot(i,n)&&(r[s++]=n[0],r[s++]=n[1]);return s}appendFlatLineCoordinates(t,e,i,n,r,s){const o=this.coordinates;let a=o.length;const l=this.getBufferedMaxExtent();s&&(e+=n);let h=t[e],u=t[e+1];const c=this.tmpCoordinate_;let d,f,g,p=!0;for(d=e+n;d<i;d+=n)c[0]=t[d],c[1]=t[d+1],g=Bt(l,c),g!==f?(p&&(o[a++]=h,o[a++]=u,p=!1),o[a++]=c[0],o[a++]=c[1]):g===Rt.INTERSECTING?(o[a++]=c[0],o[a++]=c[1],p=!1):p=!0,h=c[0],u=c[1],f=g;return(r&&p||d===e+n)&&(o[a++]=h,o[a++]=u),a}drawCustomCoordinates_(t,e,i,n,r){for(let s=0,o=i.length;s<o;++s){const o=i[s],a=this.appendFlatLineCoordinates(t,e,o,n,!1,!1);r.push(a),e=o}return e}drawCustom(t,e,i,n,r){this.beginGeometry(t,e,r);const s=t.getType(),o=t.getStride(),a=this.coordinates.length;let l,h,u,c,d;switch(s){case"MultiPolygon":l=t.getOrientedFlatCoordinates(),c=[];const e=t.getEndss();d=0;for(let t=0,i=e.length;t<i;++t){const i=[];d=this.drawCustomCoordinates_(l,d,e[t],o,i),c.push(i)}this.instructions.push([hb.CUSTOM,a,c,t,i,Ci,r]),this.hitDetectionInstructions.push([hb.CUSTOM,a,c,t,n||i,Ci,r]);break;case"Polygon":case"MultiLineString":u=[],l="Polygon"==s?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,t.getEnds(),o,u),this.instructions.push([hb.CUSTOM,a,u,t,i,Ei,r]),this.hitDetectionInstructions.push([hb.CUSTOM,a,u,t,n||i,Ei,r]);break;case"LineString":case"Circle":l=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([hb.CUSTOM,a,h,t,i,Si,r]),this.hitDetectionInstructions.push([hb.CUSTOM,a,h,t,n||i,Si,r]);break;case"MultiPoint":l=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([hb.CUSTOM,a,h,t,i,Si,r]),this.hitDetectionInstructions.push([hb.CUSTOM,a,h,t,n||i,Si,r]));break;case"Point":l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([hb.CUSTOM,a,h,t,i,void 0,r]),this.hitDetectionInstructions.push([hb.CUSTOM,a,h,t,n||i,void 0,r])}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[hb.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[hb.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let n,r,s=-1;for(e=0;e<i;++e)n=t[e],r=n[0],r==hb.END_GEOMETRY?s=e:r==hb.BEGIN_GEOMETRY&&(n[2]=e,h(this.hitDetectionInstructions,s,e),s=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const e=t.getColor();i.fillPatternScale=e&&"object"==typeof e&&"src"in e?this.pixelRatio:1,i.fillStyle=Qn(e||lr)}else i.fillStyle=void 0;if(e){const t=e.getColor();i.strokeStyle=Qn(t||dr);const n=e.getLineCap();i.lineCap=void 0!==n?n:hr;const r=e.getLineDash();i.lineDash=r?r.slice():ur;const s=e.getLineDashOffset();i.lineDashOffset=s||0;const o=e.getLineJoin();i.lineJoin=void 0!==o?o:cr;const a=e.getWidth();i.lineWidth=void 0!==a?a:1;const l=e.getMiterLimit();i.miterLimit=void 0!==l?l:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[hb.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[hb.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,r=t.lineDash,s=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||r!=t.currentLineDash&&!c(t.currentLineDash,r)||t.currentLineDashOffset!=s||t.currentLineJoin!=o||t.currentLineWidth!=a||t.currentMiterLimit!=l)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=s,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=l)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[hb.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ft(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Dt(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},db=class extends cb{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const r=this.state,s=void 0!==r.fillStyle,o=void 0!==r.strokeStyle,a=i.length;this.instructions.push(ab),this.hitDetectionInstructions.push(ab);for(let r=0;r<a;++r){const s=i[r],a=this.coordinates.length,l=this.appendFlatLineCoordinates(t,e,s,n,!0,!o),h=[hb.MOVE_TO_LINE_TO,a,l];this.instructions.push(h),this.hitDetectionInstructions.push(h),o&&(this.instructions.push(lb),this.hitDetectionInstructions.push(lb)),e=s}return s&&(this.instructions.push(sb),this.hitDetectionInstructions.push(sb)),o&&(this.instructions.push(ob),this.hitDetectionInstructions.push(ob)),e}drawCircle(t,e,i){const n=this.state,r=n.fillStyle,s=n.strokeStyle;if(void 0===r&&void 0===s)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([hb.SET_FILL_STYLE,lr]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([hb.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ur,0]);const o=t.getFlatCoordinates(),a=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[hb.CIRCLE,l];this.instructions.push(ab,h),this.hitDetectionInstructions.push(ab,h),void 0!==n.fillStyle&&(this.instructions.push(sb),this.hitDetectionInstructions.push(sb)),void 0!==n.strokeStyle&&(this.instructions.push(ob),this.hitDetectionInstructions.push(ob)),this.endGeometry(e)}drawPolygon(t,e,i){const n=this.state,r=n.fillStyle,s=n.strokeStyle;if(void 0===r&&void 0===s)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([hb.SET_FILL_STYLE,lr]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([hb.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ur,0]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(e)}drawMultiPolygon(t,e,i){const n=this.state,r=n.fillStyle,s=n.strokeStyle;if(void 0===r&&void 0===s)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([hb.SET_FILL_STYLE,lr]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([hb.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ur,0]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),l=t.getStride();let h=0;for(let t=0,e=o.length;t<e;++t)h=this.drawFlatCoordinatess_(a,h,o[t],l);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=xi(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};function fb(t,e,i,n,r){const s=[];let o=i,a=0,l=e.slice(i,2);for(;a<t&&o+r<n;){const[i,n]=l.slice(-2),h=e[o+r],u=e[o+r+1],c=Math.sqrt((h-i)*(h-i)+(u-n)*(u-n));if(a+=c,a>=t){const e=(t-a+c)/c,d=it(i,h,e),f=it(n,u,e);l.push(d,f),s.push(l),l=[d,f],a==t&&(o+=r),a=0}else if(a<t)l.push(e[o+r],e[o+r+1]),o+=r;else{const t=c-a,e=it(i,h,t/c),d=it(n,u,t/c);l.push(e,d),s.push(l),l=[e,d],a=0,o+=r}}return a>0&&s.push(l),s}function gb(t,e,i,n,r){let s,o,a,l,h,u,c,d,f,g,p=i,m=i,_=0,w=0,y=i;for(o=i;o<n;o+=r){const i=e[o],n=e[o+1];void 0!==h&&(f=i-h,g=n-u,l=Math.sqrt(f*f+g*g),void 0!==c&&(w+=a,s=Math.acos((c*f+d*g)/(a*l)),s>t&&(w>_&&(_=w,p=y,m=o),w=0,y=o-r)),a=l,c=f,d=g),h=i,u=n}return w+=l,w>_?[y,o]:[p,m]}const pb={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},mb={Circle:db,Default:cb,Image:class extends cb{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!Ot(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const n=t.getFlatCoordinates(),r=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(n,r);this.instructions.push([hb.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([hb.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const n=t.getFlatCoordinates(),r=[];for(let e=0,i=n.length;e<i;e+=t.getStride())this.maxExtent&&!Ot(this.maxExtent,n.slice(e,e+2))||r.push(n[e],n[e+1]);const s=this.coordinates.length,o=this.appendFlatPointCoordinates(r,2);this.instructions.push([hb.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([hb.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class extends cb{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const r=this.coordinates.length,s=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),o=[hb.MOVE_TO_LINE_TO,r,s];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){const n=this.state,r=n.strokeStyle,s=n.lineWidth;if(void 0===r||void 0===s)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([hb.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ur,0],ab);const o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(ob),this.endGeometry(e)}drawMultiLineString(t,e,i){const n=this.state,r=n.strokeStyle,s=n.lineWidth;if(void 0===r||void 0===s)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([hb.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ur,0],ab);const o=t.getEnds(),a=t.getFlatCoordinates(),l=t.getStride();let h=0;for(let t=0,e=o.length;t<e;++t)h=this.drawFlatCoordinates_(a,h,o[t],l);this.hitDetectionInstructions.push(ob),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ob),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ob),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(ab)}},Polygon:db,Text:class extends cb{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[lr]={fillStyle:lr},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const n=this.textFillState_,r=this.textStrokeState_,s=this.textState_;if(""===this.text_||!s||!n&&!r)return;const o=this.coordinates;let a=o.length;const l=t.getType();let h=null,u=t.getStride();if("line"!==s.placement||"LineString"!=l&&"MultiLineString"!=l&&"Polygon"!=l&&"MultiPolygon"!=l){let n=s.overflow?null:[];switch(l){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),u=2;break;case"Polygon":h=t.getFlatInteriorPoint(),s.overflow||n.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":const e=t.getFlatInteriorPoints();h=[];for(let t=0,i=e.length;t<i;t+=3)s.overflow||n.push(e[t+2]/this.resolution),h.push(e[t],e[t+1]);if(0===h.length)return;u=2}const r=this.appendFlatPointCoordinates(h,u);if(r===a)return;if(n&&(r-a)/2!=h.length/u){let t=a/2;n=n.filter(((e,i)=>{const n=o[2*(t+i)]===h[i*u]&&o[2*(t+i)+1]===h[i*u+1];return n||--t,n}))}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&this.updateFillStyle(this.state,this.createFill),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,i);let c=s.padding;if(c!=pr&&(s.scale[0]<0||s.scale[1]<0)){let t=s.padding[0],e=s.padding[1],i=s.padding[2],n=s.padding[3];s.scale[0]<0&&(e=-e,n=-n),s.scale[1]<0&&(t=-t,i=-i),c=[t,e,i,n]}const d=this.pixelRatio;this.instructions.push([hb.DRAW_IMAGE,a,r,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,c==pr?pr:c.map((function(t){return t*d})),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,n]);const f=1/d,g=this.state.fillStyle;s.backgroundFill&&(this.state.fillStyle=lr,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([hb.DRAW_IMAGE,a,r,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[f,f],NaN,this.declutterMode_,this.declutterImageWithText_,c,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?lr:this.fillKey_,this.textOffsetX_,this.textOffsetY_,n]),s.backgroundFill&&(this.state.fillStyle=g,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}else{if(!le(this.maxExtent,t.getExtent()))return;let n;if(h=t.getFlatCoordinates(),"LineString"==l)n=[h.length];else if("MultiLineString"==l)n=t.getEnds();else if("Polygon"==l)n=t.getEnds().slice(0,1);else if("MultiPolygon"==l){const e=t.getEndss();n=[];for(let t=0,i=e.length;t<i;++t)n.push(e[t][0])}this.beginGeometry(t,e,i);const r=s.repeat,c=r?void 0:s.textAlign;let d=0;for(let t=0,e=n.length;t<e;++t){let e;e=r?fb(r*this.resolution,h,d,n[t],u):[h.slice(d,n[t])];for(let i=0,r=e.length;i<r;++i){const r=e[i];let l=0,h=r.length;if(null==c){const t=gb(s.maxAngle,r,0,r.length,2);l=t[0],h=t[1]}for(let t=l;t<h;t+=u)o.push(r[t],r[t+1]);const f=o.length;d=n[t],this.drawChars_(a,f),a=f}}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||fr,justify:e.justify,textBaseline:e.textBaseline||gr,scale:e.scale});const s=this.fillKey_;i&&(s in this.fillStates||(this.fillStates[s]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,s=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,l=pb[n.textBaseline],h=this.textOffsetY_*a,u=this.text_,c=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([hb.DRAW_CHARS,t,e,l,n.overflow,o,n.maxAngle,a,h,r,c*a,u,s,1,this.declutterMode_]),this.hitDetectionInstructions.push([hb.DRAW_CHARS,t,e,l,n.overflow,o?lr:o,n.maxAngle,a,h,r,c*a,u,s,1/a,this.declutterMode_])}setTextStyle(t,e){let i,n,r;if(t){const e=t.getFill();e?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Qn(e.getColor()||lr)):(n=null,this.textFillState_=n);const s=t.getStroke();if(s){r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const t=s.getLineDash(),e=s.getLineDashOffset(),i=s.getWidth(),n=s.getMiterLimit();r.lineCap=s.getLineCap()||hr,r.lineDash=t?t.slice():ur,r.lineDashOffset=void 0===e?0:e,r.lineJoin=s.getLineJoin()||cr,r.lineWidth=void 0===i?1:i,r.miterLimit=void 0===n?10:n,r.strokeStyle=Qn(s.getColor()||dr)}else r=null,this.textStrokeState_=r;i=this.textState_;const o=t.getFont()||ar;vr(o);const a=t.getScaleArray();i.overflow=t.getOverflow(),i.font=o,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||gr,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||pr,i.scale=void 0===a?[1,1]:a;const l=t.getOffsetX(),h=t.getOffsetY(),u=t.getRotateWithView(),c=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===l?0:l,this.textOffsetY_=void 0===h?0:h,this.textRotateWithView_=void 0!==u&&u,this.textRotation_=void 0===c?0:c,this.strokeKey_=r?("string"==typeof r.strokeStyle?r.strokeStyle:D(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?"string"==typeof n.fillStyle?n.fillStyle:"|"+D(n.fillStyle):""}else this.text_="";this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}},_b=class{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const r=i[n].finish();t[e][n]=r}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let n=this.buildersByZIndex_[i];void 0===n&&(n={},this.buildersByZIndex_[i]=n);let r=n[e];return void 0===r&&(r=new(0,mb[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=r),r}};function wb(t,e,i,n,r,s,o,a,l,h,u,c){let d=t[e],f=t[e+1],g=0,p=0,m=0,_=0;function w(){g=d,p=f,d=t[e+=n],f=t[e+1],_+=m,m=Math.sqrt((d-g)*(d-g)+(f-p)*(f-p))}do{w()}while(e<i-n&&_+m<s);let y=0===m?0:(s-_)/m;const v=it(g,d,y),b=it(p,f,y),x=e-n,M=_,k=s+a*l(h,r,u);for(;e<i-n&&_+m<k;)w();y=0===m?0:(k-_)/m;const S=it(g,d,y),E=it(p,f,y);let C;if(c){const t=[v,b,S,E];oi(t,0,4,2,c,t,t),C=t[0]>t[2]}else C=v>S;const I=Math.PI,A=[],T=x+n===e;let R;if(m=0,_=M,d=t[e=x],f=t[e+1],T){w(),R=Math.atan2(f-p,d-g),C&&(R+=R>0?-I:I);const t=(S+v)/2,e=(E+b)/2;return A[0]=[t,e,(k-s)/2,R,r],A}for(let t=0,c=(r=r.replace(/\n/g," ")).length;t<c;){w();let v=Math.atan2(f-p,d-g);if(C&&(v+=v>0?-I:I),void 0!==R){let t=v-R;if(t+=t>I?-2*I:t<-I?2*I:0,Math.abs(t)>o)return null}R=v;const b=t;let x=0;for(;t<c;++t){const o=a*l(h,r[C?c-t-1:t],u);if(e+n<i&&_+m<s+x+o/2)break;x+=o}if(t===b)continue;const M=C?r.substring(c-b,c-t):r.substring(b,t);y=0===m?0:(s+x/2-_)/m;const k=it(g,d,y),S=it(p,f,y);A.push([k,S,x/2,v,M]),s+=x}return A}function yb(t,e,i,n){let r=t[e],s=t[e+1],o=0;for(let a=e+n;a<i;a+=n){const e=t[a],i=t[a+1];o+=Math.sqrt((e-r)*(e-r)+(i-s)*(i-s)),r=e,s=i}return o}const vb=[1/0,1/0,-1/0,-1/0],bb=[],xb=[],Mb=[],kb=[];function Sb(t){return t[3].declutterBox}const Eb=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Cb(t,e){return"start"===e?e=Eb.test(t)?"right":"left":"end"===e&&(e=Eb.test(t)?"left":"right"),pb[e]}function Ib(t,e,i){return i>0&&t.push("\n",""),t.push(e,""),t}const Ab=class{constructor(t,e,i,n,r){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new aa:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,n){const r=t+e+i+n;if(this.labels_[r])return this.labels_[r];const s=n?this.strokeStates[n]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],l=this.pixelRatio,h=[a.scale[0]*l,a.scale[1]*l],u=Array.isArray(t),c=a.justify?pb[a.justify]:Cb(Array.isArray(t)?t[0]:t,a.textAlign||fr),d=n&&s.lineWidth?s.lineWidth:0,f=u?t:t.split("\n").reduce(Ib,[]),{width:g,height:p,widths:m,heights:_,lineWidths:w}=function(t,e){const i=[],n=[],r=[];let s=0,o=0,a=0,l=0;for(let h=0,u=e.length;h<=u;h+=2){const c=e[h];if("\n"===c||h===u){s=Math.max(s,o),r.push(o),o=0,a+=l;continue}const d=e[h+1]||t.font,f=Mr(d,c);i.push(f),o+=f;const g=br(d);n.push(g),l=Math.max(l,g)}return{width:s,height:a,widths:i,heights:n,lineWidths:r}}(a,f),y=g+d,v=[],b=(y+2)*h[0],x=(p+d)*h[1],M={width:b<0?Math.floor(b):Math.ceil(b),height:x<0?Math.floor(x):Math.ceil(x),contextInstructions:v};1==h[0]&&1==h[1]||v.push("scale",h),n&&(v.push("strokeStyle",s.strokeStyle),v.push("lineWidth",d),v.push("lineCap",s.lineCap),v.push("lineJoin",s.lineJoin),v.push("miterLimit",s.miterLimit),v.push("setLineDash",[s.lineDash]),v.push("lineDashOffset",s.lineDashOffset)),i&&v.push("fillStyle",o.fillStyle),v.push("textBaseline","middle"),v.push("textAlign","center");const k=.5-c;let S=c*y+k*d;const E=[],C=[];let I,A=0,T=0,R=0,P=0;for(let t=0,e=f.length;t<e;t+=2){const e=f[t];if("\n"===e){T+=A,A=0,S=c*y+k*d,++P;continue}const r=f[t+1]||a.font;r!==I&&(n&&E.push("font",r),i&&C.push("font",r),I=r),A=Math.max(A,_[R]);const s=[e,S+k*m[R]+c*(m[R]-w[P]),.5*(d+A)+T];S+=m[R],n&&E.push("strokeText",s),i&&C.push("fillText",s),++R}return Array.prototype.push.apply(v,E),Array.prototype.push.apply(v,C),this.labels_[r]=M,M}replayTextBackground_(t,e,i,n,r,s,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,e),s&&(this.alignAndScaleFill_=s[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,r,s,o,a,l,h,u,c,d,f,g,p){let m=i-(o*=c[0]),_=n-(a*=c[1]);const w=r+l>t?t-l:r,y=s+h>e?e-h:s,v=f[3]+w*c[0]+f[1],b=f[0]+y*c[1]+f[2],x=m-f[3],M=_-f[0];let k;return(g||0!==u)&&(bb[0]=x,kb[0]=x,bb[1]=M,xb[1]=M,xb[0]=x+v,Mb[0]=xb[0],Mb[1]=M+b,kb[1]=Mb[1]),0!==u?(k=ei([1,0,0,1,0,0],i,n,1,1,u,-i,-n),ti(k,bb),ti(k,xb),ti(k,Mb),ti(k,kb),Ut(Math.min(bb[0],xb[0],Mb[0],kb[0]),Math.min(bb[1],xb[1],Mb[1],kb[1]),Math.max(bb[0],xb[0],Mb[0],kb[0]),Math.max(bb[1],xb[1],Mb[1],kb[1]),vb)):Ut(Math.min(x,x+v),Math.min(M,M+b),Math.max(x,x+v),Math.max(M,M+b),vb),d&&(m=Math.round(m),_=Math.round(_)),{drawImageX:m,drawImageY:_,drawImageW:w,drawImageH:y,originX:l,originY:h,declutterBox:{minX:vb[0],minY:vb[1],maxX:vb[2],maxY:vb[3],value:p},canvasTransform:k,scale:c}}replayImageOrLabel_(t,e,i,n,r,s,o){const a=!(!s&&!o),l=n.declutterBox,h=o?o[2]*n.scale[0]/2:0;return l.minX-h<=e[0]&&l.maxX+h>=0&&l.minY-h<=e[1]&&l.maxY+h>=0&&(a&&this.replayTextBackground_(t,bb,xb,Mb,kb,s,o),function(t,e,i,n,r,s,o,a,l,h,u){t.save(),1!==i&&(void 0===t.globalAlpha?t.globalAlpha=t=>t.globalAlpha*=i:t.globalAlpha*=i),e&&t.transform.apply(t,e),n.contextInstructions?(t.translate(l,h),t.scale(u[0],u[1]),function(t,e){const i=t.contextInstructions;for(let t=0,n=i.length;t<n;t+=2)Array.isArray(i[t+1])?e[i[t]].apply(e,i[t+1]):e[i[t]]=i[t+1]}(n,t)):u[0]<0||u[1]<0?(t.translate(l,h),t.scale(u[0],u[1]),t.drawImage(n,r,s,o,a,0,0,o,a)):t.drawImage(n,r,s,o,a,l,h,o*u[0],a*u[1]),t.restore()}(t,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=ti(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(i[0]%n,i[1]%n),1!==e&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const r=this.textStates[e],s=this.createLabel(t,e,n,i),o=this.strokeStates[i],a=this.pixelRatio,l=Cb(Array.isArray(t)?t[0]:t,r.textAlign||fr),h=pb[r.textBaseline||gr],u=o&&o.lineWidth?o.lineWidth:0;return{label:s,anchorX:l*(s.width/a-2*r.scale[0])+2*(.5-l)*u,anchorY:h*s.height/a+2*(.5-h)*u}}execute_(t,e,i,n,r,s,o,a){const l=this.zIndexContext_;let h;var u,d;this.pixelCoordinates_&&c(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=si(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),d=i,(u=this.renderedTransform_)[0]=d[0],u[1]=d[1],u[2]=d[2],u[3]=d[3],u[4]=d[4],u[5]=d[5]);let f=0;const g=n.length;let p,m,_,w,y,v,b,x,M,k,S,E,C,I=0,A=0,T=0,R=null,P=null;const D=this.coordinateCache_,F=this.viewRotation_,L=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,O={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:F},z=this.instructions!=n||this.overlaps?0:200;let N,B,U,G;for(;f<g;){const i=n[f];switch(i[0]){case hb.BEGIN_GEOMETRY:N=i[1],G=i[3],N.getGeometry()?void 0===o||le(o,G.getExtent())?++f:f=i[2]+1:f=i[2],l&&(l.zIndex=i[4]);break;case hb.BEGIN_PATH:A>z&&(this.fill_(t),A=0),T>z&&(t.stroke(),T=0),A||T||(t.beginPath(),y=NaN,v=NaN),++f;break;case hb.CIRCLE:I=i[1];const n=h[I],u=h[I+1],c=h[I+2]-n,d=h[I+3]-u,g=Math.sqrt(c*c+d*d);t.moveTo(n+g,u),t.arc(n,u,g,0,2*Math.PI,!0),++f;break;case hb.CLOSE_PATH:t.closePath(),++f;break;case hb.CUSTOM:I=i[1],p=i[2];const X=i[3],Y=i[4],V=i[5];O.geometry=X,O.feature=N,f in D||(D[f]=[]);const j=D[f];V?V(h,I,p,2,j):(j[0]=h[I],j[1]=h[I+1],j.length=2),l&&(l.zIndex=i[6]),Y(j,O),++f;break;case hb.DRAW_IMAGE:I=i[1],p=i[2],M=i[3],m=i[4],_=i[5];let q=i[6];const W=i[7],$=i[8],Z=i[9],H=i[10];let K=i[11];const J=i[12];let Q=i[13];w=i[14]||"declutter";const tt=i[15];if(!M&&i.length>=20){k=i[19],S=i[20],E=i[21],C=i[22];const t=this.drawLabelWithPointPlacement_(k,S,E,C);M=t.label,i[3]=M;const e=i[23];m=(t.anchorX-e)*this.pixelRatio,i[4]=m;const n=i[24];_=(t.anchorY-n)*this.pixelRatio,i[5]=_,q=M.height,i[6]=q,Q=M.width,i[13]=Q}let et,it,nt,rt;i.length>25&&(et=i[25]),i.length>17?(it=i[16],nt=i[17],rt=i[18]):(it=pr,nt=!1,rt=!1),H&&L?K+=F:H||L||(K-=F);let st=0;for(;I<p;I+=2){if(et&&et[st++]<Q/this.pixelRatio)continue;const i=this.calculateImageOrLabelDimensions_(M.width,M.height,h[I],h[I+1],Q,q,m,_,$,Z,K,J,r,it,nt||rt,N),n=[t,e,M,i,W,nt?R:null,rt?P:null];if(a){let t,e,r,s,o;if(tt){const i=p-I;if(!tt[i]){tt[i]={args:n,declutterMode:w};continue}const s=tt[i];t=s.args,e=s.declutterMode,delete tt[i],r=Sb(t)}if(!t||"declutter"===e&&a.collides(r)||(s=!0),"declutter"===w&&a.collides(i.declutterBox)||(o=!0),"declutter"===e&&"declutter"===w){const t=s&&o;s=t,o=t}s&&("none"!==e&&a.insert(r),this.replayImageOrLabel_.apply(this,t)),o&&("none"!==w&&a.insert(i.declutterBox),this.replayImageOrLabel_.apply(this,n))}else this.replayImageOrLabel_.apply(this,n)}++f;break;case hb.DRAW_CHARS:const ot=i[1],at=i[2],lt=i[3],ht=i[4];C=i[5];const ut=i[6],ct=i[7],dt=i[8];E=i[9];const ft=i[10];k=i[11],S=i[12];const gt=[i[13],i[13]];w=i[14]||"declutter";const pt=this.textStates[S],mt=pt.font,_t=[pt.scale[0]*ct,pt.scale[1]*ct];let wt;mt in this.widths_?wt=this.widths_[mt]:(wt={},this.widths_[mt]=wt);const yt=yb(h,ot,at,2),vt=Math.abs(_t[0])*kr(mt,k,wt);if(ht||vt<=yt){const i=wb(h,ot,at,2,k,(yt-vt)*Cb(k,this.textStates[S].textAlign),ut,Math.abs(_t[0]),kr,mt,wt,L?0:this.viewRotation_);t:if(i){const n=[];let r,s,o,l,h;if(E)for(r=0,s=i.length;r<s;++r){h=i[r],o=h[4],l=this.createLabel(o,S,"",E),m=h[2]+(_t[0]<0?-ft:ft),_=lt*l.height+2*(.5-lt)*ft*_t[1]/_t[0]-dt;const s=this.calculateImageOrLabelDimensions_(l.width,l.height,h[0],h[1],l.width,l.height,m,_,0,0,h[3],gt,!1,pr,!1,N);if(a&&"declutter"===w&&a.collides(s.declutterBox))break t;n.push([t,e,l,s,1,null,null])}if(C)for(r=0,s=i.length;r<s;++r){h=i[r],o=h[4],l=this.createLabel(o,S,C,""),m=h[2],_=lt*l.height-dt;const s=this.calculateImageOrLabelDimensions_(l.width,l.height,h[0],h[1],l.width,l.height,m,_,0,0,h[3],gt,!1,pr,!1,N);if(a&&"declutter"===w&&a.collides(s.declutterBox))break t;n.push([t,e,l,s,1,null,null])}a&&"none"!==w&&a.load(n.map(Sb));for(let t=0,e=n.length;t<e;++t)this.replayImageOrLabel_.apply(this,n[t])}}++f;break;case hb.END_GEOMETRY:if(void 0!==s){N=i[1];const t=s(N,G);if(t)return t}++f;break;case hb.FILL:z?A++:this.fill_(t),++f;break;case hb.MOVE_TO_LINE_TO:for(I=i[1],p=i[2],B=h[I],U=h[I+1],b=B+.5|0,x=U+.5|0,b===y&&x===v||(t.moveTo(B,U),y=b,v=x),I+=2;I<p;I+=2)B=h[I],U=h[I+1],b=B+.5|0,x=U+.5|0,I!=p-2&&b===y&&x===v||(t.lineTo(B,U),y=b,v=x);++f;break;case hb.SET_FILL_STYLE:R=i,this.alignAndScaleFill_=i[2],A&&(this.fill_(t),A=0,T&&(t.stroke(),T=0)),t.fillStyle=i[1],++f;break;case hb.SET_STROKE_STYLE:P=i,T&&(t.stroke(),T=0),this.setStrokeStyle_(t,i),++f;break;case hb.STROKE:z?T++:t.stroke(),++f;break;default:++f}}A&&this.fill_(t),T&&t.stroke()}execute(t,e,i,n,r,s){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,r,void 0,void 0,s)}executeHitDetection(t,e,i,n,r){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,n,r)}},Tb=["Polygon","Circle","LineString","Image","Text","Default"],Rb=["Image","Text"],Pb=Tb.filter((t=>!Rb.includes(t))),Db={},Fb=class{constructor(t,e,i,n,r,s,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,o)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let n=this.executorsByZIndex_[i];void 0===n&&(n={},this.executorsByZIndex_[i]=n);const r=t[i];for(const t in r){const i=r[t];n[t]=new Ab(this.resolution_,this.pixelRatio_,this.overlaps_,i,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let e=0,n=t.length;e<n;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,r,s){const o=2*(n=Math.round(n))+1,l=ei(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Xn(o,o,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;let c;u.canvas.width!==o||u.canvas.height!==o?(u.canvas.width=o,u.canvas.height=o):h||u.clearRect(0,0,o,o),void 0!==this.renderBuffer_&&(c=[1/0,1/0,-1/0,-1/0],qt(c,t),Dt(c,e*(this.renderBuffer_+n),c));const d=function(t){if(void 0!==Db[t])return Db[t];const e=2*t+1,i=t*t,n=new Array(i+1);for(let r=0;r<=t;++r)for(let s=0;s<=t;++s){const o=r*r+s*s;if(o>i)break;let a=n[o];a||(a=[],n[o]=a),a.push(4*((t+r)*e+(t+s))+3),r>0&&a.push(4*((t-r)*e+(t+s))+3),s>0&&(a.push(4*((t+r)*e+(t-s))+3),r>0&&a.push(4*((t-r)*e+(t-s))+3))}const r=[];for(let t=0,e=n.length;t<e;++t)n[t]&&r.push(...n[t]);return Db[t]=r,r}(n);let f;function g(t,e){const i=u.getImageData(0,0,o,o).data;for(let a=0,l=d.length;a<l;a++)if(i[d[a]]>0){if(!s||"Image"!==f&&"Text"!==f||s.includes(t)){const i=(d[a]-3)/4,s=n-i%o,l=n-(i/o|0),h=r(t,e,s*s+l*l);if(h)return h}u.clearRect(0,0,o,o);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);let m,_,w,y,v;for(p.sort(a),m=p.length-1;m>=0;--m){const t=p[m].toString();for(w=this.executorsByZIndex_[t],_=Tb.length-1;_>=0;--_)if(f=Tb[_],y=w[f],void 0!==y&&(v=y.executeHitDetection(u,l,i,g,c),v))return v}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],r=e[2],s=e[3],o=[i,n,i,s,r,s,r,n];return si(o,0,8,2,t,o),o}isEmpty(){return _(this.executorsByZIndex_)}execute(t,e,i,n,r,s,o){const l=Object.keys(this.executorsByZIndex_).map(Number);let h,u,c,d,f,g;for(l.sort(a),s=s||Tb,o&&l.reverse(),h=0,u=l.length;h<u;++h){const a=l[h].toString();for(f=this.executorsByZIndex_[a],c=0,d=s.length;c<d;++c){const a=s[c];if(g=f[a],void 0!==g){const s=null===o?void 0:g.getZIndexContext(),u=s?s.getContext():t,c=this.maxExtent_&&"Image"!==a&&"Text"!==a;if(c&&(u.save(),this.clip(u,i)),g.execute(u,e,i,n,r,o),c&&u.restore(),s){s.offset();const t=l[h];this.deferredZIndexContexts_[t]||(this.deferredZIndexContexts_[t]=[]),this.deferredZIndexContexts_[t].push(s)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(a);for(let i=0,n=e.length;i<n;++i)t[e[i]].forEach((t=>{t.draw(this.renderedContext_),t.clear()}))}},Lb=class extends ub{constructor(t,e,i,n,r,s,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.transformRotation_=n?nt(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=s,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(t,e,i,n){if(!this.image_)return;const r=si(t,e,i,n,this.transform_,this.pixelCoordinates_),s=this.context_,o=this.tmpLocalTransform_,a=s.globalAlpha;1!=this.imageOpacity_&&(s.globalAlpha=a*this.imageOpacity_);let l=this.imageRotation_;0===this.transformRotation_&&(l-=this.viewRotation_),this.imageRotateWithView_&&(l+=this.viewRotation_);for(let t=0,e=r.length;t<e;t+=2){const e=r[t]-this.imageAnchorX_,i=r[t+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const t=e+this.imageAnchorX_,n=i+this.imageAnchorY_;ei(o,t,n,1,1,l,-t,-n),s.save(),s.transform.apply(s,o),s.translate(t,n),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,e,i,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(s.globalAlpha=a)}drawText_(t,e,i,n){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=si(t,e,i,n,this.transform_,this.pixelCoordinates_),s=this.context_;let o=this.textRotation_;for(0===this.transformRotation_&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=n){const t=r[e]+this.textOffsetX_,i=r[e+1]+this.textOffsetY_;0!==o||1!=this.textScale_[0]||1!=this.textScale_[1]?(s.save(),s.translate(t-this.textOffsetX_,i-this.textOffsetY_),s.rotate(o),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,t,i),this.textFillState_&&s.fillText(this.text_,t,i))}}moveToLineTo_(t,e,i,n,r){const s=this.context_,o=si(t,e,i,n,this.transform_,this.pixelCoordinates_);s.moveTo(o[0],o[1]);let a=o.length;r&&(a-=2);for(let t=2;t<a;t+=2)s.lineTo(o[t],o[t+1]);return r&&s.closePath(),i}drawRings_(t,e,i,n){for(let r=0,s=i.length;r<s;++r)e=this.moveToLineTo_(t,e,i[r],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),le(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=function(t,e,i){const n=t.getFlatCoordinates();if(!n)return null;const r=t.getStride();return si(n,0,n.length,r,e,i)}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],r=Math.sqrt(i*i+n*n),s=this.context_;s.beginPath(),s.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let t=0,i=e.length;t<i;++t)this.drawGeometry(e[t])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),le(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(le(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();let n=0;const r=t.getEnds(),s=t.getStride();e.beginPath();for(let t=0,e=r.length;t<e;++t)n=this.moveToLineTo_(i,n,r[t],s,!1);e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoints();this.drawText_(e,0,e.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),le(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),le(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const r=t.getEndss(),s=t.getStride();e.beginPath();for(let t=0,e=r.length;t<e;++t){const e=r[t];n=this.drawRings_(i,n,e,s)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),c(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:fr;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const e=t.getColor();this.fillState_={fillStyle:Qn(e||lr)}}else this.fillState_=null;if(e){const t=e.getColor(),i=e.getLineCap(),n=e.getLineDash(),r=e.getLineDashOffset(),s=e.getLineJoin(),o=e.getWidth(),a=e.getMiterLimit(),l=n||ur;this.strokeState_={lineCap:void 0!==i?i:hr,lineDash:1===this.pixelRatio_?l:l.map((t=>t*this.pixelRatio_)),lineDashOffset:(r||0)*this.pixelRatio_,lineJoin:void 0!==s?s:cr,lineWidth:(void 0!==o?o:1)*this.pixelRatio_,miterLimit:void 0!==a?a:10,strokeStyle:Qn(t||dr)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const s=t.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/i,s[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const t=e.getColor();this.textFillState_={fillStyle:Qn(t||lr)}}else this.textFillState_=null;const i=t.getStroke();if(i){const t=i.getColor(),e=i.getLineCap(),n=i.getLineDash(),r=i.getLineDashOffset(),s=i.getLineJoin(),o=i.getWidth(),a=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==e?e:hr,lineDash:n||ur,lineDashOffset:r||0,lineJoin:void 0!==s?s:cr,lineWidth:void 0!==o?o:1,miterLimit:void 0!==a?a:10,strokeStyle:Qn(t||dr)}}else this.textStrokeState_=null;const n=t.getFont(),r=t.getOffsetX(),s=t.getOffsetY(),o=t.getRotateWithView(),a=t.getRotation(),l=t.getScaleArray(),h=t.getText(),u=t.getTextAlign(),c=t.getTextBaseline();this.textState_={font:void 0!==n?n:ar,textAlign:void 0!==u?u:fr,textBaseline:void 0!==c?c:gr},this.text_=void 0!==h?Array.isArray(h)?h.reduce(((t,e,i)=>t+(i%2?" ":e)),""):h:"",this.textOffsetX_=void 0!==r?this.pixelRatio_*r:0,this.textOffsetY_=void 0!==s?this.pixelRatio_*s:0,this.textRotateWithView_=void 0!==o&&o,this.textRotation_=void 0!==a?a:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=""}},Ob=.5;const zb=.5,Nb={Point:function(t,e,i,n,r,s){const o=i.getImage(),a=i.getText(),l=a&&a.getText(),h=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=ln)return;const s=t.getBuilder(i.getZIndex(),"Image");s.setImageStyle(o,h),s.drawPoint(e,n,r)}if(l){const s=t.getBuilder(i.getZIndex(),"Text");s.setTextStyle(a,h),s.drawText(e,n,r)}},LineString:function(t,e,i,n,r){const s=i.getStroke();if(s){const o=t.getBuilder(i.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawLineString(e,n,r)}const o=i.getText();if(o&&o.getText()){const s=t.getBuilder(i.getZIndex(),"Text");s.setTextStyle(o),s.drawText(e,n,r)}},Polygon:function(t,e,i,n,r){const s=i.getFill(),o=i.getStroke();if(s||o){const a=t.getBuilder(i.getZIndex(),"Polygon");a.setFillStrokeStyle(s,o),a.drawPolygon(e,n,r)}const a=i.getText();if(a&&a.getText()){const s=t.getBuilder(i.getZIndex(),"Text");s.setTextStyle(a),s.drawText(e,n,r)}},MultiPoint:function(t,e,i,n,r,s){const o=i.getImage(),a=o&&0!==o.getOpacity(),l=i.getText(),h=l&&l.getText(),u=s&&a&&h?{}:void 0;if(a){if(o.getImageState()!=ln)return;const s=t.getBuilder(i.getZIndex(),"Image");s.setImageStyle(o,u),s.drawMultiPoint(e,n,r)}if(h){const s=t.getBuilder(i.getZIndex(),"Text");s.setTextStyle(l,u),s.drawText(e,n,r)}},MultiLineString:function(t,e,i,n,r){const s=i.getStroke();if(s){const o=t.getBuilder(i.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawMultiLineString(e,n,r)}const o=i.getText();if(o&&o.getText()){const s=t.getBuilder(i.getZIndex(),"Text");s.setTextStyle(o),s.drawText(e,n,r)}},MultiPolygon:function(t,e,i,n,r){const s=i.getFill(),o=i.getStroke();if(o||s){const a=t.getBuilder(i.getZIndex(),"Polygon");a.setFillStrokeStyle(s,o),a.drawMultiPolygon(e,n,r)}const a=i.getText();if(a&&a.getText()){const s=t.getBuilder(i.getZIndex(),"Text");s.setTextStyle(a),s.drawText(e,n,r)}},GeometryCollection:function(t,e,i,n,r,s){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a)(0,Nb[o[a].getType()])(t,o[a],i,n,r,s)},Circle:function(t,e,i,n,r){const s=i.getFill(),o=i.getStroke();if(s||o){const a=t.getBuilder(i.getZIndex(),"Circle");a.setFillStrokeStyle(s,o),a.drawCircle(e,n,r)}const a=i.getText();if(a&&a.getText()){const r=t.getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,n)}}};function Bb(t,e){return parseInt(D(t),10)-parseInt(D(e),10)}function Ub(t,e){const i=Gb(t,e);return i*i}function Gb(t,e){return zb*t/e}function Xb(t,e,i,n,r,s,o,a){const l=[],h=i.getImage();if(h){let t=!0;const e=h.getImageState();e==ln||e==hn?t=!1:e==on&&h.load(),t&&l.push(h.ready())}const u=i.getFill();u&&u.loading()&&l.push(u.ready());const c=l.length>0;return c&&Promise.all(l).then((()=>r(null))),function(t,e,i,n,r,s,o){const a=i.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(n,r);i.getRenderer()?Yb(t,l,i,e,o):(0,Nb[l.getType()])(t,l,i,e,o,s)}(t,e,i,n,s,o,a),c}function Yb(t,e,i,n,r){if("GeometryCollection"!=e.getType())t.getBuilder(i.getZIndex(),"Default").drawCustom(e,n,i.getRenderer(),i.getHitDetectionRenderer(),r);else{const s=e.getGeometries();for(let e=0,o=s.length;e<o;++e)Yb(t,s[e],i,n,r)}}const Vb=class extends ua{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,r=e.viewState,s=r.center,o=r.resolution,a=r.projection,l=r.rotation,h=a.getExtent(),u=this.getLayer().getSource(),c=this.getLayer().getDeclutter(),d=e.pixelRatio,f=e.viewHints,g=!(f[0]||f[1]),p=this.context,m=Math.round(ae(n)/o*d),_=Math.round(ne(n)/o*d),w=u.getWrapX()&&a.canWrapX(),y=w?ae(h):null,v=w?Math.ceil((n[2]-h[2])/y)+1:1;let b=w?Math.floor((n[0]-h[0])/y):0;do{const n=this.getRenderTransform(s,o,l,d,m,_,b*y);t.execute(p,[p.canvas.width,p.canvas.height],n,l,g,void 0===i?Tb:i?Rb:Pb,i?c&&e.declutter[c]:void 0)}while(++b<v)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=Xn(this.context.canvas.width,this.context.canvas.height,la))}resetDrawContext_(){if(1!==this.opacity_){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,jn(this.context),la.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){this.replayGroup_&&this.getLayer().getDeclutter()&&this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(t,e){const i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];this.opacity_=n.opacity;const r=t.extent,s=t.viewState.resolution,o=Math.round(ae(r)/s*i),a=Math.round(ne(r)/s*i);ei(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/i,1/i,0,-o/2,-a/2),ii(this.inversePixelTransform,this.pixelTransform);const l=ri(this.pixelTransform);this.useContainer(e,l,this.getBackground(t));const h=this.context,u=h.canvas,c=this.replayGroup_;let d=c&&!c.isEmpty();if(!d&&!this.getLayer().hasListener(lt)&&!this.getLayer().hasListener(ht))return null;u.width!=o||u.height!=a?(u.width=o,u.height=a,u.style.transform!==l&&(u.style.transform=l)):this.containerReused||h.clearRect(0,0,o,a),this.setDrawContext_(),this.preRender(h,t);const f=t.viewState,g=f.projection;let p=!1;if(d&&n.extent&&this.clipping){const e=Ne(n.extent,g);d=le(e,t.extent),p=d&&!zt(e,t.extent),p&&this.clipUnrotated(h,t,e)}return d&&this.renderWorlds(c,t,!this.getLayer().getDeclutter()&&void 0),p&&h.restore(),this.postRender(h,t),this.renderedRotation_!==f.rotation&&(this.renderedRotation_=f.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise((e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const t=[this.context.canvas.width,this.context.canvas.height];ti(this.pixelTransform,t);const e=this.renderedCenter_,i=this.renderedResolution_,n=this.renderedRotation_,r=this.renderedProjection_,s=this.wrappedRenderedExtent_,o=this.getLayer(),l=[],h=t[0]*Ob,u=t[1]*Ob;l.push(this.getRenderTransform(e,i,n,Ob,h,u,0).slice());const c=o.getSource(),d=r.getExtent();if(c.getWrapX()&&r.canWrapX()&&!zt(d,s)){let t=s[0];const r=ae(d);let o,a=0;for(;t<d[0];)--a,o=r*a,l.push(this.getRenderTransform(e,i,n,Ob,h,u,o).slice()),t+=r;for(a=0,t=s[2];t>d[2];)++a,o=r*a,l.push(this.getRenderTransform(e,i,n,Ob,h,u,o).slice()),t-=r}const f=Fe();this.hitDetectionImageData_=function(t,e,i,n,r,s,o,l,h){const u=h?ze(r,h):r,c=Xn(t[0]*Ob,t[1]*Ob);c.imageSmoothingEnabled=!1;const d=c.canvas,f=new Lb(c,Ob,r,null,o,l,h?Ae(Fe(),h):null),g=i.length,p=Math.floor(16777215/g),m={};for(let t=1;t<=g;++t){const e=i[t-1],r=e.getStyleFunction()||n;if(!r)continue;let o=r(e,s);if(!o)continue;Array.isArray(o)||(o=[o]);const a=(t*p).toString(16).padStart(7,"#00000");for(let t=0,i=o.length;t<i;++t){const i=o[t],n=i.getGeometryFunction()(e);if(!n||!le(u,n.getExtent()))continue;const r=i.clone(),s=r.getFill();s&&s.setColor(a);const l=r.getStroke();l&&(l.setColor(a),l.setLineDash(null)),r.setText(void 0);const h=i.getImage();if(h){const t=h.getImageSize();if(!t)continue;const e=Xn(t[0],t[1],void 0,{alpha:!1}),i=e.canvas;e.fillStyle=a,e.fillRect(0,0,i.width,i.height),r.setImage(new Ur({img:i,anchor:h.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:h.getOrigin(),opacity:1,size:h.getSize(),scale:h.getScale(),rotation:h.getRotation(),rotateWithView:h.getRotateWithView()}))}const c=r.getZIndex()||0;let d=m[c];d||(d={},m[c]=d,d.Polygon=[],d.Circle=[],d.LineString=[],d.Point=[]);const f=n.getType();if("GeometryCollection"===f){const t=n.getGeometriesArrayRecursive();for(let e=0,i=t.length;e<i;++e){const i=t[e];d[i.getType().replace("Multi","")].push(i,r)}}else d[f.replace("Multi","")].push(n,r)}}const _=Object.keys(m).map(Number).sort(a);for(let t=0,i=_.length;t<i;++t){const i=m[_[t]];for(const t in i){const n=i[t];for(let t=0,i=n.length;t<i;t+=2){f.setStyle(n[t+1]);for(let i=0,r=e.length;i<r;++i)f.setTransform(e[i]),f.drawGeometry(n[t])}}}return c.getImageData(0,0,d.width,d.height)}(t,l,this.renderedFeatures_,o.getStyleFunction(),s,i,n,Ub(i,this.renderedPixelRatio_),f?r:null)}e(function(t,e,i){const n=[];if(i){const r=Math.floor(Math.round(t[0])*Ob),s=Math.floor(Math.round(t[1])*Ob),o=4*(K(r,0,i.width-1)+K(s,0,i.height-1)*i.width),a=i.data[o],l=i.data[o+1],h=i.data[o+2]+256*(l+256*a),u=Math.floor(16777215/e.length);h&&h%u==0&&n.push(e[h/u-1])}return n}(t,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(t,e,i,n,r){if(!this.replayGroup_)return;const s=e.viewState.resolution,o=e.viewState.rotation,a=this.getLayer(),l={},h=function(t,e,i){const s=D(t),o=l[s];if(o){if(!0!==o&&i<o.distanceSq){if(0===i)return l[s]=!0,r.splice(r.lastIndexOf(o),1),n(t,a,e);o.geometry=e,o.distanceSq=i}}else{if(0===i)return l[s]=!0,n(t,a,e);r.push(l[s]={feature:t,layer:a,geometry:e,distanceSq:i,callback:n})}};let u;const c=[this.replayGroup_],d=this.getLayer().getDeclutter();return c.some((n=>u=n.forEachFeatureAtCoordinate(t,s,o,i,h,d&&e.declutter[d]?e.declutter[d].all().map((t=>t.value)):null))),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[0],r=t.viewHints[1],s=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!s&&n||!o&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,l=t.viewState,h=l.projection,u=l.resolution,d=t.pixelRatio,f=e.getRevision(),g=e.getRenderBuffer();let p=e.getRenderOrder();void 0===p&&(p=Bb);const m=l.center.slice(),_=Dt(a,g*u),w=_.slice(),y=[_.slice()],v=h.getExtent();if(i.getWrapX()&&h.canWrapX()&&!zt(v,t.extent)){const t=ae(v),e=Math.max(ae(_)/2,t);_[0]=v[0]-e,_[2]=v[2]+e,ge(m,h);const i=ce(y[0],h);i[0]<v[0]&&i[2]<v[2]?y.push([i[0]+t,i[1],i[2]+t,i[3]]):i[0]>v[0]&&i[2]>v[2]&&y.push([i[0]-t,i[1],i[2]-t,i[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==p&&zt(this.wrappedRenderedExtent_,_))return c(this.renderedExtent_,w)||(this.hitDetectionImageData_=null,this.renderedExtent_=w),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const b=new _b(Gb(u,d),_,u,d),x=Fe();let M;if(x){for(let t=0,e=y.length;t<e;++t){const e=ze(y[t],h);i.loadFeatures(e,Be(u,h),x)}M=Ae(x,h)}else for(let t=0,e=y.length;t<e;++t)i.loadFeatures(y[t],u,h);const k=Ub(u,d);let S=!0;const E=(t,i)=>{let n;const r=t.getStyleFunction()||e.getStyleFunction();if(r&&(n=r(t,u)),n){const e=this.renderFeature(t,k,n,b,M,this.getLayer().getDeclutter(),i);S=S&&!e}},C=ze(_,h),I=i.getFeaturesInExtent(C);p&&I.sort(p);for(let t=0,e=I.length;t<e;++t)E(I[t],t);this.renderedFeatures_=I,this.ready=S;const A=b.finish(),T=new Fb(_,u,d,i.getOverlaps(),A,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=p,this.renderedExtent_=w,this.wrappedRenderedExtent_=_,this.renderedCenter_=m,this.renderedProjection_=h,this.renderedPixelRatio_=d,this.replayGroup_=T,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,r,s,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=Xb(n,t,i[l],e,this.boundHandleStyleImageChange_,r,s,o)||a;else a=Xb(n,t,i,e,this.boundHandleStyleImageChange_,r,s,o);return a}},jb=class extends Ys{constructor(t){super(t)}createRenderer(){return new Vb(this)}},qb=class{constructor(t){this.rbush_=new sn(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[D(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,r=e.length;n<r;n++){const r=t[n],s=e[n],o={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:s};i[n]=o,this.items_[D(s)]=o}this.rbush_.load(i)}remove(t){const e=D(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(t,e){const i=this.items_[D(e)];Vt([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map((function(t){return t.value}))}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map((function(t){return t.value}))}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,r=t.length;n<r;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return _(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Ut(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}};function Wb(t,e,i,n,r,s,o){let l,h;const u=(i-e)/n;if(1===u)l=e;else if(2===u)l=e,h=r;else if(0!==u){let s=t[e],o=t[e+1],u=0;const c=[0];for(let r=e+n;r<i;r+=n){const e=t[r],i=t[r+1];u+=Math.sqrt((e-s)*(e-s)+(i-o)*(i-o)),c.push(u),s=e,o=i}const d=r*u,f=function(t,e,i){let n,r;i=i||a;let s=0,o=t.length,l=!1;for(;s<o;)n=s+(o-s>>1),r=+i(t[n],e),r<0?s=n+1:(o=n,l=!r);return l?s:~s}(c,d);f<0?(h=(d-c[-f-2])/(c[-f-1]-c[-f-2]),l=e+(-f-2)*n):l=e+f*n}o=o>1?o:2,s=s||new Array(o);for(let e=0;e<o;++e)s[e]=void 0===l?NaN:void 0===h?t[l+e]:it(t[l+e],t[l+n+e],h);return s}function $b(t,e,i,n,r,s){if(i==e)return null;let o;if(r<t[e+n-1])return s?(o=t.slice(e,e+n),o[n-1]=r,o):null;if(t[i-1]<r)return s?(o=t.slice(i-n,i),o[n-1]=r,o):null;if(r==t[e+n-1])return t.slice(e,e+n);let a=e/n,l=i/n;for(;a<l;){const e=a+l>>1;r<t[(e+1)*n-1]?l=e:a=e+1}const h=t[a*n-1];if(r==h)return t.slice((a-1)*n,(a-1)*n+n);const u=(r-h)/(t[(a+1)*n-1]-h);o=[];for(let e=0;e<n-1;++e)o.push(it(t[(a-1)*n+e],t[a*n+e],u));return o.push(r),o}function Zb(t,e,i,n){const r=[];let s=[1/0,1/0,-1/0,-1/0];for(let o=0,a=i.length;o<a;++o){const a=i[o];s=Yt(t,e,a[0],n),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=a[a.length-1]}return r}const Hb=[1,0,0,1,0,0];class Kb{constructor(t,e,i,n,r,s){this.styleFunction,this.extent_,this.id_=s,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_="Point"===this.type_?Xt(this.flatCoordinates_):Yt(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Qt(this.getExtent());this.flatInteriorPoints_=zi(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=function(t,e){const i=[];let n,r=0,s=0;for(let o=0,a=e.length;o<a;++o){const a=e[o],l=Vi(t,r,a,2);if(void 0===n&&(n=l),l===n)i.push(e.slice(s,o+1));else{if(0===i.length)continue;i[i.length-1].push(e[s])}s=o+1,r=a}return i}(this.flatCoordinates_,this.ends_),e=Zb(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Ni(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Wb(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let n=0,r=i.length;n<r;++n){const r=i[n],s=Wb(t,e,r,2,.5);u(this.flatMidpoints_,s),e=r}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){const e=(t=ke(t)).getExtent(),i=t.getWorldExtent();if(e&&i){const t=ne(i)/ne(e);ei(Hb,i[0],i[3],t,-t,0,0,0),si(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Hb,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new Kb(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=p(((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":i.length=vi(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),n=[i.length];break;case"MultiLineString":n=[],i.length=bi(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,n);break;case"Polygon":n=[],i.length=ki(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,n)}return n&&(this.simplifiedGeometry_=new Kb(this.type_,i,n,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_})),this}}Kb.prototype.getFlatCoordinates=Kb.prototype.getOrientedFlatCoordinates;const Jb=Kb,Qb="addfeature",tx="removefeature";function ex(t,e){return[[-1/0,-1/0,1/0,1/0]]}let ix=!1;function nx(t,e){return function(i,n,r,s,o){const a=this;!function(t,e,i,n,r,s,o){const a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(i,n,r):t,!0),"arraybuffer"==e.getType()&&(a.responseType="arraybuffer"),a.withCredentials=ix,a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){const t=e.getType();let n;"json"==t?n=JSON.parse(a.responseText):"text"==t?n=a.responseText:"xml"==t?(n=a.responseXML,n||(n=(new DOMParser).parseFromString(a.responseText,"application/xml"))):"arraybuffer"==t&&(n=a.response),n?s(e.readFeatures(n,{extent:i,featureProjection:r}),e.readProjection(n)):o()}else o()},a.onerror=o,a.send()}(t,e,i,n,r,(function(t,e){a.addFeatures(t),void 0!==s&&s(t)}),o||g)}}class rx extends r{constructor(t,e,i){super(t),this.feature=e,this.features=i}}const sx=class extends Cv{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===t.wrapX||t.wrapX}),this.on,this.once,this.un,this.loader_=g,this.format_=t.format,this.overlaps_=void 0===t.overlaps||t.overlaps,this.url_=t.url,void 0!==t.loader?this.loader_=t.loader:void 0!==this.url_&&(H(this.format_,"`format` must be set when `url` is set"),this.loader_=nx(this.url_,this.format_)),this.strategy_=void 0!==t.strategy?t.strategy:ex;const e=void 0===t.useSpatialIndex||t.useSpatialIndex;let i,n;this.featuresRtree_=e?new qb:null,this.loadedExtentsRtree_=new qb,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),e||void 0!==i||(i=new U(n)),void 0!==n&&this.addFeaturesInternal(n),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=D(t);if(!this.addToIndex_(e,t))return void(this.featuresCollection_&&this.featuresCollection_.remove(t));this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const e=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(e,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new rx(Qb,t))}setupChangeEvents_(t,e){e instanceof Jb||(this.featureChangeKeys_[t]=[E(e,y,this.handleFeatureChange_,this),E(e,s,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(void 0!==e.getId()){const t=String(e.getId());if(t in this.idIndex_)if(e instanceof Jb){const n=this.idIndex_[t];n instanceof Jb?Array.isArray(n)?n.push(e):this.idIndex_[t]=[n,e]:i=!1}else i=!1;else this.idIndex_[t]=e}return i&&(H(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let e=0,n=t.length;e<n;e++){const n=t[e],r=D(n);this.addToIndex_(r,n)&&i.push(n)}for(let t=0,r=i.length;t<r;t++){const r=i[t],s=D(r);this.setupChangeEvents_(s,r);const o=r.getGeometry();if(o){const t=o.getExtent();e.push(t),n.push(r)}else this.nullGeometryFeatures_[s]=r}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(Qb))for(let t=0,e=i.length;t<e;t++)this.dispatchEvent(new rx(Qb,i[t]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Qb,(function(i){e||(e=!0,t.push(i.feature),e=!1)})),this.addEventListener(tx,(function(i){e||(e=!0,t.remove(i.feature),e=!1)})),t.addEventListener(O,(t=>{e||(e=!0,this.addFeature(t.element),e=!1)})),t.addEventListener(z,(t=>{e||(e=!0,this.removeFeature(t.element),e=!1)})),this.featuresCollection_=t}clear(t){if(t){for(const t in this.featureChangeKeys_)this.featureChangeKeys_[t].forEach(I);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const t=t=>{this.removeFeatureInternal(t)};this.featuresRtree_.forEach(t);for(const t in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[t])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new rx("clear");this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,(function(i){const n=i.getGeometry();if(n instanceof Jb||n.intersectsCoordinate(t))return e(i)}))}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,(function(i){const n=i.getGeometry();if(n instanceof Jb||n.intersectsExtent(t)){const t=e(i);if(t)return t}}))}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),_(this.nullGeometryFeatures_)||u(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,(function(t){e.push(t)})),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const i=function(t,e){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(t[0])||!isFinite(t[2]))return[[i[0],t[1],i[2],t[3]]];ce(t,e);const n=ae(i);if(ae(t)>n)return[[i[0],t[1],i[2],t[3]]];if(t[0]<i[0])return[[t[0]+n,t[1],i[2],t[3]],[i[0],t[1],t[2],t[3]]];if(t[2]>i[2])return[[t[0],t[1],i[2],t[3]],[i[0],t[1],t[2]-n,t[3]]]}return[t]}(t,e);return[].concat(...i.map((t=>this.featuresRtree_.getInExtent(t))))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let r=null;const s=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return e=e||d,this.featuresRtree_.forEachInExtent(a,(function(t){if(e(t)){const e=t.getGeometry(),l=o;if(o=e instanceof Jb?0:e.closestPointXY(i,n,s,o),o<l){r=t;const e=Math.sqrt(o);a[0]=i-e,a[1]=n-e,a[2]=i+e,a[3]=n+e}}})),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return void 0!==e?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=D(e),n=e.getGeometry();if(n){const t=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(t,e)):this.featuresRtree_&&this.featuresRtree_.update(t,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const r=e.getId();if(void 0!==r){const t=r.toString();this.idIndex_[t]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[t]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new rx("changefeature",e))}hasFeature(t){const e=t.getId();return void 0!==e?e in this.idIndex_:D(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&_(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,r=this.strategy_(t,e,i);for(let t=0,s=r.length;t<s;++t){const s=r[t];n.forEachInExtent(s,(function(t){return zt(t.extent,s)}))||(++this.loadingExtentsCount_,this.dispatchEvent(new rx("featuresloadstart")),this.loader_.call(this,s,e,i,(t=>{--this.loadingExtentsCount_,this.dispatchEvent(new rx("featuresloadend",void 0,t))}),(()=>{--this.loadingExtentsCount_,this.dispatchEvent(new rx("featuresloaderror"))})),n.insert(s,{extent:s.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,(function(e){if(Vt(e.extent,t))return i=e,!0})),i&&e.remove(i)}removeFeatures(t){const e=[];for(let i=0,n=t.length;i<n;++i){const n=t[i],r=this.removeFeatureInternal(n);r&&e.push(r)}e.length>0&&this.changed()}removeFeature(t){t&&this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=D(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const i=this.featureChangeKeys_[e];if(!i)return;i.forEach(I),delete this.featureChangeKeys_[e];const n=t.getId();return void 0!==n&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.hasListener(tx)&&this.dispatchEvent(new rx(tx,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_){const n=this.idIndex_[i];if(t instanceof Jb&&Array.isArray(n)&&n.includes(t))n.splice(n.indexOf(t),1);else if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){H(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(nx(t,this.format_))}};class ox extends ci{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}appendCoordinate(t){u(this.flatCoordinates,t),this.changed()}clone(){const t=new ox(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<Lt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),pi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))}forEachSegment(t){return Bi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:(e=void 0!==e&&e,$b(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Si(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Wb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return yb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=vi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ox(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Ui(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_i(this.flatCoordinates,0,t,this.stride),this.changed()}}const ax=ox;class lx extends ci{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){u(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new lx(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<Lt(this.getExtent(),t,e))return n;const r=this.flatCoordinates,s=this.stride;for(let o=0,a=r.length;o<a;o+=s){const a=Q(t,e,r[o],r[o+1]);if(a<n){n=a;for(let t=0;t<s;++t)i[t]=r[o+t];i.length=s}}return n}getCoordinates(){return Si(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Di(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,n=[];for(let r=0,s=t.length;r<s;r+=i){const s=new Di(t.slice(r,r+i),e);n.push(s)}return n}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let n=0,r=e.length;n<r;n+=i)if(Nt(t,e[n],e[n+1]))return!0;return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_i(this.flatCoordinates,0,t,this.stride),this.changed()}}const hx=lx;class ux extends ci{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const e=t,i=[],n=[];for(let t=0,r=e.length;t<r;++t)u(i,e[t].getFlatCoordinates()),n.push(i.length);const r=0===e.length?this.getLayout():e[0].getLayout();this.setFlatCoordinates(r,i),this.ends_=n}}appendLineString(t){u(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ux(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<Lt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gi(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))}getCoordinateAtM(t,e,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(e=void 0!==e&&e,i=void 0!==i&&i,function(t,e,i,n,r,s,o){if(o)return $b(t,e,i[i.length-1],n,r,s);let a;if(r<t[n-1])return s?(a=t.slice(0,n),a[n-1]=r,a):null;if(t[t.length-1]<r)return s?(a=t.slice(t.length-n),a[n-1]=r,a):null;for(let s=0,o=i.length;s<o;++s){const o=i[s];if(e!=o){if(r<t[e+n-1])return null;if(r<=t[o-1])return $b(t,e,o,n,r,!1);e=o}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return Ei(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new ax(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[];let r=0;for(let s=0,o=e.length;s<o;++s){const o=e[s],a=new ax(t.slice(r,o),i);n.push(a),r=o}return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const n=this.ends_,r=this.stride;for(let s=0,o=n.length;s<o;++s){const o=n[s];u(t,Wb(e,i,o,r,.5)),i=o}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=bi(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new ux(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return function(t,e,i,n,r){for(let s=0,o=i.length;s<o;++s){if(Ui(t,e,i[s],n,r))return!0;e=i[s]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=wi(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const cx=ux;class dx extends ci{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const n=t,r=[],s=[];for(let t=0,e=n.length;t<e;++t){const e=n[t],i=r.length,o=e.getEnds();for(let t=0,e=o.length;t<e;++t)o[t]+=i;u(r,e.getFlatCoordinates()),s.push(o)}e=0===n.length?this.getLayout():n[0].getLayout(),t=r,i=s}void 0!==e&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(this.flatCoordinates){const i=this.flatCoordinates.length;u(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let t=0,n=e.length;t<n;++t)e[t]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();const i=new dx(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,n){return n<Lt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,i,n,r){for(let s=0,o=i.length;s<o;++s){const o=i[s];r=gi(t,e,o,n,r),e=o[o.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,i,n,r,s,o,a,l,h,u){u=u||[NaN,NaN];for(let s=0,c=i.length;s<c;++s){const c=i[s];h=mi(t,e,c,n,r,true,o,a,l,h,u),e=c[c.length-1]}return h}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,i,n))}containsXY(t,e){return function(t,e,i,n,r,s){if(0===i.length)return!1;for(let o=0,a=i.length;o<a;++o){const a=i[o];if(Oi(t,e,a,n,r,s))return!0;e=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return function(t,e,i,n){let r=0;for(let s=0,o=i.length;s<o;++s){const o=i[s];r+=Ai(t,e,o,n),e=o[o.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),$i(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Ci(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Zb(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Ni(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new hx(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;qi(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=$i(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function(t,e,i,n,r,s,o,a){for(let l=0,h=i.length;l<h;++l){const h=i[l],u=[];o=ki(t,e,h,n,r,s,o,u),a.push(u),e=h[h.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new dx(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(0===t)e=0;else{const i=this.endss_[t-1];e=i[i.length-1]}const i=this.endss_[t].slice(),n=i[i.length-1];if(0!==e)for(let t=0,n=i.length;t<n;++t)i[t]-=e;return new Hi(this.flatCoordinates.slice(e,n),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[];let r=0;for(let s=0,o=i.length;s<o;++s){const o=i[s].slice(),a=o[o.length-1];if(0!==r)for(let t=0,e=o.length;t<e;++t)o[t]-=r;const l=new Hi(e.slice(r,a),t,o);n.push(l),r=a}return n}getType(){return"MultiPolygon"}intersectsExtent(t){return function(t,e,i,n,r){for(let s=0,o=i.length;s<o;++s){const o=i[s];if(Xi(t,e,o,n,r))return!0;e=o[o.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=yi(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const t=i[i.length-1];this.flatCoordinates.length=0===t.length?0:t[t.length-1]}this.changed()}}const fx=dx;class gx extends li{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(I),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(E(t[e],y,this.changed,this))}clone(){const t=new gx(px(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<Lt(this.getExtent(),t,e))return n;const r=this.geometries_;for(let s=0,o=r.length;s<o;++s)n=r[s].closestPointXY(t,e,i,n);return n}containsXY(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)if(i[n].containsXY(t,e))return!0;return!1}computeExtent(t){Gt(t);const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)jt(t,e[i].getExtent());return t}getGeometries(){return px(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let n=!1;for(let r=0,s=i.length;r<s;++r){const s=i[r],o=s.getSimplifiedGeometry(t);e.push(o),o!==s&&(n=!0)}return n?new gx(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].rotate(t,e);this.changed()}scale(t,e,i){i||(i=Qt(this.getExtent()));const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)n[r].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(px(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function px(t){return t.map((t=>t.clone()))}const mx=gx,_x=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=nb,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?ke(e.dataProjection):this.readProjection(t);e.extent&&i&&"tile-pixels"===i.getUnits()&&(i=ke(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return R()}readFeature(t,e){return R()}readFeatures(t,e){return R()}readGeometry(t,e){return R()}readProjection(t){return R()}writeFeature(t,e){return R()}writeFeatures(t,e){return R()}writeGeometry(t,e){return R()}};function wx(t,e,i){const n=i?ke(i.featureProjection):null,r=i?ke(i.dataProjection):null;let s=t;if(n&&r&&!Ie(n,r)){e&&(s=t.clone());const i=e?n:r,o=e?r:n;"tile-pixels"===i.getUnits()?s.transform(i,o):s.applyTransform(Te(i,o))}if(e&&i&&void 0!==i.decimals){const e=Math.pow(10,i.decimals),n=function(t){for(let i=0,n=t.length;i<n;++i)t[i]=Math.round(t[i]*e)/e;return t};s===t&&(s=t.clone()),s.applyTransform(n)}return s}const yx={Point:Di,LineString:ax,Polygon:Hi,MultiPoint:hx,MultiLineString:cx,MultiPolygon:fx};function vx(t,e){const i=t.geometry;if(!i)return[];if(Array.isArray(i))return i.map((e=>vx({...t,geometry:e}))).flat();const n="MultiPolygon"===i.type?"Polygon":i.type;if("GeometryCollection"===n||"Circle"===n)throw new Error("Unsupported geometry type: "+n);const r=i.layout.length;return wx(new Jb(n,"Polygon"===n?function(t,e,i){return Array.isArray(e[0])?(qi(t,0,e,i)||$i(t=t.slice(),0,e,i),t):(ji(t,0,e,i)||Wi(t=t.slice(),0,e,i),t)}(i.flatCoordinates,i.ends,r):i.flatCoordinates,i.ends?.flat(),r,t.properties||{},t.id).enableSimplifyTransformed(),!1,e)}function bx(t,e){if(!t)return null;if(Array.isArray(t)){const i=t.map((t=>bx(t,e)));return new mx(i)}return wx(new(0,yx[t.type])(t.flatCoordinates,t.layout,t.ends),!1,e)}function xx(t){if("string"==typeof t){return JSON.parse(t)||null}return null!==t?t:null}const Mx=class extends _x{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(xx(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(xx(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return R()}readFeaturesFromObject(t,e){return R()}readGeometry(t,e){return this.readGeometryFromObject(xx(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return R()}readProjection(t){return this.readProjectionFromObject(xx(t))}readProjectionFromObject(t){return R()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return R()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return R()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return R()}};function kx(t,e){if(!t)return null;let i;switch(t.type){case"Point":i=function(t){const e=t.coordinates;return{type:"Point",flatCoordinates:e,layout:hi(e.length)}}(t);break;case"LineString":i=function(t){const e=t.coordinates,i=e.flat();return{type:"LineString",flatCoordinates:i,ends:[i.length],layout:hi(e[0]?.length||2)}}(t);break;case"Polygon":i=function(t){const e=t.coordinates,i=[],n=e[0]?.[0]?.length;return{type:"Polygon",flatCoordinates:i,ends:wi(i,0,e,n),layout:hi(n)}}(t);break;case"MultiPoint":i=function(t){const e=t.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:hi(e[0]?.length||2)}}(t);break;case"MultiLineString":i=function(t){const e=t.coordinates,i=e[0]?.[0]?.length||2,n=[];return{type:"MultiLineString",flatCoordinates:n,ends:wi(n,0,e,i),layout:hi(i)}}(t);break;case"MultiPolygon":i=function(t){const e=t.coordinates,i=[],n=e[0]?.[0]?.[0].length||2;return{type:"MultiPolygon",flatCoordinates:i,ends:yi(i,0,e,n),layout:hi(n)}}(t);break;case"GeometryCollection":i=function(t,e){const i=t.geometries.map((function(t){return kx(t)}));return i}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return i}function Sx(t,e){const i=(t=wx(t,!0,e)).getType();let n;switch(i){case"Point":n=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case"LineString":n=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case"Polygon":n=function(t,e){let i;return e&&(i=e.rightHanded),{type:"Polygon",coordinates:t.getCoordinates(i)}}(t,e);break;case"MultiPoint":n=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case"MultiLineString":n=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case"MultiPolygon":n=function(t,e){let i;return e&&(i=e.rightHanded),{type:"MultiPolygon",coordinates:t.getCoordinates(i)}}(t,e);break;case"GeometryCollection":n=function(t,e){delete(e=Object.assign({},e)).featureProjection;return{type:"GeometryCollection",geometries:t.getGeometriesArray().map((function(t){return Sx(t,e)}))}}(t,e);break;case"Circle":n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+i)}return n}const Ex=class extends Mx{constructor(t){t=t||{},super(),this.dataProjection=ke(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=ke(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;i="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null};const n=kx(i.geometry);if(this.featureClass===Jb)return vx({geometry:n,id:i.id,properties:i.properties},e);const r=new nb;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&r.setGeometryName(i.geometry_name),r.setGeometry(bx(n,e)),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(t,e){let i=null;if("FeatureCollection"===t.type){i=[];const n=t.features;for(let t=0,r=n.length;t<r;++t){const r=this.readFeatureFromObject(n[t],e);r&&i.push(r)}}else i=[this.readFeatureFromObject(t,e)];return i.flat()}readGeometryFromObject(t,e){return function(t,e){return bx(kx(t),e)}(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if("name"==e.type)i=ke(e.properties.name);else{if("EPSG"!==e.type)throw new Error("Unknown SRS type");i=ke("EPSG:"+e.properties.code)}else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},n=t.getId();if(void 0!==n&&(i.id=n),!t.hasProperties())return i;const r=t.getProperties(),s=t.getGeometry();return s&&(i.geometry=Sx(s,e),delete r[t.getGeometryName()]),_(r)||(i.properties=r),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let n=0,r=t.length;n<r;++n)i.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return Sx(t,this.adaptOptions(e))}};let Cx=0;function Ix(t){const e=new sx({features:new Ex({dataProjection:"EPSG:3857"}).readFeatures(t)});let i=new jb;if("lines"===t.name){let t=[];e.forEachFeature((e=>{let i=e.getGeometry().simplify(3),n=new nb({geometry:i});t.push(n)}));let n=new sx({features:t});i.setSource(n),Cx=t.length}else Cx=t.features.length,i.setSource(e);return"junctions"===t.name&&i.setStyle(new zr({image:new Ur({src:"https://maps.google.com/mapfiles/kml/paddle/red-blank.png",anchor:[.5,1],scale:.5})})),i}function Ax(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}__webpack_require__(3614),Error,Error;var Tx,Rx={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Px(t){return(t=Math.round(t))<0?0:t>255?255:t}function Dx(t){return t<0?0:t>1?1:t}function Fx(t){return"%"===t[t.length-1]?Px(parseFloat(t)/100*255):Px(parseInt(t))}function Lx(t){return"%"===t[t.length-1]?Dx(parseFloat(t)/100):Dx(parseFloat(t))}function Ox(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Tx={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Rx)return Rx[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),r=i.indexOf(")");if(-1!==n&&r+1===i.length){var s=i.substr(0,n),o=i.substr(n+1,r-(n+1)).split(","),a=1;switch(s){case"rgba":if(4!==o.length)return null;a=Lx(o.pop());case"rgb":return 3!==o.length?null:[Fx(o[0]),Fx(o[1]),Fx(o[2]),a];case"hsla":if(4!==o.length)return null;a=Lx(o.pop());case"hsl":if(3!==o.length)return null;var l=(parseFloat(o[0])%360+360)%360/360,h=Lx(o[1]),u=Lx(o[2]),c=u<=.5?u*(h+1):u+h-u*h,d=2*u-c;return[Px(255*Ox(d,c,l+1/3)),Px(255*Ox(d,c,l)),Px(255*Ox(d,c,l-1/3)),a];default:return null}}return null}}catch(t){}class zx{constructor(t,e,i,n=1){this.r=t,this.g=e,this.b=i,this.a=n}static parse(t){if(!t)return;if(t instanceof zx)return t;if("string"!=typeof t)return;const e=Tx(t);return e?new zx(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,i,n]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${n})`}toArray(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*i/n,n]}toArray01(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[t/n,e/n,i/n,n]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:i,a:n}=this;return[t,e,i,n]}}zx.black=new zx(0,0,0,1),zx.white=new zx(1,1,1,1),zx.transparent=new zx(0,0,0,0),zx.red=new zx(1,0,0,1),zx.blue=new zx(0,0,1,1);var Nx=zx;class Bx extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}var Ux=Bx;class Gx{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new Gx(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Xx=Gx;const Yx={kind:"null"},Vx={kind:"number"},jx={kind:"string"},qx={kind:"boolean"},Wx={kind:"color"},$x={kind:"object"},Zx={kind:"value"},Hx={kind:"collator"},Kx={kind:"formatted"},Jx={kind:"resolvedImage"};function Qx(t,e){return{kind:"array",itemType:t,N:e}}function tM(t){if("array"===t.kind){const e=tM(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const eM=[Yx,Vx,jx,qx,Wx,Kx,$x,Qx(Zx),Jx];function iM(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!iM(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of eM)if(!iM(t,e))return null}return`Expected ${tM(t)} but found ${tM(e)} instead.`}function nM(t,e){return e.some((e=>e.kind===t.kind))}function rM(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}class sM{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class oM{constructor(t,e,i,n,r){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r}}class aM{constructor(t){this.sections=t}static fromString(t){return new aM([new oM(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof aM?t:aM.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class lM{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new lM({name:t,available:!1}):null}serialize(){return["image",this.name]}}function hM(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function uM(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Nx)return!0;if(t instanceof sM)return!0;if(t instanceof aM)return!0;if(t instanceof lM)return!0;if(Array.isArray(t)){for(const e of t)if(!uM(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!uM(t[e]))return!1;return!0}return!1}function cM(t){if(null===t)return Yx;if("string"==typeof t)return jx;if("boolean"==typeof t)return qx;if("number"==typeof t)return Vx;if(t instanceof Nx)return Wx;if(t instanceof sM)return Hx;if(t instanceof aM)return Kx;if(t instanceof lM)return Jx;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=cM(e);if(i){if(i===t)continue;i=Zx;break}i=t}return Qx(i||Zx,e)}return $x}function dM(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Nx||t instanceof aM||t instanceof lM?t.toString():JSON.stringify(t)}class fM{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!uM(t[1]))return e.error("invalid value");const i=t[1];let n=cM(i);const r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new fM(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Nx?["rgba"].concat(this.value.toArray()):this.value instanceof aM?this.value.serialize():this.value}}var gM=fM,pM=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const mM={string:jx,number:Vx,boolean:qx,object:$x};class _M{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const r=t[0];if("array"===r){let r,s;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in mM)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=mM[i],n++}else r=Zx;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);s=t[2],n++}i=Qx(r,s)}else i=mM[r];const s=[];for(;n<t.length;n++){const i=e.parse(t[n],n,Zx);if(!i)return null;s.push(i)}return new _M(i,s)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!iM(this.type,cM(i)))return i;if(e===this.args.length-1)throw new pM(`Expected value to be of type ${tM(this.type)}, but found ${tM(cM(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((t=>t.serialize())))}}var wM=_M;class yM{constructor(t){this.type=Kx,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=t.length-1;++i){const s=t[i];if(r&&"object"==typeof s&&!Array.isArray(s)){r=!1;let t=null;if(s["font-scale"]&&(t=e.parse(s["font-scale"],1,Vx),!t))return null;let i=null;if(s["text-font"]&&(i=e.parse(s["text-font"],1,Qx(jx)),!i))return null;let o=null;if(s["text-color"]&&(o=e.parse(s["text-color"],1,Wx),!o))return null;const a=n[n.length-1];a.scale=t,a.font=i,a.textColor=o}else{const s=e.parse(t[i],1,Zx);if(!s)return null;const o=s.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:s,scale:null,font:null,textColor:null})}}return new yM(n)}evaluate(t){return new aM(this.sections.map((e=>{const i=e.content.evaluate(t);return cM(i)===Jx?new oM("",i,null,null,null):new oM(dM(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class vM{constructor(t){this.type=Jx,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,jx);return i?new vM(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=lM.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const bM={"to-boolean":qx,"to-color":Wx,"to-number":Vx,"to-string":jx};class xM{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const n=bM[i],r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],i,Zx);if(!n)return null;r.push(n)}return new xM(n,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof Nx)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:hM(e[0],e[1],e[2],e[3]),!i))return new Nx(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new pM(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new pM(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?aM.fromString(dM(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?lM.fromString(dM(this.args[0].evaluate(t))):dM(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new yM([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new vM(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}var MM=xM;const kM=["Unknown","Point","LineString","Polygon"];var SM=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?kM[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord,r=i*e-t[0],s=n*e-t[1];return this.featureDistanceData.bearing[0]*r+this.featureDistanceData.bearing[1]*s}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Nx.parse(t)),e}};class EM{constructor(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const i=t[0],n=EM.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,s=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=s.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[n,s]of o){a=new tk(e.registry,e.path,null,e.scope);const o=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],r=Array.isArray(n)?n[e-1]:n.type,s=a.parse(i,1+o.length,r);if(!s){l=!0;break}o.push(s)}if(!l)if(Array.isArray(n)&&n.length!==o.length)a.error(`Expected ${n.length} arguments, but found ${o.length} instead.`);else{for(let t=0;t<o.length;t++){const e=Array.isArray(n)?n[t]:n.type,i=o[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new EM(i,r,s,o)}}if(1===o.length)e.errors.push(...a.errors);else{const i=(o.length?o:s).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(tM).join(", ")})`:`(${tM(e.type)}...)`;var e})).join(" | "),n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],1+n.length);if(!r)return null;n.push(tM(r.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){EM.definitions=e;for(const i in e)t[i]=EM}}var CM=EM;class IM{constructor(t,e,i){this.type=Hx,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,qx);if(!n)return null;const r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,qx);if(!r)return null;let s=null;return i.locale&&(s=e.parse(i.locale,1,jx),!s)?null:new IM(n,r,s)}evaluate(t){return new sM(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const AM=8192;function TM(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function RM(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function PM(t,e){const i=(180+t[0])/360,n=(r=t[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360);var r;const s=Math.pow(2,e.z);return[Math.round(i*s*AM),Math.round(n*s*AM)]}function DM(t,e,i){const n=t[0]-e[0],r=t[1]-e[1],s=t[0]-i[0],o=t[1]-i[1];return n*o-s*r==0&&n*s<=0&&r*o<=0}function FM(t,e,i){return e[1]>t[1]!=i[1]>t[1]&&t[0]<(i[0]-e[0])*(t[1]-e[1])/(i[1]-e[1])+e[0]}function LM(t,e){let i=!1;for(let n=0,r=e.length;n<r;n++){const r=e[n];for(let e=0,n=r.length;e<n-1;e++){if(DM(t,r[e],r[e+1]))return!1;FM(t,r[e],r[e+1])&&(i=!i)}}return i}function OM(t,e){for(let i=0;i<e.length;i++)if(LM(t,e[i]))return!0;return!1}function zM(t,e,i,n){const r=t[0]-i[0],s=t[1]-i[1],o=e[0]-i[0],a=e[1]-i[1],l=n[0]-i[0],h=n[1]-i[1],u=r*h-l*s,c=o*h-l*a;return u>0&&c<0||u<0&&c>0}function NM(t,e,i,n){const r=[e[0]-t[0],e[1]-t[1]];return 0!=(s=[n[0]-i[0],n[1]-i[1]])[0]*(o=r)[1]-s[1]*o[0]&&!(!zM(t,e,i,n)||!zM(i,n,t,e));var s,o}function BM(t,e,i){for(const n of i)for(let i=0;i<n.length-1;++i)if(NM(t,e,n[i],n[i+1]))return!0;return!1}function UM(t,e){for(let i=0;i<t.length;++i)if(!LM(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(BM(t[i],t[i+1],e))return!1;return!0}function GM(t,e){for(let i=0;i<e.length;i++)if(UM(t,e[i]))return!0;return!1}function XM(t,e,i){const n=[];for(let r=0;r<t.length;r++){const s=[];for(let n=0;n<t[r].length;n++){const o=PM(t[r][n],i);TM(e,o),s.push(o)}n.push(s)}return n}function YM(t,e,i){const n=[];for(let r=0;r<t.length;r++){const s=XM(t[r],e,i);n.push(s)}return n}function VM(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let r=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===r&&(r=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=r}TM(e,t)}function jM(t,e,i,n){const r=Math.pow(2,n.z)*AM,s=[n.x*AM,n.y*AM],o=[];if(!t)return o;for(const n of t)for(const t of n){const n=[t.x+s[0],t.y+s[1]];VM(n,e,i,r),o.push(n)}return o}function qM(t,e,i,n){const r=Math.pow(2,n.z)*AM,s=[n.x*AM,n.y*AM],o=[];if(!t)return o;for(const i of t){const t=[];for(const n of i){const i=[n.x+s[0],n.y+s[1]];TM(e,i),t.push(i)}o.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of o)for(const n of t)VM(n,e,i,r)}var a;return o}class WM{constructor(t,e){this.type=qx,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(uM(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new WM(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new WM(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new WM(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const s=XM(e.coordinates,n,r),o=jM(t.geometry(),i,n,r);if(!RM(i,n))return!1;for(const t of o)if(!LM(t,s))return!1}if("MultiPolygon"===e.type){const s=YM(e.coordinates,n,r),o=jM(t.geometry(),i,n,r);if(!RM(i,n))return!1;for(const t of o)if(!OM(t,s))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const s=XM(e.coordinates,n,r),o=qM(t.geometry(),i,n,r);if(!RM(i,n))return!1;for(const t of o)if(!UM(t,s))return!1}if("MultiPolygon"===e.type){const s=YM(e.coordinates,n,r),o=qM(t.geometry(),i,n,r);if(!RM(i,n))return!1;for(const t of o)if(!GM(t,s))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var $M=WM;function ZM(t){if(t instanceof CM){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof $M)return!1;let e=!0;return t.eachChild((t=>{e&&!ZM(t)&&(e=!1)})),e}function HM(t,e){if(t instanceof CM&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!HM(t,e)&&(i=!1)})),i}class KM{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new KM(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var JM=KM;class QM{constructor(t,e=[],i,n=new Xx,r=[]){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(t,e,i,n,r={}){return e?this.concat(e,i,n)._parse(t,r):this._parse(t,r)}_parse(t,e){function i(t,e,i){return"assert"===i?new wM(e,[t]):"coerce"===i?new MM(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=t[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof gM)&&"resolvedImage"!==n.type.kind&&ek(n)){const t=new SM;try{n=new gM(n.type,n.evaluate(t))}catch(t){return this.error(t.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new QM(this.registry,n,e||null,r,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new Ux(i,t))}checkSubtype(t,e){const i=iM(t,e);return i&&this.error(i),i}}var tk=QM;function ek(t){if(t instanceof JM)return ek(t.boundExpression);if(t instanceof CM&&"error"===t.name)return!1;if(t instanceof IM)return!1;if(t instanceof $M)return!1;const e=t instanceof MM||t instanceof wM;let i=!0;return t.eachChild((t=>{i=e?i&&ek(t):i&&t instanceof gM})),!!i&&ZM(t)&&HM(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ik(t,e){const i=t.length-1;let n,r,s=0,o=i,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),n=t[a],r=t[a+1],n<=e){if(a===i||e<r)return a;s=a+1}else{if(!(n>e))throw new pM("Input is not a number.");o=a-1}return 0}class nk{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,Vx);if(!i)return null;const n=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let i=1;i<t.length;i+=2){const s=1===i?-1/0:t[i],o=t[i+1],a=i,l=i+1;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const h=e.parse(o,l,r);if(!h)return null;r=r||h.type,n.push([s,h])}return new nk(r,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[ik(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var rk=nk,sk=ok;function ok(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}ok.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ok.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ok.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ok.prototype.solveCurveX=function(t,e){var i,n,r,s,o;for(void 0===e&&(e=1e-6),r=t,o=0;o<8;o++){if(s=this.sampleCurveX(r)-t,Math.abs(s)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=s/a}if((r=t)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(s=this.sampleCurveX(r),Math.abs(s-t)<e)return r;t>s?i=r:n=r,r=.5*(n-i)+i}return r},ok.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var ak=Ax(sk);function lk(t,e,i){return t*(1-i)+e*i}var hk=Object.freeze({__proto__:null,number:lk,color:function(t,e,i){return new Nx(lk(t.r,e.r,i),lk(t.g,e.g,i),lk(t.b,e.b,i),lk(t.a,e.a,i))},array:function(t,e,i){return t.map(((t,n)=>lk(t,e[n],i)))}});const uk=.95047,ck=1.08883,dk=4/29,fk=6/29,gk=3*fk*fk,pk=fk*fk*fk,mk=Math.PI/180,_k=180/Math.PI;function wk(t){return t>pk?Math.pow(t,1/3):t/gk+dk}function yk(t){return t>fk?t*t*t:gk*(t-dk)}function vk(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function bk(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function xk(t){const e=bk(t.r),i=bk(t.g),n=bk(t.b),r=wk((.4124564*e+.3575761*i+.1804375*n)/uk),s=wk((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*s-16,a:500*(r-s),b:200*(s-wk((.0193339*e+.119192*i+.9503041*n)/ck)),alpha:t.a}}function Mk(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*yk(e),i=uk*yk(i),n=ck*yk(n),new Nx(vk(3.2404542*i-1.5371385*e-.4985314*n),vk(-.969266*i+1.8760108*e+.041556*n),vk(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function kk(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const Sk={forward:xk,reverse:Mk,interpolate:function(t,e,i){return{l:lk(t.l,e.l,i),a:lk(t.a,e.a,i),b:lk(t.b,e.b,i),alpha:lk(t.alpha,e.alpha,i)}}},Ek=function(t){const{l:e,a:i,b:n}=xk(t),r=Math.atan2(n,i)*_k;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},Ck=function(t){const e=t.h*mk,i=t.c;return Mk({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},Ik=function(t,e,i){return{h:kk(t.h,e.h,i),c:lk(t.c,e.c,i),l:lk(t.l,e.l,i),alpha:lk(t.alpha,e.alpha,i)}};class Ak{constructor(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,n){let r=0;if("exponential"===t.name)r=Tk(e,t.base,i,n);else if("linear"===t.name)r=Tk(e,1,i,n);else if("cubic-bezier"===t.name){const s=t.controlPoints;r=new ak(s[0],s[1],s[2],s[3]).solve(Tk(e,1,i,n))}return r}static parse(t,e){let[i,n,r,...s]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Vx),!r)return null;const o=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=Wx:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<s.length;t+=2){const i=s[t],n=s[t+1],r=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(o.length&&o[o.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const h=e.parse(n,l,a);if(!h)return null;a=a||h.type,o.push([i,h])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Ak(a,i,n,r,o):e.error(`Type ${tM(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);const s=ik(e,n),o=e[s],a=e[s+1],l=Ak.interpolationFactor(this.interpolation,n,o,a),h=i[s].evaluate(t),u=i[s+1].evaluate(t);return"interpolate"===this.operator?hk[this.type.kind.toLowerCase()](h,u,l):"interpolate-hcl"===this.operator?Ck(Ik(Ek(h),Ek(u),l)):Sk.reverse(Sk.interpolate(Sk.forward(h),Sk.forward(u),l))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function Tk(t,e,i,n){const r=n-i,s=t-i;return 0===r?0:1===e?s/r:(Math.pow(e,s)-1)/(Math.pow(e,r)-1)}var Rk=Ak;class Pk{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of t.slice(1)){const t=e.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,r.push(t)}const s=n&&r.some((t=>iM(n,t.type)));return new Pk(s?Zx:i,r)}evaluate(t){let e,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(t),i&&i instanceof lM&&!i.available&&(e||(e=i),i=null,n===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var Dk=Pk;class Fk{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let n=1;n<t.length-1;n+=2){const r=t[n];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);const s=e.parse(t[n+1],n+1);if(!s)return null;i.push([r,s])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new Fk(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}var Lk=Fk;class Ok{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Vx),n=e.parse(t[2],2,Qx(e.expectedType||Zx));if(!i||!n)return null;const r=n.type;return new Ok(r.itemType,i,n)}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new pM(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new pM(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new pM(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var zk=Ok;class Nk{constructor(t,e){this.type=qx,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Zx),n=e.parse(t[2],2,Zx);return i&&n?nM(i.type,[qx,jx,Vx,Yx,Zx])?new Nk(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${tM(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!rM(e,["boolean","string","number","null"]))throw new pM(`Expected first argument to be of type boolean, string, number or null, but found ${tM(cM(e))} instead.`);if(!rM(i,["string","array"]))throw new pM(`Expected second argument to be of type array or string, but found ${tM(cM(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Bk=Nk;class Uk{constructor(t,e,i){this.type=Vx,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Zx),n=e.parse(t[2],2,Zx);if(!i||!n)return null;if(!nM(i.type,[qx,jx,Vx,Yx,Zx]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${tM(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Vx);return r?new Uk(i,n,r):null}return new Uk(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!rM(e,["boolean","string","number","null"]))throw new pM(`Expected first argument to be of type boolean, string, number or null, but found ${tM(cM(e))} instead.`);if(!rM(i,["string","array"]))throw new pM(`Expected second argument to be of type array or string, but found ${tM(cM(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Gk=Uk;class Xk{constructor(t,e,i,n,r,s){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=s}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r={},s=[];for(let o=2;o<t.length-1;o+=2){let a=t[o];const l=t[o+1];Array.isArray(a)||(a=[a]);const h=e.concat(o);if(0===a.length)return h.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return h.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return h.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return h.error("Numeric branch labels must be integer values.");if(i){if(h.checkSubtype(i,cM(t)))return null}else i=cM(t);if(void 0!==r[String(t)])return h.error("Branch labels must be unique.");r[String(t)]=s.length}const u=e.parse(l,o,n);if(!u)return null;n=n||u.type,s.push(u)}const o=e.parse(t[1],1,Zx);if(!o)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==o.type.kind&&e.concat(1).checkSubtype(i,o.type)?null:new Xk(i,n,o,r,s,a):null}evaluate(t){const e=this.input.evaluate(t);return(cM(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],n={};for(const t of e){const e=n[this.cases[t]];void 0===e?(n[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,n]of i)1===n.length?t.push(r(n[0])):t.push(n.map(r)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}var Yk=Xk;class Vk{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let r=1;r<t.length-1;r+=2){const s=e.parse(t[r],r,qx);if(!s)return null;const o=e.parse(t[r+1],r+1,i);if(!o)return null;n.push([s,o]),i=i||o.type}const r=e.parse(t[t.length-1],t.length-1,i);return r?new Vk(i,n,r):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var jk=Vk;class qk{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Zx),n=e.parse(t[2],2,Vx);if(!i||!n)return null;if(!nM(i.type,[Qx(Zx),jx,Zx]))return e.error(`Expected first argument to be of type array or string, but found ${tM(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Vx);return r?new qk(i.type,i,n,r):null}return new qk(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!rM(e,["string","array"]))throw new pM(`Expected first argument to be of type array or string, but found ${tM(cM(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Wk=qk;function $k(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Zk(t,e,i,n){return 0===n.compare(e,i)}function Hk(t,e,i){const n="=="!==t&&"!="!==t;return class r{constructor(t,e,i){this.type=qx,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let s=e.parse(t[1],1,Zx);if(!s)return null;if(!$k(i,s.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${tM(s.type)}'.`);let o=e.parse(t[2],2,Zx);if(!o)return null;if(!$k(i,o.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${tM(o.type)}'.`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error(`Cannot compare types '${tM(s.type)}' and '${tM(o.type)}'.`);n&&("value"===s.type.kind&&"value"!==o.type.kind?s=new wM(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new wM(s.type,[o])));let a=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Hx),!a)return null}return new r(s,o,a)}evaluate(r){const s=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const e=cM(s),i=cM(o);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new pM(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=cM(s),i=cM(o);if("string"!==t.kind||"string"!==i.kind)return e(r,s,o)}return this.collator?i(r,s,o,this.collator.evaluate(r)):e(r,s,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const Kk=Hk("==",(function(t,e,i){return e===i}),Zk),Jk=Hk("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!Zk(0,e,i,n)})),Qk=Hk("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),tS=Hk(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),eS=Hk("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),iS=Hk(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class nS{constructor(t,e,i,n,r,s){this.type=jx,this.number=t,this.locale=e,this.currency=i,this.unit=n,this.minFractionDigits=r,this.maxFractionDigits=s}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Vx);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=e.parse(n.locale,1,jx),!r))return null;let s=null;if(n.currency&&(s=e.parse(n.currency,1,jx),!s))return null;let o=null;if(n.unit&&(o=e.parse(n.unit,1,jx),!o))return null;let a=null;if(n["min-fraction-digits"]&&(a=e.parse(n["min-fraction-digits"],1,Vx),!a))return null;let l=null;return n["max-fraction-digits"]&&(l=e.parse(n["max-fraction-digits"],1,Vx),!l)?null:new nS(i,r,s,o,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class rS{constructor(t){this.type=Vx,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${tM(i.type)} instead.`):new rS(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new pM(`Expected value to be of type string or array, but found ${tM(cM(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}const sS={"==":Kk,"!=":Jk,">":tS,"<":Qk,">=":iS,"<=":eS,array:wM,at:zk,boolean:wM,case:jk,coalesce:Dk,collator:IM,format:yM,image:vM,in:Bk,"index-of":Gk,interpolate:Rk,"interpolate-hcl":Rk,"interpolate-lab":Rk,length:rS,let:Lk,literal:gM,match:Yk,number:wM,"number-format":nS,object:wM,slice:Wk,step:rk,string:wM,"to-boolean":MM,"to-color":MM,"to-number":MM,"to-string":MM,var:JM,within:$M};function oS(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const s=r?r.evaluate(t):1,o=hM(e,i,n,s);if(o)throw new pM(o);return new Nx(e/255*s,i/255*s,n/255*s,s)}function aS(t,e){return t in e}function lS(t,e){const i=e[t];return void 0===i?null:i}function hS(t){return{type:t}}CM.register(sS,{error:[{kind:"error"},[jx],(t,[e])=>{throw new pM(e.evaluate(t))}],typeof:[jx,[Zx],(t,[e])=>tM(cM(e.evaluate(t)))],"to-rgba":[Qx(Vx,4),[Wx],(t,[e])=>e.evaluate(t).toArray()],rgb:[Wx,[Vx,Vx,Vx],oS],rgba:[Wx,[Vx,Vx,Vx,Vx],oS],has:{type:qx,overloads:[[[jx],(t,[e])=>aS(e.evaluate(t),t.properties())],[[jx,$x],(t,[e,i])=>aS(e.evaluate(t),i.evaluate(t))]]},get:{type:Zx,overloads:[[[jx],(t,[e])=>lS(e.evaluate(t),t.properties())],[[jx,$x],(t,[e,i])=>lS(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Zx,[jx],(t,[e])=>lS(e.evaluate(t),t.featureState||{})],properties:[$x,[],t=>t.properties()],"geometry-type":[jx,[],t=>t.geometryType()],id:[Zx,[],t=>t.id()],zoom:[Vx,[],t=>t.globals.zoom],pitch:[Vx,[],t=>t.globals.pitch||0],"distance-from-center":[Vx,[],t=>t.distanceFromCenter()],"heatmap-density":[Vx,[],t=>t.globals.heatmapDensity||0],"line-progress":[Vx,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Vx,[],t=>t.globals.skyRadialProgress||0],accumulated:[Zx,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Vx,hS(Vx),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Vx,hS(Vx),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Vx,overloads:[[[Vx,Vx],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Vx],(t,[e])=>-e.evaluate(t)]]},"/":[Vx,[Vx,Vx],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Vx,[Vx,Vx],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Vx,[],()=>Math.LN2],pi:[Vx,[],()=>Math.PI],e:[Vx,[],()=>Math.E],"^":[Vx,[Vx,Vx],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Vx,[Vx],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Vx,[Vx],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Vx,[Vx],(t,[e])=>Math.log(e.evaluate(t))],log2:[Vx,[Vx],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Vx,[Vx],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Vx,[Vx],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Vx,[Vx],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Vx,[Vx],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Vx,[Vx],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Vx,[Vx],(t,[e])=>Math.atan(e.evaluate(t))],min:[Vx,hS(Vx),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[Vx,hS(Vx),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[Vx,[Vx],(t,[e])=>Math.abs(e.evaluate(t))],round:[Vx,[Vx],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Vx,[Vx],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Vx,[Vx],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[qx,[jx,Zx],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[qx,[Zx],(t,[e])=>t.id()===e.value],"filter-type-==":[qx,[jx],(t,[e])=>t.geometryType()===e.value],"filter-<":[qx,[jx,Zx],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[qx,[Zx],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[qx,[jx,Zx],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[qx,[Zx],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[qx,[jx,Zx],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[qx,[Zx],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[qx,[jx,Zx],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[qx,[Zx],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[qx,[Zx],(t,[e])=>e.value in t.properties()],"filter-has-id":[qx,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[qx,[Qx(jx)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[qx,[Qx(Zx)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[qx,[jx,Qx(Zx)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[qx,[jx,Qx(Zx)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:qx,overloads:[[[qx,qx],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[hS(qx),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:qx,overloads:[[[qx,qx],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[hS(qx),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[qx,[qx],(t,[e])=>!e.evaluate(t)],"is-supported-script":[qx,[jx],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[jx,[jx],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[jx,[jx],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[jx,hS(Zx),(t,e)=>e.map((e=>dM(e.evaluate(t)))).join("")],"resolved-locale":[jx,[Hx],(t,[e])=>e.evaluate(t).resolvedLocale()]}),new Set(["in","==","!=",">",">=","<","<=","to-boolean"]),function(){const t=[];for(let e=78271.51696402048;t.length<=24;e/=2)t.push(e)}(),Array(256).join("");let uS=new class{constructor(){let t=new qv;this.OSM_Standard=new Yv,this.Bing_RoadsOnDemand=new Vv({key:t.apikeys.BingMapKey,imagerySet:"RoadOnDemand"}),this.ArcGIS_sample=new jv({url:`https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/styles/arcgis/streets?token=${t.apikeys.ArcGISKey}`,crossOrigin:"Anonymous"}),this.EsriXYZ=new Xv({attributions:'Tiles  <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",maxZoom:19,crossOrigin:"Anonymous"}),this.EsriMaps=new Xv({url:"https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/MapServer/tile/{z}/{y}/{x}"})}};const cS=document.getElementById("imgCanvas1"),dS=document.getElementById("imgCanvas2"),fS=cS.getContext("2d",{willReadFrequently:!0}),gS=dS.getContext("2d",{willReadFrequently:!0});var pS=document.createElement("canvas"),mS=document.createElement("canvas");pS.getContext("2d"),mS.getContext("2d"),new rv,new rv;const _S=document.getElementById("processImgBtn"),wS=document.getElementById("vectorizeBtn"),yS=(document.getElementById("compareBtn"),document.getElementById("downloadVector")),vS=document.getElementById("imageCov"),bS=document.getElementById("extentBox"),xS=document.getElementById("zoomLevel"),MS=document.getElementById("FeatureType"),kS=document.getElementById("MapType1"),SS=document.getElementById("MapType2"),ES=document.getElementById("processOptions");let CS,IS,AS,TS,RS,PS,DS,FS=!1,LS=!1,OS=!1,zS=!1,NS=!1,BS=!1;MS.addEventListener("change",(t=>{"1"===MS.value?Qv(ES):"2"===MS.value?(Qv(ES),function(t){$v.append(Zv,Hv,Kv),t.append($v)}(ES)):"3"===MS.value&&(Qv(ES),function(t){let e=Jv("ER_KER_SIZ_1",3,""),i=Jv("ER_ITER_1",3,""),n=Jv("WIN_MIN_SIZ_1",25,""),r=Jv("WIN_MAX_SIZ_1",31,""),s=Jv("ER_KER_SIZ_2",3,""),o=Jv("ER_ITER_2",3,""),a=Jv("WIN_MIN_SIZ_2",25,""),l=Jv("WIN_MAX_SIZ_2",31,"");$v.append(Zv,Hv,e,i,n,r,Kv,s,o,a,l),t.append($v)}(ES))})),_S.addEventListener("click",(t=>{if("1"===MS.value)alert("Choose a feature type from drop down");else if("2"===MS.value){if(!0===FS){let t=fS.getImageData(0,0,cS.width,cS.height);CS=Ga(t,cS),OS=!0}if(!0===LS){let t=gS.getImageData(0,0,dS.width,dS.height);IS=Ga(t,dS),zS=!0}}else if("3"===MS.value){if(!0===FS){let t=parseInt(sessionStorage.getItem("ER_KER_SIZ_1")),e=parseInt(sessionStorage.getItem("ER_ITER_1")),i=fS.getImageData(0,0,cS.width,cS.height);AS=function(t,e,i){let n=function(t,e,i){let n=cv.matFromImageData(t);console.log(n);let r=new cv.Mat,s=cv.Mat.ones(e,e,cv.CV_8U),o=new cv.Point(-1,-1);return cv.erode(n,r,s,o,i,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),n.delete(),s.delete(),r}(t,e,i),r=Xa(t),s=new Uint8ClampedArray(n.data.length);for(let t=0,e=0;n.data.length,e<r.data.length;t+=4,e++)s[t]=n.data[t],s[t+1]=r.data[e],s[t+3]=255;return new ImageData(s,300,300)}(i,t,e),OS=!0,fS.putImageData(AS,0,0)}!0===LS&&gS.getImageData(0,0,dS.width,dS.height)}})),wS.addEventListener("click",(t=>{if("2"===MS.value){if(!0===OS){let t=PS.getView().calculateExtent(PS.getSize());TS=_v(CS,cS.width,cS.height,t),NS=!0;let e=Ix(TS);PS.addLayer(e),OS=!1,console.log(PS.getLayers())}else alert("Process image from map1 before vectorizing");if(!0===zS){let t=DS.getView().calculateExtent(DS.getSize());RS=_v(IS,dS.width,dS.height,t),BS=!0;let e=Ix(RS);PS.addLayer(e),zS=!1}}else if("3"===MS.value)if(!0===OS){let t=PS.getView().calculateExtent(PS.getSize()),e=function(t,e,i,n){let r,s=[],o=!0,a=[],l=[],h=0,u=[],c=[],d=(n[2]-n[0])/e,f=(n[3]-n[1])/i;for(let e=0;e<t.length;e+=4)s.push(t[e]),u.push(t[e+1]);for(let t=0;t<s.length;t++)if(255===s[t]){let i=t%e,n=Math.floor(t/e);t:for(let r=25;r<=31;r+=2){let o=[],a=r,l=0,h=eb(r);for(let t=0-Math.floor(a/2);t<=Math.floor(a/2);t++){let r,s;for(let l=0-Math.floor(a/2);l<=Math.floor(a/2);l++){r=i+t,s=n+l;let a=s*e+r;o.push(u[a])}}for(let t=0;t<r;t++)for(let e=0;e<r;e++)h[t][e]*o[t*r+e]==255&&(l+=1);if(l>=8){c.push(t),s[t]=0;break t}}}let g=new Uint8ClampedArray(t.length);for(let t=0,e=0;t<g.length;t+=4,e++)g[t]=s[e],g[t+1]=0,g[t+2]=0,g[t+3]=255;let p=new ImageData(g,e,i),m=0;for(let t=0;t<s.length;t++)255===s[t]&&(m+=1);function _(){let t;for(let i=0;i<s.length;i++)if(255===s[i]){t=[i%e,Math.floor(i/e)];break}return t}function w(t){a.push(t),console.log(t,"ip");for(let t=0;t<m&&void 0!==a[t];t++){let i=a[t][0],n=a[t][1],r=n*e+i,o=tb([i,n],3),l=[];for(let t=0;t<o.length;t++){let i,n=o[t][0],a=o[t][1];n>=0&&a>=0&&(i=a*e+n),255===s[i]&&(l.push([n,a]),s[r]=0)}for(let t=0;t<l.length;t++){let e=!1;for(let i=0;i<a.length;i++){if(l[t][0]===a[i][0]&&l[t][1]===a[i][1]){e=!0;break}e=!1}!1===e&&a.push(l[t])}}console.log(a,"la"),a.length>=30?(l.push(a),h+=1,a=[]):a=[]}for(;o;){if(r=_(),void 0===r){o=!1;break}w(r)}let y=function(t,e,i,n,r){let s={type:"FeatureCollection",name:"junctions",crs:{type:"name",properties:{name:"EPSG:3857"}},features:[]},o=new Array(t.length);for(let s in t){let a=t[s]%e,l=Math.floor(t[s]/e),h=i[0]+a*n,u=i[3]-l*r;o[s]={x:h,y:u}}let a=(0,yv.b)().eps(10).minPts(1).distance("EUCLIDEAN").data(o),l=(a(),a.getClusters());for(let t=0;t<l.length;t++){let e=[l[t].x,l[t].y];s.features.push({type:"Feature",geometry:{type:"Point",coordinates:e},proprties:{prop:""}})}return s}(c,e,n,d,f),v=function(t,e,i,n,r){let s={type:"FeatureCollection",name:"lines",crs:{type:"name",properties:{name:"EPSG:3857"}},features:[]};for(let e=0;e<t.length;e++){let o=[];for(let s=0;s<t[e].length;s+=3){let a=t[e][s][0],l=t[e][s][1],h=[i[0]+a*n,i[3]-l*r];o.push(h)}s.features.push({type:"Feature",geometry:{type:"LineString",coordinates:o},proprties:{prop:""}})}return s}(l,0,n,d,f);return console.log(h,v,"jjffj"),[y,v,p]}(AS.data,300,300,t);TS=e[0],NS=!0;let i=Ix(TS),n=Ix(e[1]);PS.addLayer(i),PS.addLayer(n),fS.putImageData(e[2],0,0),OS=!1,Qv(ES)}else alert("Process image from map1 before vectorizing")})),yS.addEventListener("click",(t=>{var e,i;!0===NS?(e=JSON.stringify(TS),(i=document.createElement("a")).setAttribute("href","data:application/json;charset=utf-8, "+encodeURIComponent(e)),i.setAttribute("download","layer.geojson"),document.body.appendChild(i),i.click(),document.body.removeChild(i)):alert("Generate vector file before downloading")})),vS.addEventListener("click",(t=>{if(!0===FS&&!0===FS){let t=fS.getImageData(0,0,cS.width,cS.height),e=gS.getImageData(0,0,dS.width,dS.height);Xa(t),Xa(e);let i=fS.getImageData(0,0,cS.width,cS.height),n=gS.getImageData(0,0,dS.width,dS.height);console.log(i,n),function(t,e){let i=sc(t.data),n=sc(e.data),r=new Array(i.length),s=new Array(n.length);for(let t=0;t<i.length;t++)i[t][0]&&i[t][1]&&255===i[t][2]?r[t]=255:r[t]=0;for(let t=0;t<n.length;t++)n[t][0]&&n[t][1]&&255===n[t][2]?s[t]=255:s[t]=0;let o=[r,s],a=o.length,l=new Array(a*a);for(let t=0;t<a;t++)for(let e=0;e<a;e++){let i=0,n=o[t],r=o[e],s=n.length,a=n.reduce(((t,e)=>t+e))/s,h=r.reduce(((t,e)=>t+e))/s;for(let t=0;t<s;t++)i+=(n[t]-a)*(r[t]-h)/s;l.push(i)}let h=Math.min(...l),u=Math.max(...l);console.log(h,u,l)}(i,n)}else alert("Select features from both maps")}));let US={1:uS.OSM_Standard,2:uS.Bing_RoadsOnDemand,3:uS.EsriXYZ,4:uS.ArcGIS_sample,5:uS.EsriMaps};!function(t,e){const i=new en({center:[8687373.06,3544749.53],zoom:13,constrainResolution:!0});PS=new ia({layers:[new ka({source:t})],view:i,target:"map1"}),DS=new ia({layers:[new ka({source:e})],view:i,target:"map2"}),bS.textContent="Extent: "+PS.getView().calculateExtent(PS.getSize()),xS.textContent="Zoom Level: "+PS.getView().getZoom(),PS.on("moveend",(t=>{Wv(PS,cS,fS),!0===NS&&(CS=void 0,TS=void 0,NS=!1),bS.textContent="Extent: "+PS.getView().calculateExtent(PS.getSize()),xS.textContent="Zoom Level: "+PS.getView().getZoom()})),DS.on("moveend",(t=>{Wv(DS,dS,gS),!0===BS&&(IS=void 0,RS=void 0,BS=!1)})),PS.on("click",(t=>{let e=fS.getImageData(0,0,cS.width,cS.height);console.log(oc(t.pixel,e.data,300));let i=fv(e,oc(t.pixel,e.data,300),0);fS.putImageData(i,0,0),FS=!0})),DS.on("click",(t=>{let e=gS.getImageData(0,0,dS.width,dS.height),i=fv(e,oc(t.pixel,e.data,300),0);gS.putImageData(i,0,0),LS=!0}))}(US[1],US[2]),kS.addEventListener("change",(t=>{})),SS.addEventListener("change",(t=>{}))})()})();